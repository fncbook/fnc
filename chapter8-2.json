{"kind":"Notebook","sha256":"b7f1b6482bc107279816892fa2d7898625f353109f113d414aa8ac9db8b4c5b4","slug":"chapter8-2","location":"/python/chapter8.md","dependencies":[],"frontmatter":{"title":"Chapter 8","numbering":{"heading_1":{"enabled":false},"heading_2":{"enabled":false},"heading_3":{"enabled":false},"heading_4":{"enabled":false},"heading_5":{"enabled":false},"heading_6":{"enabled":false}},"kernelspec":{"name":"python3","display_name":"Python 3","language":"python"},"content_includes_title":false,"authors":[{"nameParsed":{"literal":"Tobin A. Driscoll","given":"Tobin A.","family":"Driscoll"},"name":"Tobin A. Driscoll","email":"driscoll@udel.edu","id":"contributors-myst-generated-uid-0","corresponding":true},{"nameParsed":{"literal":"Richard J. Braun","given":"Richard J.","family":"Braun"},"name":"Richard J. Braun","id":"contributors-myst-generated-uid-1"}],"github":"https://github.com/fncbook/fnc","math":{"\\float":{"macro":"\\mathbb{F}"},"\\real":{"macro":"\\mathbb{R}"},"\\complex":{"macro":"\\mathbb{C}"},"\\nat":{"macro":"\\mathbb{N}"},"\\integer":{"macro":"\\mathbb{Z}"},"\\rmn":{"macro":"\\mathbb{R}^{#1 \\times #2}"},"\\dd":{"macro":"\\frac{d #1}{d #2}"},"\\ddd":{"macro":"\\frac{d^2 #1}{d #2^2}"},"\\pp":{"macro":"\\frac{\\partial #1}{\\partial #2}"},"\\ppp":{"macro":"\\frac{\\partial^2 #1}{\\partial #2^2}"},"\\ppdd":{"macro":"\\frac{\\partial^2 #1}{\\partial #2 \\partial #3}"},"\\abs":{"macro":"\\left\\lvert #1 \\right\\rvert"},"\\norm":{"macro":"\\left\\lVert #1 \\right\\rVert"},"\\twonorm":{"macro":"\\norm{#1}_2"},"\\onenorm":{"macro":"\\norm{#1}_1"},"\\infnorm":{"macro":"\\norm{#1}_\\infty"},"\\anynorm":{"macro":"\\norm{#1}_#2"},"\\innerprod":{"macro":"\\langle #1,#2 \\rangle"},"\\pr":{"macro":"^{(#1)}"},"\\kron":{"macro":"#1 \\otimes #2"},"\\eye":{"macro":"\\mathbf{e}_#1"},"\\meye":{"macro":"\\mathbf{I}"},"\\Qhat":{"macro":"\\hat{\\mathbf{Q}}"},"\\Rhat":{"macro":"\\hat{\\mathbf{R}}"},"\\bfalpha":{"macro":"\\mathbf{alpha}"},"\\bfdelta":{"macro":"\\mathbf{delta}"},"\\bfzero":{"macro":"\\boldsymbol{0}"},"\\macheps":{"macro":"\\epsilon_\\text{mach}"},"\\fl":{"macro":"\\operatorname{fl}"},"\\diag":{"macro":"\\operatorname{diag}"},"\\ign":{"macro":"\\operatorname{sign}"},"\\Re":{"macro":"\\operatorname{Re}"},"\\Im":{"macro":"\\operatorname{Im}"},"\\ee":{"macro":"\\times 10^"},"\\lnorm":{"macro":"\\|"},"\\rnorm":{"macro":"\\|"},"\\floor":{"macro":"\\lfloor#1\\rfloor"},"\\cI":{"macro":"\\mathcal{I}"},"\\mtx":{"macro":"\\operatorname{mtx}"},"\\myvec":{"macro":"\\operatorname{vec}"},"\\argmin":{"macro":"\\operatorname{argmin}"}},"abbreviations":{"IVP":"initial-value problem","BVP":"boundary-value problem","ONC":"matrix with orthonormal columns","SVD":"singular value decomposition","EVD":"eigenvalue decomposition","SPD":"symmetric positive definite","HPD":"hermitian positive definite","PDE":"partial differential equation","ODE":"ordinary differential equation"},"exports":[{"format":"md","filename":"chapter8.md","url":"fncbook.com/build/chapter8-3a52b7383359d6a1a067ffb75760eb64.md"}]},"mdast":{"type":"root","children":[{"type":"block","children":[{"type":"heading","depth":2,"position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"children":[{"type":"text","value":"Functions","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"key":"KguKQKmoin"}],"identifier":"functions","label":"Functions","html_id":"functions","implicit":true,"key":"Zl1jms0DGs"},{"type":"details","open":true,"children":[{"type":"summary","children":[{"type":"text","value":"Power iteration","position":{"start":{"line":14,"column":1},"end":{"line":14,"column":1}},"key":"NPByk1Tw4Z"}],"key":"K0ioE50LRX"},{"type":"include","file":"fncbook/fncbook/chapter08.py","literal":true,"filter":{"startAt":"def poweriter","endAt":"return gamma, x"},"children":[{"type":"code","value":"def poweriter(A, numiter):\n    \"\"\"\n    poweriter(A, numiter)\n\n    Perform numiter power iterations with the matrix A, starting from a random vector, \n    and return a vector of eigenvalue estimates and the final eigenvector approximation.\n    \"\"\"\n    n = A.shape[0]\n    x = np.random.randn(n)\n    x = x / np.linalg.norm(x, np.inf)\n    gamma = np.zeros(numiter)\n    for k in range(numiter):\n        y = A @ x\n        m = np.argmax(abs(y))\n        gamma[k] = y[m] / x[m]\n        x = y / y[m]\n\n    return gamma, x","lang":"python","showLineNumbers":true,"filename":"poweriter.py","key":"UbJ6tdyb8O"}],"key":"PoGy6XzS1Q"}],"label":"function-poweriter-python","identifier":"function-poweriter-python","html_id":"function-poweriter-python","key":"VxhbJy24q0"},{"type":"details","open":true,"children":[{"type":"summary","children":[{"type":"text","value":"Inverse iteration","position":{"start":{"line":26,"column":1},"end":{"line":26,"column":1}},"key":"vz4xSHfmwW"}],"key":"koYHDGxAAI"},{"type":"include","file":"fncbook/fncbook/chapter08.py","literal":true,"filter":{"startAt":"def inviter","endAt":"return gamma, x"},"children":[{"type":"code","value":"def inviter(A, s, numiter):\n    \"\"\"\n    inviter(A, s, numiter)\n\n    Perform numiter inverse iterations with the matrix A and shift s, starting\n    from a random vector, and return a vector of eigenvalue estimates and the final\n    eigenvector approximation.\n    \"\"\"\n    n = A.shape[0]\n    x = np.random.randn(n)\n    x = x / np.linalg.norm(x, np.inf)\n    gamma = np.zeros(numiter)\n    PL, U = lu(A - s * np.eye(n), permute_l=True)\n    for k in range(numiter):\n        y = np.linalg.solve(U, np.linalg.solve(PL, x))\n        m = np.argmax(abs(y))\n        gamma[k] = x[m] / y[m] + s\n        x = y / y[m]\n\n    return gamma, x","lang":"python","showLineNumbers":true,"filename":"inviter.py","key":"RtGnrBsU6V"}],"key":"yg90JoOufb"}],"label":"function-inviter-python","identifier":"function-inviter-python","html_id":"function-inviter-python","key":"t27olix3Si"},{"type":"details","open":true,"children":[{"type":"summary","children":[{"type":"text","value":"Arnoldi iteration","position":{"start":{"line":38,"column":1},"end":{"line":38,"column":1}},"key":"kcgKisKrDJ"}],"key":"XFWeSPqm6M"},{"type":"include","file":"fncbook/fncbook/chapter08.py","literal":true,"filter":{"startAt":"def arnoldi","endAt":"return Q, H"},"children":[{"type":"code","value":"def arnoldi(A, u, m):\n    \"\"\"\n    arnoldi(A, u, m)\n\n    Perform the Arnoldi iteration for A starting with vector u, out to the Krylov\n    subspace of degree m. Return the orthonormal basis (m+1 columns) and the upper\n    Hessenberg H of size m+1 by m.\n    \"\"\"\n    n = u.size\n    Q = np.zeros([n, m + 1])\n    H = np.zeros([m + 1, m])\n    Q[:, 0] = u / np.linalg.norm(u)\n    for j in range(m):\n        # Find the new direction that extends the Krylov subspace.\n        v = A @ Q[:, j]\n        # Remove the projections onto the previous vectors.\n        for i in range(j + 1):\n            H[i, j] = Q[:, i] @ v\n            v -= H[i, j] * Q[:, i]\n        # Normalize and store the new basis vector.\n        H[j + 1, j] = np.linalg.norm(v)\n        Q[:, j + 1] = v / H[j + 1, j]\n\n    return Q, H","lang":"python","showLineNumbers":true,"filename":"arnoldi.py","key":"tRCFjnN8T3"}],"key":"yLAMN3SBNE"},{"type":"admonition","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"About the code","position":{"start":{"line":48,"column":1},"end":{"line":48,"column":1}},"key":"EpzpSrKRTd"}],"key":"XkFFcQe2cl"},{"type":"paragraph","position":{"start":{"line":49,"column":1},"end":{"line":49,"column":1}},"children":[{"type":"text","value":"The loop starting at line 17 does not exactly implement ","position":{"start":{"line":49,"column":1},"end":{"line":49,"column":1}},"key":"oRnw60xDpP"},{"type":"crossReference","kind":"equation","identifier":"arnoldiip","label":"arnoldiip","children":[{"type":"text","value":"(","key":"IX305daSJg"},{"type":"text","value":"8.4.7","key":"lyAyYQB9bx"},{"type":"text","value":")","key":"lcjjULfEEA"}],"template":"(%s)","enumerator":"8.4.7","resolved":true,"html_id":"arnoldiip","remote":true,"url":"/subspace","dataUrl":"/subspace.json","key":"Zptzro5sFF"},{"type":"text","value":" and ","position":{"start":{"line":49,"column":1},"end":{"line":49,"column":1}},"key":"VfoPFOYrt0"},{"type":"crossReference","kind":"equation","identifier":"arnoldigs","label":"arnoldigs","children":[{"type":"text","value":"(","key":"nE0Rfbx6ZL"},{"type":"text","value":"8.4.8","key":"yynHAcEVak"},{"type":"text","value":")","key":"cTfMuAVgZm"}],"template":"(%s)","enumerator":"8.4.8","resolved":true,"html_id":"arnoldigs","remote":true,"url":"/subspace","dataUrl":"/subspace.json","key":"i9xmB8gll6"},{"type":"text","value":". The reason is numerical stability. Though the described and implemented versions are mathematically equivalent in exact arithmetic (see ","position":{"start":{"line":49,"column":1},"end":{"line":49,"column":1}},"key":"UUXwGWyJi0"},{"type":"crossReference","position":{"start":{"line":49,"column":1},"end":{"line":49,"column":1}},"children":[{"type":"text","value":"Exercise 6","position":{"start":{"line":49,"column":1},"end":{"line":49,"column":1}},"key":"BxsC5aBJMV"}],"identifier":"problem-subspace-modifiedgs","label":"problem-subspace-modifiedgs","kind":"list","template":"List","resolved":true,"html_id":"problem-subspace-modifiedgs","remote":true,"url":"/subspace","dataUrl":"/subspace.json","key":"ZGS789e9pn"},{"type":"text","value":"), the approach in ","position":{"start":{"line":49,"column":1},"end":{"line":49,"column":1}},"key":"On4qLjyXTh"},{"type":"crossReference","kind":"proof:algorithm","identifier":"function-arnoldi","label":"function-arnoldi","children":[{"type":"text","value":"Function ","key":"wYa20sfWdV"},{"type":"text","value":"8.4.2","key":"kNsyYMgNDK"}],"template":"Algorithm %s","enumerator":"8.4.2","resolved":true,"html_id":"function-arnoldi","remote":true,"url":"/subspace","dataUrl":"/subspace.json","key":"nAc1XGVok2"},{"type":"text","value":" is more stable.","position":{"start":{"line":49,"column":1},"end":{"line":49,"column":1}},"key":"mq1F8hcQbO"}],"key":"D8T6zDb8zL"}],"key":"cya01wE57i"}],"label":"function-arnoldi-python","identifier":"function-arnoldi-python","html_id":"function-arnoldi-python","key":"CktOMWrYln"},{"type":"details","open":true,"children":[{"type":"summary","children":[{"type":"text","value":"GMRES","position":{"start":{"line":54,"column":1},"end":{"line":54,"column":1}},"key":"oOCHhroKnC"}],"key":"vfWjxezpl5"},{"type":"include","file":"fncbook/fncbook/chapter08.py","literal":true,"filter":{"startAt":"def gmres","endAt":"return x, residual"},"children":[{"type":"code","value":"def gmres(A, b, m):\n    \"\"\"\n    gmres(A, b, m)\n\n    Do m iterations of GMRES for the linear system A*x=b. Return the final solution\n    estimate x and a vector with the history of residual norms. (This function is for\n    demo only, not practical use.)\n    \"\"\"\n    n = len(b)\n    Q = np.zeros([n, m + 1])\n    Q[:, 0] = b / np.linalg.norm(b)\n    H = np.zeros([m + 1, m])\n\n    # Initial \"solution\" is zero.\n    residual = np.hstack([np.linalg.norm(b), np.zeros(m)])\n\n    for j in range(m):\n        # Next step of Arnoldi iteration.\n        v = A @ Q[:, j]\n        for i in range(j + 1):\n            H[i, j] = Q[:, i] @ v\n            v -= H[i, j] * Q[:, i]\n        H[j + 1, j] = np.linalg.norm(v)\n        Q[:, j + 1] = v / H[j + 1, j]\n\n        # Solve the minimum residual problem.\n        r = np.hstack([np.linalg.norm(b), np.zeros(j + 1)])\n        z = np.linalg.lstsq(H[:j + 2, :j + 1], r)[0]\n        x = Q[:, :j + 1] @ z\n        residual[j + 1] = np.linalg.norm(A @ x - b)\n\n    return x, residual","lang":"python","showLineNumbers":true,"filename":"gmres.py","key":"YNcsNdRjaa"}],"key":"zC0et5qzoP"}],"label":"function-gmres-python","identifier":"function-gmres-python","html_id":"function-gmres-python","key":"JoGpe1IZhA"},{"type":"heading","depth":2,"position":{"start":{"line":65,"column":1},"end":{"line":65,"column":1}},"children":[{"type":"text","value":"Examples","position":{"start":{"line":65,"column":1},"end":{"line":65,"column":1}},"key":"xAUC9UV3VM"}],"identifier":"examples","label":"Examples","html_id":"examples","implicit":true,"key":"ItpK18xXsW"}],"key":"NSJYHRfABc"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"exec(open(\"FNC_init.py\").read())","visibility":"show","key":"X62Dvs6uhs"},{"type":"output","id":"5dPY4Cl1ncvXQRucY08YY","data":[],"visibility":"show","key":"J9gcVOoreq"}],"data":{"tags":[]},"visibility":"remove","key":"FTrw8usVEn"},{"type":"block","children":[{"type":"heading","depth":3,"position":{"start":{"line":72,"column":1},"end":{"line":72,"column":1}},"children":[{"type":"text","value":"8.1 ","position":{"start":{"line":72,"column":1},"end":{"line":72,"column":1}},"key":"A4UQQ9cHhd"},{"type":"link","identifier":"section-krylov-structure","label":"section-krylov-structure","kind":"narrative","position":{"start":{"line":72,"column":5},"end":{"line":72,"column":30}},"url":"/structure-1","internal":true,"dataUrl":"/structure-1.json","children":[{"type":"text","value":"Sparsity and structure","key":"bboz5W6g1y"}],"key":"WaWDrq9GEn"}],"identifier":"id-8-1","label":"8.1 ","html_id":"id-8-1","implicit":true,"key":"NySV6qiAoQ"},{"type":"details","open":true,"children":[{"type":"summary","children":[{"type":"crossReference","identifier":"demo-structure-sparse","label":"demo-structure-sparse","kind":"proof:example","position":{"start":{"line":75,"column":1},"end":{"line":75,"column":23}},"children":[{"type":"text","value":"Example ","key":"OUX7V6nTSQ"},{"type":"text","value":"8.1.1","key":"L7tZY5WDHK"}],"template":"Example %s","enumerator":"8.1.1","resolved":true,"html_id":"demo-structure-sparse","remote":true,"url":"/structure-1","dataUrl":"/structure-1.json","key":"DjYu0tZvJo"}],"key":"O82Ss6oAKB"},{"type":"admonition","kind":"tip","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"Tip","key":"mBl0O12R6w"}],"key":"RfdkFfKdS0"},{"type":"paragraph","position":{"start":{"line":78,"column":1},"end":{"line":78,"column":1}},"children":[{"type":"text","value":"Functions to work with sparse matrices are found in the ","position":{"start":{"line":78,"column":1},"end":{"line":78,"column":1}},"key":"IXnHS6omVC"},{"type":"inlineCode","value":"scipy.sparse","position":{"start":{"line":78,"column":1},"end":{"line":78,"column":1}},"key":"fn7NqxWCan"},{"type":"text","value":" module.","position":{"start":{"line":78,"column":1},"end":{"line":78,"column":1}},"key":"hENO8Ll76W"}],"key":"oTd9SUAxnj"}],"key":"nvk0BqnoBl"},{"type":"paragraph","position":{"start":{"line":81,"column":1},"end":{"line":81,"column":1}},"children":[{"type":"text","value":"Here we load the adjacency matrix of a graph with 2790 nodes. Each node is a web page referring to Roswell, NM, and the edges represent links between web pages. (Credit goes to Panayiotis Tsaparas and the University of Toronto for making this data public.)","position":{"start":{"line":81,"column":1},"end":{"line":81,"column":1}},"key":"nIBVvnmUPP"}],"key":"sw3pcnikgu"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"import scipy.sparse as sp\nfrom scipy.io import loadmat\n\nvars = loadmat(\"roswelladj.mat\")    # get from the book's website\nA = sp.csr_matrix(vars[\"A\"])","key":"WNzq5mowkY"},{"type":"output","id":"PG8SMrkdzurq0lUIrzXHV","data":[],"key":"jJlbTk7dDP"}],"data":{},"key":"wA93WlaLAa"},{"type":"paragraph","position":{"start":{"line":91,"column":1},"end":{"line":91,"column":1}},"children":[{"type":"text","value":"We may define the density of ","position":{"start":{"line":91,"column":1},"end":{"line":91,"column":1}},"key":"pKsVMZTVqI"},{"type":"inlineMath","value":"\\mathbf{A}","position":{"start":{"line":91,"column":1},"end":{"line":91,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi mathvariant=\"bold\">A</mi></mrow><annotation encoding=\"application/x-tex\">\\mathbf{A}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6861em;\"></span><span class=\"mord mathbf\">A</span></span></span></span>","key":"aT6Kdq0GeH"},{"type":"text","value":" as the number of nonzeros divided by the total number of entries.","position":{"start":{"line":91,"column":1},"end":{"line":91,"column":1}},"key":"wyFW4mbRnr"}],"key":"r9st879RuT"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"m, n = A.shape\nprint(f\"density is {A.nnz / (m * n):.3%}\")","key":"yYqAzezvgL"},{"type":"output","id":"u6WJdnRYQRWvsAP_2CwRC","data":[{"output_type":"stream","name":"stdout","text":"density is 0.109%\n"}],"key":"sbNwxNNPHf"}],"data":{},"indexEntries":[{"entry":"Python","subEntry":{"value":"nnz","kind":"entry"},"emphasis":true}],"label":"index-hYOCMzT4Ia","identifier":"index-hyocmzt4ia","html_id":"index-hyocmzt4ia","key":"CgC6T54GsT"},{"type":"paragraph","position":{"start":{"line":101,"column":1},"end":{"line":101,"column":1}},"children":[{"type":"text","value":"We can compare the storage space needed for the sparse ","position":{"start":{"line":101,"column":1},"end":{"line":101,"column":1}},"key":"zYm7Fawu3U"},{"type":"inlineMath","value":"\\mathbf{A}","position":{"start":{"line":101,"column":1},"end":{"line":101,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi mathvariant=\"bold\">A</mi></mrow><annotation encoding=\"application/x-tex\">\\mathbf{A}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6861em;\"></span><span class=\"mord mathbf\">A</span></span></span></span>","key":"D9FDKdlKKj"},{"type":"text","value":" with the space needed for its dense / full counterpart.","position":{"start":{"line":101,"column":1},"end":{"line":101,"column":1}},"key":"ieILaYt1Qc"}],"key":"mekZ5IJNHZ"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"F = A.todense()\nprint(f\"{A.data.nbytes/1e6:.3f} MB for sparse form, {F.nbytes/1e6:.3f} MB for dense form\")","key":"ghGFa5Dtpi"},{"type":"output","id":"revoVZlbx8D9HafWI8uMS","data":[{"output_type":"stream","name":"stdout","text":"0.068 MB for sparse form, 62.273 MB for dense form\n"}],"key":"Qf5w4D1E0O"}],"data":{},"key":"sYeCy3nsYy"},{"type":"paragraph","position":{"start":{"line":109,"column":1},"end":{"line":109,"column":1}},"children":[{"type":"text","value":"Matrix-vector products are also much faster using the sparse form because operations with structural zeros are skipped.","position":{"start":{"line":109,"column":1},"end":{"line":109,"column":1}},"key":"kV0Jx4xtjU"}],"key":"VK5WgVO494"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"from timeit import default_timer as timer\nx = random.randn(n)\nstart = timer()\nfor i in range(1000):\n    A @ x\nprint(f\"sparse time: {timer() - start:.4g} sec\")","key":"cMKYDvIZzi"},{"type":"output","id":"JY7Qa9bbMlzy08JA3L21s","data":[{"output_type":"stream","name":"stdout","text":"sparse time: 0.01756 sec\n"}],"key":"ibk9NeaUP4"}],"data":{},"key":"x8hploYdMq"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"start = timer()\nfor i in range(1000):\n    F @ x\nprint(f\"dense time: {timer() - start:.4g} sec\")","key":"Ny63zW29Hf"},{"type":"output","id":"bA9FpGb5cjRJrs7Eg9r9k","data":[{"output_type":"stream","name":"stdout","text":"dense time: 14.12 sec\n"}],"key":"o8WFS0GTxq"}],"data":{},"key":"gKFKejVISM"}],"label":"demo-structure-sparse-python","identifier":"demo-structure-sparse-python","html_id":"demo-structure-sparse-python","key":"d6D1aYhR3D"},{"type":"details","open":true,"children":[{"type":"summary","children":[{"type":"crossReference","identifier":"demo-structure-fill","label":"demo-structure-fill","kind":"proof:example","position":{"start":{"line":129,"column":1},"end":{"line":129,"column":21}},"children":[{"type":"text","value":"Example ","key":"XquTtY6AM1"},{"type":"text","value":"8.1.2","key":"oXwlyBN22J"}],"template":"Example %s","enumerator":"8.1.2","resolved":true,"html_id":"demo-structure-fill","remote":true,"url":"/structure-1","dataUrl":"/structure-1.json","key":"Zk5WVQLB5Q"}],"key":"KUtDJnAz0L"},{"type":"paragraph","position":{"start":{"line":132,"column":1},"end":{"line":132,"column":1}},"children":[{"type":"text","value":"Here is the adjacency matrix of a graph representing a small-world network, featuring connections to neighbors and a small number of distant contacts.","position":{"start":{"line":132,"column":1},"end":{"line":132,"column":1}},"key":"BuBGSapC80"}],"key":"ZsylRsqRXW"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"import networkx as nx\nwsg = nx.watts_strogatz_graph(200, 4, 0.02)","key":"L5iOPR7OEK"},{"type":"output","id":"ionMf5525PUDcvmFCFBXF","data":[],"key":"AUoGLvjLs0"}],"data":{},"key":"R1tKOhn640"},{"type":"paragraph","position":{"start":{"line":139,"column":1},"end":{"line":139,"column":1}},"children":[{"type":"text","value":"Because each node connects to relatively few others, the adjacency matrix is quite sparse.","position":{"start":{"line":139,"column":1},"end":{"line":139,"column":1}},"key":"Pu6ERyy2zC"}],"key":"Q9SAVhqGY7"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"A = nx.adjacency_matrix(wsg)\nspy(A)\ntitle(\"Adjacency matrix $A$\");","key":"FTc0ioXTSi"},{"type":"output","id":"MGbEYFczlVAIUIZKlo0dC","data":[{"output_type":"display_data","metadata":{},"data":{"text/plain":{"content":"<Figure size 700x400 with 1 Axes>","content_type":"text/plain"},"image/png":{"content_type":"image/png","hash":"d4605993dac9b3ca4669b5e7f89ce3c1","path":"fncbook.com/build/d4605993dac9b3ca4669b5e7f89ce3c1.png"}}}],"key":"Ppb6gAECRj"}],"data":{},"key":"ePEw0TJl0E"},{"type":"paragraph","position":{"start":{"line":147,"column":1},"end":{"line":147,"column":1}},"children":[{"type":"text","value":"By ","position":{"start":{"line":147,"column":1},"end":{"line":147,"column":1}},"key":"bjfIVStoRh"},{"type":"crossReference","kind":"proof:theorem","identifier":"theorem-insight-adjmat","label":"theorem-insight-adjmat","children":[{"type":"text","value":"Theorem ","key":"MPRYQm2DPt"},{"type":"text","value":"7.1.1","key":"s3Id0tbtIu"}],"template":"Theorem %s","enumerator":"7.1.1","resolved":true,"html_id":"theorem-insight-adjmat","remote":true,"url":"/insight","dataUrl":"/insight.json","key":"WF7marOFHX"},{"type":"text","value":", the entries of ","position":{"start":{"line":147,"column":1},"end":{"line":147,"column":1}},"key":"EYEKPGLgDM"},{"type":"inlineMath","value":"\\mathbf{A}^k","position":{"start":{"line":147,"column":1},"end":{"line":147,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msup><mi mathvariant=\"bold\">A</mi><mi>k</mi></msup></mrow><annotation encoding=\"application/x-tex\">\\mathbf{A}^k</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8491em;\"></span><span class=\"mord\"><span class=\"mord mathbf\">A</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8491em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03148em;\">k</span></span></span></span></span></span></span></span></span></span></span>","key":"uSS3rZWkBc"},{"type":"text","value":" give the number of walks of length ","position":{"start":{"line":147,"column":1},"end":{"line":147,"column":1}},"key":"VFbcvWpyuc"},{"type":"inlineMath","value":"k","position":{"start":{"line":147,"column":1},"end":{"line":147,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>k</mi></mrow><annotation encoding=\"application/x-tex\">k</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6944em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03148em;\">k</span></span></span></span>","key":"tRMyB5XFRR"},{"type":"text","value":" between pairs of nodes, as with “","position":{"start":{"line":147,"column":1},"end":{"line":147,"column":1}},"key":"GeMonz88Ar"},{"type":"emphasis","position":{"start":{"line":147,"column":1},"end":{"line":147,"column":1}},"children":[{"type":"text","value":"k","position":{"start":{"line":147,"column":1},"end":{"line":147,"column":1}},"key":"wl1aMBhPOv"}],"key":"AEdSmze80V"},{"type":"text","value":" degrees of separation” within a social network. As ","position":{"start":{"line":147,"column":1},"end":{"line":147,"column":1}},"key":"JhRhAWTtL3"},{"type":"inlineMath","value":"k","position":{"start":{"line":147,"column":1},"end":{"line":147,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>k</mi></mrow><annotation encoding=\"application/x-tex\">k</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6944em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03148em;\">k</span></span></span></span>","key":"UWWz6QJhbz"},{"type":"text","value":" grows, the density of ","position":{"start":{"line":147,"column":1},"end":{"line":147,"column":1}},"key":"heFAPOfrkf"},{"type":"inlineMath","value":"\\mathbf{A}^k","position":{"start":{"line":147,"column":1},"end":{"line":147,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msup><mi mathvariant=\"bold\">A</mi><mi>k</mi></msup></mrow><annotation encoding=\"application/x-tex\">\\mathbf{A}^k</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8491em;\"></span><span class=\"mord\"><span class=\"mord mathbf\">A</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8491em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03148em;\">k</span></span></span></span></span></span></span></span></span></span></span>","key":"GHBUUhtO5W"},{"type":"text","value":" also grows.","position":{"start":{"line":147,"column":1},"end":{"line":147,"column":1}},"key":"NtePY43VyE"}],"key":"G6dT8tU2hJ"},{"type":"admonition","kind":"tip","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"Tip","key":"FnMkyalmnh"}],"key":"xoUDW79TdO"},{"type":"paragraph","position":{"start":{"line":150,"column":1},"end":{"line":150,"column":1}},"children":[{"type":"text","value":"While ","position":{"start":{"line":150,"column":1},"end":{"line":150,"column":1}},"key":"qCZPW8wnIS"},{"type":"inlineCode","value":"A**6","position":{"start":{"line":150,"column":1},"end":{"line":150,"column":1}},"key":"z9twgV9ZeI"},{"type":"text","value":" is valid syntax here, it means elementwise power, not matrix power.","position":{"start":{"line":150,"column":1},"end":{"line":150,"column":1}},"key":"zCYwN3FZG7"}],"key":"NkIahTsqRa"}],"class":"dropdown","key":"Qa9qjAI9cW"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"from scipy.sparse.linalg import matrix_power\nspy(matrix_power(A, 6))\ntitle((\"$A^6$\"));","key":"A5vabkNpSe"},{"type":"output","id":"ENTXqErRCJbwvO42qcEd9","data":[{"output_type":"display_data","metadata":{},"data":{"text/plain":{"content":"<Figure size 700x400 with 1 Axes>","content_type":"text/plain"},"image/png":{"content_type":"image/png","hash":"b75adf49d504511c92c20ea9b02645c0","path":"fncbook.com/build/b75adf49d504511c92c20ea9b02645c0.png"}}}],"key":"xOnt4m0Ly3"}],"data":{},"indexEntries":[{"entry":"Python","subEntry":{"value":"matrix_power","kind":"entry"},"emphasis":true}],"label":"index-fYXyc8g3Bj","identifier":"index-fyxyc8g3bj","html_id":"index-fyxyc8g3bj","key":"SXGMsAc6Dx"}],"label":"demo-structure-fill-python","identifier":"demo-structure-fill-python","html_id":"demo-structure-fill-python","key":"LiV3NlC5b7"},{"type":"details","open":true,"children":[{"type":"summary","children":[{"type":"crossReference","identifier":"demo-structure-sparseband","label":"demo-structure-sparseband","kind":"proof:example","position":{"start":{"line":164,"column":1},"end":{"line":164,"column":27}},"children":[{"type":"text","value":"Example ","key":"NPXOeeqOBv"},{"type":"text","value":"8.1.3","key":"PEgEoQegYc"}],"template":"Example %s","enumerator":"8.1.3","resolved":true,"html_id":"demo-structure-sparseband","remote":true,"url":"/structure-1","dataUrl":"/structure-1.json","key":"bZlg2dErD9"}],"key":"iiN5bHt5yY"},{"type":"paragraph","position":{"start":{"line":169,"column":1},"end":{"line":169,"column":1}},"children":[{"type":"text","value":"The ","position":{"start":{"line":169,"column":1},"end":{"line":169,"column":1}},"key":"TCNHym3ofy"},{"type":"inlineCode","value":"scipi.sparse.diags","position":{"start":{"line":169,"column":1},"end":{"line":169,"column":1}},"key":"a3UQTNy8HL"},{"type":"text","value":" function creates a sparse matrix given its diagonal elements and the diagonal indexes to put them on. The main or central diagonal is numbered zero, above and to the right of that is positive, and below and to the left is negative.","position":{"start":{"line":169,"column":1},"end":{"line":169,"column":1}},"key":"nN4jCV9Eq8"}],"indexEntries":[{"entry":"Julia","subEntry":{"value":"spdiagm","kind":"entry"},"emphasis":true}],"label":"index-C2TKmXCHmk","identifier":"index-c2tkmxchmk","html_id":"index-c2tkmxchmk","key":"ODFrFXwqeC"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"n = 50\ndata = [n * ones(n-3), ones(n), linspace(-1, 1-n, n-1)]\noffsets = [-3, 0, 1]    # 3rd below, main, 1st above\nA = sp.diags(data, offsets, format=\"lil\")\nprint(A[:7, :7].todense())","key":"a2fpqSQTat"},{"type":"output","id":"mfUI2eLLLg0jwtKsuV3y3","data":[{"output_type":"stream","name":"stdout","text":"[[ 1. -1.  0.  0.  0.  0.  0.]\n [ 0.  1. -2.  0.  0.  0.  0.]\n [ 0.  0.  1. -3.  0.  0.  0.]\n [50.  0.  0.  1. -4.  0.  0.]\n [ 0. 50.  0.  0.  1. -5.  0.]\n [ 0.  0. 50.  0.  0.  1. -6.]\n [ 0.  0.  0. 50.  0.  0.  1.]]\n"}],"key":"QgJLsCuFd9"}],"data":{},"key":"eBUJfziaW0"},{"type":"paragraph","position":{"start":{"line":179,"column":1},"end":{"line":179,"column":1}},"children":[{"type":"text","value":"Without pivoting, the LU factors have the same lower and upper bandwidth as the original matrix.","position":{"start":{"line":179,"column":1},"end":{"line":179,"column":1}},"key":"fwj7CoWOr2"}],"key":"SccbWp98xv"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"L, U = FNC.lufact(A.todense())\nsubplot(1, 2, 1), spy(L)\nsubplot(1, 2, 2), spy(U);","key":"WexAiHUxrH"},{"type":"output","id":"dFlXIxL2V_59xcbi2SiIA","data":[{"output_type":"display_data","metadata":{},"data":{"text/plain":{"content":"<Figure size 700x400 with 2 Axes>","content_type":"text/plain"},"image/png":{"content_type":"image/png","hash":"b9b58db058e30b06125ba5957e17466a","path":"fncbook.com/build/b9b58db058e30b06125ba5957e17466a.png"}}}],"key":"dtm7Op9Z4u"}],"data":{},"key":"zhyWlMY8dC"},{"type":"paragraph","position":{"start":{"line":187,"column":1},"end":{"line":187,"column":1}},"children":[{"type":"text","value":"However, if we introduce row pivoting, bandedness may be expanded or destroyed.","position":{"start":{"line":187,"column":1},"end":{"line":187,"column":1}},"key":"Qs2B68CmDU"}],"key":"pp4Ntla74N"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"L, U, p = FNC.plufact(A.todense())\nsubplot(1, 2, 1), spy(L[p, :])\nsubplot(1, 2, 2), spy(U)","key":"m0KDzckHmE"},{"type":"output","id":"nOwXhLMWwxAeGamGgEnja","data":[{"output_type":"display_data","metadata":{},"data":{"text/plain":{"content":"<Figure size 700x400 with 2 Axes>","content_type":"text/plain"},"image/png":{"content_type":"image/png","hash":"6d9b517d3399a41c419b8a0f7e078788","path":"fncbook.com/build/6d9b517d3399a41c419b8a0f7e078788.png"}}}],"key":"SKkwIyOMeO"}],"data":{},"key":"yjmH734Zom"}],"label":"demo-structure-sparseband-python","identifier":"demo-structure-sparseband-python","html_id":"demo-structure-sparseband-python","key":"wlnCIDsVwU"},{"type":"details","open":true,"children":[{"type":"summary","children":[{"type":"crossReference","identifier":"demo-structure-linalg","label":"demo-structure-linalg","kind":"proof:example","position":{"start":{"line":198,"column":1},"end":{"line":198,"column":23}},"children":[{"type":"text","value":"Example ","key":"bo707eWrcP"},{"type":"text","value":"8.1.4","key":"qfwTaCS6QS"}],"template":"Example %s","enumerator":"8.1.4","resolved":true,"html_id":"demo-structure-linalg","remote":true,"url":"/structure-1","dataUrl":"/structure-1.json","key":"i1SKFKlb5r"}],"key":"e971wOIaKo"},{"type":"paragraph","position":{"start":{"line":201,"column":1},"end":{"line":201,"column":1}},"children":[{"type":"text","value":"The following generates a random sparse matrix with prescribed eigenvalues.","position":{"start":{"line":201,"column":1},"end":{"line":201,"column":1}},"key":"hGYXYdU4NR"}],"key":"hqtvo3QlLS"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"n = 4000\ndensity = 4e-4\nev = 1 / arange(1, n + 1)\nA = FNC.sprandsym(n, density, eigvals=ev)\nprint(f\"density is {A.nnz / prod(A.shape):.3%}\")","key":"B4yliRgHXG"},{"type":"output","id":"cWDicMIZ0veFlMRwhE7Ir","data":[{"output_type":"stream","name":"stdout","text":"density is 0.040%\n"}],"key":"SNmDhz1YXW"}],"data":{},"key":"RcQcmphUw6"},{"type":"paragraph","position":{"start":{"line":214,"column":1},"end":{"line":214,"column":1}},"children":[{"type":"text","value":"The ","position":{"start":{"line":214,"column":1},"end":{"line":214,"column":1}},"key":"XAiUbuK7s8"},{"type":"inlineCode","value":"eigs","position":{"start":{"line":214,"column":1},"end":{"line":214,"column":1}},"key":"XY7aa0LZWK"},{"type":"text","value":" function finds a small number eigenvalues meeting some criterion. First, we ask for the 5 of largest (complex) magnitude using ","position":{"start":{"line":214,"column":1},"end":{"line":214,"column":1}},"key":"rTIF1GXX7x"},{"type":"inlineCode","value":"which=\"LM\"","position":{"start":{"line":214,"column":1},"end":{"line":214,"column":1}},"key":"NmLsMnErxq"},{"type":"text","value":".","position":{"start":{"line":214,"column":1},"end":{"line":214,"column":1}},"key":"ZVFmZESYIz"}],"indexEntries":[{"entry":"Python","subEntry":{"value":"eigs","kind":"entry"},"emphasis":true}],"label":"index-oKMUDL3tSt","identifier":"index-okmudl3tst","html_id":"index-okmudl3tst","key":"fGwzCt1Nxo"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"from scipy.sparse.linalg import eigs\nev, V = eigs(A, k=5, which=\"LM\")    # largest magnitude\nprint(1 / ev)","key":"d9gvxzQwLQ"},{"type":"output","id":"IHsB8XgH_pkIkrMvqixUJ","data":[{"output_type":"stream","name":"stdout","text":"[1.+0.j 2.+0.j 3.+0.j 4.+0.j 5.+0.j]\n"}],"key":"g5ZeHls9kj"}],"data":{},"key":"ZhCExA0dqO"},{"type":"paragraph","position":{"start":{"line":222,"column":1},"end":{"line":222,"column":1}},"children":[{"type":"text","value":"Now we find the 4 closest to the value 1 in the complex plane, via ","position":{"start":{"line":222,"column":1},"end":{"line":222,"column":1}},"key":"dGJBB2QWHj"},{"type":"inlineCode","value":"sigma=1","position":{"start":{"line":222,"column":1},"end":{"line":222,"column":1}},"key":"AKR5NMrAim"},{"type":"text","value":".","position":{"start":{"line":222,"column":1},"end":{"line":222,"column":1}},"key":"S0HBv5X2TK"}],"key":"S4HkOnoXc2"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"from scipy.sparse.linalg import eigs\nev, V = eigs(A, k=4, sigma=0.03)    # closest to sigma\nprint(ev)","key":"EYDu5kN1hO"},{"type":"output","id":"8Gi7nS2B-mMNsEnw0tYE7","data":[{"output_type":"stream","name":"stdout","text":"[0.03030303+0.j 0.02941176+0.j 0.03125   +0.j 0.02857143+0.j]\n"}],"key":"OcmUCC7PnR"}],"data":{},"key":"oaOVeFBHK9"},{"type":"paragraph","position":{"start":{"line":230,"column":1},"end":{"line":230,"column":1}},"children":[{"type":"text","value":"The time needed to solve a sparse linear system is not easy to predict unless you have some more information about the matrix. But it will typically be orders of magnitude faster than the dense version of the same problem.","position":{"start":{"line":230,"column":1},"end":{"line":230,"column":1}},"key":"plLg7o4aMv"}],"key":"D9bkVFBQIH"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"from scipy.sparse.linalg import spsolve\nx = 1 / arange(1, n + 1)\nb = A @ x\nstart = timer()\nxx = spsolve(A, b)\nprint(f\"sparse time: {timer() - start:.3g} sec\")\nprint(f\"residual: {norm(b - A @ xx, 2):.1e}\")","key":"uUuDxNf5KX"},{"type":"output","id":"UbMt0BEGYRriHXIOBbY3o","data":[{"output_type":"stream","name":"stdout","text":"sparse time: 0.0015 sec\nresidual: 5.3e-18\n"}],"key":"soF14THtdz"}],"data":{},"key":"kGbzEIibdB"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"from numpy.linalg import solve\nF = A.todense()\nstart = timer()\nxx = solve(F, b)\nprint(f\"dense time: {timer() - start:.3g} sec\")\nprint(f\"residual: {norm(b - A @ xx, 2):.1e}\")","key":"S2e09m6HYJ"},{"type":"output","id":"f08QHZb-wMLI6nSnXz9sz","data":[{"output_type":"stream","name":"stdout","text":"dense time: 0.665 sec\nresidual: 5.2e-18\n"}],"key":"OdF6Vi7rTZ"}],"data":{},"key":"Lz2pAAhbpr"}],"label":"demo-structure-linalg-python","identifier":"demo-structure-linalg-python","html_id":"demo-structure-linalg-python","key":"UPafLgc1tJ"},{"type":"heading","depth":3,"position":{"start":{"line":252,"column":1},"end":{"line":252,"column":1}},"children":[{"type":"text","value":"8.2 ","position":{"start":{"line":252,"column":1},"end":{"line":252,"column":1}},"key":"NU3s9kIY1L"},{"type":"link","identifier":"section-krylov-power","label":"section-krylov-power","kind":"narrative","position":{"start":{"line":252,"column":5},"end":{"line":252,"column":26}},"url":"/power","internal":true,"dataUrl":"/power.json","children":[{"type":"text","value":"Power iteration","key":"l8IiJJYlCH"}],"key":"mzaxDo6MMK"}],"identifier":"id-8-2","label":"8.2 ","html_id":"id-8-2","implicit":true,"key":"kOmq65eH7A"},{"type":"details","open":true,"children":[{"type":"summary","children":[{"type":"crossReference","identifier":"demo-power-one","label":"demo-power-one","kind":"proof:example","position":{"start":{"line":255,"column":1},"end":{"line":255,"column":16}},"children":[{"type":"text","value":"Example ","key":"uE4jcs68cZ"},{"type":"text","value":"8.2.1","key":"f5uX7Z21zp"}],"template":"Example %s","enumerator":"8.2.1","resolved":true,"html_id":"demo-power-one","remote":true,"url":"/power","dataUrl":"/power.json","key":"idzK5gHYME"}],"key":"JN98hdlWYl"},{"type":"paragraph","position":{"start":{"line":257,"column":1},"end":{"line":257,"column":1}},"children":[{"type":"text","value":"Here we choose a random 5×5 matrix and a random 5-vector.","position":{"start":{"line":257,"column":1},"end":{"line":257,"column":1}},"key":"c8yUCGLxv2"}],"key":"YPNPhoPHJS"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"A = random.choice(range(10), (5, 5))\nA = A / sum(A, 0)\nx = random.randn(5)\nprint(x)","key":"JLYn2Szj63"},{"type":"output","id":"IHmEkUWuIQqOCLdQhQnEQ","data":[{"output_type":"stream","name":"stdout","text":"[ 0.16978275 -1.13985535 -0.10207207  0.70204959 -0.55130676]\n"}],"key":"CqE44cp4ZF"}],"data":{},"key":"vNRmcbS49J"},{"type":"paragraph","position":{"start":{"line":266,"column":1},"end":{"line":266,"column":1}},"children":[{"type":"text","value":"Applying matrix-vector multiplication once doesn’t do anything recognizable.","position":{"start":{"line":266,"column":1},"end":{"line":266,"column":1}},"key":"IUCaaRMrUk"}],"key":"et8MI3j70F"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"y = A @ x\nprint(y)","key":"JNkvJ7zF9k"},{"type":"output","id":"_L9bEKbzz21L2PuiHogeo","data":[{"output_type":"stream","name":"stdout","text":"[ 0.04580142 -0.07757707 -0.15931028 -0.61958189 -0.11073401]\n"}],"key":"eoeRNiHKyv"}],"data":{},"key":"p2DZZAusce"},{"type":"paragraph","position":{"start":{"line":273,"column":1},"end":{"line":273,"column":1}},"children":[{"type":"text","value":"Repeating the multiplication still doesn’t do anything obvious.","position":{"start":{"line":273,"column":1},"end":{"line":273,"column":1}},"key":"eHktATje8D"}],"key":"Gq7lcntRIv"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"z = A @ y\nprint(z)","key":"oQ5FbsCgQv"},{"type":"output","id":"Tex8TE9JGHlxMjkhc-CmN","data":[{"output_type":"stream","name":"stdout","text":"[-0.12046302 -0.18321533 -0.2097453  -0.10789248 -0.3000857 ]\n"}],"key":"nD0EiFHUI9"}],"data":{},"key":"cnv85tlafz"},{"type":"paragraph","position":{"start":{"line":280,"column":1},"end":{"line":280,"column":1}},"children":[{"type":"text","value":"But if we keep repeating the matrix-vector multiplication, something remarkable happens: ","position":{"start":{"line":280,"column":1},"end":{"line":280,"column":1}},"key":"WzUWCkMtnl"},{"type":"inlineMath","value":"\\mathbf{A} \\mathbf{x} \\approx \\mathbf{x}","position":{"start":{"line":280,"column":1},"end":{"line":280,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi mathvariant=\"bold\">A</mi><mi mathvariant=\"bold\">x</mi><mo>≈</mo><mi mathvariant=\"bold\">x</mi></mrow><annotation encoding=\"application/x-tex\">\\mathbf{A} \\mathbf{x} \\approx \\mathbf{x}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6861em;\"></span><span class=\"mord mathbf\">Ax</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">≈</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.4444em;\"></span><span class=\"mord mathbf\">x</span></span></span></span>","key":"abgzHYRNfa"},{"type":"text","value":".","position":{"start":{"line":280,"column":1},"end":{"line":280,"column":1}},"key":"YH6zypySJR"}],"key":"kUaZ2Q7urd"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"x = random.randn(5)\nfor j in range(6):\n    x = A @ x\nprint(x)\nprint(A @ x)","key":"QgrMPH4K2a"},{"type":"output","id":"_qtQ6Db4a_jN6irtW7_wB","data":[{"output_type":"stream","name":"stdout","text":"[-0.06228606 -0.06954688 -0.07498971 -0.08668721 -0.11640553]\n[-0.06256514 -0.06945653 -0.07509878 -0.08617613 -0.1166188 ]\n"}],"key":"pF9Gi7zTVi"}],"data":{},"key":"Q6Xc73c3mG"},{"type":"paragraph","position":{"start":{"line":290,"column":1},"end":{"line":290,"column":1}},"children":[{"type":"text","value":"This phenomenon is unlikely to be a coincidence!","position":{"start":{"line":290,"column":1},"end":{"line":290,"column":1}},"key":"JetRiBiHZN"}],"key":"mhG0moSSeN"}],"label":"demo-power-one-python","identifier":"demo-power-one-python","html_id":"demo-power-one-python","key":"Z5kWNg5xWk"},{"type":"details","open":true,"children":[{"type":"summary","children":[{"type":"crossReference","identifier":"demo-power-iter","label":"demo-power-iter","kind":"proof:example","position":{"start":{"line":295,"column":1},"end":{"line":295,"column":17}},"children":[{"type":"text","value":"Example ","key":"a4akxSU1RS"},{"type":"text","value":"8.2.2","key":"UmcvzKHW2z"}],"template":"Example %s","enumerator":"8.2.2","resolved":true,"html_id":"demo-power-iter","remote":true,"url":"/power","dataUrl":"/power.json","key":"ixkUxlyZRy"}],"key":"aJR6yWzYo9"},{"type":"paragraph","position":{"start":{"line":297,"column":1},"end":{"line":297,"column":1}},"children":[{"type":"text","value":"We will experiment with the power iteration on a 5×5 matrix with prescribed eigenvalues and dominant eigenvalue at 1.","position":{"start":{"line":297,"column":1},"end":{"line":297,"column":1}},"key":"fYZsdcAO4K"}],"key":"R3ZHQ9GUqh"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"ev = [1, -0.75, 0.6, -0.4, 0]\nA = triu(ones([5, 5]), 1) + diag(ev)    # triangular matrix, eigs on diagonal","key":"QtDYTkWmaa"},{"type":"output","id":"6Bn4ErAaobE2Cvp2cjBdJ","data":[],"key":"Hs0NOVD35Y"}],"data":{},"key":"ouOSHNaU0N"},{"type":"paragraph","position":{"start":{"line":304,"column":1},"end":{"line":304,"column":1}},"children":[{"type":"text","value":"We run the power iteration 60 times. The first output should be a sequence of estimates converging to the dominant eigenvalue—which, in this case, we set up to be 1.","position":{"start":{"line":304,"column":1},"end":{"line":304,"column":1}},"key":"kwSjcHsCdZ"}],"key":"Vr921y2bHn"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"beta, x = FNC.poweriter(A, 60)\nprint(beta)","key":"JZH2yhCnq8"},{"type":"output","id":"hmiPrG9kR-pL4qv5AcXaY","data":[{"output_type":"stream","name":"stdout","text":"[3.33368188 3.33037418 1.47485841 1.16520317 1.10307687 1.04382263\n 1.03398738 1.01334075 1.01262209 1.00398074 1.00499216 1.00103027\n 1.00207863 1.00015103 1.00091065 0.99993142 1.00041974 0.99990622\n 1.00020289 0.99992737 1.00010218 0.99995199 1.00005318 0.99997042\n 1.00002837 0.99998243 1.0000154  0.99998979 1.00000846 0.99999413\n 1.00000469 0.99999666 1.00000261 0.9999981  1.00000146 0.99999893\n 1.00000082 0.99999939 1.00000046 0.99999966 1.00000026 0.99999981\n 1.00000014 0.99999989 1.00000008 0.99999994 1.00000005 0.99999997\n 1.00000003 0.99999998 1.00000001 0.99999999 1.00000001 0.99999999\n 1.         1.         1.         1.         1.         1.        ]\n"}],"key":"HaFgz376TB"}],"data":{},"key":"VHe80k5Smh"},{"type":"paragraph","position":{"start":{"line":311,"column":1},"end":{"line":311,"column":1}},"children":[{"type":"text","value":"We check for linear convergence using a log-linear plot of the error.","position":{"start":{"line":311,"column":1},"end":{"line":311,"column":1}},"key":"J7GHgAmsGz"}],"key":"b1z4w1kBQe"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"err = 1 - beta\nsemilogy(arange(60), abs(err), \"-o\")\nylim(1e-10, 1)\nxlabel(\"$k$\")\nylabel(\"$|\\\\lambda_1 - \\\\beta_k|$\")\ntitle(\"Convergence of power iteration\");","key":"yyl1ZNYmP2"},{"type":"output","id":"Nj93IGgb39mlvp-3t6BGV","data":[{"output_type":"display_data","metadata":{},"data":{"text/plain":{"content":"<Figure size 700x400 with 1 Axes>","content_type":"text/plain"},"image/png":{"content_type":"image/png","hash":"26f8f5939f651165983c79bebf15d44f","path":"fncbook.com/build/26f8f5939f651165983c79bebf15d44f.png"}}}],"key":"u1aqTsSXOs"}],"data":{},"key":"xfpLKZPSDL"},{"type":"paragraph","position":{"start":{"line":322,"column":1},"end":{"line":322,"column":1}},"children":[{"type":"text","value":"The asymptotic trend seems to be a straight line, consistent with linear convergence. To estimate the convergence rate, we look at the ratio of two consecutive errors in the linear part of the convergence curve. The ratio of the first two eigenvalues should match the observed rate.","position":{"start":{"line":322,"column":1},"end":{"line":322,"column":1}},"key":"KF7euU0M6y"}],"key":"lR0ySJHO5Q"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"print(f\"theory: {ev[1] / ev[0]:.5f}\")\nprint(f\"observed: {err[40] / err[39]:.5f}\")","key":"ckQmlgJ3rq"},{"type":"output","id":"_JY9q_okrUG7YA8b-Fny1","data":[{"output_type":"stream","name":"stdout","text":"theory: -0.75000\nobserved: -0.75511\n"}],"key":"aq0BEh7aZN"}],"data":{},"key":"q22Ku3k4do"},{"type":"paragraph","position":{"start":{"line":329,"column":1},"end":{"line":329,"column":1}},"children":[{"type":"text","value":"Note that the error is supposed to change sign on each iteration. The effect of these alternating signs is that estimates oscillate around the exact value.","position":{"start":{"line":329,"column":1},"end":{"line":329,"column":1}},"key":"qvh0ZxdjbP"}],"key":"bRF6kD4w2t"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"print(beta[26:30])","key":"hQ69TWHhbW"},{"type":"output","id":"2-OB1Pw2w5_8choqojG3K","data":[{"output_type":"stream","name":"stdout","text":"[1.0000154  0.99998979 1.00000846 0.99999413]\n"}],"key":"t1XNuYarzo"}],"data":{},"key":"neHlsoDqMQ"},{"type":"paragraph","position":{"start":{"line":335,"column":1},"end":{"line":335,"column":1}},"children":[{"type":"text","value":"In practical situations, we don’t know the exact eigenvalue that the algorithm is supposed to find. In that case we would base errors on the final ","position":{"start":{"line":335,"column":1},"end":{"line":335,"column":1}},"key":"TC6wXedKR6"},{"type":"text","value":"β","position":{"start":{"line":335,"column":1},"end":{"line":335,"column":1}},"key":"aXuau2l51E"},{"type":"text","value":" that was found, as in the following plot.","position":{"start":{"line":335,"column":1},"end":{"line":335,"column":1}},"key":"ZfyAG2B38f"}],"key":"TxjEnh7x6y"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"err = beta[-1] - beta\nsemilogy(arange(60), abs(err), \"-o\")\nylim(1e-10, 1), xlabel(\"$k$\")\nylabel(\"$|\\\\lambda_1 - \\\\beta_k|$\")\ntitle(\"Convergence of power iteration\");","key":"vOK86sAW77"},{"type":"output","id":"nRco4o1bSTo47tZqSY0RH","data":[{"output_type":"display_data","metadata":{},"data":{"text/plain":{"content":"<Figure size 700x400 with 1 Axes>","content_type":"text/plain"},"image/png":{"content_type":"image/png","hash":"f149e14f17bc89a4d446306203971533","path":"fncbook.com/build/f149e14f17bc89a4d446306203971533.png"}}}],"key":"q8oQCojFba"}],"data":{},"key":"OQ5T8qEvNl"},{"type":"paragraph","position":{"start":{"line":345,"column":1},"end":{"line":345,"column":1}},"children":[{"type":"text","value":"The results are very similar until the last few iterations, when the limited accuracy of the reference value begins to show. That is, while it is a good estimate of ","position":{"start":{"line":345,"column":1},"end":{"line":345,"column":1}},"key":"P8A3OLTiTI"},{"type":"inlineMath","value":"\\lambda_1","position":{"start":{"line":345,"column":1},"end":{"line":345,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>λ</mi><mn>1</mn></msub></mrow><annotation encoding=\"application/x-tex\">\\lambda_1</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8444em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">λ</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3011em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">1</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span>","key":"mPcrV9cTjp"},{"type":"text","value":", it is less good as an estimate of the error in nearby estimates.","position":{"start":{"line":345,"column":1},"end":{"line":345,"column":1}},"key":"y9nMeHHQ8I"}],"key":"gFIOFEvKBY"}],"label":"demo-power-iter-python","identifier":"demo-power-iter-python","html_id":"demo-power-iter-python","key":"VAcu9o9034"},{"type":"heading","depth":3,"position":{"start":{"line":349,"column":1},"end":{"line":349,"column":1}},"children":[{"type":"text","value":"8.3 ","position":{"start":{"line":349,"column":1},"end":{"line":349,"column":1}},"key":"ZRVOkbAByB"},{"type":"link","identifier":"section-krylov-inviter","label":"section-krylov-inviter","kind":"narrative","position":{"start":{"line":349,"column":5},"end":{"line":349,"column":28}},"url":"/inviter","internal":true,"dataUrl":"/inviter.json","children":[{"type":"text","value":"Inverse iteration","key":"YmIOsp4ixm"}],"key":"U0IoHLXQ0M"}],"identifier":"id-8-3","label":"8.3 ","html_id":"id-8-3","implicit":true,"key":"gMgrijnBfz"},{"type":"details","open":true,"children":[{"type":"summary","children":[{"type":"crossReference","identifier":"demo-inviter-conv","label":"demo-inviter-conv","kind":"proof:example","position":{"start":{"line":352,"column":1},"end":{"line":352,"column":19}},"children":[{"type":"text","value":"Example ","key":"ZlrFYS1qgj"},{"type":"text","value":"8.3.1","key":"HEwrXNXiyA"}],"template":"Example %s","enumerator":"8.3.1","resolved":true,"html_id":"demo-inviter-conv","remote":true,"url":"/inviter","dataUrl":"/inviter.json","key":"GmRJuqtOV4"}],"key":"GKFs719MrL"},{"type":"paragraph","position":{"start":{"line":354,"column":1},"end":{"line":354,"column":1}},"children":[{"type":"text","value":"We set up a ","position":{"start":{"line":354,"column":1},"end":{"line":354,"column":1}},"key":"aaAMac5RJK"},{"type":"inlineMath","value":"5\\times 5","position":{"start":{"line":354,"column":1},"end":{"line":354,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>5</mn><mo>×</mo><mn>5</mn></mrow><annotation encoding=\"application/x-tex\">5\\times 5</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.7278em;vertical-align:-0.0833em;\"></span><span class=\"mord\">5</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">×</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">5</span></span></span></span>","key":"Xcte9kxzzZ"},{"type":"text","value":" triangular matrix with prescribed eigenvalues on its diagonal.","position":{"start":{"line":354,"column":1},"end":{"line":354,"column":1}},"key":"fIaEXBAvUh"}],"key":"etAGYHrEuQ"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"ev = array([1, -0.75, 0.6, -0.4, 0])\nA = triu(ones([5, 5]), 1) + diag(ev)    # triangular matrix, eigs on diagonal","key":"oPES8K6TBm"},{"type":"output","id":"OhQNpMlNSxnw1X0mRDO2c","data":[],"key":"Vv0PpwZRX2"}],"data":{},"key":"X9YcCavavN"},{"type":"paragraph","position":{"start":{"line":361,"column":1},"end":{"line":361,"column":1}},"children":[{"type":"text","value":"We run inverse iteration with the shift ","position":{"start":{"line":361,"column":1},"end":{"line":361,"column":1}},"key":"FqzwmMoICA"},{"type":"inlineMath","value":"s=0.7","position":{"start":{"line":361,"column":1},"end":{"line":361,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>s</mi><mo>=</mo><mn>0.7</mn></mrow><annotation encoding=\"application/x-tex\">s=0.7</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">s</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">0.7</span></span></span></span>","key":"MtXnsC241K"},{"type":"text","value":". Convergence should be to the eigenvalue closest to the shift, which we know to be ","position":{"start":{"line":361,"column":1},"end":{"line":361,"column":1}},"key":"w6aIRMZ1zO"},{"type":"text","value":"0.6","position":{"start":{"line":361,"column":1},"end":{"line":361,"column":1}},"key":"AbM8UofDDd"},{"type":"text","value":" here.","position":{"start":{"line":361,"column":1},"end":{"line":361,"column":1}},"key":"bAMR74BHKQ"}],"key":"J7Zx05hNrR"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"beta, x = FNC.inviter(A, 0.7, 30)\nprint(beta)","key":"VgJTat5zjD"},{"type":"output","id":"EO6AY1l2Ovxm7XBuhlp4p","data":[{"output_type":"stream","name":"stdout","text":"[0.69949953 0.5788059  0.60902175 0.59730106 0.60094685 0.59969144\n 0.6001039  0.59996552 0.60001152 0.59999616 0.60000128 0.59999957\n 0.60000014 0.59999995 0.60000002 0.59999999 0.6        0.6\n 0.6        0.6        0.6        0.6        0.6        0.6\n 0.6        0.6        0.6        0.6        0.6        0.6       ]\n"}],"key":"YguxbXNzgb"}],"data":{},"key":"Z8QMMrL6Ud"},{"type":"paragraph","position":{"start":{"line":368,"column":1},"end":{"line":368,"column":1}},"children":[{"type":"text","value":"As expected, the eigenvalue that was found is the one closest to 0.7. The convergence is again linear.","position":{"start":{"line":368,"column":1},"end":{"line":368,"column":1}},"key":"Ulu1cEuQX5"}],"key":"VefqegZnpI"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"err = beta[-1] - beta    # last estimate is our best\nsemilogy(arange(30), abs(err), \"-o\")\nylim(1e-16, 1)\nxlabel(\"$k$\"),  ylabel(\"$|\\\\lambda_3 - \\\\beta_k|$\")\ntitle((\"Convergence of inverse iteration\"));","key":"JT9fG6aZyc"},{"type":"output","id":"W6wzXYApiZ3GO_FhtR6E5","data":[{"output_type":"display_data","metadata":{},"data":{"text/plain":{"content":"<Figure size 700x400 with 1 Axes>","content_type":"text/plain"},"image/png":{"content_type":"image/png","hash":"792516cd34441c651203734419206307","path":"fncbook.com/build/792516cd34441c651203734419206307.png"}}}],"key":"wCPCEGdRw0"}],"data":{},"key":"yUXEHcFi9d"},{"type":"paragraph","position":{"start":{"line":381,"column":1},"end":{"line":381,"column":1}},"children":[{"type":"text","value":"Let’s reorder the eigenvalues to enforce ","position":{"start":{"line":381,"column":1},"end":{"line":381,"column":1}},"key":"kJxDnljmNe"},{"type":"crossReference","kind":"equation","identifier":"shiftorder","label":"shiftorder","children":[{"type":"text","value":"(","key":"vhk1HrmfR0"},{"type":"text","value":"8.3.3","key":"nTJszdRLr1"},{"type":"text","value":")","key":"NyRxPyLQzm"}],"template":"(%s)","enumerator":"8.3.3","resolved":true,"html_id":"shiftorder","remote":true,"url":"/inviter","dataUrl":"/inviter.json","key":"gC2kPdw8q1"},{"type":"text","value":".","position":{"start":{"line":381,"column":1},"end":{"line":381,"column":1}},"key":"vS6dONU0XL"}],"indexEntries":[{"entry":"Python","subEntry":{"value":"argsort","kind":"entry"},"emphasis":true}],"label":"index-xv406aax5c","identifier":"index-xv406aax5c","html_id":"index-xv406aax5c","key":"YA7lboJnfq"},{"type":"admonition","kind":"tip","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"Tip","key":"HKxVIa0tdx"}],"key":"hQgYVDSMVf"},{"type":"paragraph","position":{"start":{"line":384,"column":1},"end":{"line":384,"column":1}},"children":[{"type":"text","value":"The ","position":{"start":{"line":384,"column":1},"end":{"line":384,"column":1}},"key":"JFtKKaAHEn"},{"type":"inlineCode","value":"argsort","position":{"start":{"line":384,"column":1},"end":{"line":384,"column":1}},"key":"J5hdKwbg40"},{"type":"text","value":" function returns the index permutation needed to sort the given vector, rather than the sorted vector itself.","position":{"start":{"line":384,"column":1},"end":{"line":384,"column":1}},"key":"lPHJrAJThI"}],"key":"Q9Bei80wtc"}],"class":"dropdown","key":"zrVbz1Swtl"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"ev = ev[argsort(abs(ev - 0.7))]\nprint(ev)","key":"Pbcn0hKBH5"},{"type":"output","id":"jssUXguOi5avEWQk1T3AK","data":[{"output_type":"stream","name":"stdout","text":"[ 0.6   1.    0.   -0.4  -0.75]\n"}],"key":"WhfKwlqcXS"}],"data":{},"key":"H6vrYoUmgp"},{"type":"paragraph","position":{"start":{"line":392,"column":1},"end":{"line":392,"column":1}},"children":[{"type":"text","value":"Now it is easy to compare the theoretical and observed linear convergence rates.","position":{"start":{"line":392,"column":1},"end":{"line":392,"column":1}},"key":"ttDlBWpsCP"}],"key":"I1mQpeLXiM"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"print(f\"theory: {(ev[0] - 0.7) / (ev[1] - 0.7):.5f}\")\nprint(f\"observed: {err[21] / err[20]:.5f}\")","key":"xVl2ScvhSV"},{"type":"output","id":"v4fXAu4ylYZJojTWUX-0B","data":[{"output_type":"stream","name":"stdout","text":"theory: -0.33333\nobserved: -0.33327\n"}],"key":"Wo8YgY97VT"}],"data":{},"key":"gXBekK0Cts"}],"label":"demo-inviter-conv-python","identifier":"demo-inviter-conv-python","html_id":"demo-inviter-conv-python","key":"UE71F2JPZy"},{"type":"details","open":true,"children":[{"type":"summary","children":[{"type":"crossReference","identifier":"demo-inviter-accel","label":"demo-inviter-accel","kind":"proof:example","position":{"start":{"line":401,"column":1},"end":{"line":401,"column":20}},"children":[{"type":"text","value":"Example ","key":"ZvB1Xu8X4C"},{"type":"text","value":"8.3.2","key":"k7iCln2Bkp"}],"template":"Example %s","enumerator":"8.3.2","resolved":true,"html_id":"demo-inviter-accel","remote":true,"url":"/inviter","dataUrl":"/inviter.json","key":"vDU97ta5Ff"}],"key":"PSPS8D4Row"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"ev = array([1, -0.75, 0.6, -0.4, 0])\nA = triu(ones([5, 5]), 1) + diag(ev)    # triangular matrix, eigs on diagonal","key":"vvEXjmcKSd"},{"type":"output","id":"1kTel2MnbKeTK6ooBJNXc","data":[],"key":"oHpPep3zLI"}],"data":{},"key":"mq8nkIvvNH"},{"type":"paragraph","position":{"start":{"line":408,"column":1},"end":{"line":408,"column":1}},"children":[{"type":"text","value":"We begin with a shift ","position":{"start":{"line":408,"column":1},"end":{"line":408,"column":1}},"key":"GKLRO6autv"},{"type":"inlineMath","value":"s=0.7","position":{"start":{"line":408,"column":1},"end":{"line":408,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>s</mi><mo>=</mo><mn>0.7</mn></mrow><annotation encoding=\"application/x-tex\">s=0.7</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">s</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">0.7</span></span></span></span>","key":"q5Rk9RUXEN"},{"type":"text","value":", which is closest to the eigenvalue 0.6.","position":{"start":{"line":408,"column":1},"end":{"line":408,"column":1}},"key":"nNH0aIlxpG"}],"key":"tkDThcxUrQ"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"from numpy.linalg import solve\ns = 0.7\nx = ones(5)\ny = solve(A - s * eye(5), x)\nbeta = x[0] / y[0] + s\nprint(f\"latest estimate: {beta:.8f}\")","key":"JyjOPaSrSd"},{"type":"output","id":"FXpGA7l21Wgoghh6d2wzl","data":[{"output_type":"stream","name":"stdout","text":"latest estimate: 0.70348139\n"}],"key":"K0aUUstr7O"}],"data":{},"key":"QOf2lBvpNq"},{"type":"paragraph","position":{"start":{"line":419,"column":1},"end":{"line":419,"column":1}},"children":[{"type":"text","value":"Note that the result is not yet any closer to the targeted 0.6. But we proceed (without being too picky about normalization here).","position":{"start":{"line":419,"column":1},"end":{"line":419,"column":1}},"key":"C9pdaNpAHU"}],"key":"aN4M2P1eRp"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"s = beta\nx = y / y[0]\ny = solve(A - s * eye(5), x)\nbeta = x[0] / y[0] + s\nprint(f\"latest estimate: {beta:.8f}\")","key":"yw9H22435D"},{"type":"output","id":"w9PQuXvLlvZ3PFMhz8_Po","data":[{"output_type":"stream","name":"stdout","text":"latest estimate: 0.56127614\n"}],"key":"uSreqihisH"}],"data":{},"key":"bOJPY9Fzna"},{"type":"paragraph","position":{"start":{"line":429,"column":1},"end":{"line":429,"column":1}},"children":[{"type":"text","value":"Still not much apparent progress. However, in just a few more iterations the results are dramatically better.","position":{"start":{"line":429,"column":1},"end":{"line":429,"column":1}},"key":"BmwqaH7gg8"}],"key":"L9EENIjVNg"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"for k in range(4):\n    s = beta\n    x = y / y[0]\n    y = solve(A - s * eye(5), x)\n    beta = x[0] / y[0] + s\n    print(f\"latest estimate: {beta:.12f}\")","key":"b2jAIzKpCn"},{"type":"output","id":"SHxKDLChCaU_lcZQWI977","data":[{"output_type":"stream","name":"stdout","text":"latest estimate: 0.596431288475\nlatest estimate: 0.599971709182\nlatest estimate: 0.599999997856\nlatest estimate: 0.600000000000\n"}],"key":"s2qwzB5OzW"}],"data":{},"key":"nx9E0GCgi6"}],"label":"demo-inviter-accel-python","identifier":"demo-inviter-accel-python","html_id":"demo-inviter-accel-python","key":"KJ4oa6BDLW"},{"type":"heading","depth":3,"position":{"start":{"line":441,"column":1},"end":{"line":441,"column":1}},"children":[{"type":"text","value":"8.4 ","position":{"start":{"line":441,"column":1},"end":{"line":441,"column":1}},"key":"oQGtfJr5ua"},{"type":"link","identifier":"section-krylov-subspace","label":"section-krylov-subspace","kind":"narrative","position":{"start":{"line":441,"column":5},"end":{"line":441,"column":29}},"url":"/subspace","internal":true,"dataUrl":"/subspace.json","children":[{"type":"text","value":"Krylov subspaces","key":"V5QBipI1dD"}],"key":"duhPRPCX1Y"}],"identifier":"id-8-4","label":"8.4 ","html_id":"id-8-4","implicit":true,"key":"KpEdUtO3Ib"},{"type":"details","open":true,"children":[{"type":"summary","children":[{"type":"crossReference","identifier":"demo-subspace-unstable","label":"demo-subspace-unstable","kind":"proof:example","position":{"start":{"line":444,"column":1},"end":{"line":444,"column":24}},"children":[{"type":"text","value":"Example ","key":"JS9b4Sf8tx"},{"type":"text","value":"8.4.1","key":"Ij68ZGcpbc"}],"template":"Example %s","enumerator":"8.4.1","resolved":true,"html_id":"demo-subspace-unstable","remote":true,"url":"/subspace","dataUrl":"/subspace.json","key":"DJMeyUSRdM"}],"key":"bG9OWbKaJP"},{"type":"paragraph","position":{"start":{"line":446,"column":1},"end":{"line":446,"column":1}},"children":[{"type":"text","value":"First we define a triangular matrix with known eigenvalues, and a random vector ","position":{"start":{"line":446,"column":1},"end":{"line":446,"column":1}},"key":"agsAFyp6Dc"},{"type":"inlineMath","value":"b","position":{"start":{"line":446,"column":1},"end":{"line":446,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>b</mi></mrow><annotation encoding=\"application/x-tex\">b</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6944em;\"></span><span class=\"mord mathnormal\">b</span></span></span></span>","key":"VfmcgDKJ5r"},{"type":"text","value":".","position":{"start":{"line":446,"column":1},"end":{"line":446,"column":1}},"key":"gs6ExQtYWc"}],"key":"tIp3F8WnAG"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"ev = 10 + arange(1, 101)\nA = triu(random.rand(100, 100), 1) + diag(ev)\nb = random.rand(100)","key":"CaUczE4BQN"},{"type":"output","id":"ApVD220AQS7jKBOuEdAQ9","data":[],"key":"OkSrGMKHGJ"}],"data":{},"key":"N6SOcI4qTb"},{"type":"paragraph","position":{"start":{"line":454,"column":1},"end":{"line":454,"column":1}},"children":[{"type":"text","value":"Next we build up the first ten Krylov matrices iteratively, using renormalization after each matrix-vector multiplication.","position":{"start":{"line":454,"column":1},"end":{"line":454,"column":1}},"key":"tHMxZPAs2D"}],"key":"fib3tHilYx"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"Km = zeros([100, 30])\nKm[:, 0] = b\nfor m in range(29):\n    v = A @ Km[:, m]\n    Km[:, m + 1] = v / norm(v)","key":"kS8GspSO3X"},{"type":"output","id":"XcZq3ZOHtKZlu55N2xfml","data":[],"key":"jg1Uo6xVIh"}],"data":{},"key":"LWKUHaShZh"},{"type":"paragraph","position":{"start":{"line":464,"column":1},"end":{"line":464,"column":1}},"children":[{"type":"text","value":"Now we solve least-squares problems for Krylov matrices of increasing dimension, recording the residual in each case.","position":{"start":{"line":464,"column":1},"end":{"line":464,"column":1}},"key":"vKICPJOI23"}],"key":"XKNP4W9001"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"from numpy.linalg import lstsq\nresid = zeros(30)\nresid[0] = norm(b)\nfor m in range(1, 30):\n    z = lstsq(A @ Km[:, :m], b, rcond=None)[0]\n    x = Km[:, :m] @ z\n    resid[m] = norm(b - A @ x)","key":"OPeGtV9Xvc"},{"type":"output","id":"3iln25NNnKt1cYvDl58V9","data":[],"key":"ejriPkaHG9"}],"data":{},"key":"oXXJHfQ9YV"},{"type":"paragraph","position":{"start":{"line":476,"column":1},"end":{"line":476,"column":1}},"children":[{"type":"text","value":"The linear system approximations show smooth linear convergence at first, but the convergence stagnates after only a few digits have been found.","position":{"start":{"line":476,"column":1},"end":{"line":476,"column":1}},"key":"Zq4HAZoWqL"}],"key":"ofvgthfocV"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"semilogy(range(30), resid, \"-o\")\nxlabel(\"$m$\"),  ylabel(\"$\\\\| b-Ax_m \\\\|$\")\ntitle((\"Residual for linear systems\"));","key":"S8qHlQjpCS"},{"type":"output","id":"KRRe5bmcxc2Es8Bbudniw","data":[{"output_type":"display_data","metadata":{},"data":{"text/plain":{"content":"<Figure size 700x400 with 1 Axes>","content_type":"text/plain"},"image/png":{"content_type":"image/png","hash":"514aea2457ab3d0027b1a8e9fe140093","path":"fncbook.com/build/514aea2457ab3d0027b1a8e9fe140093.png"}}}],"key":"rpLdYubFHw"}],"data":{},"key":"trHkj7u2qR"}],"label":"demo-subspace-unstable-python","identifier":"demo-subspace-unstable-python","html_id":"demo-subspace-unstable-python","key":"fxOYfNnxRc"},{"type":"details","open":true,"children":[{"type":"summary","children":[{"type":"crossReference","identifier":"demo-subspace-arnoldi","label":"demo-subspace-arnoldi","kind":"proof:example","position":{"start":{"line":486,"column":1},"end":{"line":486,"column":23}},"children":[{"type":"text","value":"Example ","key":"gybp6E4lVx"},{"type":"text","value":"8.4.2","key":"rSt681Hxvm"}],"template":"Example %s","enumerator":"8.4.2","resolved":true,"html_id":"demo-subspace-arnoldi","remote":true,"url":"/subspace","dataUrl":"/subspace.json","key":"zKb19Rdxtj"}],"key":"s7Qj7MOmh7"},{"type":"paragraph","position":{"start":{"line":488,"column":1},"end":{"line":488,"column":1}},"children":[{"type":"text","value":"We illustrate a few steps of the Arnoldi iteration for a small matrix.","position":{"start":{"line":488,"column":1},"end":{"line":488,"column":1}},"key":"kfGz5Ghwkj"}],"key":"cffwg1dtTz"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"A = random.choice(range(10), (6, 6))\nprint(A)","key":"ZEz2C7XPTd"},{"type":"output","id":"1JcPc6IOjuCUlTiKAuGB-","data":[{"output_type":"stream","name":"stdout","text":"[[1 3 7 3 9 7]\n [0 8 4 9 8 6]\n [8 1 9 9 5 1]\n [5 9 4 3 6 3]\n [8 8 6 7 5 2]\n [3 8 4 6 8 5]]\n"}],"key":"R2jxACLjm5"}],"data":{},"key":"weDs6TufYd"},{"type":"paragraph","position":{"start":{"line":495,"column":1},"end":{"line":495,"column":1}},"children":[{"type":"text","value":"The seed vector we choose here determines the first member of the orthonormal basis.","position":{"start":{"line":495,"column":1},"end":{"line":495,"column":1}},"key":"a8I6rcjl4k"}],"key":"OxbRnnHtGR"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"u = random.randn(6)\nQ = zeros([6, 3])\nQ[:, 0] = u / norm(u)","key":"bhe2XghMI0"},{"type":"output","id":"5uOH-bcA1Wnv-qTXZ6Pdh","data":[],"key":"wwasqsuhEU"}],"data":{},"key":"vNCV5iQexN"},{"type":"paragraph","position":{"start":{"line":503,"column":1},"end":{"line":503,"column":1}},"children":[{"type":"text","value":"Multiplication by ","position":{"start":{"line":503,"column":1},"end":{"line":503,"column":1}},"key":"NYtYkpfQoW"},{"type":"inlineMath","value":"\\mathbf{A}","position":{"start":{"line":503,"column":1},"end":{"line":503,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi mathvariant=\"bold\">A</mi></mrow><annotation encoding=\"application/x-tex\">\\mathbf{A}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6861em;\"></span><span class=\"mord mathbf\">A</span></span></span></span>","key":"XCn5LTiq1s"},{"type":"text","value":" gives us a new vector in ","position":{"start":{"line":503,"column":1},"end":{"line":503,"column":1}},"key":"Lpg8k7rAdW"},{"type":"inlineMath","value":"\\mathcal{K}_2","position":{"start":{"line":503,"column":1},"end":{"line":503,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi mathvariant=\"script\">K</mi><mn>2</mn></msub></mrow><annotation encoding=\"application/x-tex\">\\mathcal{K}_2</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8333em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathcal\" style=\"margin-right:0.01445em;\">K</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3011em;\"><span style=\"top:-2.55em;margin-left:-0.0144em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span>","key":"zfZAXqaYmV"},{"type":"text","value":".","position":{"start":{"line":503,"column":1},"end":{"line":503,"column":1}},"key":"EPeyHLZNYg"}],"key":"AGoDZ7PxbI"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"Aq = A @ Q[:, 0]","key":"E2oDjisLCN"},{"type":"output","id":"If5xa0eAki51ppv01BeAl","data":[],"key":"k0obAY3vFt"}],"data":{},"key":"J0K1v4TLcd"},{"type":"paragraph","position":{"start":{"line":509,"column":1},"end":{"line":509,"column":1}},"children":[{"type":"text","value":"We subtract off its projection in the previous direction. The remainder is rescaled to give us the next orthonormal column.","position":{"start":{"line":509,"column":1},"end":{"line":509,"column":1}},"key":"CUwlXUkOCZ"}],"key":"DVDPfERliw"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"v = Aq - dot(Q[:, 0], Aq) * Q[:, 0]\nQ[:, 1] = v / norm(v)","key":"LizQrhdk5z"},{"type":"output","id":"cM7Ik_itDfOzwQT3XgLyG","data":[],"key":"ZkFhZQNDlQ"}],"data":{},"key":"dl9MeAWJIk"},{"type":"paragraph","position":{"start":{"line":516,"column":1},"end":{"line":516,"column":1}},"children":[{"type":"text","value":"On the next pass, we have to subtract off the projections in two previous directions.","position":{"start":{"line":516,"column":1},"end":{"line":516,"column":1}},"key":"vg2OWRdsoa"}],"key":"O9ovNKoTxy"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"Aq = A @ Q[:, 1]\nv = Aq - dot(Q[:, 0], Aq) * Q[:, 0] - dot(Q[:, 1], Aq) * Q[:, 1]\nQ[:, 2] = v / norm(v)","key":"nCrXmGi6b1"},{"type":"output","id":"sYCTUF0AiC2t5sahbeaom","data":[],"key":"VMOhRJtR6p"}],"data":{},"key":"brLyNxyYB7"},{"type":"paragraph","position":{"start":{"line":524,"column":1},"end":{"line":524,"column":1}},"children":[{"type":"text","value":"At every step, ","position":{"start":{"line":524,"column":1},"end":{"line":524,"column":1}},"key":"VwvLpT5EHf"},{"type":"inlineMath","value":"\\mathbf{Q}_m","position":{"start":{"line":524,"column":1},"end":{"line":524,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi mathvariant=\"bold\">Q</mi><mi>m</mi></msub></mrow><annotation encoding=\"application/x-tex\">\\mathbf{Q}_m</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8805em;vertical-align:-0.1944em;\"></span><span class=\"mord\"><span class=\"mord mathbf\">Q</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.1514em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">m</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span>","key":"ffSNsS0Fbs"},{"type":"text","value":" is an ","key":"APJ9bUWI5g"},{"type":"abbreviation","title":"matrix with orthonormal columns","children":[{"type":"text","value":"ONC","key":"io8u38ZHRH"}],"key":"opFtKUBX3r"},{"type":"text","value":" matrix.","key":"cht6v02rQb"}],"key":"d4XH84WMMW"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"print(f\"should be near zero: {norm(Q.T @ Q - eye(3)):.2e}\")","key":"jXiznADB6D"},{"type":"output","id":"Bhw_WisBS0k8HCJ8LoZv7","data":[{"output_type":"stream","name":"stdout","text":"should be near zero: 1.37e-15\n"}],"key":"qe5gWDLN1L"}],"data":{},"key":"jZThymvws1"},{"type":"paragraph","position":{"start":{"line":530,"column":1},"end":{"line":530,"column":1}},"children":[{"type":"text","value":"And ","position":{"start":{"line":530,"column":1},"end":{"line":530,"column":1}},"key":"QkKPZeCuMC"},{"type":"inlineMath","value":"\\mathbf{Q}_m","position":{"start":{"line":530,"column":1},"end":{"line":530,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi mathvariant=\"bold\">Q</mi><mi>m</mi></msub></mrow><annotation encoding=\"application/x-tex\">\\mathbf{Q}_m</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8805em;vertical-align:-0.1944em;\"></span><span class=\"mord\"><span class=\"mord mathbf\">Q</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.1514em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">m</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span>","key":"Fbn7PMRJxf"},{"type":"text","value":" spans the same space as the three-dimensional Krylov matrix.","position":{"start":{"line":530,"column":1},"end":{"line":530,"column":1}},"key":"YdYJQ1FqT4"}],"key":"nbVJ5nC7Zo"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"from numpy.linalg import matrix_rank\nK = stack([u, A @ u, A @ A @ u], axis=-1)\nQ_and_K = hstack([Q, K])\nprint(matrix_rank(Q_and_K))","key":"O6D4N59bWE"},{"type":"output","id":"wA3YozpeGaLIK0z4XON5r","data":[{"output_type":"stream","name":"stdout","text":"3\n"}],"key":"GcB5uYpid9"}],"data":{},"key":"moy0uy5lso"}],"label":"demo-subspace-arnoldi-python","identifier":"demo-subspace-arnoldi-python","html_id":"demo-subspace-arnoldi-python","key":"rfwtnqEU42"},{"type":"heading","depth":3,"position":{"start":{"line":540,"column":1},"end":{"line":540,"column":1}},"children":[{"type":"text","value":"8.5 ","position":{"start":{"line":540,"column":1},"end":{"line":540,"column":1}},"key":"UvCd3lUvly"},{"type":"link","identifier":"section-krylov-gmres","label":"section-krylov-gmres","kind":"narrative","position":{"start":{"line":540,"column":5},"end":{"line":540,"column":26}},"url":"/gmres","internal":true,"dataUrl":"/gmres.json","children":[{"type":"text","value":"GMRES","key":"fceUbRdCYt"}],"key":"eh4iu6WwpD"}],"identifier":"id-8-5","label":"8.5 ","html_id":"id-8-5","implicit":true,"key":"Fn5HdHKQdS"},{"type":"details","open":true,"children":[{"type":"summary","children":[{"type":"crossReference","identifier":"demo-gmres-intro","label":"demo-gmres-intro","kind":"proof:example","position":{"start":{"line":543,"column":1},"end":{"line":543,"column":18}},"children":[{"type":"text","value":"Example ","key":"DVVnlbyDVf"},{"type":"text","value":"8.5.1","key":"nU2NbDb3tG"}],"template":"Example %s","enumerator":"8.5.1","resolved":true,"html_id":"demo-gmres-intro","remote":true,"url":"/gmres","dataUrl":"/gmres.json","key":"yfNbUswXTm"}],"key":"PLP4KvLfRI"},{"type":"paragraph","position":{"start":{"line":545,"column":1},"end":{"line":545,"column":1}},"children":[{"type":"text","value":"We define a triangular matrix with known eigenvalues and a random vector ","position":{"start":{"line":545,"column":1},"end":{"line":545,"column":1}},"key":"bcPCgpG5UP"},{"type":"inlineMath","value":"\\mathbf{b}","position":{"start":{"line":545,"column":1},"end":{"line":545,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi mathvariant=\"bold\">b</mi></mrow><annotation encoding=\"application/x-tex\">\\mathbf{b}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6944em;\"></span><span class=\"mord mathbf\">b</span></span></span></span>","key":"b1H8zB3PhL"},{"type":"text","value":".","position":{"start":{"line":545,"column":1},"end":{"line":545,"column":1}},"key":"i1ptCcJiph"}],"key":"UQNYbOvAmm"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"ev = 10 + arange(1, 101)\nA = triu(random.rand(100, 100), 1) + diag(ev)\nb = random.rand(100)","key":"I9rTk7FhQC"},{"type":"output","id":"uBwPwd2Cb5K5wpPEsexoI","data":[],"key":"JOHMOpKVEX"}],"data":{},"key":"WJxx3FESmN"},{"type":"paragraph","position":{"start":{"line":553,"column":1},"end":{"line":553,"column":1}},"children":[{"type":"text","value":"Instead of building the Krylov matrices, we use the Arnoldi iteration to generate equivalent orthonormal vectors.","position":{"start":{"line":553,"column":1},"end":{"line":553,"column":1}},"key":"xuMy1rUxOu"}],"key":"Tk5gZT2ZAY"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"Q, H = FNC.arnoldi(A, b, 60)\nprint(H[:5, :5])","key":"hOgwnKaMgh"},{"type":"output","id":"LFtklkH3wptquAIqYPNhA","data":[{"output_type":"stream","name":"stdout","text":"[[77.37734323 37.68198103  7.76623215  1.4210155  -1.1732659 ]\n [19.64964842 54.58286026 32.01581406  1.42820014 -0.16509739]\n [ 0.         25.90932193 57.80119766 25.28685492  0.73134252]\n [ 0.          0.         21.98286939 62.9391178  25.25320201]\n [ 0.          0.          0.         23.81918315 55.34041208]]\n"}],"key":"wbxV265cVA"}],"data":{},"key":"IHLn2ftiTV"},{"type":"paragraph","position":{"start":{"line":560,"column":1},"end":{"line":560,"column":1}},"children":[{"type":"text","value":"The Arnoldi bases are used to solve the least-squares problems defining the GMRES iterates.","position":{"start":{"line":560,"column":1},"end":{"line":560,"column":1}},"key":"fnBzWeaITA"}],"key":"sSRpYlaOhn"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"from numpy.linalg import lstsq\nresid = zeros(61)\nresid[0] = norm(b)\nfor m in range(1, 61):\n    s = hstack([norm(b), zeros(m)])\n    z = lstsq(H[: m + 1, :m], s, rcond=None)[0]\n    x = Q[:, :m] @ z\n    resid[m] = norm(b - A @ x)","key":"dBGXp6bDwl"},{"type":"output","id":"rUjOSDfP4wf0lHmsjuaCU","data":[],"key":"une2pVzr9z"}],"data":{},"key":"zkZWVP4k8t"},{"type":"paragraph","position":{"start":{"line":573,"column":1},"end":{"line":573,"column":1}},"children":[{"type":"text","value":"The approximations converge smoothly, practically all the way to machine epsilon.","position":{"start":{"line":573,"column":1},"end":{"line":573,"column":1}},"key":"nzureVavFc"}],"key":"oLZPsl2Rox"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"semilogy(range(61), resid, \"-o\")\nxlabel(\"$m$\"),  ylabel(\"$\\| b-Ax_m \\|$\")\ntitle(\"Residual for GMRES\");","key":"wmzgC7GOPh"},{"type":"output","id":"uM5QJTu2OZ_VdBmYrSckD","data":[{"output_type":"stream","name":"stderr","text":"<>:2: SyntaxWarning: invalid escape sequence '\\|'\n<>:2: SyntaxWarning: invalid escape sequence '\\|'\n/var/folders/gc/0752xrm56pnf0r0dsrn5370c0000gr/T/ipykernel_93664/580350478.py:2: SyntaxWarning: invalid escape sequence '\\|'\n  xlabel(\"$m$\"),  ylabel(\"$\\| b-Ax_m \\|$\")\n"},{"output_type":"display_data","metadata":{},"data":{"text/plain":{"content":"<Figure size 700x400 with 1 Axes>","content_type":"text/plain"},"image/png":{"content_type":"image/png","hash":"022b4c763f100849068b7939f599e11d","path":"fncbook.com/build/022b4c763f100849068b7939f599e11d.png"}}}],"key":"eBw5pFP6s2"}],"data":{},"key":"ZQCLN0qYZe"}],"label":"demo-gmres-intro-python","identifier":"demo-gmres-intro-python","html_id":"demo-gmres-intro-python","key":"rWGQ8Rcm5G"},{"type":"details","open":true,"children":[{"type":"summary","children":[{"type":"crossReference","identifier":"demo-gmres-restart","label":"demo-gmres-restart","kind":"proof:example","position":{"start":{"line":583,"column":1},"end":{"line":583,"column":20}},"children":[{"type":"text","value":"Example ","key":"KBPmqOWgYo"},{"type":"text","value":"8.5.2","key":"wOxyLjCsCP"}],"template":"Example %s","enumerator":"8.5.2","resolved":true,"html_id":"demo-gmres-restart","remote":true,"url":"/gmres","dataUrl":"/gmres.json","key":"GUXGhXGlqU"}],"key":"JKzErD0doS"},{"type":"paragraph","position":{"start":{"line":585,"column":1},"end":{"line":585,"column":1}},"children":[{"type":"text","value":"The following experiments are based on a matrix resulting from discretization of a partial differential equation.","position":{"start":{"line":585,"column":1},"end":{"line":585,"column":1}},"key":"Sek3EU8F57"}],"key":"Z6f6PPbtIG"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"d = 50;  n = d**2\nA = FNC.poisson2d(d)\nb = ones(n)\nspy(A);","key":"u3WZiPq8CF"},{"type":"output","id":"0cMbbUQHpAWXipkHN7jak","data":[{"output_type":"display_data","metadata":{},"data":{"text/plain":{"content":"<Figure size 700x400 with 1 Axes>","content_type":"text/plain"},"image/png":{"content_type":"image/png","hash":"2f28202d37aec32e09f3f84a559b5d9f","path":"fncbook.com/build/2f28202d37aec32e09f3f84a559b5d9f.png"}}}],"key":"AM1r69rHRP"}],"data":{},"key":"oSOvb5amvl"},{"type":"paragraph","position":{"start":{"line":597,"column":1},"end":{"line":597,"column":1}},"children":[{"type":"text","value":"We compare unrestarted GMRES with three different thresholds for restarting. Here we are using ","position":{"start":{"line":597,"column":1},"end":{"line":597,"column":1}},"key":"xbT7Noyd5b"},{"type":"inlineCode","value":"gmres","position":{"start":{"line":597,"column":1},"end":{"line":597,"column":1}},"key":"nnysYLoODy"},{"type":"text","value":" from ","position":{"start":{"line":597,"column":1},"end":{"line":597,"column":1}},"key":"MZfhSYtPE9"},{"type":"inlineCode","value":"scipy.sparse.linalg","position":{"start":{"line":597,"column":1},"end":{"line":597,"column":1}},"key":"dEXVoT47rZ"},{"type":"text","value":", since our simple implementation does not offer restarting. We’re also using a trick to accumulate the vector of residual norms as it runs.","position":{"start":{"line":597,"column":1},"end":{"line":597,"column":1}},"key":"D7J8rvoXXB"}],"indexEntries":[{"entry":"Python","subEntry":{"value":"gmres","kind":"entry"},"emphasis":true}],"label":"index-Mwfs5ATOwK","identifier":"index-mwfs5atowk","html_id":"index-mwfs5atowk","key":"IGdpxeLHWS"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"from scipy.sparse.linalg import gmres\nctr = lambda rvec: resid.append(norm(rvec))\nresid = [1.]\nx, flag = gmres(A, b, restart=None, rtol=1e-8, atol=1e-14, maxiter=120, callback=ctr)\nsemilogy(resid); \nxlabel(\"$m$\"), ylabel(\"residual norm\")\ntitle((\"Convergence of unrestarted GMRES\"));","key":"RNC4Blg3Nx"},{"type":"output","id":"qmv7ZP21BNRpqEXdzzNbp","data":[{"output_type":"display_data","metadata":{},"data":{"text/plain":{"content":"<Figure size 700x400 with 1 Axes>","content_type":"text/plain"},"image/png":{"content_type":"image/png","hash":"64c2e4714ac90a8178a228acc4fd1138","path":"fncbook.com/build/64c2e4714ac90a8178a228acc4fd1138.png"}}}],"key":"E4PraSgTBx"}],"data":{},"key":"LFuNoOC3MZ"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"maxit = 120\nrtol = 1e-8\nrestarts = [maxit, 20, 40, 60]\nhist = lambda rvec: resid.append(norm(rvec))\nfor r in restarts:\n    resid = [1.]\n    x, flag = gmres(A, b, restart=r, rtol=rtol, atol=1e-14, maxiter=maxit, callback=hist)\n    semilogy(resid)\n\nylim(1e-8, 2)\nlegend([\"none\", \"20\", \"40\", \"60\"])\ntitle((\"Convergence of restarted GMRES\"));","key":"Axks96YRZC"},{"type":"output","id":"_tsAE6HNMt0tUkm8TKaS4","data":[{"output_type":"display_data","metadata":{},"data":{"text/plain":{"content":"<Figure size 700x400 with 1 Axes>","content_type":"text/plain"},"image/png":{"content_type":"image/png","hash":"9df824ebcea1e928132c8bef193a50fc","path":"fncbook.com/build/9df824ebcea1e928132c8bef193a50fc.png"}}}],"key":"fzb667QT2z"}],"data":{},"key":"paSLMgqA54"},{"type":"paragraph","position":{"start":{"line":624,"column":1},"end":{"line":624,"column":1}},"children":[{"type":"text","value":"The “pure” GMRES curve is the lowest one. All of the other curves agree with it until the first restart. Decreasing the restart value makes the convergence per iteration generally worse, but the time required per iteration smaller as well.","position":{"start":{"line":624,"column":1},"end":{"line":624,"column":1}},"key":"rouS0pq0RV"}],"key":"qEmHhwsDSX"}],"label":"demo-gmres-restart-python","identifier":"demo-gmres-restart-python","html_id":"demo-gmres-restart-python","key":"Bn92JQnVhi"},{"type":"heading","depth":3,"position":{"start":{"line":627,"column":1},"end":{"line":627,"column":1}},"children":[{"type":"text","value":"8.6 ","position":{"start":{"line":627,"column":1},"end":{"line":627,"column":1}},"key":"GYofNQFHn8"},{"type":"link","identifier":"section-krylov-minrescg","label":"section-krylov-minrescg","kind":"narrative","position":{"start":{"line":627,"column":5},"end":{"line":627,"column":29}},"url":"/minrescg","internal":true,"dataUrl":"/minrescg.json","children":[{"type":"text","value":"MINRES and conjugate gradients","key":"SUDiZxHo8Q"}],"key":"SzknGiV3aD"}],"identifier":"id-8-6","label":"8.6 ","html_id":"id-8-6","implicit":true,"key":"XqpDquS8M7"},{"type":"details","open":true,"children":[{"type":"summary","children":[{"type":"crossReference","identifier":"demo-minrescg-indefinite","label":"demo-minrescg-indefinite","kind":"proof:example","position":{"start":{"line":630,"column":1},"end":{"line":630,"column":26}},"children":[{"type":"text","value":"Example ","key":"LrehNLWKIk"},{"type":"text","value":"8.6.2","key":"mIzh4Gf1Dc"}],"template":"Example %s","enumerator":"8.6.2","resolved":true,"html_id":"demo-minrescg-indefinite","remote":true,"url":"/minrescg","dataUrl":"/minrescg.json","key":"rIqoLlYk5E"}],"key":"ywoVzlsOrT"},{"type":"paragraph","position":{"start":{"line":632,"column":1},"end":{"line":632,"column":1}},"children":[{"type":"text","value":"The following matrix is indefinite.","position":{"start":{"line":632,"column":1},"end":{"line":632,"column":1}},"key":"LrAcqkAgwm"}],"key":"t06LRi2IpI"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"from numpy.linalg import eig\nimport scipy.sparse as sp\nA = FNC.poisson2d(10) - 20*sp.eye(100)\nev, _ = eig(A.todense())\nnum_negative_ev = sum(ev < 0)\nprint(f\"There are {sum(ev < 0)} negative and {sum(ev > 0)} positive eigenvalues\")","key":"EkqlCt6nGU"},{"type":"output","id":"wpPG5wnFhgFcHkbMetyp6","data":[{"output_type":"stream","name":"stdout","text":"There are 13 negative and 87 positive eigenvalues\n"}],"key":"ryu83EoCOF"}],"data":{},"key":"hK0p522ufL"},{"type":"paragraph","position":{"start":{"line":643,"column":1},"end":{"line":643,"column":1}},"children":[{"type":"text","value":"We can compute the relevant quantities from ","position":{"start":{"line":643,"column":1},"end":{"line":643,"column":1}},"key":"h78metQmgE"},{"type":"crossReference","kind":"proof:theorem","identifier":"theorem-minrescg-indefinite","label":"theorem-minrescg-indefinite","children":[{"type":"text","value":"Theorem ","key":"cnYOZ7LIdV"},{"type":"text","value":"8.6.1","key":"Z9EXLR2Sor"}],"template":"Theorem %s","enumerator":"8.6.1","resolved":true,"html_id":"theorem-minrescg-indefinite","remote":true,"url":"/minrescg","dataUrl":"/minrescg.json","key":"QUJ7M6nMWo"},{"type":"text","value":".","position":{"start":{"line":643,"column":1},"end":{"line":643,"column":1}},"key":"i3Vf2miG1h"}],"key":"GmJAHNs9po"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"m, M = min(-ev[ev < 0]), max(-ev[ev < 0])\nkappa_minus = M / m\nm, M = min(ev[ev > 0]), max(ev[ev > 0])\nkappa_plus = M / m\nS = sqrt(kappa_plus * kappa_minus)\nrho = sqrt((S - 1) / (S + 1))\nprint(f\"Condition numbers: {kappa_minus:.2e}, {kappa_plus:.2e}\")\nprint(f\"Convergence rate: {rho:.3f}\")","key":"JOvs71qTs3"},{"type":"output","id":"ZiKkG6hI3LeIDtMfsHcQg","data":[{"output_type":"stream","name":"stdout","text":"Condition numbers: 1.02e+01, 3.76e+01\nConvergence rate: 0.950\n"}],"key":"dpGnv68AOq"}],"data":{},"key":"FCtJD1CV2z"},{"type":"paragraph","position":{"start":{"line":656,"column":1},"end":{"line":656,"column":1}},"children":[{"type":"text","value":"Because the iteration number ","position":{"start":{"line":656,"column":1},"end":{"line":656,"column":1}},"key":"tSSesEEZfM"},{"type":"inlineMath","value":"m","position":{"start":{"line":656,"column":1},"end":{"line":656,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>m</mi></mrow><annotation encoding=\"application/x-tex\">m</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">m</span></span></span></span>","key":"KxkNp74xtV"},{"type":"text","value":" is halved in ","position":{"start":{"line":656,"column":1},"end":{"line":656,"column":1}},"key":"B89kIfkKiU"},{"type":"crossReference","kind":"equation","identifier":"minres-conv","label":"minres-conv","children":[{"type":"text","value":"(","key":"oGoTRafHm4"},{"type":"text","value":"8.6.4","key":"Ua4rxXEUmL"},{"type":"text","value":")","key":"KsMhVdsFBW"}],"template":"(%s)","enumerator":"8.6.4","resolved":true,"html_id":"minres-conv","remote":true,"url":"/minrescg","dataUrl":"/minrescg.json","key":"Lo7ArOP5ly"},{"type":"text","value":", the rate constant of linear convergence is the square root of this number, which makes it even closer to 1.","position":{"start":{"line":656,"column":1},"end":{"line":656,"column":1}},"key":"RLZ51xrMTH"}],"key":"oQVXaAaLBy"},{"type":"paragraph","position":{"start":{"line":658,"column":1},"end":{"line":658,"column":1}},"children":[{"type":"text","value":"Now we apply MINRES to a linear system with this matrix, and compare the observed convergence to the upper bound from the theorem.","position":{"start":{"line":658,"column":1},"end":{"line":658,"column":1}},"key":"STm1xR5X9m"}],"key":"J8ILNClwJd"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"from scipy.sparse.linalg import minres\nb = random.rand(100)\nresid = [norm(b)]\nhist = lambda x: resid.append(norm(b - A @ x))\nx, flag = minres(A, b, rtol=1e-8, maxiter=1000, callback=hist)","key":"ca2YE5JKqb"},{"type":"output","id":"ssx55GBKuOyOXvTrbCnEa","data":[],"key":"sqmqpYwa5U"}],"data":{},"indexEntries":[{"entry":"Python","subEntry":{"value":"minres","kind":"entry"},"emphasis":true}],"label":"index-xa3064q5v6","identifier":"index-xa3064q5v6","html_id":"index-xa3064q5v6","key":"MjxnJNrcAM"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"semilogy(resid, \".-\");\nupper = norm(b) * rho**arange(len(resid))\nsemilogy(upper, \"k--\")\nxlabel(\"$m$\"),  ylabel(\"residual norm\")\nlegend([\"MINRES\", \"upper bound\"], loc=\"lower left\")\ntitle(\"Convergence of MINRES\");","visibility":"hide","key":"v3nskkz3tx"},{"type":"output","id":"vWrxPDMJpaEeUGR3nKvx5","data":[{"output_type":"display_data","metadata":{},"data":{"text/plain":{"content":"<Figure size 700x400 with 1 Axes>","content_type":"text/plain"},"image/png":{"content_type":"image/png","hash":"c5f62a47539e6bbfb3ea02622839aa68","path":"fncbook.com/build/c5f62a47539e6bbfb3ea02622839aa68.png"}}}],"visibility":"show","key":"BtfkIu7aCw"}],"data":{"tags":[]},"visibility":"show","key":"gqJnab3ba2"},{"type":"paragraph","position":{"start":{"line":681,"column":1},"end":{"line":681,"column":1}},"children":[{"type":"text","value":"The upper bound turns out to be pessimistic here, especially in the later iterations. However, you can see a slow linear phase in the convergence that tracks the bound closely.","position":{"start":{"line":681,"column":1},"end":{"line":681,"column":1}},"key":"L7hhDsqtn7"}],"key":"Jlkkscy8VX"}],"label":"demo-minrescg-indefinite-python","identifier":"demo-minrescg-indefinite-python","html_id":"demo-minrescg-indefinite-python","key":"LTAHeGknUA"},{"type":"details","open":true,"children":[{"type":"summary","children":[{"type":"crossReference","identifier":"demo-minrescg-converge","label":"demo-minrescg-converge","kind":"proof:example","position":{"start":{"line":685,"column":1},"end":{"line":685,"column":24}},"children":[{"type":"text","value":"Example ","key":"n3wqMgnmOI"},{"type":"text","value":"8.6.3","key":"RYiQjVTgpL"}],"template":"Example %s","enumerator":"8.6.3","resolved":true,"html_id":"demo-minrescg-converge","remote":true,"url":"/minrescg","dataUrl":"/minrescg.json","key":"oHhNoD8Is8"}],"key":"wcIIWQgi8K"},{"type":"paragraph","position":{"start":{"line":687,"column":1},"end":{"line":687,"column":1}},"children":[{"type":"text","value":"We will compare MINRES and CG on some quasi-random ","key":"qkXn7PQzjD"},{"type":"abbreviation","title":"symmetric positive definite","children":[{"type":"text","value":"SPD","key":"Zfj4PKII5a"}],"key":"BR3sV3yua0"},{"type":"text","value":" problems.  The first matrix has a condition number of 100.","key":"GnDYMp4AZV"}],"key":"mPln2IiEGq"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"n = 5000\ndensity = 0.001\nA = FNC.sprandsym(n, density, rcond=1e-2)\nx = arange(1, n+1) / n\nb = A @ x","key":"eKskGh7dS5"},{"type":"output","id":"9Ujx_Pbl4JQLziWz1KJTg","data":[],"key":"IKWI2UZ72u"}],"data":{},"key":"eiY5zozjV1"},{"type":"paragraph","position":{"start":{"line":700,"column":1},"end":{"line":700,"column":1}},"children":[{"type":"text","value":"Now we apply both methods and compare the convergence of the system residuals, using implementations imported from ","position":{"start":{"line":700,"column":1},"end":{"line":700,"column":1}},"key":"zh0h0wsA98"},{"type":"inlineCode","value":"scipy.sparse.linalg","position":{"start":{"line":700,"column":1},"end":{"line":700,"column":1}},"key":"oyDCE60sbK"},{"type":"text","value":".","position":{"start":{"line":700,"column":1},"end":{"line":700,"column":1}},"key":"g1BBiqgRSv"}],"indexEntries":[{"entry":"Python","subEntry":{"value":"cg","kind":"entry"},"emphasis":true},{"entry":"Python","subEntry":{"value":"minres","kind":"entry"},"emphasis":false}],"label":"index-dr00xDFz1O","identifier":"index-dr00xdfz1o","html_id":"index-dr00xdfz1o","key":"esvlSyy2Hl"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"from scipy.sparse.linalg import cg, minres\nhist = lambda x: resid.append(norm(b - A @ x))\n\nresid = [norm(b)]\nxMR, flag = minres(A, b, rtol=1e-12, maxiter=100, callback=hist)\nsemilogy(resid / norm(b), label=\"MINRES\")\n\nresid = [norm(b)]\nxCG, flag = cg(A, b, rtol=1e-12, maxiter=100, callback=hist)\nsemilogy(resid / norm(b), label=\"CG\")\n\nxlabel(\"Krylov dimension $m$\"), ylabel(\"$\\\\|r_m\\\\| / \\\\|b\\\\|$\")\ngrid(),  legend(),  title(\"Convergence of MINRES and CG\");","key":"H51SUnyhub"},{"type":"output","id":"DquZ2PwCS_10fk7rSVrFU","data":[{"output_type":"display_data","metadata":{},"data":{"text/plain":{"content":"<Figure size 700x400 with 1 Axes>","content_type":"text/plain"},"image/png":{"content_type":"image/png","hash":"65f60d3f917a6ab2f897cad74e68b4e9","path":"fncbook.com/build/65f60d3f917a6ab2f897cad74e68b4e9.png"}}}],"key":"rj6Zju95Qu"}],"data":{},"key":"KGx1ksFK60"},{"type":"paragraph","position":{"start":{"line":718,"column":1},"end":{"line":718,"column":1}},"children":[{"type":"text","value":"There is little difference between the two methods here. Both achieve relative residual of ","position":{"start":{"line":718,"column":1},"end":{"line":718,"column":1}},"key":"vha8fOGAfO"},{"type":"span","position":{"start":{"line":718,"column":1},"end":{"line":718,"column":1}},"children":[{"type":"text","value":"10","key":"Pd3E7rKQY8"},{"type":"superscript","children":[{"type":"text","value":"-6","key":"nSkRccYI34"}],"key":"DVGRWOML7m"}],"key":"RmT5aUvWv8"},{"type":"text","value":" in aout 60 iterations, for example. The final errors are similar, too.","position":{"start":{"line":718,"column":1},"end":{"line":718,"column":1}},"key":"uOR8LgGti1"}],"key":"vcIdGVWZGI"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"print(f\"MINRES error: {norm(xMR - x) / norm(x):.2e}\")\nprint(f\"CG error: {norm(xCG - x) / norm(x):.2e}\")","key":"Pjf8mOhMo3"},{"type":"output","id":"S5SGmdwi8lr6dsoJVT5TH","data":[{"output_type":"stream","name":"stdout","text":"MINRES error: 4.68e-09\nCG error: 2.98e-09\n"}],"key":"TIdxAns5c2"}],"data":{},"key":"TDmfnk9GaY"},{"type":"paragraph","position":{"start":{"line":725,"column":1},"end":{"line":725,"column":1}},"children":[{"type":"text","value":"Next, we increase the condition number of the matrix by a factor of 25. The rule of thumb predicts that the number of iterations required should increase by a factor of about 5; i.e., 300 iterations to reach ","position":{"start":{"line":725,"column":1},"end":{"line":725,"column":1}},"key":"aB4hlBnEjE"},{"type":"span","position":{"start":{"line":725,"column":1},"end":{"line":725,"column":1}},"children":[{"type":"text","value":"10","key":"HvGrv68fCG"},{"type":"superscript","children":[{"type":"text","value":"-6","key":"YyaxJ9CwjN"}],"key":"K7e69985AW"}],"key":"Zt6MILbur6"},{"type":"text","value":".","position":{"start":{"line":725,"column":1},"end":{"line":725,"column":1}},"key":"THXvXeJPJn"}],"key":"KhEdTa4e4s"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"A = FNC.sprandsym(n, density, rcond=1e-2 / 25)\nx = arange(1, n+1) / n\nb = A @ x","key":"d3nAKeML0k"},{"type":"output","id":"iLNgjA4pPm-dU2dvqzh_U","data":[],"key":"Jg6cwwpZJo"}],"data":{},"key":"GVGCWQWLAh"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"from scipy.sparse.linalg import cg, minres\nhist = lambda x: resid.append(norm(b - A @ x))\n\nresid = [norm(b)]\nxMR, flag = minres(A, b, rtol=1e-12, maxiter=400, callback=hist)\nsemilogy(resid / norm(b), label=\"MINRES\")\n\nresid = [norm(b)]\nxCG, flag = cg(A, b, rtol=1e-12, maxiter=400, callback=hist)\nsemilogy(resid / norm(b), label=\"CG\")\n\nxlabel(\"Krylov dimension $m$\"), ylabel(\"$\\\\|r_m\\\\| / \\\\|b\\\\|$\")\ngrid(),  legend(),  title(\"Convergence of MINRES and CG\")\n\nprint(f\"MINRES error: {norm(xMR - x) / norm(x):.2e}\")\nprint(f\"CG error: {norm(xCG - x) / norm(x):.2e}\")","visibility":"hide","key":"Xij3oUZHQL"},{"type":"output","id":"25aFkh5mTFZaAlf-YzZC1","data":[{"output_type":"stream","name":"stdout","text":"MINRES error: 2.52e-07\nCG error: 1.50e-07\n"},{"output_type":"display_data","metadata":{},"data":{"text/plain":{"content":"<Figure size 700x400 with 1 Axes>","content_type":"text/plain"},"image/png":{"content_type":"image/png","hash":"c0ae9bceec8d5e70ba1b25d07c9d2250","path":"fncbook.com/build/c0ae9bceec8d5e70ba1b25d07c9d2250.png"}}}],"visibility":"show","key":"YQGmv7jKyS"}],"data":{"tags":[]},"visibility":"show","key":"O1Cu4OvblB"},{"type":"paragraph","position":{"start":{"line":753,"column":1},"end":{"line":753,"column":1}},"children":[{"type":"text","value":"Both methods have an early superlinear phase that allow them to finish slightly sooner than the factor of 5 predicted: ","position":{"start":{"line":753,"column":1},"end":{"line":753,"column":1}},"key":"ZmO3EM15PH"},{"type":"crossReference","kind":"proof:theorem","identifier":"theorem-minrescg-converge","label":"theorem-minrescg-converge","children":[{"type":"text","value":"Theorem ","key":"NeGMVxkXM0"},{"type":"text","value":"8.6.2","key":"Mai72ofele"}],"template":"Theorem %s","enumerator":"8.6.2","resolved":true,"html_id":"theorem-minrescg-converge","remote":true,"url":"/minrescg","dataUrl":"/minrescg.json","key":"ul2UJMXdKb"},{"type":"text","value":" is an upper bound, not necessarily an approximation.","position":{"start":{"line":753,"column":1},"end":{"line":753,"column":1}},"key":"TYLXpH6fuL"}],"key":"k3iiAPY2JG"}],"label":"demo-minrescg-converge-python","identifier":"demo-minrescg-converge-python","html_id":"demo-minrescg-converge-python","key":"pj2TNPsKaf"},{"type":"heading","depth":3,"position":{"start":{"line":756,"column":1},"end":{"line":756,"column":1}},"children":[{"type":"text","value":"8.7 ","position":{"start":{"line":756,"column":1},"end":{"line":756,"column":1}},"key":"N8k8YaSA8j"},{"type":"link","identifier":"section-krylov-matrixfree","label":"section-krylov-matrixfree","kind":"narrative","position":{"start":{"line":756,"column":5},"end":{"line":756,"column":31}},"url":"/matrixfree","internal":true,"dataUrl":"/matrixfree.json","children":[{"type":"text","value":"Matrix-free iterations","key":"DpsQ49o7YA"}],"key":"PYYJ3S62mh"}],"identifier":"id-8-7","label":"8.7 ","html_id":"id-8-7","implicit":true,"key":"AMkUvqmwha"},{"type":"details","open":true,"children":[{"type":"summary","children":[{"type":"crossReference","identifier":"demo-matrixfree-blur","label":"demo-matrixfree-blur","kind":"proof:example","position":{"start":{"line":759,"column":1},"end":{"line":759,"column":22}},"children":[{"type":"text","value":"Example ","key":"lCR3De625R"},{"type":"text","value":"8.7.1","key":"LRLaVq1Qcz"}],"template":"Example %s","enumerator":"8.7.1","resolved":true,"html_id":"demo-matrixfree-blur","remote":true,"url":"/matrixfree","dataUrl":"/matrixfree.json","key":"YjF0nvM2Sr"}],"key":"ssFDCcZw7n"},{"type":"paragraph","position":{"start":{"line":761,"column":1},"end":{"line":761,"column":1}},"children":[{"type":"text","value":"We use a readily available test image.","position":{"start":{"line":761,"column":1},"end":{"line":761,"column":1}},"key":"u3iMdgO8MO"}],"key":"wNghVwnVG5"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"from skimage import data as testimages\nfrom skimage.color import rgb2gray\nimg = getattr(testimages, \"coffee\")()\nX = rgb2gray(img)\nimshow(X, cmap=\"gray\");","key":"qvLkKzoJeX"},{"type":"output","id":"dw_2YJ0rurPm_HA43NWiS","data":[{"output_type":"display_data","metadata":{},"data":{"text/plain":{"content":"<Figure size 700x400 with 1 Axes>","content_type":"text/plain"},"image/png":{"content_type":"image/png","hash":"d2bec04d13cf33ce992d054cda071a24","path":"fncbook.com/build/d2bec04d13cf33ce992d054cda071a24.png"}}}],"key":"Bzczy8axTM"}],"data":{},"key":"RTxa4uhtGk"},{"type":"paragraph","position":{"start":{"line":771,"column":1},"end":{"line":771,"column":1}},"children":[{"type":"text","value":"We define the one-dimensional tridiagonal blurring matrices.","position":{"start":{"line":771,"column":1},"end":{"line":771,"column":1}},"key":"a96zepsXE1"}],"key":"Pj1JzotTMq"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"import scipy.sparse as sp\ndef blurmatrix(d):\n    data = [[0.25] * (d-1), [0.5] * d, [0.25] * (d-1)]\n    return sp.diags(data, [-1, 0, 1], shape=(d, d))\n\nm, n = X.shape\nB = blurmatrix(m)\nC = blurmatrix(n)","key":"PaBTTOYe0R"},{"type":"output","id":"Y7KZy9VlVxRupxFJmJ30-","data":[],"key":"uYD22HGlfJ"}],"data":{},"key":"DNPaTddgX2"},{"type":"paragraph","position":{"start":{"line":784,"column":1},"end":{"line":784,"column":1}},"children":[{"type":"text","value":"Finally, we show the results of using ","position":{"start":{"line":784,"column":1},"end":{"line":784,"column":1}},"key":"fS0ofoNGCV"},{"type":"inlineMath","value":"k=12","position":{"start":{"line":784,"column":1},"end":{"line":784,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>k</mi><mo>=</mo><mn>12</mn></mrow><annotation encoding=\"application/x-tex\">k=12</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6944em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03148em;\">k</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">12</span></span></span></span>","key":"A1l1s3VWfr"},{"type":"text","value":" repetitions of the blur in each direction.","position":{"start":{"line":784,"column":1},"end":{"line":784,"column":1}},"key":"QKtBKpcFos"}],"key":"X62JGirpcZ"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"from scipy.sparse.linalg import matrix_power\nblur = lambda X: matrix_power(B, 12) @ X @ matrix_power(C, 12)\n\nimshow(blur(X), cmap=\"gray\")\ntitle(\"Blurred image\");","key":"JDGckonlTr"},{"type":"output","id":"B4lvDWqJ5ke1QwHZGvz67","data":[{"output_type":"display_data","metadata":{},"data":{"text/plain":{"content":"<Figure size 700x400 with 1 Axes>","content_type":"text/plain"},"image/png":{"content_type":"image/png","hash":"630304258ba17797d84cac30ac121eb3","path":"fncbook.com/build/630304258ba17797d84cac30ac121eb3.png"}}}],"key":"Jyq0SMbeRS"}],"data":{},"key":"oy0atm3JLP"}],"label":"demo-matrixfree-blur-python","identifier":"demo-matrixfree-blur-python","html_id":"demo-matrixfree-blur-python","key":"KXLsY593bh"},{"type":"details","open":true,"children":[{"type":"summary","children":[{"type":"crossReference","identifier":"demo-matrixfree-deblur","label":"demo-matrixfree-deblur","kind":"proof:example","position":{"start":{"line":796,"column":1},"end":{"line":796,"column":24}},"children":[{"type":"text","value":"Example ","key":"VcqQWXmSnR"},{"type":"text","value":"8.7.2","key":"G9MOBAIVbr"}],"template":"Example %s","enumerator":"8.7.2","resolved":true,"html_id":"demo-matrixfree-deblur","remote":true,"url":"/matrixfree","dataUrl":"/matrixfree.json","key":"HfqLM63OI5"}],"key":"W5j1KApvas"},{"type":"paragraph","position":{"start":{"line":798,"column":1},"end":{"line":798,"column":1}},"children":[{"type":"text","value":"We repeat the earlier process to blur an original image ","position":{"start":{"line":798,"column":1},"end":{"line":798,"column":1}},"key":"rGzitfJPVN"},{"type":"inlineMath","value":"\\mathbf{X}","position":{"start":{"line":798,"column":1},"end":{"line":798,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi mathvariant=\"bold\">X</mi></mrow><annotation encoding=\"application/x-tex\">\\mathbf{X}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6861em;\"></span><span class=\"mord mathbf\">X</span></span></span></span>","key":"fgahY5ZNrq"},{"type":"text","value":" to get ","position":{"start":{"line":798,"column":1},"end":{"line":798,"column":1}},"key":"IEQ99IdqR3"},{"type":"inlineMath","value":"\\mathbf{Z}","position":{"start":{"line":798,"column":1},"end":{"line":798,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi mathvariant=\"bold\">Z</mi></mrow><annotation encoding=\"application/x-tex\">\\mathbf{Z}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6861em;\"></span><span class=\"mord mathbf\">Z</span></span></span></span>","key":"VJHwtYZLZn"},{"type":"text","value":".","position":{"start":{"line":798,"column":1},"end":{"line":798,"column":1}},"key":"RxMmpsfOuG"}],"key":"A2Ol2PuqHY"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"img = getattr(testimages, \"coffee\")()\nX = rgb2gray(img)\nm, n = X.shape\n\nimport scipy.sparse as sp\ndef blurmatrix(d):\n    data = [[0.25] * (d-1), [0.5] * d, [0.25] * (d-1)]\n    return sp.diags(data, [-1, 0, 1], shape=(d, d))\nB = blurmatrix(m)\nC = blurmatrix(n)\n\nfrom scipy.sparse.linalg import matrix_power\nblur = lambda X: matrix_power(B, 12) @ X @ matrix_power(C, 12)","visibility":"show","key":"MtB2qIBVzq"},{"type":"output","id":"2vUw9ilWgLfDGRCPcAthd","data":[],"visibility":"show","key":"PAdZ4egJnx"}],"data":{"tags":[]},"visibility":"hide","key":"kmnHuIrD55"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"Z = blur(X)\nimshow(Z, cmap=\"gray\")\ntitle(\"Blurred image\");","key":"ulXBH05HI7"},{"type":"output","id":"zmHwLgYO0fYcf1hgMZdsK","data":[{"output_type":"display_data","metadata":{},"data":{"text/plain":{"content":"<Figure size 700x400 with 1 Axes>","content_type":"text/plain"},"image/png":{"content_type":"image/png","hash":"630304258ba17797d84cac30ac121eb3","path":"fncbook.com/build/630304258ba17797d84cac30ac121eb3.png"}}}],"key":"bbdsl50Yuv"}],"data":{},"key":"TUYNsKBz5K"},{"type":"paragraph","position":{"start":{"line":824,"column":1},"end":{"line":824,"column":1}},"children":[{"type":"text","value":"Now we imagine that ","position":{"start":{"line":824,"column":1},"end":{"line":824,"column":1}},"key":"OSW1D8rRHO"},{"type":"inlineMath","value":"\\mathbf{X}","position":{"start":{"line":824,"column":1},"end":{"line":824,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi mathvariant=\"bold\">X</mi></mrow><annotation encoding=\"application/x-tex\">\\mathbf{X}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6861em;\"></span><span class=\"mord mathbf\">X</span></span></span></span>","key":"EGk13yK2RR"},{"type":"text","value":" is unknown and that we want to recover it from ","position":{"start":{"line":824,"column":1},"end":{"line":824,"column":1}},"key":"PQFSYVLzMc"},{"type":"inlineMath","value":"\\mathbf{Z}","position":{"start":{"line":824,"column":1},"end":{"line":824,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi mathvariant=\"bold\">Z</mi></mrow><annotation encoding=\"application/x-tex\">\\mathbf{Z}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6861em;\"></span><span class=\"mord mathbf\">Z</span></span></span></span>","key":"k0ns5SgquW"},{"type":"text","value":". We first need functions that translate between vector and matrix representations.","position":{"start":{"line":824,"column":1},"end":{"line":824,"column":1}},"key":"kytusBCn3o"}],"key":"UEGqztUrMv"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"from scipy.sparse.linalg import LinearOperator\nvec = lambda Z: Z.reshape(m * n)\nunvec = lambda z: z.reshape(m, n)\nxform = lambda x: vec(blur(unvec(x)))","key":"yhTJYsoMc5"},{"type":"output","id":"has65JswhOiojt8cUDXQS","data":[],"key":"YvsuEUt06Y"}],"data":{},"key":"S7nHlim3if"},{"type":"paragraph","position":{"start":{"line":836,"column":1},"end":{"line":836,"column":1}},"children":[{"type":"text","value":"Now we declare the three-step blur transformation as a ","position":{"start":{"line":836,"column":1},"end":{"line":836,"column":1}},"key":"sojYE550qo"},{"type":"inlineCode","value":"LinearOperator","position":{"start":{"line":836,"column":1},"end":{"line":836,"column":1}},"key":"Zy8gBQ1tKk"},{"type":"text","value":", supplying also the size of the vector form of an image.","position":{"start":{"line":836,"column":1},"end":{"line":836,"column":1}},"key":"JJk2vFejRm"}],"indexEntries":[{"entry":"Python","subEntry":{"value":"LinearOperator","kind":"entry"},"emphasis":true}],"label":"index-KWpdVDT3El","identifier":"index-kwpdvdt3el","html_id":"index-kwpdvdt3el","key":"d3aPgnHTNS"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"T = LinearOperator((m * n, m * n), matvec=xform)","key":"ZzREgXBLa9"},{"type":"output","id":"CxQSCF8ucaU0_Q9djwcKs","data":[],"key":"MPp6FtwJ8n"}],"data":{},"key":"heaYYT4WNL"},{"type":"paragraph","position":{"start":{"line":842,"column":1},"end":{"line":842,"column":1}},"children":[{"type":"text","value":"The blurring operators are symmetric, so we apply ","position":{"start":{"line":842,"column":1},"end":{"line":842,"column":1}},"key":"k7IsGjQyQ3"},{"type":"inlineCode","value":"minres","position":{"start":{"line":842,"column":1},"end":{"line":842,"column":1}},"key":"f7YVQoqVF9"},{"type":"text","value":" to the composite blurring transformation ","position":{"start":{"line":842,"column":1},"end":{"line":842,"column":1}},"key":"yaOr7nG3D6"},{"type":"inlineCode","value":"T","position":{"start":{"line":842,"column":1},"end":{"line":842,"column":1}},"key":"VEe5YuVByP"},{"type":"text","value":".","position":{"start":{"line":842,"column":1},"end":{"line":842,"column":1}},"key":"IQ0lMVhG8F"}],"key":"wM7ozjmuIC"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"from scipy.sparse.linalg import gmres\ny, flag = gmres(T, vec(Z), rtol=1e-5, maxiter=50)\nY = unvec(maximum(0, minimum(1, y)))\n\n\nsubplot(1, 2, 1),  imshow(X, cmap=\"gray\")\naxis(\"off\"),  title(\"Original\")\nsubplot(1, 2, 2),  imshow(Y, cmap=\"gray\")\naxis(\"off\"),  title(\"Deblurred\");","key":"RGh2Pu31c4"},{"type":"output","id":"oXP_8TkaRayEwqCvxSsPS","data":[{"output_type":"display_data","metadata":{},"data":{"text/plain":{"content":"<Figure size 700x400 with 2 Axes>","content_type":"text/plain"},"image/png":{"content_type":"image/png","hash":"d3cdd3bb48448fb07e88303f7c9a0081","path":"fncbook.com/build/d3cdd3bb48448fb07e88303f7c9a0081.png"}}}],"key":"p4eVEiZR62"}],"data":{},"key":"TAeHlfJPXr"}],"label":"demo-matrixfree-deblur-python","identifier":"demo-matrixfree-deblur-python","html_id":"demo-matrixfree-deblur-python","key":"a0yCIDX8Ri"},{"type":"heading","depth":3,"position":{"start":{"line":857,"column":1},"end":{"line":857,"column":1}},"children":[{"type":"text","value":"8.8 ","position":{"start":{"line":857,"column":1},"end":{"line":857,"column":1}},"key":"NtreC5xm6P"},{"type":"link","identifier":"section-krylov-precond","label":"section-krylov-precond","kind":"narrative","position":{"start":{"line":857,"column":5},"end":{"line":857,"column":28}},"url":"/precond","internal":true,"dataUrl":"/precond.json","children":[{"type":"text","value":"Preconditioning","key":"itjRQvjRx7"}],"key":"BmU5u1dBsW"}],"identifier":"id-8-8","label":"8.8 ","html_id":"id-8-8","implicit":true,"key":"heJoBk5tlJ"},{"type":"details","open":true,"children":[{"type":"summary","children":[{"type":"crossReference","identifier":"demo-precond-diagonal","label":"demo-precond-diagonal","kind":"proof:example","position":{"start":{"line":860,"column":1},"end":{"line":860,"column":23}},"children":[{"type":"text","value":"Example ","key":"RdMlDf0KMG"},{"type":"text","value":"8.8.1","key":"hZwo6D8K3p"}],"template":"Example %s","enumerator":"8.8.1","resolved":true,"html_id":"demo-precond-diagonal","remote":true,"url":"/precond","dataUrl":"/precond.json","key":"OKrpPjMAfm"}],"key":"shm4ZadK60"},{"type":"paragraph","position":{"start":{"line":862,"column":1},"end":{"line":862,"column":1}},"children":[{"type":"text","value":"Here is an ","key":"gXSqo6pWA0"},{"type":"abbreviation","title":"symmetric positive definite","children":[{"type":"text","value":"SPD","key":"ptGrGT9Kg1"}],"key":"rs1VXFG2wq"},{"type":"text","value":" matrix that arises from solving partial differential equations.","key":"Lh1nsqSbyJ"}],"key":"p1ifzTob2I"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"from scipy.sparse import sparray\nimport rogues\nA = rogues.wathen(60, 60)\nn = A.shape[0]\nprint(f\"Matrix is {n} x {n} with {A.nnz} nonzeros\")","key":"eKf22KeT5z"},{"type":"output","id":"CUG4DJk7UXDe1GQBgd0_S","data":[{"output_type":"stream","name":"stdout","text":"Matrix is 11041 x 11041 with 170161 nonzeros\n"}],"key":"b9lmqngbdy"}],"data":{},"key":"kl7lwL0LSC"},{"type":"paragraph","position":{"start":{"line":875,"column":1},"end":{"line":875,"column":1}},"children":[{"type":"text","value":"There is an easy way to use the diagonal elements of ","position":{"start":{"line":875,"column":1},"end":{"line":875,"column":1}},"key":"C1CscFkRZb"},{"type":"inlineMath","value":"\\mathbf{A}","position":{"start":{"line":875,"column":1},"end":{"line":875,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi mathvariant=\"bold\">A</mi></mrow><annotation encoding=\"application/x-tex\">\\mathbf{A}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6861em;\"></span><span class=\"mord mathbf\">A</span></span></span></span>","key":"uLSctzRgIE"},{"type":"text","value":", or any other vector, as a diagonal preconditioner.","position":{"start":{"line":875,"column":1},"end":{"line":875,"column":1}},"key":"DUIHrygVkw"}],"indexEntries":[{"entry":"Julia","subEntry":{"value":"DiagonalPreconditioner","kind":"entry"},"emphasis":true}],"label":"index-KMQEw6tZ0b","identifier":"index-kmqew6tz0b","html_id":"index-kmqew6tz0b","key":"rjCaR1oY9H"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"import scipy.sparse as sp\nprec = sp.diags(1 / A.diagonal(), 0)","key":"a5ODeRB5BC"},{"type":"output","id":"Q7fJPxnF0mOR9qohIDmfC","data":[],"key":"O2pMKLrSPu"}],"data":{},"key":"EKLGm7o06I"},{"type":"paragraph","position":{"start":{"line":882,"column":1},"end":{"line":882,"column":1}},"children":[{"type":"text","value":"We now compare CG with and without the preconditioner.","position":{"start":{"line":882,"column":1},"end":{"line":882,"column":1}},"key":"jRpC2EzySk"}],"key":"k0XRMvZXE4"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"from scipy.sparse.linalg import cg\nb = ones(n)\nhist = lambda x: resid.append(norm(b - A @ x))\nresid = [norm(b)]\nstart = timer()\nx, _ = cg(A, b, rtol=1e-4, maxiter=200, callback=hist)\nprint(f\"No preconditioner: Finished in {timer() - start:.2f} sec\")\nresid_plain = resid.copy()\nresid = [norm(b)]\nstart = timer()\nx, _ = cg(A, b, rtol=1e-4, maxiter=200, M=prec, callback=hist)\nprint(f\"Diagonal preconditioner: Finished in {timer() - start:.2f} sec\")\nresid_prec = resid.copy()\n\nsemilogy(resid_plain, label=\"no preconditioner\")\nsemilogy(resid_prec, label=\"diagonal preconditioner\")\nxlabel(\"iteration\"), ylabel(\"residual norm\")\nlegend(),  title(\"Convergence of CG with and without preconditioning\");","visibility":"hide","key":"ubEGRyikEw"},{"type":"output","id":"LbOR3AfpxNCHw0ZHAkqNN","data":[{"output_type":"stream","name":"stdout","text":"No preconditioner: Finished in 2.94 sec\n"},{"output_type":"stream","name":"stdout","text":"Diagonal preconditioner: Finished in 0.59 sec\n"},{"output_type":"display_data","metadata":{},"data":{"text/plain":{"content":"<Figure size 700x400 with 1 Axes>","content_type":"text/plain"},"image/png":{"content_type":"image/png","hash":"25e3e3ee9ece5a468d260d843675d79e","path":"fncbook.com/build/25e3e3ee9ece5a468d260d843675d79e.png"}}}],"visibility":"show","key":"xDZV0mqyBW"}],"data":{"tags":[]},"visibility":"show","key":"FBFLc9YEUf"},{"type":"paragraph","position":{"start":{"line":907,"column":1},"end":{"line":907,"column":1}},"children":[{"type":"text","value":"The diagonal preconditioner cut down substantially on the number of iterations and the execution time.","position":{"start":{"line":907,"column":1},"end":{"line":907,"column":1}},"key":"MnQ2p24vcU"}],"key":"TzPbZRP2JW"}],"label":"demo-precond-diagonal-python","identifier":"demo-precond-diagonal-python","html_id":"demo-precond-diagonal-python","key":"FCP2ME4qHj"},{"type":"details","open":true,"children":[{"type":"summary","children":[{"type":"crossReference","identifier":"demo-precond-gmres","label":"demo-precond-gmres","kind":"proof:example","position":{"start":{"line":911,"column":1},"end":{"line":911,"column":20}},"children":[{"type":"text","value":"Example ","key":"nNlS8nyvBz"},{"type":"text","value":"8.8.2","key":"rJSYwtJtjA"}],"template":"Example %s","enumerator":"8.8.2","resolved":true,"html_id":"demo-precond-gmres","remote":true,"url":"/precond","dataUrl":"/precond.json","key":"j24Tlcxx97"}],"key":"Jujd9Esets"},{"type":"paragraph","position":{"start":{"line":913,"column":1},"end":{"line":913,"column":1}},"children":[{"type":"text","value":"Here is a random nonsymmetric matrix.","position":{"start":{"line":913,"column":1},"end":{"line":913,"column":1}},"key":"hXlSfqO3Lp"}],"key":"HOvjFCq02u"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"import scipy.sparse as sp\nn = 8000\nA = 2.8 * sp.eye(n) + sp.rand(n, n, 0.002)","key":"LCFw4wkiLO"},{"type":"output","id":"T4sbThKcuOiRSf4IAmsyY","data":[],"key":"PrwI6POXI8"}],"data":{},"key":"SPGCjiCUYr"},{"type":"paragraph","position":{"start":{"line":921,"column":1},"end":{"line":921,"column":1}},"children":[{"type":"text","value":"Without a preconditioner, GMRES can solve a system with this matrix.","position":{"start":{"line":921,"column":1},"end":{"line":921,"column":1}},"key":"pXiehC9ura"}],"key":"j4lj2c378t"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"from scipy.sparse.linalg import gmres\n\nb = random.rand(n)\nhist = lambda rvec: resid.append(norm(rvec))\nresid = [1.]\n\nstart = timer()\nx, flag = gmres(A, b, maxiter=300, rtol=1e-10, restart=50, callback=hist)\nprint(f\"time for plain GMRES: {timer() - start:.3f} sec\")\nresid_plain = resid.copy()","key":"croAcI0wRY"},{"type":"output","id":"GE8nmjCMPFJtcOs0p17Vq","data":[{"output_type":"stream","name":"stdout","text":"time for plain GMRES: 0.209 sec\n"}],"key":"OGpaSeXJXj"}],"data":{},"key":"bAX9Aqznfr"},{"type":"paragraph","position":{"start":{"line":939,"column":1},"end":{"line":939,"column":1}},"children":[{"type":"text","value":"The following version of incomplete LU factorization drops all sufficiently small values (i.e., replaces them with zeros). This keeps the number of nonzeros in the factors under control.","position":{"start":{"line":939,"column":1},"end":{"line":939,"column":1}},"key":"Wvsel1DcMU"}],"indexEntries":[{"entry":"Python","subEntry":{"value":"spilu","kind":"entry"},"emphasis":true}],"label":"index-bfUkOX8pdZ","identifier":"index-bfukox8pdz","html_id":"index-bfukox8pdz","key":"SWLPAFaWi4"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"from scipy.sparse.linalg import spilu\niLU = spilu(A, drop_tol=0.2)\nprint(f\"Factors have {iLU.nnz} nonzeros, while A has {A.nnz}\")","key":"t4wTpjtwCM"},{"type":"output","id":"IDy59QdfyQMSsdiIn43kA","data":[{"output_type":"stream","name":"stderr","text":"/var/folders/gc/0752xrm56pnf0r0dsrn5370c0000gr/T/ipykernel_93664/769705972.py:2: SparseEfficiencyWarning: spilu converted its input to CSC format\n  iLU = spilu(A, drop_tol=0.2)\n"},{"output_type":"stream","name":"stdout","text":"Factors have 100036 nonzeros, while A has 135987\n"}],"key":"x9KghmRNvc"}],"data":{},"key":"YcxTzG99Of"},{"type":"paragraph","position":{"start":{"line":947,"column":1},"end":{"line":947,"column":1}},"children":[{"type":"text","value":"The result is not a true factorization of the original matrix. However, it’s close enough for an approximate inverse in a preconditioner.","position":{"start":{"line":947,"column":1},"end":{"line":947,"column":1}},"key":"kxp0hnrf69"}],"key":"MjZMrjZRWn"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"from scipy.sparse.linalg import LinearOperator\nprec = LinearOperator((n, n), matvec=lambda y: iLU.solve(y))\n\nresid = [1.];  start = timer()\nx, flag = gmres(A, b, M=prec, maxiter=300, rtol=1e-10, restart=50, callback=hist)\nprint(f\"time for preconditioned GMRES: {timer() - start:.3f} sec\")\nresid_prec = resid","key":"BaPMbkAx8p"},{"type":"output","id":"OudMkyBK4Dvjc3OPUpWNp","data":[{"output_type":"stream","name":"stdout","text":"time for preconditioned GMRES: 0.142 sec\n"}],"key":"uBFIuFYikf"}],"data":{},"key":"ZwokCNFnWs"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"semilogy(resid_plain, label=\"no prec.\")\nsemilogy(resid_prec, label=\"iLU prec.\")\nxlabel(\"iteration number\"),  ylabel(\"residual norm\")\nlegend()\ntitle(\"GMRES convergence compared\");","visibility":"hide","key":"RuNfWnxaSV"},{"type":"output","id":"j9nckcjPXrpc2apbWoVJM","data":[{"output_type":"display_data","metadata":{},"data":{"text/plain":{"content":"<Figure size 700x400 with 1 Axes>","content_type":"text/plain"},"image/png":{"content_type":"image/png","hash":"ed1f57ec4a72a5a97cab4a75a6dcffa2","path":"fncbook.com/build/ed1f57ec4a72a5a97cab4a75a6dcffa2.png"}}}],"visibility":"show","key":"crpMA6I6Ee"}],"data":{"tags":[]},"visibility":"show","key":"AxgCN6p8cj"}],"label":"demo-precond-gmres-python","identifier":"demo-precond-gmres-python","html_id":"demo-precond-gmres-python","key":"fI54QF6K3B"}],"key":"v1wRPBfzT7"}],"key":"AoDretNdMd"},"references":{"cite":{"order":[],"data":{}}},"footer":{"navigation":{"prev":{"title":"Chapter 7","url":"/chapter7-2","group":"Python codes"},"next":{"title":"Chapter 9","url":"/chapter9-2","group":"Python codes"}}},"domain":"http://localhost:3000"}