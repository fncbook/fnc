{"version":2,"kind":"Notebook","sha256":"c51e36d659d568abd3610ae9ad45a85d3523297421ca222bb4e904d45b9512f7","slug":"chapter8","location":"/julia/chapter8.md","dependencies":[],"frontmatter":{"title":"Chapter 8","numbering":{"heading_1":{"enabled":false},"heading_2":{"enabled":false},"heading_3":{"enabled":false},"heading_4":{"enabled":false},"heading_5":{"enabled":false},"heading_6":{"enabled":false},"title":{"offset":2}},"kernelspec":{"name":"julia-1.11","display_name":"Julia 1","language":"julia"},"content_includes_title":false,"authors":[{"nameParsed":{"literal":"Tobin A. Driscoll","given":"Tobin A.","family":"Driscoll"},"name":"Tobin A. Driscoll","email":"driscoll@udel.edu","id":"contributors-myst-generated-uid-0","corresponding":true},{"nameParsed":{"literal":"Richard J. Braun","given":"Richard J.","family":"Braun"},"name":"Richard J. Braun","id":"contributors-myst-generated-uid-1"}],"github":"https://github.com/fncbook/fnc","math":{"\\float":{"macro":"\\mathbb{F}"},"\\real":{"macro":"\\mathbb{R}"},"\\complex":{"macro":"\\mathbb{C}"},"\\nat":{"macro":"\\mathbb{N}"},"\\integer":{"macro":"\\mathbb{Z}"},"\\rmn":{"macro":"\\mathbb{R}^{#1 \\times #2}"},"\\dd":{"macro":"\\frac{d #1}{d #2}"},"\\ddd":{"macro":"\\frac{d^2 #1}{d #2^2}"},"\\pp":{"macro":"\\frac{\\partial #1}{\\partial #2}"},"\\ppp":{"macro":"\\frac{\\partial^2 #1}{\\partial #2^2}"},"\\ppdd":{"macro":"\\frac{\\partial^2 #1}{\\partial #2 \\partial #3}"},"\\abs":{"macro":"\\left\\lvert #1 \\right\\rvert"},"\\norm":{"macro":"\\left\\lVert #1 \\right\\rVert"},"\\twonorm":{"macro":"\\norm{#1}_2"},"\\onenorm":{"macro":"\\norm{#1}_1"},"\\infnorm":{"macro":"\\norm{#1}_\\infty"},"\\anynorm":{"macro":"\\norm{#1}_#2"},"\\innerprod":{"macro":"\\langle #1,#2 \\rangle"},"\\pr":{"macro":"^{(#1)}"},"\\kron":{"macro":"#1 \\otimes #2"},"\\eye":{"macro":"\\mathbf{e}_#1"},"\\meye":{"macro":"\\mathbf{I}"},"\\Qhat":{"macro":"\\hat{\\mathbf{Q}}"},"\\Rhat":{"macro":"\\hat{\\mathbf{R}}"},"\\bfalpha":{"macro":"\\mathbf{alpha}"},"\\bfdelta":{"macro":"\\mathbf{delta}"},"\\bfzero":{"macro":"\\boldsymbol{0}"},"\\macheps":{"macro":"\\epsilon_\\text{mach}"},"\\fl":{"macro":"\\operatorname{fl}"},"\\diag":{"macro":"\\operatorname{diag}"},"\\ign":{"macro":"\\operatorname{sign}"},"\\Re":{"macro":"\\operatorname{Re}"},"\\Im":{"macro":"\\operatorname{Im}"},"\\ee":{"macro":"\\times 10^"},"\\lnorm":{"macro":"\\|"},"\\rnorm":{"macro":"\\|"},"\\floor":{"macro":"\\lfloor#1\\rfloor"},"\\cI":{"macro":"\\mathcal{I}"},"\\mtx":{"macro":"\\operatorname{mtx}"},"\\myvec":{"macro":"\\operatorname{vec}"},"\\argmin":{"macro":"\\operatorname{argmin}"}},"abbreviations":{"IVP":"initial-value problem","BVP":"boundary-value problem","TPBVP":"two-point boundary-value problem","ONC":"matrix with orthonormal columns","SVD":"singular value decomposition","EVD":"eigenvalue decomposition","SPD":"symmetric positive definite","HPD":"hermitian positive definite","PDE":"partial differential equation","ODE":"ordinary differential equation"},"edit_url":"https://github.com/fncbook/fnc/blob/master/julia/chapter8.md","exports":[{"format":"md","filename":"chapter8.md","url":"/build/chapter8-49014c0c620fe3a5f93359299d5b1d0d.md"}]},"mdast":{"type":"root","children":[{"type":"block","children":[{"type":"heading","depth":2,"position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"children":[{"type":"text","value":"Functions","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"key":"QQ0vqVY3E1"}],"identifier":"functions","label":"Functions","html_id":"functions","implicit":true,"key":"ezTT3Rl5nD"},{"type":"details","open":true,"children":[{"type":"summary","children":[{"type":"text","value":"Power iteration","position":{"start":{"line":14,"column":1},"end":{"line":14,"column":1}},"key":"ouRCg0EzFK"}],"key":"dhEKMnUucv"},{"type":"include","file":"FNCFunctions/src/chapter08.jl","literal":true,"filter":{"startAfter":"# begin poweriter","endBefore":"# end poweriter"},"children":[{"type":"code","value":"\"\"\"\n    poweriter(A, numiter)\n\nPerform `numiter` power iterations with the matrix `A`, starting\nfrom a random vector. Returns a vector of eigenvalue estimates\nand the final eigenvector approximation.\n\"\"\"\nfunction poweriter(A, numiter)\n    n = size(A, 1)\n    x = normalize(randn(n), Inf)\n    β = zeros(numiter)\n    for k in 1:numiter\n        y = A * x\n        m = argmax(abs.(y))\n        β[k] = y[m] / x[m]\n        x = y / y[m]\n    end\n    return β, x\nend","lang":"julia","showLineNumbers":true,"filename":"poweriter.jl","key":"qVLFWTQfp3"}],"key":"u5QOQgootm"}],"label":"function-poweriter-julia","identifier":"function-poweriter-julia","html_id":"function-poweriter-julia","key":"fbcJwMVGOd"},{"type":"details","open":true,"children":[{"type":"summary","children":[{"type":"text","value":"Inverse iteration","position":{"start":{"line":26,"column":1},"end":{"line":26,"column":1}},"key":"jTukngw6r1"}],"key":"S1hnFRK1np"},{"type":"include","file":"FNCFunctions/src/chapter08.jl","literal":true,"filter":{"startAfter":"# begin inviter","endBefore":"# end inviter"},"children":[{"type":"code","value":"\"\"\"\n    inviter(A, s, numiter)\n\nPerform `numiter` inverse iterations with the matrix `A` and shift\n`s`, starting from a random vector. Returns a vector of\neigenvalue estimates and the final eigenvector approximation.\n\"\"\"\nfunction inviter(A, s, numiter)\n    n = size(A, 1)\n    x = normalize(randn(n), Inf)\n    β = zeros(numiter)\n    fact = lu(A - s * I)\n    for k in 1:numiter\n        y = fact \\ x\n        normy, m = findmax(abs.(y))\n        β[k] = x[m] / y[m] + s\n        x = y / y[m]\n    end\n    return β, x\nend","lang":"julia","showLineNumbers":true,"filename":"inviter.jl","key":"jYMJuGxgwM"}],"key":"oQvpArt2Y1"}],"label":"function-inviter-julia","identifier":"function-inviter-julia","html_id":"function-inviter-julia","key":"Z4WJjkX6yG"},{"type":"details","open":true,"children":[{"type":"summary","children":[{"type":"text","value":"Arnoldi iteration","position":{"start":{"line":38,"column":1},"end":{"line":38,"column":1}},"key":"e9LeTSwE8v"}],"key":"j7dZGx4HS8"},{"type":"include","file":"FNCFunctions/src/chapter08.jl","literal":true,"filter":{"startAfter":"# begin arnoldi","endBefore":"# end arnoldi"},"children":[{"type":"code","value":"\"\"\"\n    arnoldi(A, u, m)\n\nPerform the Arnoldi iteration for `A` starting with vector `u`, out\nto the Krylov subspace of degree `m`. Returns the orthonormal basis\n(`m`+1 columns) and the upper Hessenberg `H` of size `m`+1 by `m`.\n\"\"\"\nfunction arnoldi(A, u, m)\n    n = length(u)\n    Q = zeros(n, m+1)\n    H = zeros(m+1, m)\n    Q[:, 1] = u / norm(u)\n    for j in 1:m\n        # Find the new direction that extends the Krylov subspace.\n        v = A * Q[:, j]\n        # Remove the projections onto the previous vectors.\n        for i in 1:j\n            H[i, j] = dot(Q[:, i], v)\n            v -= H[i, j] * Q[:, i]\n        end\n        # Normalize and store the new basis vector.\n        H[j+1, j] = norm(v)\n        Q[:, j+1] = v / H[j+1, j]\n    end\n    return Q, H\nend","lang":"julia","showLineNumbers":true,"filename":"arnoldi.jl","key":"AAavbmXwAi"}],"key":"hikRnRga3P"}],"label":"function-arnoldi-julia","identifier":"function-arnoldi-julia","html_id":"function-arnoldi-julia","key":"RX1n3li6GK"},{"type":"details","open":true,"children":[{"type":"summary","children":[{"type":"text","value":"GMRES","position":{"start":{"line":50,"column":1},"end":{"line":50,"column":1}},"key":"piR8PmbRMp"}],"key":"W19tMTNI5e"},{"type":"include","file":"FNCFunctions/src/chapter08.jl","literal":true,"filter":{"startAfter":"# begin gmres","endBefore":"# end gmres"},"children":[{"type":"code","value":"\"\"\"\n    gmres(A, b, m)\n\nDo `m` iterations of GMRES for the linear system `A`*x=`b`. Returns\nthe final solution estimate x and a vector with the history of\nresidual norms. (This function is for demo only, not practical use.)\n\"\"\"\nfunction gmres(A, b, m)\n    n = length(b)\n    Q = zeros(n, m+1)\n    Q[:, 1] = b / norm(b)\n    H = zeros(m+1, m)\n\n    # Initial solution is zero.\n    x = 0\n    residual = [norm(b); zeros(m)]\n\n    for j in 1:m\n        # Next step of Arnoldi iteration.\n        v = A * Q[:, j]\n        for i in 1:j\n            H[i, j] = dot(Q[:, i], v)\n            v -= H[i, j] * Q[:, i]\n        end\n        H[j+1, j] = norm(v)\n        Q[:, j+1] = v / H[j+1, j]\n\n        # Solve the minimum residual problem.\n        r = [norm(b); zeros(j)]\n        z = H[1:j+1, 1:j] \\ r\n        x = Q[:, 1:j] * z\n        residual[j+1] = norm(A * x - b)\n    end\n    return x, residual\nend","lang":"julia","showLineNumbers":true,"filename":"gmres.jl","key":"TSNRK5inUt"}],"key":"RF1yuvPJ30"}],"label":"function-gmres-julia","identifier":"function-gmres-julia","html_id":"function-gmres-julia","key":"RvXOqNgQmf"},{"type":"heading","depth":2,"position":{"start":{"line":61,"column":1},"end":{"line":61,"column":1}},"children":[{"type":"text","value":"Examples","position":{"start":{"line":61,"column":1},"end":{"line":61,"column":1}},"key":"vmz2oUjD75"}],"identifier":"examples","label":"Examples","html_id":"examples","implicit":true,"key":"kivcWqDO0m"}],"key":"L8zRYVbPFT"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"julia","executable":true,"value":"include(\"FNC_init.jl\")","visibility":"show","key":"yGlZOLhOON"},{"type":"output","id":"yr3KIbFCauuUepN8drxGu","data":[{"output_type":"stream","name":"stderr","text":"\u001b[32m\u001b[1m  Activating\u001b[22m\u001b[39m "},{"output_type":"stream","name":"stderr","text":"project at `~/Documents/GitHub/fnc`\n"}],"visibility":"show","key":"JpAza490cA"}],"data":{"tags":[]},"visibility":"remove","key":"HpF8KhdE3u"},{"type":"block","children":[{"type":"heading","depth":3,"position":{"start":{"line":68,"column":1},"end":{"line":68,"column":1}},"children":[{"type":"text","value":"8.1 ","position":{"start":{"line":68,"column":1},"end":{"line":68,"column":1}},"key":"vlxWuOPacw"},{"type":"link","identifier":"section-krylov-structure","label":"section-krylov-structure","kind":"narrative","position":{"start":{"line":68,"column":5},"end":{"line":68,"column":30}},"url":"/structure-1","internal":true,"dataUrl":"/structure-1.json","children":[{"type":"text","value":"Sparsity and structure","key":"ffsUZkbZuW"}],"key":"y47mS8hdiv"}],"identifier":"id-8-1","label":"8.1 ","html_id":"id-8-1","implicit":true,"key":"pr3FH3f9UA"},{"type":"details","open":true,"children":[{"type":"summary","children":[{"type":"crossReference","identifier":"demo-structure-sparse","label":"demo-structure-sparse","kind":"proof:example","position":{"start":{"line":71,"column":1},"end":{"line":71,"column":23}},"children":[{"type":"text","value":"Example ","key":"Ey8BzKHTO0"},{"type":"text","value":"8.1.1","key":"GY40Qo0ruP"}],"template":"Example %s","enumerator":"8.1.1","resolved":true,"html_id":"demo-structure-sparse","remote":true,"url":"/structure-1","dataUrl":"/structure-1.json","key":"M5MuvaSkD4"}],"key":"o3ArYX7oeF"},{"type":"admonition","kind":"tip","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"Tip","key":"J5C7YLj8Wh"}],"key":"W68xSr0x8U"},{"type":"paragraph","position":{"start":{"line":75,"column":1},"end":{"line":75,"column":1}},"children":[{"type":"text","value":"Julia functions to deal with sparse matrices are found in the ","position":{"start":{"line":75,"column":1},"end":{"line":75,"column":1}},"key":"RMsW2FIJo3"},{"type":"inlineCode","value":"SparseArrays","position":{"start":{"line":75,"column":1},"end":{"line":75,"column":1}},"key":"LSNC51Ue4T"},{"type":"text","value":" package in the standard library.","position":{"start":{"line":75,"column":1},"end":{"line":75,"column":1}},"key":"AhuY5qoVE6"}],"key":"GMoNsmjLV4"}],"key":"S4NXMLDAor"},{"type":"paragraph","position":{"start":{"line":78,"column":1},"end":{"line":78,"column":1}},"children":[{"type":"text","value":"Here we load the adjacency matrix of a graph with 2790 nodes. Each node is a web page referring to Roswell, NM, and the edges represent links between web pages. (Credit goes to Panayiotis Tsaparas and the University of Toronto for making this data public.)","position":{"start":{"line":78,"column":1},"end":{"line":78,"column":1}},"key":"QTDhzwa1XN"}],"key":"xnIfVC769p"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"julia","executable":true,"value":"using SparseArrays, JLD2\n@load \"roswell.jld2\" A;      # file is on the book's website","key":"b6wK5vBClC"},{"type":"output","id":"NtfW1c7VAh0kRVz_fYi1j","data":[],"key":"XeRnNzNdOp"}],"key":"bHXWSI6S0c"},{"type":"paragraph","position":{"start":{"line":87,"column":1},"end":{"line":87,"column":1}},"children":[{"type":"text","value":"We may define the density of ","position":{"start":{"line":87,"column":1},"end":{"line":87,"column":1}},"key":"DMo7DtBmoR"},{"type":"inlineMath","value":"\\mathbf{A}","position":{"start":{"line":87,"column":1},"end":{"line":87,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi mathvariant=\"bold\">A</mi></mrow><annotation encoding=\"application/x-tex\">\\mathbf{A}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6861em;\"></span><span class=\"mord mathbf\">A</span></span></span></span>","key":"ccFN6ziH7J"},{"type":"text","value":" as the number of nonzeros divided by the total number of entries.","position":{"start":{"line":87,"column":1},"end":{"line":87,"column":1}},"key":"RYNmSmZQZh"}],"indexEntries":[{"entry":"Julia","subEntry":{"value":"nnz","kind":"entry"},"emphasis":true}],"label":"index-HFmnnS8UGP","identifier":"index-hfmnns8ugp","html_id":"index-hfmnns8ugp","key":"RYgAp89HeA"},{"type":"admonition","kind":"tip","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"Tip","key":"swp5Bn8jB8"}],"key":"W1eNttOHs7"},{"type":"paragraph","position":{"start":{"line":90,"column":1},"end":{"line":90,"column":1}},"children":[{"type":"text","value":"Use ","position":{"start":{"line":90,"column":1},"end":{"line":90,"column":1}},"key":"iYGwzkLNm6"},{"type":"inlineCode","value":"nnz","position":{"start":{"line":90,"column":1},"end":{"line":90,"column":1}},"key":"nImb0rGna9"},{"type":"text","value":" to count the number of nonzeros in a sparse matrix.","position":{"start":{"line":90,"column":1},"end":{"line":90,"column":1}},"key":"DOmzDCHePq"}],"key":"uroENtmKFB"}],"class":"dropdown","key":"GU4N5IDP4i"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"julia","executable":true,"value":"m, n = size(A)\n@show density = nnz(A) / (m * n);","key":"Nqpyhdwh6l"},{"type":"output","id":"DtuQnlN2AucA1FZVitKLR","data":[{"output_type":"stream","name":"stdout","text":"density = nnz(A) / (m * n) = 0.0010902994565845762"},{"output_type":"stream","name":"stdout","text":"\n"}],"key":"BE7ZkEBNmh"}],"key":"jcFXiTHZ9a"},{"type":"paragraph","position":{"start":{"line":101,"column":1},"end":{"line":101,"column":1}},"children":[{"type":"text","value":"The computer memory consumed by any variable can be discovered using ","position":{"start":{"line":101,"column":1},"end":{"line":101,"column":1}},"key":"S8tftkfbRQ"},{"type":"inlineCode","value":"summarysize","position":{"start":{"line":101,"column":1},"end":{"line":101,"column":1}},"key":"KGvGvpUbFx"},{"type":"text","value":". We can use it to compare the space needed for the sparse representation to its dense counterpart, that is, the space needed to store all the elements, whether zero or not.","position":{"start":{"line":101,"column":1},"end":{"line":101,"column":1}},"key":"barYRoEBSu"}],"indexEntries":[{"entry":"Julia","subEntry":{"value":"summarysize","kind":"entry"},"emphasis":true}],"label":"index-YktDnhPDMK","identifier":"index-yktdnhpdmk","html_id":"index-yktdnhpdmk","key":"n53jOMqXOV"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"julia","executable":true,"value":"F = Matrix(A)\nBase.summarysize(F) / Base.summarysize(A)","key":"BliR9pfI0t"},{"type":"output","id":"tYK8akdglp5uGYG46WBXZ","data":[{"output_type":"execute_result","execution_count":4,"metadata":{},"data":{"text/plain":{"content":"550.2690513219285","content_type":"text/plain"}}}],"key":"GJzEJPk9ia"}],"key":"sc1UF9jsRl"},{"type":"paragraph","position":{"start":{"line":108,"column":1},"end":{"line":108,"column":1}},"children":[{"type":"text","value":"As you can see, the storage savings are dramatic. Matrix-vector products are also much faster using the sparse form because operations with structural zeros are skipped.","position":{"start":{"line":108,"column":1},"end":{"line":108,"column":1}},"key":"xTEMAFhpU9"}],"key":"z5BjRiS6B8"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"julia","executable":true,"value":"x = randn(n)\nA * x;   # make sure * is loaded and compiled\n@elapsed for i in 1:300\n    A * x\nend","key":"RgSv2CTrwh"},{"type":"output","id":"LK6E4S1rJYEpLRDcpSdi5","data":[{"output_type":"execute_result","execution_count":5,"metadata":{},"data":{"text/plain":{"content":"0.002516875","content_type":"text/plain"}}}],"key":"HeSa1NTb6w"}],"key":"Mq3K5OuLdN"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"julia","executable":true,"value":"F * x;\n@elapsed for i in 1:300\n    F * x\nend","key":"uvdnLM7pal"},{"type":"output","id":"CZHnKuXBDIzjTISHX2rGF","data":[{"output_type":"execute_result","execution_count":6,"metadata":{},"data":{"text/plain":{"content":"10.005612416","content_type":"text/plain"}}}],"key":"EOrtdOyfWb"}],"key":"fOIGKuU5go"}],"label":"demo-structure-sparse-julia","identifier":"demo-structure-sparse-julia","html_id":"demo-structure-sparse-julia","key":"z7lt0piHwV"},{"type":"details","open":true,"children":[{"type":"summary","children":[{"type":"crossReference","identifier":"demo-structure-fill","label":"demo-structure-fill","kind":"proof:example","position":{"start":{"line":127,"column":1},"end":{"line":127,"column":21}},"children":[{"type":"text","value":"Example ","key":"eWj0jXuLCD"},{"type":"text","value":"8.1.2","key":"q3A89qw2Ry"}],"template":"Example %s","enumerator":"8.1.2","resolved":true,"html_id":"demo-structure-fill","remote":true,"url":"/structure-1","dataUrl":"/structure-1.json","key":"VOBOlAxme0"}],"key":"kFze5p0VKT"},{"type":"paragraph","position":{"start":{"line":132,"column":1},"end":{"line":132,"column":1}},"children":[{"type":"text","value":"Here is the adjacency matrix of a graph representing a small-world network, featuring connections to neighbors and a small number of distant contacts.","position":{"start":{"line":132,"column":1},"end":{"line":132,"column":1}},"key":"sqFP4alGdB"}],"indexEntries":[{"entry":"Julia","subEntry":{"value":"sprandsym","kind":"entry"},"emphasis":true}],"label":"index-qZJLtSfGrv","identifier":"index-qzjltsfgrv","html_id":"index-qzjltsfgrv","key":"Yw7Q2zaG7Z"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"julia","executable":true,"value":"using GraphRecipes\n@load \"smallworld.jld2\" A\ngraphplot(A, linealpha=0.5)","key":"PO8gZEn9PQ"},{"type":"output","id":"ND9rs4eSJsI6xsJco1oiy","data":[{"output_type":"execute_result","execution_count":7,"metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"e82690ef2bd56e05a63ed95ec259b9b4","path":"/build/e82690ef2bd56e05a63ed95ec259b9b4.png"},"text/html":{"content_type":"text/html","hash":"5c1904f224055e3f0b9e506b0b4cbf0e","path":"/build/5c1904f224055e3f0b9e506b0b4cbf0e.html"},"image/svg+xml":{"content_type":"image/svg+xml","hash":"4d5b930e3c28e0da023b3194dfb218e2","path":"/build/4d5b930e3c28e0da023b3194dfb218e2.svg"}}}],"key":"p9gYD7CUZD"}],"key":"tdQjrP4EwZ"},{"type":"paragraph","position":{"start":{"line":140,"column":1},"end":{"line":140,"column":1}},"children":[{"type":"text","value":"Because each node connects to relatively few others, the adjacency matrix is quite sparse.","position":{"start":{"line":140,"column":1},"end":{"line":140,"column":1}},"key":"i82k9JZ6jy"}],"key":"B1jf5eYOcN"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"julia","executable":true,"value":"spy(A, title=\"Nonzero locations\", m=2, color=:blues)","key":"FgGX5YFMyB"},{"type":"output","id":"c35YcAGLUhvEytCIa2Vcj","data":[{"output_type":"execute_result","execution_count":8,"metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"6e5e16bb1dbb6a69591864d136ee14c7","path":"/build/6e5e16bb1dbb6a69591864d136ee14c7.png"},"text/html":{"content_type":"text/html","hash":"937a9b79c5a63fef796d8e528152d50b","path":"/build/937a9b79c5a63fef796d8e528152d50b.html"},"image/svg+xml":{"content_type":"image/svg+xml","hash":"520e4213fa076506648d0697a94a939a","path":"/build/520e4213fa076506648d0697a94a939a.svg"}}}],"key":"pLXB8bFoPA"}],"key":"z0ampNOvII"},{"type":"paragraph","position":{"start":{"line":146,"column":1},"end":{"line":146,"column":1}},"children":[{"type":"text","value":"By ","position":{"start":{"line":146,"column":1},"end":{"line":146,"column":1}},"key":"esI7TAkp7Q"},{"type":"crossReference","kind":"proof:theorem","identifier":"theorem-insight-adjmat","label":"theorem-insight-adjmat","children":[{"type":"text","value":"Theorem ","key":"VeUOBPwK36"},{"type":"text","value":"7.1.1","key":"eXjUDVTSIm"}],"template":"Theorem %s","enumerator":"7.1.1","resolved":true,"html_id":"theorem-insight-adjmat","remote":true,"url":"/insight","dataUrl":"/insight.json","key":"IYLzvjA88r"},{"type":"text","value":", the entries of ","position":{"start":{"line":146,"column":1},"end":{"line":146,"column":1}},"key":"fxaRXiaI2i"},{"type":"inlineMath","value":"\\mathbf{A}^k","position":{"start":{"line":146,"column":1},"end":{"line":146,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msup><mi mathvariant=\"bold\">A</mi><mi>k</mi></msup></mrow><annotation encoding=\"application/x-tex\">\\mathbf{A}^k</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8491em;\"></span><span class=\"mord\"><span class=\"mord mathbf\">A</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8491em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03148em;\">k</span></span></span></span></span></span></span></span></span></span></span>","key":"oNy8jYQU6N"},{"type":"text","value":" give the number of walks of length ","position":{"start":{"line":146,"column":1},"end":{"line":146,"column":1}},"key":"PCOkSH4NtF"},{"type":"inlineMath","value":"k","position":{"start":{"line":146,"column":1},"end":{"line":146,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>k</mi></mrow><annotation encoding=\"application/x-tex\">k</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6944em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03148em;\">k</span></span></span></span>","key":"gbBdsFCHwJ"},{"type":"text","value":" between pairs of nodes, as with “","position":{"start":{"line":146,"column":1},"end":{"line":146,"column":1}},"key":"ilzF2mMCzx"},{"type":"emphasis","position":{"start":{"line":146,"column":1},"end":{"line":146,"column":1}},"children":[{"type":"text","value":"k","position":{"start":{"line":146,"column":1},"end":{"line":146,"column":1}},"key":"tK8C5Ht17z"}],"key":"pZbkhiMHRs"},{"type":"text","value":" degrees of separation” within a social network. As ","position":{"start":{"line":146,"column":1},"end":{"line":146,"column":1}},"key":"w2IjREntYa"},{"type":"inlineMath","value":"k","position":{"start":{"line":146,"column":1},"end":{"line":146,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>k</mi></mrow><annotation encoding=\"application/x-tex\">k</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6944em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03148em;\">k</span></span></span></span>","key":"oZ3BDzAnyy"},{"type":"text","value":" grows, the density of ","position":{"start":{"line":146,"column":1},"end":{"line":146,"column":1}},"key":"fznrnLp5iQ"},{"type":"inlineMath","value":"\\mathbf{A}^k","position":{"start":{"line":146,"column":1},"end":{"line":146,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msup><mi mathvariant=\"bold\">A</mi><mi>k</mi></msup></mrow><annotation encoding=\"application/x-tex\">\\mathbf{A}^k</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8491em;\"></span><span class=\"mord\"><span class=\"mord mathbf\">A</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8491em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03148em;\">k</span></span></span></span></span></span></span></span></span></span></span>","key":"Rpw5zsv3IA"},{"type":"text","value":" also grows.","position":{"start":{"line":146,"column":1},"end":{"line":146,"column":1}},"key":"Pf1tdpbjmR"}],"key":"trsttW0Ktb"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"julia","executable":true,"value":"plt = plot(layout=(1, 3), legend=:none, size=(600, 240))\nfor k in 2:4\n    spy!(A^k;\n        subplot=k - 1, color=:blues,\n        title=latexstring(\"\\\\mathbf{A}^$k\"))\nend\nplt","key":"CgM62rnNHY"},{"type":"output","id":"z3fg9StepmXB5uXGzKahO","data":[{"output_type":"execute_result","execution_count":9,"metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"a8b0b253ce078e6d9a2c1c4671194b97","path":"/build/a8b0b253ce078e6d9a2c1c4671194b97.png"},"text/html":{"content_type":"text/html","hash":"2acf634d6af4cd2b1fb5ba26dd85c958","path":"/build/2acf634d6af4cd2b1fb5ba26dd85c958.html"},"image/svg+xml":{"content_type":"image/svg+xml","hash":"4a5919b3a517694336c5da93da61eb39","path":"/build/4a5919b3a517694336c5da93da61eb39.svg"}}}],"key":"kURHUb5dRT"}],"key":"umjmRUNcpy"}],"label":"demo-structure-fill-julia","identifier":"demo-structure-fill-julia","html_id":"demo-structure-fill-julia","key":"vQdaYlLqsP"},{"type":"details","open":true,"children":[{"type":"summary","children":[{"type":"crossReference","identifier":"demo-structure-sparseband","label":"demo-structure-sparseband","kind":"proof:example","position":{"start":{"line":160,"column":1},"end":{"line":160,"column":27}},"children":[{"type":"text","value":"Example ","key":"Y9hMh0rHCg"},{"type":"text","value":"8.1.3","key":"DqgI0LrOMc"}],"template":"Example %s","enumerator":"8.1.3","resolved":true,"html_id":"demo-structure-sparseband","remote":true,"url":"/structure-1","dataUrl":"/structure-1.json","key":"nJxVWE1pDn"}],"key":"a6p4AKQ1KN"},{"type":"paragraph","position":{"start":{"line":166,"column":1},"end":{"line":166,"column":1}},"children":[{"type":"text","value":"The ","position":{"start":{"line":166,"column":1},"end":{"line":166,"column":1}},"key":"SEA2TkEr4Q"},{"type":"inlineCode","value":"spdiagm","position":{"start":{"line":166,"column":1},"end":{"line":166,"column":1}},"key":"D6llysaMAp"},{"type":"text","value":" function creates a sparse matrix given its diagonal elements. The main or central diagonal is numbered zero, above and to the right of that is positive, and below and to the left is negative.","position":{"start":{"line":166,"column":1},"end":{"line":166,"column":1}},"key":"tBPz6XhrBY"}],"indexEntries":[{"entry":"Julia","subEntry":{"value":"spdiagm","kind":"entry"},"emphasis":true}],"label":"index-YrTksQsKuL","identifier":"index-yrtksqskul","html_id":"index-yrtksqskul","key":"Vd8KyADABO"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"julia","executable":true,"value":"n = 50;\nA = spdiagm(-3 => fill(n, n - 3),\n    0 => ones(n),\n    1 => -(1:n-1),\n    5 => fill(0.1, n - 5))\nMatrix(A[1:7, 1:7])","key":"tEMroFW1lR"},{"type":"output","id":"YH2E_UVK5rEY3zTGId4NR","data":[{"output_type":"execute_result","execution_count":10,"metadata":{},"data":{"text/plain":{"content":"7×7 Matrix{Float64}:\n  1.0  -1.0   0.0   0.0   0.0   0.1   0.0\n  0.0   1.0  -2.0   0.0   0.0   0.0   0.1\n  0.0   0.0   1.0  -3.0   0.0   0.0   0.0\n 50.0   0.0   0.0   1.0  -4.0   0.0   0.0\n  0.0  50.0   0.0   0.0   1.0  -5.0   0.0\n  0.0   0.0  50.0   0.0   0.0   1.0  -6.0\n  0.0   0.0   0.0  50.0   0.0   0.0   1.0","content_type":"text/plain"}}}],"key":"fM7BkNF443"}],"key":"buU1bXlwhf"},{"type":"paragraph","position":{"start":{"line":180,"column":1},"end":{"line":180,"column":1}},"children":[{"type":"text","value":"Without pivoting, the LU factors have the same lower and upper bandwidth as the original matrix.","position":{"start":{"line":180,"column":1},"end":{"line":180,"column":1}},"key":"U1JvioQ0yZ"}],"indexEntries":[{"entry":"Julia","subEntry":{"value":"sparse","kind":"entry"},"emphasis":true}],"label":"index-WCK6jACz8m","identifier":"index-wck6jacz8m","html_id":"index-wck6jacz8m","key":"gcfwFr38gK"},{"type":"admonition","kind":"tip","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"Tip","key":"UetoZsRzo6"}],"key":"zSTvkGiIeq"},{"type":"paragraph","position":{"start":{"line":184,"column":1},"end":{"line":184,"column":1}},"children":[{"type":"text","value":"The ","position":{"start":{"line":184,"column":1},"end":{"line":184,"column":1}},"key":"xSfIUTLk9P"},{"type":"inlineCode","value":"sparse","position":{"start":{"line":184,"column":1},"end":{"line":184,"column":1}},"key":"oKfNddop1T"},{"type":"text","value":" function converts any matrix to sparse form. But it’s usually better to construct a sparse matrix directly, as the standard form might not fit in memory.","position":{"start":{"line":184,"column":1},"end":{"line":184,"column":1}},"key":"uIFfldeuEg"}],"key":"swOfM45f53"}],"class":"dropdown","key":"AgHCov2bWK"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"julia","executable":true,"value":"L, U = FNC.lufact(A)\nplot(layout=2)\nspy!(sparse(L), m=2, subplot=1, title=L\"\\mathbf{L}\", color=:blues)\nspy!(sparse(U), m=2, subplot=2, title=L\"\\mathbf{U}\", color=:blues)","key":"IC6ukJkoKx"},{"type":"output","id":"E2DxImR7u9XOEg3NzQSAB","data":[{"output_type":"execute_result","execution_count":11,"metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"78e11847faf7fd5e17fd901999586556","path":"/build/78e11847faf7fd5e17fd901999586556.png"},"text/html":{"content_type":"text/html","hash":"862b9369f72b1efad289a0d0f48fbe42","path":"/build/862b9369f72b1efad289a0d0f48fbe42.html"},"image/svg+xml":{"content_type":"image/svg+xml","hash":"9330967553cc1d3324dbda818c419473","path":"/build/9330967553cc1d3324dbda818c419473.svg"}}}],"key":"CFk5as9EHz"}],"key":"E4QzYKOTJr"},{"type":"paragraph","position":{"start":{"line":194,"column":1},"end":{"line":194,"column":1}},"children":[{"type":"text","value":"However, if we introduce row pivoting, bandedness may be expanded or destroyed.","position":{"start":{"line":194,"column":1},"end":{"line":194,"column":1}},"key":"F2mA0IFBbC"}],"key":"VrjngcRox9"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"julia","executable":true,"value":"fact = lu(A)\nplot(layout=2)\nspy!(sparse(fact.L), m=2, subplot=1, title=L\"\\mathbf{L}\", color=:blues)\nspy!(sparse(fact.U), m=2, subplot=2, title=L\"\\mathbf{U}\", color=:blues)","key":"XaNV17Ggei"},{"type":"output","id":"0gQM_PIgrVglRgWx7gxVa","data":[{"output_type":"execute_result","execution_count":12,"metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"d733fc96dacd55427ae7fe3de0c6b525","path":"/build/d733fc96dacd55427ae7fe3de0c6b525.png"},"text/html":{"content_type":"text/html","hash":"185884f6b72440cf9f4afdc573e59e39","path":"/build/185884f6b72440cf9f4afdc573e59e39.html"},"image/svg+xml":{"content_type":"image/svg+xml","hash":"10704dc2dfba3cdb6a7bf685ee3b9ac4","path":"/build/10704dc2dfba3cdb6a7bf685ee3b9ac4.svg"}}}],"key":"k62gZENGVK"}],"key":"QLF7ZAO8kS"}],"label":"demo-structure-sparseband-julia","identifier":"demo-structure-sparseband-julia","html_id":"demo-structure-sparseband-julia","key":"J20POllYc9"},{"type":"details","open":true,"children":[{"type":"summary","children":[{"type":"crossReference","identifier":"demo-structure-linalg","label":"demo-structure-linalg","kind":"proof:example","position":{"start":{"line":206,"column":1},"end":{"line":206,"column":23}},"children":[{"type":"text","value":"Example ","key":"leU1vVJjWF"},{"type":"text","value":"8.1.4","key":"cWaD9wwkUd"}],"template":"Example %s","enumerator":"8.1.4","resolved":true,"html_id":"demo-structure-linalg","remote":true,"url":"/structure-1","dataUrl":"/structure-1.json","key":"w11TQuHRD9"}],"key":"RvcNGZVkww"},{"type":"paragraph","position":{"start":{"line":208,"column":1},"end":{"line":208,"column":1}},"children":[{"type":"text","value":"The following generates a random sparse matrix with prescribed eigenvalues.","position":{"start":{"line":208,"column":1},"end":{"line":208,"column":1}},"key":"tHJMYhlIVD"}],"key":"F2POZDeaWA"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"julia","executable":true,"value":"n = 4000\ndensity = 4e-4\nλ = @. 1 + 1 / (1:n)   # exact eigenvalues\nA = FNC.sprandsym(n, density, λ);","key":"lNO0kOo6qk"},{"type":"output","id":"FKUiimJDkE6oz-lIZJV7M","data":[],"key":"JPPJce0kFm"}],"key":"hREUj6VOkx"},{"type":"paragraph","position":{"start":{"line":220,"column":1},"end":{"line":220,"column":1}},"children":[{"type":"text","value":"The ","position":{"start":{"line":220,"column":1},"end":{"line":220,"column":1}},"key":"KlmbjJQMzK"},{"type":"inlineCode","value":"eigs","position":{"start":{"line":220,"column":1},"end":{"line":220,"column":1}},"key":"E527ljdFNV"},{"type":"text","value":" function from ","position":{"start":{"line":220,"column":1},"end":{"line":220,"column":1}},"key":"QcosCdr91V"},{"type":"inlineCode","value":"Arpack","position":{"start":{"line":220,"column":1},"end":{"line":220,"column":1}},"key":"s2FGUhlXgg"},{"type":"text","value":" finds a small number eigenvalues meeting some criterion. First, we ask for the 5 of largest (complex) magnitude using ","position":{"start":{"line":220,"column":1},"end":{"line":220,"column":1}},"key":"BTxiwgoGwO"},{"type":"inlineCode","value":"which=:LM","position":{"start":{"line":220,"column":1},"end":{"line":220,"column":1}},"key":"e9XV1FjIgq"},{"type":"text","value":".","position":{"start":{"line":220,"column":1},"end":{"line":220,"column":1}},"key":"whKsdMcBw6"}],"indexEntries":[{"entry":"Julia","subEntry":{"value":"eigs","kind":"entry"},"emphasis":true}],"label":"index-YX3kJeHfPf","identifier":"index-yx3kjehfpf","html_id":"index-yx3kjehfpf","key":"StsEWKp3ww"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"julia","executable":true,"value":"using Arpack\nλmax, V = eigs(A, nev=5, which=:LM)    # Largest Magnitude\nfmt = ft_printf(\"%20.15f\")\npretty_table([λmax λ[1:5]], header=[\"found\", \"exact\"], formatters=fmt)","key":"O60XJFuTH5"},{"type":"output","id":"5hKkThbUN4quXK4FB-HIl","data":[{"output_type":"stream","name":"stdout","text":"┌──────────────────────┬──────────────────────┐\n│\u001b[1m                found \u001b[0m│\u001b[1m                exact \u001b[0m│\n├──────────────────────┼──────────────────────┤\n│    2.000000000000000 │    2.000000000000000 │\n│    1.500000000000002 │    1.500000000000000 │\n│    1.333333333333336 │    1.333333333333333 │\n│    1.250000000000002 │    1.250000000000000 │\n│    1.200000000000004 │    1.200000000000000 │\n└──────────────────────┴──────────────────────┘\n"}],"key":"TLw90TWkCU"}],"key":"lfzLznhBNg"},{"type":"paragraph","position":{"start":{"line":229,"column":1},"end":{"line":229,"column":1}},"children":[{"type":"text","value":"Now we find the 5 closest to the value 1 in the complex plane, via ","position":{"start":{"line":229,"column":1},"end":{"line":229,"column":1}},"key":"IUbHuqEMni"},{"type":"inlineCode","value":"sigma=1","position":{"start":{"line":229,"column":1},"end":{"line":229,"column":1}},"key":"LY8KULpk9d"},{"type":"text","value":".","position":{"start":{"line":229,"column":1},"end":{"line":229,"column":1}},"key":"LrqI3LJygW"}],"key":"yjX8YxEZjY"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"julia","executable":true,"value":"λ1, V = eigs(A, nev=5, sigma=1)    # closest to sigma\ndata = [λ1 λ[end:-1:end-4]]\npretty_table(data, header=[\"found\", \"exact\"], formatters=fmt)","key":"NfqLmvuvBF"},{"type":"output","id":"PI_dp1pkfTJevKLUYhmO2","data":[{"output_type":"stream","name":"stdout","text":"┌──────────────────────┬──────────────────────┐\n│\u001b[1m                found \u001b[0m│\u001b[1m                exact \u001b[0m│\n├──────────────────────┼──────────────────────┤\n│    1.000250000000000 │    1.000250000000000 │\n│    1.000250062515629 │    1.000250062515629 │\n│    1.000250125062531 │    1.000250125062531 │\n│    1.000250187640731 │    1.000250187640731 │\n│    1.000250250250250 │    1.000250250250250 │\n└──────────────────────┴──────────────────────┘\n"}],"key":"mxoNhKLpz7"}],"key":"QuMUjvlh56"},{"type":"paragraph","position":{"start":{"line":240,"column":1},"end":{"line":240,"column":1}},"children":[{"type":"text","value":"The time needed to solve a sparse linear system is not easy to predict unless you have some more information about the matrix. But it will typically be orders of magnitude faster than the dense version of the same problem.","position":{"start":{"line":240,"column":1},"end":{"line":240,"column":1}},"key":"Mz5QNvpHPE"}],"indexEntries":[{"entry":"Julia","subEntry":{"value":"\\\\","kind":"entry"},"emphasis":false}],"label":"index-zKjp2qUkUJ","identifier":"index-zkjp2qukuj","html_id":"index-zkjp2qukuj","key":"sZ76s4We08"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"julia","executable":true,"value":"x = @. 1 / (1:n);\nb = A * x;","key":"u7B7zI82Cl"},{"type":"output","id":"B8xbaEApsX7sM0zWZz02y","data":[],"key":"ceoWYPRy00"}],"key":"MskavARNwL"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"julia","executable":true,"value":"norm(x - A \\ b);  # force compilation\nt = @elapsed sparse_err = norm(x - A \\ b)\nprintln(\"Time for sparse solve: $t\")","key":"UgV4UrOm4P"},{"type":"output","id":"HDPOJWW_EGii7hDTDZhpR","data":[{"output_type":"stream","name":"stdout","text":"Time for sparse solve: 0.000582083\n"}],"key":"Rhe5wrjr0X"}],"key":"F6ngqR3xgu"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"julia","executable":true,"value":"D = Matrix(A)  # convert to regular matrix\nnorm(x - D \\ b);\nt = @elapsed dense_err = norm(x - D \\ b)\nprintln(\"Time for dense solve: $t\")","key":"HISYTqWU76"},{"type":"output","id":"jF0dNrzbjZHI8X1Y_FMe3","data":[{"output_type":"stream","name":"stdout","text":"Time for dense solve: 15.377480375\n"}],"key":"ZIAivQwAen"}],"key":"QdrcbctKAe"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"julia","executable":true,"value":"@show sparse_err;\n@show dense_err;","key":"tFrfMVDTSm"},{"type":"output","id":"GJ8HDFyb6BOEnYQuRex49","data":[{"output_type":"stream","name":"stdout","text":"sparse_err = 4.024723632301656e-17\ndense_err = 4.041471762201952e-18\n"}],"key":"TGBn2yfa6i"}],"key":"cFZDRQH9Ml"}],"label":"demo-structure-linalg-julia","identifier":"demo-structure-linalg-julia","html_id":"demo-structure-linalg-julia","key":"cU6WwTn2St"},{"type":"heading","depth":3,"position":{"start":{"line":266,"column":1},"end":{"line":266,"column":1}},"children":[{"type":"text","value":"8.2 ","position":{"start":{"line":266,"column":1},"end":{"line":266,"column":1}},"key":"lgyDskg4xg"},{"type":"link","identifier":"section-krylov-power","label":"section-krylov-power","kind":"narrative","position":{"start":{"line":266,"column":5},"end":{"line":266,"column":26}},"url":"/power","internal":true,"dataUrl":"/power.json","children":[{"type":"text","value":"Power iteration","key":"B3QWkTKc1x"}],"key":"DTugFwmYmv"}],"identifier":"id-8-2","label":"8.2 ","html_id":"id-8-2","implicit":true,"key":"TWB9Yj8feG"},{"type":"details","open":true,"children":[{"type":"summary","children":[{"type":"crossReference","identifier":"demo-power-one","label":"demo-power-one","kind":"proof:example","position":{"start":{"line":269,"column":1},"end":{"line":269,"column":16}},"children":[{"type":"text","value":"Example ","key":"fTJNQkXjky"},{"type":"text","value":"8.2.1","key":"zN53r0GFPu"}],"template":"Example %s","enumerator":"8.2.1","resolved":true,"html_id":"demo-power-one","remote":true,"url":"/power","dataUrl":"/power.json","key":"wLwzx64xSc"}],"key":"sD11IDx3uA"},{"type":"paragraph","position":{"start":{"line":271,"column":1},"end":{"line":271,"column":1}},"children":[{"type":"text","value":"Here we choose a random 5×5 matrix and a random 5-vector.","position":{"start":{"line":271,"column":1},"end":{"line":271,"column":1}},"key":"FfLGz42Mtj"}],"key":"xLL8qqXjRs"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"julia","executable":true,"value":"A = rand(1.0:9.0, 5, 5)\nA = A ./ sum(A, dims=1)\nx = randn(5)","key":"gMgvTgfUDM"},{"type":"output","id":"at2cyfvCO8bJY-mcdQMqw","data":[{"output_type":"execute_result","execution_count":20,"metadata":{},"data":{"text/plain":{"content":"5-element Vector{Float64}:\n  0.0241992633862751\n  1.231016460269885\n -0.42682019772216284\n -0.459817613252672\n  1.4882698929845564","content_type":"text/plain"}}}],"key":"CTlnb1jPuG"}],"key":"cKaaiA0iOp"},{"type":"paragraph","position":{"start":{"line":279,"column":1},"end":{"line":279,"column":1}},"children":[{"type":"text","value":"Applying matrix-vector multiplication once doesn’t do anything recognizable.","position":{"start":{"line":279,"column":1},"end":{"line":279,"column":1}},"key":"aB9vHQAIJi"}],"key":"lcwLF04KxS"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"julia","executable":true,"value":"y = A * x","key":"rlonx9h9ek"},{"type":"output","id":"R0T9zaVdH8L1CQ64m4XF_","data":[{"output_type":"execute_result","execution_count":21,"metadata":{},"data":{"text/plain":{"content":"5-element Vector{Float64}:\n 0.3801746590042248\n 0.590767457955022\n 0.22248091016888397\n 0.38654985233424066\n 0.2768749262035101","content_type":"text/plain"}}}],"key":"DsfPR6eoAh"}],"key":"IxYBWCHnj6"},{"type":"paragraph","position":{"start":{"line":285,"column":1},"end":{"line":285,"column":1}},"children":[{"type":"text","value":"Repeating the multiplication still doesn’t do anything obvious.","position":{"start":{"line":285,"column":1},"end":{"line":285,"column":1}},"key":"mg4mCkZmgG"}],"key":"BSD60OToPO"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"julia","executable":true,"value":"z = A * y","key":"AhXTOIHyxR"},{"type":"output","id":"wyNxmQLH5I5XwtdDeKREd","data":[{"output_type":"execute_result","execution_count":22,"metadata":{},"data":{"text/plain":{"content":"5-element Vector{Float64}:\n 0.38212242423964443\n 0.42168429264363905\n 0.30748599521476216\n 0.4053069905377939\n 0.34024810303004194","content_type":"text/plain"}}}],"key":"WW6QbfWPKl"}],"key":"hVc0ZN3oru"},{"type":"paragraph","position":{"start":{"line":291,"column":1},"end":{"line":291,"column":1}},"children":[{"type":"text","value":"But if we keep repeating the matrix-vector multiplication, something remarkable happens: ","position":{"start":{"line":291,"column":1},"end":{"line":291,"column":1}},"key":"U3qy0OPY1m"},{"type":"inlineMath","value":"\\mathbf{A} \\mathbf{x} \\approx \\mathbf{x}","position":{"start":{"line":291,"column":1},"end":{"line":291,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi mathvariant=\"bold\">A</mi><mi mathvariant=\"bold\">x</mi><mo>≈</mo><mi mathvariant=\"bold\">x</mi></mrow><annotation encoding=\"application/x-tex\">\\mathbf{A} \\mathbf{x} \\approx \\mathbf{x}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6861em;\"></span><span class=\"mord mathbf\">Ax</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">≈</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.4444em;\"></span><span class=\"mord mathbf\">x</span></span></span></span>","key":"aVVaDEK3Tk"},{"type":"text","value":".","position":{"start":{"line":291,"column":1},"end":{"line":291,"column":1}},"key":"Wnz6ahG67O"}],"key":"amnsE3XE8h"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"julia","executable":true,"value":"for j in 1:8\n    x = A * x\nend\n[x A * x]","key":"zJHY909Kr2"},{"type":"output","id":"r9vYjKHZW6Q4P7yBEg82U","data":[{"output_type":"execute_result","execution_count":23,"metadata":{},"data":{"text/plain":{"content":"5×2 Matrix{Float64}:\n 0.417112  0.41714\n 0.39128   0.39126\n 0.313515  0.313528\n 0.419203  0.419192\n 0.315738  0.315728","content_type":"text/plain"}}}],"key":"Yh93e5YU9J"}],"key":"nU7QcvMD9n"},{"type":"paragraph","position":{"start":{"line":300,"column":1},"end":{"line":300,"column":1}},"children":[{"type":"text","value":"This phenomenon seems to occur regardless of the starting vector.","position":{"start":{"line":300,"column":1},"end":{"line":300,"column":1}},"key":"pmPLE1pUc6"}],"key":"OqUhy1IJPx"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"julia","executable":true,"value":"x = randn(5)\nfor j in 1:8\n    x = A * x\nend\n[x A * x]","key":"bUNDnHKHsR"},{"type":"output","id":"QjLP0iI9yVJdMcql9VHJl","data":[{"output_type":"execute_result","execution_count":24,"metadata":{},"data":{"text/plain":{"content":"5×2 Matrix{Float64}:\n 0.236107  0.236163\n 0.221583  0.221545\n 0.177484  0.177509\n 0.237375  0.237354\n 0.178794  0.178772","content_type":"text/plain"}}}],"key":"KBWyxzKcEL"}],"key":"sd6qz7giZJ"}],"label":"demo-power-one-julia","identifier":"demo-power-one-julia","html_id":"demo-power-one-julia","key":"DVre0EkrjH"},{"type":"details","open":true,"children":[{"type":"summary","children":[{"type":"crossReference","identifier":"demo-power-iter","label":"demo-power-iter","kind":"proof:example","position":{"start":{"line":312,"column":1},"end":{"line":312,"column":17}},"children":[{"type":"text","value":"Example ","key":"N46rICeQRo"},{"type":"text","value":"8.2.2","key":"ujX2eZtAor"}],"template":"Example %s","enumerator":"8.2.2","resolved":true,"html_id":"demo-power-iter","remote":true,"url":"/power","dataUrl":"/power.json","key":"dmu1IJNHer"}],"key":"cOqgsQVfmU"},{"type":"paragraph","position":{"start":{"line":314,"column":1},"end":{"line":314,"column":1}},"children":[{"type":"text","value":"We will experiment with the power iteration on a 5×5 matrix with prescribed eigenvalues and dominant eigenvalue at 1.","position":{"start":{"line":314,"column":1},"end":{"line":314,"column":1}},"key":"hoFIvXqmxF"}],"key":"HpYowaBtZS"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"julia","executable":true,"value":"λ = [1, -0.75, 0.6, -0.4, 0]\n# Make a triangular matrix with eigenvalues on the diagonal.\nA = triu(ones(5, 5), 1) + diagm(λ)","key":"O3ZJ7PglJT"},{"type":"output","id":"lD5L8cNvdg4tbuiawMB9F","data":[{"output_type":"execute_result","execution_count":25,"metadata":{},"data":{"text/plain":{"content":"5×5 Matrix{Float64}:\n 1.0   1.0   1.0   1.0  1.0\n 0.0  -0.75  1.0   1.0  1.0\n 0.0   0.0   0.6   1.0  1.0\n 0.0   0.0   0.0  -0.4  1.0\n 0.0   0.0   0.0   0.0  0.0","content_type":"text/plain"}}}],"key":"OhKJyUAdma"}],"key":"tpb2HxRhCr"},{"type":"paragraph","position":{"start":{"line":322,"column":1},"end":{"line":322,"column":1}},"children":[{"type":"text","value":"We run the power iteration 60 times. The best estimate of the dominant eigenvalue is the last entry of the first output.","position":{"start":{"line":322,"column":1},"end":{"line":322,"column":1}},"key":"f0JgYhhIjr"}],"key":"ulxmVEer8w"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"julia","executable":true,"value":"β, x = FNC.poweriter(A, 60)\neigval = β[end]","key":"JS4ASiTVzC"},{"type":"output","id":"al6GcYlRzBL4GKrehZG5H","data":[{"output_type":"execute_result","execution_count":26,"metadata":{},"data":{"text/plain":{"content":"1.0000000013710957","content_type":"text/plain"}}}],"key":"GX9HxoHu8b"}],"key":"WUW20rUZOV"},{"type":"paragraph","position":{"start":{"line":329,"column":1},"end":{"line":329,"column":1}},"children":[{"type":"text","value":"We check for linear convergence using a log-linear plot of the error.","position":{"start":{"line":329,"column":1},"end":{"line":329,"column":1}},"key":"mCdDyfljaX"}],"key":"qqVANrHtjv"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"julia","executable":true,"value":"using Plots\nerr = @. 1 - β\nplot(0:59, abs.(err); m=:o, \n    xlabel=L\"k\",  \n    yaxis=(L\"|\\lambda_1-\\beta_k|\", :log10, [1e-10, 1]),\n    title=\"Convergence of power iteration\")","key":"gkCOdt2a6K"},{"type":"output","id":"zhSyd_so5_hs2_W8AXJ_1","data":[{"output_type":"execute_result","execution_count":27,"metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"d30545c727e6233b5115a080689cdbc1","path":"/build/d30545c727e6233b5115a080689cdbc1.png"},"text/html":{"content_type":"text/html","hash":"100109fe487c60d73e83cd4778d2bec0","path":"/build/100109fe487c60d73e83cd4778d2bec0.html"},"image/svg+xml":{"content_type":"image/svg+xml","hash":"aed36e8b8202423eba70719a66eb798a","path":"/build/aed36e8b8202423eba70719a66eb798a.svg"}}}],"key":"dwu7Lw98kx"}],"key":"P6tsbfhMbT"},{"type":"paragraph","position":{"start":{"line":340,"column":1},"end":{"line":340,"column":1}},"children":[{"type":"text","value":"The asymptotic trend seems to be a straight line, consistent with linear convergence. To estimate the convergence rate, we look at the ratio of two consecutive errors in the linear part of the convergence curve. The ratio of the first two eigenvalues should match the observed rate.","position":{"start":{"line":340,"column":1},"end":{"line":340,"column":1}},"key":"A0F8hhH2UV"}],"key":"eM8ela1BXL"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"julia","executable":true,"value":"@show theory = λ[2] / λ[1];\n@show observed = err[40] / err[39];","key":"QFHxx6pI7s"},{"type":"output","id":"G2sP_mfkwsQR5Koq5Uqj6","data":[{"output_type":"stream","name":"stdout","text":"theory = λ[2] / λ[1] = -0.75"},{"output_type":"stream","name":"stdout","text":"\nobserved = err[40] / err[39] = -0.7554623885557898\n"}],"key":"aaLNn84MOL"}],"key":"ldv8xS2lmq"},{"type":"paragraph","position":{"start":{"line":347,"column":1},"end":{"line":347,"column":1}},"children":[{"type":"text","value":"Note that the error is supposed to change sign on each iteration. The effect of these alternating signs is that estimates oscillate around the exact value.","position":{"start":{"line":347,"column":1},"end":{"line":347,"column":1}},"key":"oPnbHL6Axh"}],"key":"Wzg98ws1pV"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"julia","executable":true,"value":"β[26:30]","key":"ySuPjM6dkA"},{"type":"output","id":"n2afUCNkGbSfe8tMWGl9X","data":[{"output_type":"execute_result","execution_count":29,"metadata":{},"data":{"text/plain":{"content":"5-element Vector{Float64}:\n 1.0000260433508983\n 0.9999828689837219\n 1.0000142890999255\n 0.9999901476864022\n 1.0000079079280384","content_type":"text/plain"}}}],"key":"CplUq4MfA6"}],"key":"Hvr3rokjKF"},{"type":"paragraph","position":{"start":{"line":353,"column":1},"end":{"line":353,"column":1}},"children":[{"type":"text","value":"In practical situations, we don’t know the exact eigenvalue that the algorithm is supposed to find. In that case we would base errors on the final ","position":{"start":{"line":353,"column":1},"end":{"line":353,"column":1}},"key":"qJw9batuCq"},{"type":"text","value":"β","position":{"start":{"line":353,"column":1},"end":{"line":353,"column":1}},"key":"TJCIQgAKKg"},{"type":"text","value":" that was found, as in the following plot.","position":{"start":{"line":353,"column":1},"end":{"line":353,"column":1}},"key":"DQVt23cCPv"}],"key":"p6JzzIeGJQ"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"julia","executable":true,"value":"err = @. β[end] - β[1:end-1]\nplot(0:58, abs.(err), m=:o, \n    xlabel=L\"k\", \n    yaxis=(L\"|\\beta_{60}-\\beta_k|\", :log10, [1e-10, 1]),\n    title=\"Convergence of power iteration\")","key":"zZ0qxmiRPf"},{"type":"output","id":"K0w0NQWZK8hXq5WIx2k-7","data":[{"output_type":"execute_result","execution_count":30,"metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"9c7dba530aad723d1016d1ae2d62a3d5","path":"/build/9c7dba530aad723d1016d1ae2d62a3d5.png"},"text/html":{"content_type":"text/html","hash":"1d19c1b0588a47794df927170230b17c","path":"/build/1d19c1b0588a47794df927170230b17c.html"},"image/svg+xml":{"content_type":"image/svg+xml","hash":"b7ed89c953b8fe9cc35e0964c0a35de6","path":"/build/b7ed89c953b8fe9cc35e0964c0a35de6.svg"}}}],"key":"sxrxJ8DZtv"}],"key":"h8QeZGzcH4"},{"type":"paragraph","position":{"start":{"line":363,"column":1},"end":{"line":363,"column":1}},"children":[{"type":"text","value":"The results are very similar until the last few iterations, when the limited accuracy of the reference value begins to show. That is, while it is a good estimate of ","position":{"start":{"line":363,"column":1},"end":{"line":363,"column":1}},"key":"VIDTA1MPzj"},{"type":"inlineMath","value":"\\lambda_1","position":{"start":{"line":363,"column":1},"end":{"line":363,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>λ</mi><mn>1</mn></msub></mrow><annotation encoding=\"application/x-tex\">\\lambda_1</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8444em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">λ</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3011em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">1</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span>","key":"zKoFSxDmeW"},{"type":"text","value":", it is less good as an estimate of the error in nearby estimates.","position":{"start":{"line":363,"column":1},"end":{"line":363,"column":1}},"key":"JTgMwCOjxd"}],"key":"wHvz1EdMda"}],"label":"demo-power-iter-julia","identifier":"demo-power-iter-julia","html_id":"demo-power-iter-julia","key":"klEWQGOLSC"},{"type":"heading","depth":3,"position":{"start":{"line":367,"column":1},"end":{"line":367,"column":1}},"children":[{"type":"text","value":"8.3 ","position":{"start":{"line":367,"column":1},"end":{"line":367,"column":1}},"key":"aVuHSxtjbn"},{"type":"link","identifier":"section-krylov-inviter","label":"section-krylov-inviter","kind":"narrative","position":{"start":{"line":367,"column":5},"end":{"line":367,"column":28}},"url":"/inviter","internal":true,"dataUrl":"/inviter.json","children":[{"type":"text","value":"Inverse iteration","key":"GPEvLH8Y3k"}],"key":"O8JOBy4Zx3"}],"identifier":"id-8-3","label":"8.3 ","html_id":"id-8-3","implicit":true,"key":"QQ6LmTigz8"},{"type":"details","open":true,"children":[{"type":"summary","children":[{"type":"crossReference","identifier":"demo-inviter-conv","label":"demo-inviter-conv","kind":"proof:example","position":{"start":{"line":370,"column":1},"end":{"line":370,"column":19}},"children":[{"type":"text","value":"Example ","key":"s4LS9jYkS6"},{"type":"text","value":"8.3.1","key":"V2xVAXMrxp"}],"template":"Example %s","enumerator":"8.3.1","resolved":true,"html_id":"demo-inviter-conv","remote":true,"url":"/inviter","dataUrl":"/inviter.json","key":"M3KSADAc5Y"}],"key":"ayQ0QO8Cx4"},{"type":"paragraph","position":{"start":{"line":372,"column":1},"end":{"line":372,"column":1}},"children":[{"type":"text","value":"We set up a ","position":{"start":{"line":372,"column":1},"end":{"line":372,"column":1}},"key":"kHQgTbRQMi"},{"type":"inlineMath","value":"5\\times 5","position":{"start":{"line":372,"column":1},"end":{"line":372,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>5</mn><mo>×</mo><mn>5</mn></mrow><annotation encoding=\"application/x-tex\">5\\times 5</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.7278em;vertical-align:-0.0833em;\"></span><span class=\"mord\">5</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">×</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">5</span></span></span></span>","key":"aGHlZVXHu1"},{"type":"text","value":" triangular matrix with prescribed eigenvalues on its diagonal.","position":{"start":{"line":372,"column":1},"end":{"line":372,"column":1}},"key":"aMIoMKF1RB"}],"key":"P26oU2O6I0"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"julia","executable":true,"value":"λ = [1, -0.75, 0.6, -0.4, 0]\n# Make a triangular matrix with eigenvalues on the diagonal.\nA = triu(ones(5, 5), 1) + diagm(λ)","key":"pjiUPm1J4K"},{"type":"output","id":"YB4dMP98C2toF6CVyO-cN","data":[{"output_type":"execute_result","execution_count":31,"metadata":{},"data":{"text/plain":{"content":"5×5 Matrix{Float64}:\n 1.0   1.0   1.0   1.0  1.0\n 0.0  -0.75  1.0   1.0  1.0\n 0.0   0.0   0.6   1.0  1.0\n 0.0   0.0   0.0  -0.4  1.0\n 0.0   0.0   0.0   0.0  0.0","content_type":"text/plain"}}}],"key":"Q3Zn38T0Fw"}],"key":"snv2EEuOHA"},{"type":"paragraph","position":{"start":{"line":380,"column":1},"end":{"line":380,"column":1}},"children":[{"type":"text","value":"We run inverse iteration with the shift ","position":{"start":{"line":380,"column":1},"end":{"line":380,"column":1}},"key":"V0mMIjZUfG"},{"type":"inlineMath","value":"s=0.7","position":{"start":{"line":380,"column":1},"end":{"line":380,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>s</mi><mo>=</mo><mn>0.7</mn></mrow><annotation encoding=\"application/x-tex\">s=0.7</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">s</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">0.7</span></span></span></span>","key":"KM52VXr8SV"},{"type":"text","value":" and take the final estimate as our “exact” answer to observe the convergence.","position":{"start":{"line":380,"column":1},"end":{"line":380,"column":1}},"key":"UpEeiWe1oL"}],"key":"ApwYLuQmIk"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"julia","executable":true,"value":"s = 0.7\nβ, x = FNC.inviter(A, s, 30)\neigval = β[end]","key":"bpU54DLgot"},{"type":"output","id":"eqA3kg_7gDxJ6VZmdLEs-","data":[{"output_type":"execute_result","execution_count":32,"metadata":{},"data":{"text/plain":{"content":"0.5999999999999988","content_type":"text/plain"}}}],"key":"wJ4zUWpA52"}],"key":"hZESHkTklF"},{"type":"paragraph","position":{"start":{"line":388,"column":1},"end":{"line":388,"column":1}},"children":[{"type":"text","value":"As expected, the eigenvalue that was found is the one closest to 0.7. The convergence is again linear.","position":{"start":{"line":388,"column":1},"end":{"line":388,"column":1}},"key":"IvlUS1NP6l"}],"key":"EpJYgVuGlT"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"julia","executable":true,"value":"using Plots\nerr = @. abs(eigval - β)\nplot(0:28, err[1:end-1];\n    m=:o,  xlabel=L\"k\", \n    yaxis=(L\"|\\lambda_3-\\beta_k|\", :log10, [1e-16, 1]),\n    title=\"Convergence of inverse iteration\")","key":"Cw1H4zDou4"},{"type":"output","id":"_Z2oPiq2Tc65V9i3oBRur","data":[{"output_type":"execute_result","execution_count":33,"metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"8ed8981ea532b42fc0a0bbc40826833c","path":"/build/8ed8981ea532b42fc0a0bbc40826833c.png"},"text/html":{"content_type":"text/html","hash":"ccc1eae8d51c43d53b06b13eef18eb52","path":"/build/ccc1eae8d51c43d53b06b13eef18eb52.html"},"image/svg+xml":{"content_type":"image/svg+xml","hash":"9bbfb23f4cc0cb0c4fb6a00d1dc4fe1c","path":"/build/9bbfb23f4cc0cb0c4fb6a00d1dc4fe1c.svg"}}}],"key":"ZqNSxBmP9f"}],"key":"vcvXXgLrX4"},{"type":"paragraph","position":{"start":{"line":399,"column":1},"end":{"line":399,"column":1}},"children":[{"type":"text","value":"The observed linear convergence rate is found from the data.","position":{"start":{"line":399,"column":1},"end":{"line":399,"column":1}},"key":"gBpxs5vcg4"}],"key":"zuHpkWO4pM"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"julia","executable":true,"value":"@show observed_rate = err[22] / err[21];","key":"OUD2eHEtgt"},{"type":"output","id":"UaLfVYIOUzrubUSmDTux_","data":[{"output_type":"stream","name":"stdout","text":"observed_rate = err[22] / err[21] = 0.3332639255207899\n"}],"key":"MiC6UpOhhq"}],"key":"aAYpyII3Hl"},{"type":"paragraph","position":{"start":{"line":408,"column":1},"end":{"line":408,"column":1}},"children":[{"type":"text","value":"We reorder the eigenvalues to enforce ","position":{"start":{"line":408,"column":1},"end":{"line":408,"column":1}},"key":"JNqILfWZOF"},{"type":"crossReference","kind":"equation","identifier":"shiftorder","label":"shiftorder","children":[{"type":"text","value":"(","key":"ZBBdfrfomw"},{"type":"text","value":"8.3.3","key":"USPwm9n5h3"},{"type":"text","value":")","key":"EgZWAM4URl"}],"template":"(%s)","enumerator":"8.3.3","resolved":true,"html_id":"shiftorder","remote":true,"url":"/inviter","dataUrl":"/inviter.json","key":"TZI0MBMulg"},{"type":"text","value":".","position":{"start":{"line":408,"column":1},"end":{"line":408,"column":1}},"key":"raPyBX54Ci"}],"indexEntries":[{"entry":"Julia","subEntry":{"value":"sortperm","kind":"entry"},"emphasis":true}],"label":"index-w4MbMTRwvw","identifier":"index-w4mbmtrwvw","html_id":"index-w4mbmtrwvw","key":"EMPqbI4dYs"},{"type":"admonition","kind":"tip","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"Tip","key":"CUQUI96bNz"}],"key":"oFaGcULCNT"},{"type":"paragraph","position":{"start":{"line":411,"column":1},"end":{"line":411,"column":1}},"children":[{"type":"text","value":"The ","position":{"start":{"line":411,"column":1},"end":{"line":411,"column":1}},"key":"PDK94CABUQ"},{"type":"inlineCode","value":"sortperm","position":{"start":{"line":411,"column":1},"end":{"line":411,"column":1}},"key":"Ygrhjtqip8"},{"type":"text","value":" function returns the index permutation needed to sort the given vector, rather than the sorted vector itself.","position":{"start":{"line":411,"column":1},"end":{"line":411,"column":1}},"key":"xaOZLZ3nqS"}],"key":"ZDcQrLmNma"}],"class":"dropdown","key":"O5WSLZvYzi"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"julia","executable":true,"value":"λ = λ[sortperm(abs.(λ .- s))]","key":"D0WrNyi7mp"},{"type":"output","id":"7tLDMIQPMZcsYe1uR42ks","data":[{"output_type":"execute_result","execution_count":35,"metadata":{},"data":{"text/plain":{"content":"5-element Vector{Float64}:\n  0.6\n  1.0\n  0.0\n -0.4\n -0.75","content_type":"text/plain"}}}],"key":"fV9vFlYHGS"}],"key":"jhWo6SUBpv"},{"type":"paragraph","position":{"start":{"line":418,"column":1},"end":{"line":418,"column":1}},"children":[{"type":"text","value":"Hence the theoretical convergence rate is","position":{"start":{"line":418,"column":1},"end":{"line":418,"column":1}},"key":"AGB98oNNII"}],"key":"gJepIsdnC7"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"julia","executable":true,"value":"@show theoretical_rate = (λ[1] - s) / (λ[2] - s);","key":"eHv1WnrVzC"},{"type":"output","id":"cNdsohcC8dmCqg6LBEYFJ","data":[{"output_type":"stream","name":"stdout","text":"theoretical_rate = (λ[1] - s) / (λ[2] - s) = -0.3333333333333332\n"}],"key":"FysSU36lBN"}],"key":"TqQCEFJzNd"}],"label":"demo-inviter-conv-julia","identifier":"demo-inviter-conv-julia","html_id":"demo-inviter-conv-julia","key":"m57wLfuUwv"},{"type":"details","open":true,"children":[{"type":"summary","children":[{"type":"crossReference","identifier":"demo-inviter-accel","label":"demo-inviter-accel","kind":"proof:example","position":{"start":{"line":426,"column":1},"end":{"line":426,"column":20}},"children":[{"type":"text","value":"Example ","key":"dXIIbdQlmV"},{"type":"text","value":"8.3.2","key":"arzwuu26vX"}],"template":"Example %s","enumerator":"8.3.2","resolved":true,"html_id":"demo-inviter-accel","remote":true,"url":"/inviter","dataUrl":"/inviter.json","key":"s1iJMYM0OG"}],"key":"jKU5CP6743"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"julia","executable":true,"value":"λ = [1, -0.75, 0.6, -0.4, 0]\n# Make a triangular matrix with eigenvalues on the diagonal.\nA = triu(ones(5, 5), 1) + diagm(λ)","key":"O1JFDwQ9XM"},{"type":"output","id":"2rj4t__FUeZwquXyjFwrX","data":[{"output_type":"execute_result","execution_count":37,"metadata":{},"data":{"text/plain":{"content":"5×5 Matrix{Float64}:\n 1.0   1.0   1.0   1.0  1.0\n 0.0  -0.75  1.0   1.0  1.0\n 0.0   0.0   0.6   1.0  1.0\n 0.0   0.0   0.0  -0.4  1.0\n 0.0   0.0   0.0   0.0  0.0","content_type":"text/plain"}}}],"key":"XiXAf9XvsM"}],"key":"lOGWCAYtf0"},{"type":"paragraph","position":{"start":{"line":434,"column":1},"end":{"line":434,"column":1}},"children":[{"type":"text","value":"We begin with a shift ","position":{"start":{"line":434,"column":1},"end":{"line":434,"column":1}},"key":"Ybxc0ngsCO"},{"type":"inlineMath","value":"s=0.7","position":{"start":{"line":434,"column":1},"end":{"line":434,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>s</mi><mo>=</mo><mn>0.7</mn></mrow><annotation encoding=\"application/x-tex\">s=0.7</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">s</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">0.7</span></span></span></span>","key":"KJgi72gxFj"},{"type":"text","value":", which is closest to the eigenvalue 0.6.","position":{"start":{"line":434,"column":1},"end":{"line":434,"column":1}},"key":"dvacdn10ki"}],"key":"ziHBzx0Vxx"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"julia","executable":true,"value":"s = 0.7\nx = ones(5)\ny = (A - s * I) \\ x\nβ = x[1] / y[1] + s","key":"J1EgmqC41i"},{"type":"output","id":"Dx2j8RdXZaHVv59CgiTIQ","data":[{"output_type":"execute_result","execution_count":38,"metadata":{},"data":{"text/plain":{"content":"0.7034813925570228","content_type":"text/plain"}}}],"key":"yT2VvI2mZU"}],"key":"BxgZFJTBT9"},{"type":"paragraph","position":{"start":{"line":443,"column":1},"end":{"line":443,"column":1}},"children":[{"type":"text","value":"Note that the result is not yet any closer to the targeted 0.6. But we proceed (without being too picky about normalization here).","position":{"start":{"line":443,"column":1},"end":{"line":443,"column":1}},"key":"E05d7BgqXR"}],"key":"TqBBaW0e30"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"julia","executable":true,"value":"s = β\nx = y / y[1]\ny = (A - s * I) \\ x\nβ = x[1] / y[1] + s","key":"PJOQgX4Y7V"},{"type":"output","id":"n7pwWzrgAMZsmu0sf5res","data":[{"output_type":"execute_result","execution_count":39,"metadata":{},"data":{"text/plain":{"content":"0.5612761406172997","content_type":"text/plain"}}}],"key":"oBnLahq21u"}],"key":"C6yAbHIakK"},{"type":"paragraph","position":{"start":{"line":452,"column":1},"end":{"line":452,"column":1}},"children":[{"type":"text","value":"Still not much apparent progress. However, in just a few more iterations the results are dramatically better.","position":{"start":{"line":452,"column":1},"end":{"line":452,"column":1}},"key":"nEUbB3uK2o"}],"key":"mGmXbY5hlZ"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"julia","executable":true,"value":"for k in 1:4\n    s = β\n    x = y / y[1]\n    y = (A - s * I) \\ x\n    @show β = x[1] / y[1] + s\nend","key":"svhpcXfmcD"},{"type":"output","id":"M8uLxdsYUyHhKjGWsMxMO","data":[{"output_type":"stream","name":"stdout","text":"β = x[1] / y[1] + s = 0.5964312884753865\nβ = x[1] / y[1] + s = 0.5999717091820104\nβ = x[1] / y[1] + s = 0.5999999978556353\nβ = x[1] / y[1] + s = 0.6\n"}],"key":"aVRKnLq7g6"}],"key":"qoHAbMtOwn"}],"label":"demo-inviter-accel-julia","identifier":"demo-inviter-accel-julia","html_id":"demo-inviter-accel-julia","key":"MFu8fjahBS"},{"type":"heading","depth":3,"position":{"start":{"line":464,"column":1},"end":{"line":464,"column":1}},"children":[{"type":"text","value":"8.4 ","position":{"start":{"line":464,"column":1},"end":{"line":464,"column":1}},"key":"m4hgxanfOz"},{"type":"link","identifier":"section-krylov-subspace","label":"section-krylov-subspace","kind":"narrative","position":{"start":{"line":464,"column":5},"end":{"line":464,"column":29}},"url":"/subspace","internal":true,"dataUrl":"/subspace.json","children":[{"type":"text","value":"Krylov subspaces","key":"cHFCGwIXn8"}],"key":"gZnDQMFtRu"}],"identifier":"id-8-4","label":"8.4 ","html_id":"id-8-4","implicit":true,"key":"h0O7eIPUFT"},{"type":"details","open":true,"children":[{"type":"summary","children":[{"type":"crossReference","identifier":"demo-subspace-unstable","label":"demo-subspace-unstable","kind":"proof:example","position":{"start":{"line":467,"column":1},"end":{"line":467,"column":24}},"children":[{"type":"text","value":"Example ","key":"FRuYztOnv3"},{"type":"text","value":"8.4.1","key":"AUT659fL19"}],"template":"Example %s","enumerator":"8.4.1","resolved":true,"html_id":"demo-subspace-unstable","remote":true,"url":"/subspace","dataUrl":"/subspace.json","key":"suVgw1joE4"}],"key":"oxPw2cTiZX"},{"type":"paragraph","position":{"start":{"line":469,"column":1},"end":{"line":469,"column":1}},"children":[{"type":"text","value":"First we define a triangular matrix with known eigenvalues, and a random vector ","position":{"start":{"line":469,"column":1},"end":{"line":469,"column":1}},"key":"A0vynNyxYO"},{"type":"inlineMath","value":"b","position":{"start":{"line":469,"column":1},"end":{"line":469,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>b</mi></mrow><annotation encoding=\"application/x-tex\">b</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6944em;\"></span><span class=\"mord mathnormal\">b</span></span></span></span>","key":"oaKKxilOuq"},{"type":"text","value":".","position":{"start":{"line":469,"column":1},"end":{"line":469,"column":1}},"key":"s4JNtVAdrA"}],"key":"zRp0iQ7ogd"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"julia","executable":true,"value":"λ = @. 10 + (1:100)\nA = triu(rand(100, 100), 1) + diagm(λ)\nb = rand(100);","key":"k9O6mN3bvZ"},{"type":"output","id":"XpJeNOK82BOkJrfGquqgl","data":[],"key":"HewiIIi3J5"}],"key":"vj2rvfuIWs"},{"type":"paragraph","position":{"start":{"line":477,"column":1},"end":{"line":477,"column":1}},"children":[{"type":"text","value":"Next we build up the first ten Krylov matrices iteratively, using renormalization after each matrix-vector multiplication.","position":{"start":{"line":477,"column":1},"end":{"line":477,"column":1}},"key":"BrFLOzFi50"}],"key":"WF9mxcAUzH"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"julia","executable":true,"value":"Km = [b zeros(100, 29)]\nfor m in 1:29\n    v = A * Km[:, m]\n    Km[:, m+1] = v / norm(v)\nend","key":"LQTGBOle54"},{"type":"output","id":"knk3xjntL0xFm75VlbP7O","data":[],"key":"zyJKGYT7DH"}],"key":"P1lUFbhABe"},{"type":"paragraph","position":{"start":{"line":487,"column":1},"end":{"line":487,"column":1}},"children":[{"type":"text","value":"Now we solve least-squares problems for Krylov matrices of increasing dimension, recording the residual in each case.","position":{"start":{"line":487,"column":1},"end":{"line":487,"column":1}},"key":"BcElHiPVzV"}],"key":"mUuCMhKxsn"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"julia","executable":true,"value":"resid = zeros(30)\nfor m in 1:30\n    z = (A * Km[:, 1:m]) \\ b\n    x = Km[:, 1:m] * z\n    resid[m] = norm(b - A * x)\nend","key":"R6vJJyVfLV"},{"type":"output","id":"qdTkWtE4kOwLJzsiYSzwM","data":[],"key":"HPFUyfm2AG"}],"key":"Rra7ryh6dE"},{"type":"paragraph","position":{"start":{"line":498,"column":1},"end":{"line":498,"column":1}},"children":[{"type":"text","value":"The linear system approximations show smooth linear convergence at first, but the convergence stagnates after only a few digits have been found.","position":{"start":{"line":498,"column":1},"end":{"line":498,"column":1}},"key":"P2kv0gzQhr"}],"key":"RXiN1LI12n"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"julia","executable":true,"value":"using Plots\nplot(0:29, resid; m=:o,\n    xaxis=(L\"m\"), yaxis=(:log10, L\"\\| b-Ax_m \\|\"),\n    title=\"Residual for linear systems\", legend=:none)","key":"zb1c07gBdk"},{"type":"output","id":"KIbObdqAGVTyzuNhrtx9r","data":[{"output_type":"execute_result","execution_count":44,"metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"d03d090acb8ee424caa0d7db8c9b7806","path":"/build/d03d090acb8ee424caa0d7db8c9b7806.png"},"text/html":{"content_type":"text/html","hash":"dc58edb42462150d3ae613d341b44137","path":"/build/dc58edb42462150d3ae613d341b44137.html"},"image/svg+xml":{"content_type":"image/svg+xml","hash":"f2d7064a337907e1fbfc317af41ff316","path":"/build/f2d7064a337907e1fbfc317af41ff316.svg"}}}],"key":"L0QyLN8xHu"}],"key":"Mn4TBfxAeE"}],"label":"demo-subspace-unstable-julia","identifier":"demo-subspace-unstable-julia","html_id":"demo-subspace-unstable-julia","key":"zDgXmfGNuX"},{"type":"details","open":true,"children":[{"type":"summary","children":[{"type":"crossReference","identifier":"demo-subspace-arnoldi","label":"demo-subspace-arnoldi","kind":"proof:example","position":{"start":{"line":509,"column":1},"end":{"line":509,"column":23}},"children":[{"type":"text","value":"Example ","key":"zWO86vh2cI"},{"type":"text","value":"8.4.2","key":"e1a5yxhUlt"}],"template":"Example %s","enumerator":"8.4.2","resolved":true,"html_id":"demo-subspace-arnoldi","remote":true,"url":"/subspace","dataUrl":"/subspace.json","key":"FCvBPUc6tJ"}],"key":"c5GQQQkiZT"},{"type":"paragraph","position":{"start":{"line":511,"column":1},"end":{"line":511,"column":1}},"children":[{"type":"text","value":"Here again is the linear system from ","position":{"start":{"line":511,"column":1},"end":{"line":511,"column":1}},"key":"ZLFygsuuNU"},{"type":"crossReference","identifier":"demo-subspace-unstable","label":"demo-subspace-unstable","kind":"proof:example","position":{"start":{"line":511,"column":38},"end":{"line":511,"column":61}},"children":[{"type":"text","value":"Example ","key":"Uxg3GQ69HX"},{"type":"text","value":"8.4.1","key":"itiOKCoyzb"}],"template":"Example %s","enumerator":"8.4.1","resolved":true,"html_id":"demo-subspace-unstable","remote":true,"url":"/subspace","dataUrl":"/subspace.json","key":"TyJwlZwL57"},{"type":"text","value":".","position":{"start":{"line":511,"column":1},"end":{"line":511,"column":1}},"key":"EUCtCXSh06"}],"key":"pWCbxwW19A"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"julia","executable":true,"value":"λ = @. 10 + (1:100)\nA = triu(rand(100, 100), 1) + diagm(λ)\nb = rand(100);","key":"xLhSGhadSM"},{"type":"output","id":"Gy2LHa-44FFj4GL9iVnuT","data":[],"key":"zWyFdsvUIU"}],"key":"oG6Us8GdIh"},{"type":"paragraph","position":{"start":{"line":519,"column":1},"end":{"line":519,"column":1}},"children":[{"type":"text","value":"We can use ","position":{"start":{"line":519,"column":1},"end":{"line":519,"column":1}},"key":"PaXSvvQqVJ"},{"type":"inlineMath","value":"\\mathbf{b}","position":{"start":{"line":519,"column":1},"end":{"line":519,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi mathvariant=\"bold\">b</mi></mrow><annotation encoding=\"application/x-tex\">\\mathbf{b}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6944em;\"></span><span class=\"mord mathbf\">b</span></span></span></span>","key":"ZNL55xr2vh"},{"type":"text","value":" as the seed vector for the Arnoldi iteration.","position":{"start":{"line":519,"column":1},"end":{"line":519,"column":1}},"key":"sobcvyNDn4"}],"key":"ZFnYGWM3gT"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"julia","executable":true,"value":"Q, H = FNC.arnoldi(A, b, 30)\nprintln(\"Q has size $(size(Q))\")\nprintln(\"H has size $(size(H))\")","key":"Q88b8Nkn1Z"},{"type":"output","id":"8_yAbdIfrPRm-kMblFLoi","data":[{"output_type":"stream","name":"stdout","text":"Q has size (100, 31)\nH has size (31, 30)\n"}],"key":"Gokhk3EKz9"}],"key":"k5N8Nu9wLx"},{"type":"paragraph","position":{"start":{"line":527,"column":1},"end":{"line":527,"column":1}},"children":[{"type":"text","value":"Here’s one validation of the key identity ","position":{"start":{"line":527,"column":1},"end":{"line":527,"column":1}},"key":"W7nOeWGh8z"},{"type":"crossReference","identifier":"arnoldimat","label":"arnoldimat","kind":"equation","position":{"start":{"line":527,"column":43},"end":{"line":527,"column":54}},"children":[{"type":"text","value":"(","key":"fSJEk1MvEg"},{"type":"text","value":"8.4.10","key":"P0aomL5pBm"},{"type":"text","value":")","key":"MJ49zy4SAO"}],"template":"(%s)","enumerator":"8.4.10","resolved":true,"html_id":"arnoldimat","remote":true,"url":"/subspace","dataUrl":"/subspace.json","key":"XdNSPnH83t"},{"type":"text","value":".","position":{"start":{"line":527,"column":1},"end":{"line":527,"column":1}},"key":"gXQ5TNAXxz"}],"key":"Sgv6gJJam9"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"julia","executable":true,"value":"should_be_near_zero = opnorm(A * Q[:, 1:20] - Q[:, 1:21] * H[1:21, 1:20])","key":"Srjk0g4jzQ"},{"type":"output","id":"sPnNZ-7N7TF7hImxaXpa9","data":[{"output_type":"execute_result","execution_count":47,"metadata":{},"data":{"text/plain":{"content":"2.1854836270940343e-14","content_type":"text/plain"}}}],"key":"S0Iadxev46"}],"key":"g9wmbPPU2G"},{"type":"paragraph","position":{"start":{"line":532,"column":1},"end":{"line":532,"column":1}},"children":[{"type":"text","value":"Using the Krylov matrix to project the linear system into a Kyrlov subspace in ","position":{"start":{"line":532,"column":1},"end":{"line":532,"column":1}},"key":"qXWRkSZYzA"},{"type":"crossReference","identifier":"demo-subspace-unstable","label":"demo-subspace-unstable","kind":"proof:example","position":{"start":{"line":532,"column":80},"end":{"line":532,"column":103}},"children":[{"type":"text","value":"Example ","key":"FOJPjF1ltn"},{"type":"text","value":"8.4.1","key":"bG7TZXDWHp"}],"template":"Example %s","enumerator":"8.4.1","resolved":true,"html_id":"demo-subspace-unstable","remote":true,"url":"/subspace","dataUrl":"/subspace.json","key":"GJHfqkMt8M"},{"type":"text","value":" was unable to get the residual much smaller than about ","position":{"start":{"line":532,"column":1},"end":{"line":532,"column":1}},"key":"wnqyP2gh9I"},{"type":"span","position":{"start":{"line":532,"column":1},"end":{"line":532,"column":1}},"children":[{"type":"text","value":"10","key":"VMV6gqFuyf"},{"type":"superscript","children":[{"type":"text","value":"-4","key":"wmDeUrdsE7"}],"key":"gHk2aVs35v"}],"key":"GvtL5cHu6m"},{"type":"text","value":". But the Arnoldi basis gives us a stable way to work in that subspace and get better results.","position":{"start":{"line":532,"column":1},"end":{"line":532,"column":1}},"key":"BOQyvx9C3l"}],"key":"WBJEIZ0aXO"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"julia","executable":true,"value":"z = (A * Q) \\ b\nx = Q * z\n@show resid_norm = norm(b - A * x);","key":"UW6yPfQmm9"},{"type":"output","id":"XLJ5svafOFE8fTfkGqSrm","data":[{"output_type":"stream","name":"stdout","text":"resid_norm = norm(b - A * x) = 2.264479699632136e-9\n"}],"key":"qkeKMaP1zm"}],"key":"T5XTSWLz8w"}],"label":"demo-subspace-arnoldi-julia","identifier":"demo-subspace-arnoldi-julia","html_id":"demo-subspace-arnoldi-julia","key":"xLOFEpsZa5"},{"type":"heading","depth":3,"position":{"start":{"line":541,"column":1},"end":{"line":541,"column":1}},"children":[{"type":"text","value":"8.5 ","position":{"start":{"line":541,"column":1},"end":{"line":541,"column":1}},"key":"qOogVDAf6L"},{"type":"link","identifier":"section-krylov-gmres","label":"section-krylov-gmres","kind":"narrative","position":{"start":{"line":541,"column":5},"end":{"line":541,"column":26}},"url":"/gmres","internal":true,"dataUrl":"/gmres.json","children":[{"type":"text","value":"GMRES","key":"ZCPxHw8maD"}],"key":"a5yqCsD257"}],"identifier":"id-8-5","label":"8.5 ","html_id":"id-8-5","implicit":true,"key":"s32A8wu2Z0"},{"type":"details","open":true,"children":[{"type":"summary","children":[{"type":"crossReference","identifier":"demo-gmres-intro","label":"demo-gmres-intro","kind":"proof:example","position":{"start":{"line":544,"column":1},"end":{"line":544,"column":18}},"children":[{"type":"text","value":"Example ","key":"QxtuZicdlO"},{"type":"text","value":"8.5.1","key":"BIxhttCq6r"}],"template":"Example %s","enumerator":"8.5.1","resolved":true,"html_id":"demo-gmres-intro","remote":true,"url":"/gmres","dataUrl":"/gmres.json","key":"Mh72FX4S0s"}],"key":"yMDX8GNs0i"},{"type":"paragraph","position":{"start":{"line":546,"column":1},"end":{"line":546,"column":1}},"children":[{"type":"text","value":"We define a triangular matrix with known eigenvalues and a random vector ","position":{"start":{"line":546,"column":1},"end":{"line":546,"column":1}},"key":"rXibzrtxDn"},{"type":"inlineMath","value":"\\mathbf{b}","position":{"start":{"line":546,"column":1},"end":{"line":546,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi mathvariant=\"bold\">b</mi></mrow><annotation encoding=\"application/x-tex\">\\mathbf{b}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6944em;\"></span><span class=\"mord mathbf\">b</span></span></span></span>","key":"iRZQsh67A7"},{"type":"text","value":".","position":{"start":{"line":546,"column":1},"end":{"line":546,"column":1}},"key":"G0WaBGNjGv"}],"key":"ZukrSsSSYf"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"julia","executable":true,"value":"λ = @. 10 + (1:100)\nA = triu(rand(100, 100), 1) + diagm(λ)\nb = rand(100);","key":"pUtKzTO7NH"},{"type":"output","id":"arU8tieCRSJ-TAlefNIt_","data":[],"key":"Ytg1scTrpd"}],"key":"Q20Kf5sDBH"},{"type":"paragraph","position":{"start":{"line":554,"column":1},"end":{"line":554,"column":1}},"children":[{"type":"text","value":"Instead of building the Krylov matrices, we use the Arnoldi iteration to generate equivalent orthonormal vectors.","position":{"start":{"line":554,"column":1},"end":{"line":554,"column":1}},"key":"h5DA5p6PU9"}],"key":"ipLJbERo6D"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"julia","executable":true,"value":"Q, H = FNC.arnoldi(A, b, 60);","key":"jr3EYBfrDF"},{"type":"output","id":"_RRIoLBQmov91VEg7Ly2N","data":[],"key":"spOQa1GGFL"}],"key":"D5uM9Sacf0"},{"type":"paragraph","position":{"start":{"line":560,"column":1},"end":{"line":560,"column":1}},"children":[{"type":"text","value":"The Arnoldi bases are used to solve the least-squares problems defining the GMRES iterates.","position":{"start":{"line":560,"column":1},"end":{"line":560,"column":1}},"key":"EtydTPKgRH"}],"key":"aQr4QTCQfi"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"julia","executable":true,"value":"resid = [norm(b); zeros(60)]\nfor m in 1:60\n    s = [norm(b); zeros(m)]\n    z = H[1:m+1, 1:m] \\ s\n    x = Q[:, 1:m] * z\n    resid[m+1] = norm(b - A * x)\nend","key":"G5iPHHVP10"},{"type":"output","id":"xWnZWJr_8gYiZ7EAq194M","data":[],"key":"W1uQte7XLS"}],"key":"N7lZcn6cql"},{"type":"paragraph","position":{"start":{"line":572,"column":1},"end":{"line":572,"column":1}},"children":[{"type":"text","value":"The approximations converge smoothly, practically all the way to machine epsilon.","position":{"start":{"line":572,"column":1},"end":{"line":572,"column":1}},"key":"d1GkDRbXdh"}],"key":"w1f1FNsQuQ"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"julia","executable":true,"value":"using Plots\nplot(0:60, resid, m=:o,\n    xaxis=(L\"m\"),  yaxis=(:log10, \"norm of mth residual\"),\n    title=\"Residual for GMRES\",  legend=:none)","key":"VPug3Q4hKm"},{"type":"output","id":"h5FI3b2ihyKm26gn7xYDR","data":[{"output_type":"execute_result","execution_count":52,"metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"31f2cbafc20f50582f360bb7f405fa8f","path":"/build/31f2cbafc20f50582f360bb7f405fa8f.png"},"text/html":{"content_type":"text/html","hash":"9fefc8d6fa4ae18c23892fdf5539a979","path":"/build/9fefc8d6fa4ae18c23892fdf5539a979.html"},"image/svg+xml":{"content_type":"image/svg+xml","hash":"b9b3f7db8f84a6d07bd4046ebffc3b56","path":"/build/b9b3f7db8f84a6d07bd4046ebffc3b56.svg"}}}],"key":"la0WEHs3Vq"}],"key":"z2OBJuTB4G"}],"label":"demo-gmres-intro-julia","identifier":"demo-gmres-intro-julia","html_id":"demo-gmres-intro-julia","key":"zzI50y8viC"},{"type":"details","open":true,"children":[{"type":"summary","children":[{"type":"crossReference","identifier":"demo-gmres-restart","label":"demo-gmres-restart","kind":"proof:example","position":{"start":{"line":583,"column":1},"end":{"line":583,"column":20}},"children":[{"type":"text","value":"Example ","key":"zQUooCzqkC"},{"type":"text","value":"8.5.2","key":"KUD0gQFezH"}],"template":"Example %s","enumerator":"8.5.2","resolved":true,"html_id":"demo-gmres-restart","remote":true,"url":"/gmres","dataUrl":"/gmres.json","key":"hfhl9yeTjj"}],"key":"VsW0iANPrp"},{"type":"paragraph","position":{"start":{"line":585,"column":1},"end":{"line":585,"column":1}},"children":[{"type":"text","value":"The following experiments are based on a matrix resulting from discretization of a partial differential equation.","position":{"start":{"line":585,"column":1},"end":{"line":585,"column":1}},"key":"GrmPmSHiOH"}],"key":"YFxVs5BW37"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"julia","executable":true,"value":"A = FNC.poisson(50)\nn = size(A, 1)\nb = ones(n);\nspy(A, color=:blues)","key":"kAjfaqawIr"},{"type":"output","id":"5MxUkD6deIXA2-wB3t_h5","data":[{"output_type":"execute_result","execution_count":53,"metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"e8cbdba603651d154934287c6867a7e4","path":"/build/e8cbdba603651d154934287c6867a7e4.png"},"text/html":{"content_type":"text/html","hash":"d702192229bb5fcdb26b078f62849211","path":"/build/d702192229bb5fcdb26b078f62849211.html"},"image/svg+xml":{"content_type":"image/svg+xml","hash":"25131363ca0471d5ce94dabf9655f2d9","path":"/build/25131363ca0471d5ce94dabf9655f2d9.svg"}}}],"key":"san8SME0O9"}],"indexEntries":[{"entry":"Julia","subEntry":{"value":"keyword function arguments","kind":"entry"},"emphasis":false}],"label":"index-JNRpHU6IbI","identifier":"index-jnrphu6ibi","html_id":"index-jnrphu6ibi","key":"SxqkrOgY8I"},{"type":"paragraph","position":{"start":{"line":600,"column":1},"end":{"line":600,"column":1}},"children":[{"type":"text","value":"We compare unrestarted GMRES with three different thresholds for restarting. Here we are using ","position":{"start":{"line":600,"column":1},"end":{"line":600,"column":1}},"key":"f9FqKt5qpu"},{"type":"inlineCode","value":"gmres","position":{"start":{"line":600,"column":1},"end":{"line":600,"column":1}},"key":"geDErlVOwq"},{"type":"text","value":" from the ","position":{"start":{"line":600,"column":1},"end":{"line":600,"column":1}},"key":"eA37DrzMWa"},{"type":"inlineCode","value":"IterativeSolvers","position":{"start":{"line":600,"column":1},"end":{"line":600,"column":1}},"key":"haFOD7KZdi"},{"type":"text","value":" package, since our simple implementation does not offer restarting.","position":{"start":{"line":600,"column":1},"end":{"line":600,"column":1}},"key":"wrDPLkQ7a5"}],"indexEntries":[{"entry":"Julia","subEntry":{"value":"gmres","kind":"entry"},"emphasis":true}],"label":"index-bL9YPmNa0G","identifier":"index-bl9ypmna0g","html_id":"index-bl9ypmna0g","key":"fQJk6nBeX9"},{"type":"admonition","kind":"tip","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"Tip","key":"zrhaJGn9Rh"}],"key":"KAQlKLYoFR"},{"type":"paragraph","position":{"start":{"line":603,"column":1},"end":{"line":603,"column":1}},"children":[{"type":"text","value":"The syntax ","position":{"start":{"line":603,"column":1},"end":{"line":603,"column":1}},"key":"D2WRF0llg6"},{"type":"inlineCode","value":"f(x;foo)","position":{"start":{"line":603,"column":1},"end":{"line":603,"column":1}},"key":"H7K10XFIZj"},{"type":"text","value":" is shorthand for ","position":{"start":{"line":603,"column":1},"end":{"line":603,"column":1}},"key":"DiMydr2xMO"},{"type":"inlineCode","value":"f(x,foo=foo)","position":{"start":{"line":603,"column":1},"end":{"line":603,"column":1}},"key":"PCds3Hm3lR"},{"type":"text","value":".","position":{"start":{"line":603,"column":1},"end":{"line":603,"column":1}},"key":"BSVbzlgSGW"}],"key":"x8dbkHenCJ"}],"class":"dropdown","key":"bxrXftdEf1"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"julia","executable":true,"value":"using IterativeSolvers\nreltol = 1e-12;\nplt = plot(title=\"Convergence of restarted GMRES\", legend=:bottomleft,\n    xaxis=(L\"m\"),  yaxis=(:log10, \"residual norm\", [1e-8, 100]))\n\nfor restart in [n, 20, 40, 60]\n    x, hist = IterativeSolvers.gmres(A, b; restart, reltol,\n        maxiter=100, log=true)\n    plot!(hist[:resnorm], label=\"restart = $restart\")\nend\n\nplt","key":"ROYA9YgcQD"},{"type":"output","id":"bt-RaUhz7RWl_Zj-OKdIg","data":[{"output_type":"execute_result","execution_count":54,"metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"3bb77cc56127f7ec89d10c591cfce98a","path":"/build/3bb77cc56127f7ec89d10c591cfce98a.png"},"text/html":{"content_type":"text/html","hash":"81bd5a79352edea5036fb6203e39eaa1","path":"/build/81bd5a79352edea5036fb6203e39eaa1.html"},"image/svg+xml":{"content_type":"image/svg+xml","hash":"ffb1295a5fa1160719a6f09480acd09c","path":"/build/ffb1295a5fa1160719a6f09480acd09c.svg"}}}],"key":"aUFejV1iJZ"}],"key":"zZzrYHhbqn"},{"type":"paragraph","position":{"start":{"line":621,"column":1},"end":{"line":621,"column":1}},"children":[{"type":"text","value":"The “pure” GMRES curve is the lowest one. All of the other curves agree with it until the first restart. Decreasing the restart value makes the convergence per iteration generally worse, but the time required per iteration smaller as well.","position":{"start":{"line":621,"column":1},"end":{"line":621,"column":1}},"key":"tUqF2oggX6"}],"key":"axrwwocgfL"}],"label":"demo-gmres-restart-julia","identifier":"demo-gmres-restart-julia","html_id":"demo-gmres-restart-julia","key":"jjCa46I6PN"},{"type":"heading","depth":3,"position":{"start":{"line":625,"column":1},"end":{"line":625,"column":1}},"children":[{"type":"text","value":"8.6 ","position":{"start":{"line":625,"column":1},"end":{"line":625,"column":1}},"key":"VR3dLQl6cv"},{"type":"link","identifier":"section-krylov-minrescg","label":"section-krylov-minrescg","kind":"narrative","position":{"start":{"line":625,"column":5},"end":{"line":625,"column":29}},"url":"/minrescg","internal":true,"dataUrl":"/minrescg.json","children":[{"type":"text","value":"MINRES and conjugate gradients","key":"VFBSsK09ev"}],"key":"TVVSPoTLJZ"}],"identifier":"id-8-6","label":"8.6 ","html_id":"id-8-6","implicit":true,"key":"ypY0nJ9U7L"},{"type":"details","open":true,"children":[{"type":"summary","children":[{"type":"crossReference","identifier":"demo-minrescg-indefinite","label":"demo-minrescg-indefinite","kind":"proof:example","position":{"start":{"line":628,"column":1},"end":{"line":628,"column":26}},"children":[{"type":"text","value":"Example ","key":"j9p4wESSTj"},{"type":"text","value":"8.6.2","key":"mKDZsIjffS"}],"template":"Example %s","enumerator":"8.6.2","resolved":true,"html_id":"demo-minrescg-indefinite","remote":true,"url":"/minrescg","dataUrl":"/minrescg.json","key":"cU4NWRImDk"}],"key":"e6e4Q8yKey"},{"type":"paragraph","position":{"start":{"line":630,"column":1},"end":{"line":630,"column":1}},"children":[{"type":"text","value":"The following matrix is indefinite.","position":{"start":{"line":630,"column":1},"end":{"line":630,"column":1}},"key":"bHrxCN8Mop"}],"key":"J8Jks4AAYy"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"julia","executable":true,"value":"A = FNC.poisson(10) - 20I\nλ = eigvals(Matrix(A))\nisneg = @. λ < 0\n@show sum(isneg), sum(.!isneg);","key":"VEc06KM0tA"},{"type":"output","id":"5xQgTITHr-M5dbrUtSbZ6","data":[{"output_type":"stream","name":"stdout","text":"(sum(isneg), sum(.!(isneg))) = (13, 87)"},{"output_type":"stream","name":"stdout","text":"\n"}],"key":"KnPPVUOl9u"}],"key":"OuiOlA11sE"},{"type":"paragraph","position":{"start":{"line":639,"column":1},"end":{"line":639,"column":1}},"children":[{"type":"text","value":"We can compute the relevant quantities from ","position":{"start":{"line":639,"column":1},"end":{"line":639,"column":1}},"key":"SpTjIfLp2k"},{"type":"crossReference","kind":"proof:theorem","identifier":"theorem-minrescg-indefinite","label":"theorem-minrescg-indefinite","children":[{"type":"text","value":"Theorem ","key":"WbWJoF0LOX"},{"type":"text","value":"8.6.1","key":"mvNXKDN99e"}],"template":"Theorem %s","enumerator":"8.6.1","resolved":true,"html_id":"theorem-minrescg-indefinite","remote":true,"url":"/minrescg","dataUrl":"/minrescg.json","key":"nnAzlbQ6kG"},{"type":"text","value":".","position":{"start":{"line":639,"column":1},"end":{"line":639,"column":1}},"key":"RALhuHOPcb"}],"key":"lK9eGEmCgh"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"julia","executable":true,"value":"mn, mx = extrema(-λ[isneg])\nκ₋ = mx / mn\nmn, mx = extrema(λ[.!isneg])\nκ₊ = mx / mn\nρ = (sqrt(κ₋ * κ₊) - 1) / (sqrt(κ₋ * κ₊) + 1)","key":"ewj1qoLAwl"},{"type":"output","id":"FFPKOHwQMx0eh9_jmfvFm","data":[{"output_type":"execute_result","execution_count":56,"metadata":{},"data":{"text/plain":{"content":"0.9026418585584018","content_type":"text/plain"}}}],"key":"rtjCCWvcE0"}],"key":"Qx5f1pClxk"},{"type":"paragraph","position":{"start":{"line":649,"column":1},"end":{"line":649,"column":1}},"children":[{"type":"text","value":"Because the iteration number ","position":{"start":{"line":649,"column":1},"end":{"line":649,"column":1}},"key":"e8seEeN8Wi"},{"type":"inlineMath","value":"m","position":{"start":{"line":649,"column":1},"end":{"line":649,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>m</mi></mrow><annotation encoding=\"application/x-tex\">m</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">m</span></span></span></span>","key":"pt2iHKvguJ"},{"type":"text","value":" is halved in ","position":{"start":{"line":649,"column":1},"end":{"line":649,"column":1}},"key":"SzqNh3xaju"},{"type":"crossReference","kind":"equation","identifier":"minres-conv","label":"minres-conv","children":[{"type":"text","value":"(","key":"KLdYGVQRdg"},{"type":"text","value":"8.6.4","key":"bKrvROfbi6"},{"type":"text","value":")","key":"iqYyePkowG"}],"template":"(%s)","enumerator":"8.6.4","resolved":true,"html_id":"minres-conv","remote":true,"url":"/minrescg","dataUrl":"/minrescg.json","key":"wQ4UJsQdyg"},{"type":"text","value":", the rate constant of linear convergence is the square root of this number, which makes it even closer to 1.","position":{"start":{"line":649,"column":1},"end":{"line":649,"column":1}},"key":"N6lvpdMwQW"}],"key":"YaY3tcRTol"},{"type":"paragraph","position":{"start":{"line":651,"column":1},"end":{"line":651,"column":1}},"children":[{"type":"text","value":"Now we apply MINRES to a linear system with this matrix, and compare the observed convergence to the upper bound from the theorem.","position":{"start":{"line":651,"column":1},"end":{"line":651,"column":1}},"key":"dtyhS1GdpF"}],"key":"FzaqBZovx7"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"julia","executable":true,"value":"using IterativeSolvers, Plots\nb = rand(100)\nx, hist = minres(A, b, reltol=1e-10, maxiter=51, log=true);\nrelres = hist[:resnorm] / norm(b)\nm = 0:length(relres)-1\nplot(m, relres;\n    label=\"observed\", legend=:left,\n    xaxis=L\"m\",  yaxis=(:log10, \"relative residual\"),\n    title=(\"Convergence of MINRES\"))\nplot!(m, ρ .^ (m / 2), l=:dash, label=\"upper bound\")","key":"J56m64gDXD"},{"type":"output","id":"iHGeUDKfs7zFy49vVKzk6","data":[{"output_type":"execute_result","execution_count":57,"metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"537bcbaf596070c1ff536bc5e5274c4e","path":"/build/537bcbaf596070c1ff536bc5e5274c4e.png"},"text/html":{"content_type":"text/html","hash":"d0d18f6ff7e2cd0505df602f5119c197","path":"/build/d0d18f6ff7e2cd0505df602f5119c197.html"},"image/svg+xml":{"content_type":"image/svg+xml","hash":"34faa8f62bebeee176fd63253b80cce6","path":"/build/34faa8f62bebeee176fd63253b80cce6.svg"}}}],"key":"y9NthQUxYr"}],"indexEntries":[{"entry":"Julia","subEntry":{"value":"minres","kind":"entry"},"emphasis":true}],"label":"index-bBpJh0ysOr","identifier":"index-bbpjh0ysor","html_id":"index-bbpjh0ysor","key":"ipnPZQbxfr"},{"type":"paragraph","position":{"start":{"line":669,"column":1},"end":{"line":669,"column":1}},"children":[{"type":"text","value":"The upper bound turns out to be pessimistic here, especially in the later iterations. However, you can see a slow linear phase in the convergence that tracks the bound closely.","position":{"start":{"line":669,"column":1},"end":{"line":669,"column":1}},"key":"UzooDlIMWQ"}],"key":"ettvZ2DEuM"}],"label":"demo-minrescg-indefinite-julia","identifier":"demo-minrescg-indefinite-julia","html_id":"demo-minrescg-indefinite-julia","key":"ZjIAKI7HnR"},{"type":"details","open":true,"children":[{"type":"summary","children":[{"type":"crossReference","identifier":"demo-minrescg-converge","label":"demo-minrescg-converge","kind":"proof:example","position":{"start":{"line":673,"column":1},"end":{"line":673,"column":24}},"children":[{"type":"text","value":"Example ","key":"HtslhMXysr"},{"type":"text","value":"8.6.3","key":"NCMNM9lgcL"}],"template":"Example %s","enumerator":"8.6.3","resolved":true,"html_id":"demo-minrescg-converge","remote":true,"url":"/minrescg","dataUrl":"/minrescg.json","key":"HpjbKzY7nb"}],"key":"HoZDmsMjCk"},{"type":"paragraph","position":{"start":{"line":675,"column":1},"end":{"line":675,"column":1}},"children":[{"type":"text","value":"We will compare MINRES and CG on some quasi-random ","key":"iFUIfehFZq"},{"type":"abbreviation","title":"symmetric positive definite","children":[{"type":"text","value":"SPD","key":"Vsk9IiM024"}],"key":"ygHxNRhgBA"},{"type":"text","value":" problems.  The first matrix has a condition number of 100.","key":"cEKIWD5IF8"}],"key":"ovrpltV46n"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"julia","executable":true,"value":"n = 5000\ndensity = 0.001\nA = FNC.sprandsym(n, density, 1 / 100)\nx = (1:n) / n\nb = A * x;","key":"vRMJDNOPSH"},{"type":"output","id":"TzB5vBGtHIanv2nQGfrfj","data":[],"key":"hlQSdz3IWF"}],"key":"Pk8u8EWKn3"},{"type":"paragraph","position":{"start":{"line":688,"column":1},"end":{"line":688,"column":1}},"children":[{"type":"text","value":"Now we apply both methods and compare the convergence of the system residuals, using implementations imported from ","position":{"start":{"line":688,"column":1},"end":{"line":688,"column":1}},"key":"bPJBfmojP8"},{"type":"inlineCode","value":"IterativeSolvers","position":{"start":{"line":688,"column":1},"end":{"line":688,"column":1}},"key":"L6S2xV14d6"},{"type":"text","value":".","position":{"start":{"line":688,"column":1},"end":{"line":688,"column":1}},"key":"vD4M4igPoM"}],"indexEntries":[{"entry":"Julia","subEntry":{"value":"cg","kind":"entry"},"emphasis":true}],"label":"index-RPowBXh5r3","identifier":"index-rpowbxh5r3","html_id":"index-rpowbxh5r3","key":"eqO7S5ZZH6"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"julia","executable":true,"value":"plt = plot(title=\"Convergence of MINRES and CG\",\n    xaxis=(\"Krylov dimension\"),  yaxis=(:log10, \"relative residual norm\"))\nfor method in [minres, cg]\n    x̃, history = method(A, b, reltol=1e-6, maxiter=1000, log=true)\n    relres = history[:resnorm] / norm(b)\n    plot!(0:length(relres)-1, relres, label=\"$method\")\n    err = round(norm(x̃ - x) / norm(x), sigdigits=4)\n    println(\"$method error: $err\")\nend\nplt","key":"dPEPS8OJkz"},{"type":"output","id":"3QeBVfPNfHY6rHZxxHpfp","data":[{"output_type":"stream","name":"stdout","text":"minres error: 1.172e-5\n"},{"output_type":"stream","name":"stdout","text":"cg error: 5.022e-6\n"},{"output_type":"execute_result","execution_count":59,"metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"1d251697dd51b3544937aeb2220f9ecb","path":"/build/1d251697dd51b3544937aeb2220f9ecb.png"},"text/html":{"content_type":"text/html","hash":"671aca1302fd11c034a37bd7b944e7aa","path":"/build/671aca1302fd11c034a37bd7b944e7aa.html"},"image/svg+xml":{"content_type":"image/svg+xml","hash":"faacfda3c742e66a70da1ca52f444de3","path":"/build/faacfda3c742e66a70da1ca52f444de3.svg"}}}],"key":"rpoojcaDbb"}],"key":"tNsigXJF9y"},{"type":"paragraph","position":{"start":{"line":703,"column":1},"end":{"line":703,"column":1}},"children":[{"type":"text","value":"There is little difference between the two methods here. Next, we increase the condition number of the matrix by a factor of 25. The rule of thumb predicts that the number of iterations required should increase by a factor of about 5.","position":{"start":{"line":703,"column":1},"end":{"line":703,"column":1}},"key":"DuRzwXvwwb"}],"key":"tnAV5jewwE"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"julia","executable":true,"value":"A = FNC.sprandsym(n, density, 1 / 2500)\nb = A * x;","key":"iF9g0zr21V"},{"type":"output","id":"Em4LBonKY64LqQnRx9tDk","data":[],"key":"thR0UlGDPB"}],"key":"STgmlIt8QL"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"julia","executable":true,"value":"plt = plot(title=\"Convergence of MINRES and CG\",\n    xaxis=(\"Krylov dimension\"), yaxis=(:log10, \"relative residual norm\"))\nfor method in [minres, cg]\n    x̃, history = method(A, b, reltol=1e-6, maxiter=1000, log=true)\n    relres = history[:resnorm] / norm(b)\n    plot!(0:length(relres)-1, relres, label=\"$method\")\n    err = round(norm(x̃ - x) / norm(x), sigdigits=4)\n    println(\"$method error: $err\")\nend\nplt","visibility":"hide","key":"LPtDcDIG4U"},{"type":"output","id":"3D8PZ8NQATYWzMZ4Gs6pF","data":[{"output_type":"stream","name":"stdout","text":"minres error: 0.0002455\ncg error: 3.913e-5\n"},{"output_type":"execute_result","execution_count":61,"metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"ad0e8f2ba5337c8834b4afb639062258","path":"/build/ad0e8f2ba5337c8834b4afb639062258.png"},"text/html":{"content_type":"text/html","hash":"068ece7308bd76ecf3dfd0d9f2f7f126","path":"/build/068ece7308bd76ecf3dfd0d9f2f7f126.html"},"image/svg+xml":{"content_type":"image/svg+xml","hash":"5f088ea4eaf5c03c2f936c783c66011c","path":"/build/5f088ea4eaf5c03c2f936c783c66011c.svg"}}}],"visibility":"show","key":"U423GrF3By"}],"data":{"tags":[]},"visibility":"show","key":"KZVphMNL5m"},{"type":"paragraph","position":{"start":{"line":725,"column":1},"end":{"line":725,"column":1}},"children":[{"type":"text","value":"Both methods have an early superlinear phase that allow them to finish slightly sooner than the factor of 5 predicted: ","position":{"start":{"line":725,"column":1},"end":{"line":725,"column":1}},"key":"dl1GjhKYsS"},{"type":"crossReference","kind":"proof:theorem","identifier":"theorem-minrescg-converge","label":"theorem-minrescg-converge","children":[{"type":"text","value":"Theorem ","key":"e6XrEvAqy7"},{"type":"text","value":"8.6.2","key":"DONroApPlw"}],"template":"Theorem %s","enumerator":"8.6.2","resolved":true,"html_id":"theorem-minrescg-converge","remote":true,"url":"/minrescg","dataUrl":"/minrescg.json","key":"eqLzquO6Oz"},{"type":"text","value":" is an upper bound, not necessarily an approximation. Both methods ultimately achieve the same reduction in the residual; MINRES stops earlier, but with a slightly larger error.","position":{"start":{"line":725,"column":1},"end":{"line":725,"column":1}},"key":"d10fZ8NrJq"}],"key":"cx2aYgYCLp"}],"label":"demo-minrescg-converge-julia","identifier":"demo-minrescg-converge-julia","html_id":"demo-minrescg-converge-julia","key":"sI0NAuAxGW"},{"type":"heading","depth":3,"position":{"start":{"line":729,"column":1},"end":{"line":729,"column":1}},"children":[{"type":"text","value":"8.7 ","position":{"start":{"line":729,"column":1},"end":{"line":729,"column":1}},"key":"I5neqoHFmL"},{"type":"link","identifier":"section-krylov-matrixfree","label":"section-krylov-matrixfree","kind":"narrative","position":{"start":{"line":729,"column":5},"end":{"line":729,"column":31}},"url":"/matrixfree","internal":true,"dataUrl":"/matrixfree.json","children":[{"type":"text","value":"Matrix-free iterations","key":"goMHypDbmh"}],"key":"INRTVjMxpY"}],"identifier":"id-8-7","label":"8.7 ","html_id":"id-8-7","implicit":true,"key":"aTkXtDGRPI"},{"type":"details","open":true,"children":[{"type":"summary","children":[{"type":"crossReference","identifier":"demo-matrixfree-blur","label":"demo-matrixfree-blur","kind":"proof:example","position":{"start":{"line":732,"column":1},"end":{"line":732,"column":22}},"children":[{"type":"text","value":"Example ","key":"GYluj8USjy"},{"type":"text","value":"8.7.1","key":"lBvhRPzaRf"}],"template":"Example %s","enumerator":"8.7.1","resolved":true,"html_id":"demo-matrixfree-blur","remote":true,"url":"/matrixfree","dataUrl":"/matrixfree.json","key":"PwTC1lSfvB"}],"key":"v8cHjCNKdY"},{"type":"paragraph","position":{"start":{"line":734,"column":1},"end":{"line":734,"column":1}},"children":[{"type":"text","value":"We use a readily available test image.","position":{"start":{"line":734,"column":1},"end":{"line":734,"column":1}},"key":"VzLfIkgkRU"}],"key":"pqqm4R5wFW"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"julia","executable":true,"value":"using Images, TestImages\nimg = testimage(\"mandrill\")\nm, n = size(img)\nX = @. Float64(Gray(img))\nplot(Gray.(X), title=\"Original image\", aspect_ratio=1)","key":"SyPJ29UZc6"},{"type":"output","id":"X1-HKdzQdrfZ1T5NKgP86","data":[{"output_type":"execute_result","execution_count":62,"metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"424618489fe753a2c6704d69a43f0abf","path":"/build/424618489fe753a2c6704d69a43f0abf.png"},"text/html":{"content_type":"text/html","hash":"bab1ce9e3711d965dca3234434fa251b","path":"/build/bab1ce9e3711d965dca3234434fa251b.html"},"image/svg+xml":{"content_type":"image/svg+xml","hash":"f641ec875490d50b6d419fd1c8a7fac6","path":"/build/f641ec875490d50b6d419fd1c8a7fac6.svg"}}}],"key":"ubVX34bO0n"}],"key":"onHd6L0thU"},{"type":"paragraph","position":{"start":{"line":744,"column":1},"end":{"line":744,"column":1}},"children":[{"type":"text","value":"We define the one-dimensional tridiagonal blurring matrices.","position":{"start":{"line":744,"column":1},"end":{"line":744,"column":1}},"key":"T9kzIlUtSD"}],"key":"qPUxpG4CaB"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"julia","executable":true,"value":"using SparseArrays\nfunction blurmatrix(d)\n    v1 = fill(0.25, d - 1)\n    return spdiagm(0 => fill(0.5, d), 1 => v1, -1 => v1)\nend\nB, C = blurmatrix(m), blurmatrix(n);","key":"zNAR2RpiSc"},{"type":"output","id":"UKOewkkAJvtfxJ02rtRg8","data":[],"key":"SQwVLQkNEx"}],"key":"wVWavFnzG3"},{"type":"paragraph","position":{"start":{"line":755,"column":1},"end":{"line":755,"column":1}},"children":[{"type":"text","value":"Finally, we show the results of using ","position":{"start":{"line":755,"column":1},"end":{"line":755,"column":1}},"key":"I6zJnwdTMM"},{"type":"inlineMath","value":"k=12","position":{"start":{"line":755,"column":1},"end":{"line":755,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>k</mi><mo>=</mo><mn>12</mn></mrow><annotation encoding=\"application/x-tex\">k=12</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6944em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03148em;\">k</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">12</span></span></span></span>","key":"cDyguVzJ1x"},{"type":"text","value":" repetitions of the blur in each direction.","position":{"start":{"line":755,"column":1},"end":{"line":755,"column":1}},"key":"ZIUeTDkDgq"}],"key":"oV5w5sBKpU"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"julia","executable":true,"value":"using Plots\nblur = X -> B^12 * X * C^12;\nZ = blur(X)\nplot(Gray.(Z), title=\"Blurred image\")","key":"HE0Q1ErAPS"},{"type":"output","id":"arkppX6sXatnTgwIMBqpI","data":[{"output_type":"execute_result","execution_count":64,"metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"460e1f7fc91dd36aa524f6908de120fa","path":"/build/460e1f7fc91dd36aa524f6908de120fa.png"},"text/html":{"content_type":"text/html","hash":"60acf5b4971388fa528b51d595d5bc6e","path":"/build/60acf5b4971388fa528b51d595d5bc6e.html"},"image/svg+xml":{"content_type":"image/svg+xml","hash":"aa89c21e22014e124066c3b877490978","path":"/build/aa89c21e22014e124066c3b877490978.svg"}}}],"key":"wqplpNn0GR"}],"key":"qe10vQaC6D"}],"label":"demo-matrixfree-blur-julia","identifier":"demo-matrixfree-blur-julia","html_id":"demo-matrixfree-blur-julia","key":"wV1OIWJ7ch"},{"type":"details","open":true,"children":[{"type":"summary","children":[{"type":"crossReference","identifier":"demo-matrixfree-deblur","label":"demo-matrixfree-deblur","kind":"proof:example","position":{"start":{"line":766,"column":1},"end":{"line":766,"column":24}},"children":[{"type":"text","value":"Example ","key":"IhzQ20OytD"},{"type":"text","value":"8.7.2","key":"QYIcaU7MEh"}],"template":"Example %s","enumerator":"8.7.2","resolved":true,"html_id":"demo-matrixfree-deblur","remote":true,"url":"/matrixfree","dataUrl":"/matrixfree.json","key":"RxINQ46039"}],"key":"RziuKNjpwK"},{"type":"paragraph","position":{"start":{"line":768,"column":1},"end":{"line":768,"column":1}},"children":[{"type":"text","value":"We repeat the earlier process to blur an original image ","position":{"start":{"line":768,"column":1},"end":{"line":768,"column":1}},"key":"OcAjkeVjui"},{"type":"inlineMath","value":"\\mathbf{X}","position":{"start":{"line":768,"column":1},"end":{"line":768,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi mathvariant=\"bold\">X</mi></mrow><annotation encoding=\"application/x-tex\">\\mathbf{X}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6861em;\"></span><span class=\"mord mathbf\">X</span></span></span></span>","key":"odxAhADsEI"},{"type":"text","value":" to get ","position":{"start":{"line":768,"column":1},"end":{"line":768,"column":1}},"key":"g6mp7Rqx0B"},{"type":"inlineMath","value":"\\mathbf{Z}","position":{"start":{"line":768,"column":1},"end":{"line":768,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi mathvariant=\"bold\">Z</mi></mrow><annotation encoding=\"application/x-tex\">\\mathbf{Z}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6861em;\"></span><span class=\"mord mathbf\">Z</span></span></span></span>","key":"ZJHxrv13vt"},{"type":"text","value":".","position":{"start":{"line":768,"column":1},"end":{"line":768,"column":1}},"key":"q8XiBSmxb1"}],"key":"MSQOHsHxrC"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"julia","executable":true,"value":"img = testimage(\"lighthouse\")\nm, n = size(img)\nX = @. Float64(Gray(img))\n\nB = spdiagm(0 => fill(0.5, m),\n    1 => fill(0.25, m - 1), -1 => fill(0.25, m - 1))\nC = spdiagm(0 => fill(0.5, n),\n    1 => fill(0.25, n - 1), -1 => fill(0.25, n - 1))\nblur = X -> B^12 * X * C^12\nZ = blur(X)\nplot(Gray.(Z), title=\"Blurred image\")","visibility":"hide","key":"gPDpu7Y0Zu"},{"type":"output","id":"_1Ttf2KEJ3qQ5n7RDnI4K","data":[{"output_type":"execute_result","execution_count":65,"metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"f91dae2ac65a0db16e5e77a9051578ad","path":"/build/f91dae2ac65a0db16e5e77a9051578ad.png"},"text/html":{"content_type":"text/html","hash":"65cc19bdfe2693cf4b9b8fbba16b9509","path":"/build/65cc19bdfe2693cf4b9b8fbba16b9509.html"},"image/svg+xml":{"content_type":"image/svg+xml","hash":"c9371cf12e5d132669be9cbcaf337e0d","path":"/build/c9371cf12e5d132669be9cbcaf337e0d.svg"}}}],"visibility":"show","key":"VPBlZ54jFr"}],"data":{"tags":[]},"visibility":"show","key":"PxfK45ro2y"},{"type":"paragraph","position":{"start":{"line":786,"column":1},"end":{"line":786,"column":1}},"children":[{"type":"text","value":"Now we imagine that ","position":{"start":{"line":786,"column":1},"end":{"line":786,"column":1}},"key":"EKjyWQZp1w"},{"type":"inlineMath","value":"\\mathbf{X}","position":{"start":{"line":786,"column":1},"end":{"line":786,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi mathvariant=\"bold\">X</mi></mrow><annotation encoding=\"application/x-tex\">\\mathbf{X}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6861em;\"></span><span class=\"mord mathbf\">X</span></span></span></span>","key":"AyKT7dtk80"},{"type":"text","value":" is unknown and that we want to recover it from ","position":{"start":{"line":786,"column":1},"end":{"line":786,"column":1}},"key":"Xfu5frGqwY"},{"type":"inlineMath","value":"\\mathbf{Z}","position":{"start":{"line":786,"column":1},"end":{"line":786,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi mathvariant=\"bold\">Z</mi></mrow><annotation encoding=\"application/x-tex\">\\mathbf{Z}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6861em;\"></span><span class=\"mord mathbf\">Z</span></span></span></span>","key":"rvWlF7TrwF"},{"type":"text","value":". We first need functions that translate between vector and matrix representations.","position":{"start":{"line":786,"column":1},"end":{"line":786,"column":1}},"key":"D4puVVu8wM"}],"key":"R5BY4POq08"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"julia","executable":true,"value":"# vec (built-in) converts matrix to vector\nunvec = z -> reshape(z, m, n);  # convert vector to matrix","key":"XDTavvaKJJ"},{"type":"output","id":"MN_RrZzLnZIHg5Wzj57Em","data":[],"key":"sXXqf5hgoT"}],"key":"zqUHTTEEJl"},{"type":"paragraph","position":{"start":{"line":796,"column":1},"end":{"line":796,"column":1}},"children":[{"type":"text","value":"Now we declare the three-step blur transformation as a ","position":{"start":{"line":796,"column":1},"end":{"line":796,"column":1}},"key":"HFYrkf8sqI"},{"type":"inlineCode","value":"LinearMap","position":{"start":{"line":796,"column":1},"end":{"line":796,"column":1}},"key":"GcC8eMTg1r"},{"type":"text","value":", supplying also the size of the vector form of an image.","position":{"start":{"line":796,"column":1},"end":{"line":796,"column":1}},"key":"fm8B4NHbdj"}],"indexEntries":[{"entry":"Julia","subEntry":{"value":"LinearMap","kind":"entry"},"emphasis":true}],"label":"index-Ai7Dop4E7r","identifier":"index-ai7dop4e7r","html_id":"index-ai7dop4e7r","key":"NGsgasWsbR"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"julia","executable":true,"value":"using LinearMaps\nT = LinearMap(x -> vec(blur(unvec(x))), m * n);","key":"eOXMSlQG5C"},{"type":"output","id":"FJPND76Lyy-rM8XRkvjfX","data":[],"key":"MeCboYPARO"}],"key":"UdXLRXZUjg"},{"type":"paragraph","position":{"start":{"line":803,"column":1},"end":{"line":803,"column":1}},"children":[{"type":"text","value":"The blurring operators are symmetric, so we apply ","position":{"start":{"line":803,"column":1},"end":{"line":803,"column":1}},"key":"EwSxVsnURD"},{"type":"inlineCode","value":"minres","position":{"start":{"line":803,"column":1},"end":{"line":803,"column":1}},"key":"mNNdBxY9NW"},{"type":"text","value":" to the composite blurring transformation ","position":{"start":{"line":803,"column":1},"end":{"line":803,"column":1}},"key":"pxfaKTGZwi"},{"type":"inlineCode","value":"T","position":{"start":{"line":803,"column":1},"end":{"line":803,"column":1}},"key":"CAfdYKIh2H"},{"type":"text","value":".","position":{"start":{"line":803,"column":1},"end":{"line":803,"column":1}},"key":"qiXD6dzwnx"}],"key":"uayna3wnuD"},{"type":"admonition","kind":"tip","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"Tip","key":"yftMoNGepI"}],"key":"DYBwVjJNLu"},{"type":"paragraph","position":{"start":{"line":806,"column":1},"end":{"line":806,"column":1}},"children":[{"type":"text","value":"The function ","position":{"start":{"line":806,"column":1},"end":{"line":806,"column":1}},"key":"R0g7wKMtGG"},{"type":"inlineCode","value":"clamp01","position":{"start":{"line":806,"column":1},"end":{"line":806,"column":1}},"key":"E0VMjcb3rF"},{"type":"text","value":" in ","position":{"start":{"line":806,"column":1},"end":{"line":806,"column":1}},"key":"haHX5BUnUD"},{"type":"inlineCode","value":"Images","position":{"start":{"line":806,"column":1},"end":{"line":806,"column":1}},"key":"JcnCQ4siSQ"},{"type":"text","value":" restricts values to be in the interval ","position":{"start":{"line":806,"column":1},"end":{"line":806,"column":1}},"key":"qqPRh4ejB4"},{"type":"inlineMath","value":"[0,1]","position":{"start":{"line":806,"column":1},"end":{"line":806,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mo stretchy=\"false\">[</mo><mn>0</mn><mo separator=\"true\">,</mo><mn>1</mn><mo stretchy=\"false\">]</mo></mrow><annotation encoding=\"application/x-tex\">[0,1]</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mopen\">[</span><span class=\"mord\">0</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord\">1</span><span class=\"mclose\">]</span></span></span></span>","key":"KYlFtPx9eO"},{"type":"text","value":".","position":{"start":{"line":806,"column":1},"end":{"line":806,"column":1}},"key":"LZwX1GryOB"}],"key":"zuMrmHrCw2"}],"class":"dropdown","key":"yMUL56gmG9"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"julia","executable":true,"value":"using IterativeSolvers\ny = minres(T, vec(Z), maxiter=50, reltol=1e-5);\nY = unvec(clamp01.(y))\n\nplot(Gray.(X), layout=2, title=\"Original\")\nplot!(Gray.(Y), subplot=2, title=\"Deblurred\")","key":"X4soj9OpYe"},{"type":"output","id":"FssPrR0b08Ce0hfXb5ej2","data":[{"output_type":"execute_result","execution_count":68,"metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"9185a8da493f483da16d69cbcc829501","path":"/build/9185a8da493f483da16d69cbcc829501.png"},"text/html":{"content_type":"text/html","hash":"6452c44db62fbda5ea56035007e8bb86","path":"/build/6452c44db62fbda5ea56035007e8bb86.html"},"image/svg+xml":{"content_type":"image/svg+xml","hash":"dc17d2be82f92a342c62cd43af5b8916","path":"/build/dc17d2be82f92a342c62cd43af5b8916.svg"}}}],"key":"aMnn3tugjA"}],"key":"AgDbSNrNQB"}],"label":"demo-matrixfree-deblur-julia","identifier":"demo-matrixfree-deblur-julia","html_id":"demo-matrixfree-deblur-julia","key":"pvQfzWIHkO"},{"type":"heading","depth":3,"position":{"start":{"line":819,"column":1},"end":{"line":819,"column":1}},"children":[{"type":"text","value":"8.8 ","position":{"start":{"line":819,"column":1},"end":{"line":819,"column":1}},"key":"k1IaRgutGH"},{"type":"link","identifier":"section-krylov-precond","label":"section-krylov-precond","kind":"narrative","position":{"start":{"line":819,"column":5},"end":{"line":819,"column":28}},"url":"/precond","internal":true,"dataUrl":"/precond.json","children":[{"type":"text","value":"Preconditioning","key":"ohx1WzIaQA"}],"key":"Q9jDfQVJCn"}],"identifier":"id-8-8","label":"8.8 ","html_id":"id-8-8","implicit":true,"key":"i4vLeHeJNV"},{"type":"details","open":true,"children":[{"type":"summary","children":[{"type":"crossReference","identifier":"demo-precond-diagonal","label":"demo-precond-diagonal","kind":"proof:example","position":{"start":{"line":822,"column":1},"end":{"line":822,"column":23}},"children":[{"type":"text","value":"Example ","key":"P2XVreiDQe"},{"type":"text","value":"8.8.1","key":"u3C2ke2GRw"}],"template":"Example %s","enumerator":"8.8.1","resolved":true,"html_id":"demo-precond-diagonal","remote":true,"url":"/precond","dataUrl":"/precond.json","key":"tI06NOkGro"}],"key":"QSoKBojtNu"},{"type":"paragraph","position":{"start":{"line":824,"column":1},"end":{"line":824,"column":1}},"children":[{"type":"text","value":"Here is an ","key":"JStvjSFGEP"},{"type":"abbreviation","title":"symmetric positive definite","children":[{"type":"text","value":"SPD","key":"do9vOjXOre"}],"key":"AG8qcJxXp2"},{"type":"text","value":" matrix that arises from solving partial differential equations.","key":"MpBTSSHJBO"}],"key":"NWBCKy5eyr"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"julia","executable":true,"value":"using MatrixDepot\nA = matrixdepot(\"wathen\", 60)\nn = size(A, 1)\n@show n, nnz(A);","key":"HRe87zikfL"},{"type":"output","id":"JdbuVl8g4xP6SWGJ5hwML","data":[{"output_type":"stream","name":"stderr","text":"\u001b[36m\u001b[1m[ \u001b[22m\u001b[39m\u001b[36m\u001b[1mInfo: \u001b[22m\u001b[39mverify download of index files...\n\u001b[36m\u001b[1m[ \u001b[22m\u001b[39m\u001b[36m\u001b[1mInfo: \u001b[22m\u001b[39mcreating database file\n"},{"output_type":"stream","name":"stderr","text":"\u001b[36m\u001b[1m[ \u001b[22m\u001b[39m\u001b[36m\u001b[1mInfo: \u001b[22m\u001b[39mreading index files\n\u001b[36m\u001b[1m[ \u001b[22m\u001b[39m\u001b[36m\u001b[1mInfo: \u001b[22m\u001b[39mdownloading: https://sparse.tamu.edu/files/ss_index.mat\n"},{"output_type":"stream","name":"stderr","text":"\u001b[36m\u001b[1m[ \u001b[22m\u001b[39m\u001b[36m\u001b[1mInfo: \u001b[22m\u001b[39mdownloading index file https://math.nist.gov/MatrixMarket/matrices.html\n"},{"output_type":"stream","name":"stderr","text":"\u001b[36m\u001b[1m[ \u001b[22m\u001b[39m\u001b[36m\u001b[1mInfo: \u001b[22m\u001b[39madding metadata...\n\u001b[36m\u001b[1m[ \u001b[22m\u001b[39m\u001b[36m\u001b[1mInfo: \u001b[22m\u001b[39madding svd data...\n"},{"output_type":"stream","name":"stderr","text":"\u001b[36m\u001b[1m[ \u001b[22m\u001b[39m\u001b[36m\u001b[1mInfo: \u001b[22m\u001b[39mwriting database\n\u001b[33m\u001b[1m┌ \u001b[22m\u001b[39m\u001b[33m\u001b[1mWarning: \u001b[22m\u001b[39mexception during initialization: 'KeyError(MatrixDepot)'\n\u001b[33m\u001b[1m└ \u001b[22m\u001b[39m\u001b[90m@ MatrixDepot ~/.julia/packages/MatrixDepot/4S7Oa/src/MatrixDepot.jl:125\u001b[39m\n"},{"output_type":"stream","name":"stdout","text":"(n, nnz(A)) = (11041, 170161)"},{"output_type":"stream","name":"stdout","text":"\n"}],"key":"xrgAqnOyqV"}],"key":"p804vwg0ZJ"},{"type":"paragraph","position":{"start":{"line":836,"column":1},"end":{"line":836,"column":1}},"children":[{"type":"text","value":"There is an easy way to use the diagonal elements of ","position":{"start":{"line":836,"column":1},"end":{"line":836,"column":1}},"key":"tTtSm1H7We"},{"type":"inlineMath","value":"\\mathbf{A}","position":{"start":{"line":836,"column":1},"end":{"line":836,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi mathvariant=\"bold\">A</mi></mrow><annotation encoding=\"application/x-tex\">\\mathbf{A}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6861em;\"></span><span class=\"mord mathbf\">A</span></span></span></span>","key":"EaiMUCUJwM"},{"type":"text","value":", or any other vector, as a diagonal preconditioner.","position":{"start":{"line":836,"column":1},"end":{"line":836,"column":1}},"key":"BF7mFepdtD"}],"indexEntries":[{"entry":"Julia","subEntry":{"value":"DiagonalPreconditioner","kind":"entry"},"emphasis":true}],"label":"index-revYUN2oii","identifier":"index-revyun2oii","html_id":"index-revyun2oii","key":"Z1eCPpEP24"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"julia","executable":true,"value":"using Preconditioners\nb = ones(n)\nM = DiagonalPreconditioner(diag(A));","key":"bqbtt7ArnC"},{"type":"output","id":"rGnbh2if7CpWS-dq4AsHv","data":[],"key":"t3eKgRTUVy"}],"key":"wcxtD9Flui"},{"type":"paragraph","position":{"start":{"line":844,"column":1},"end":{"line":844,"column":1}},"children":[{"type":"text","value":"We now compare CG with and without the preconditioner.","position":{"start":{"line":844,"column":1},"end":{"line":844,"column":1}},"key":"VwJMD8BHMD"}],"key":"HxL7aDp64X"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"julia","executable":true,"value":"using IterativeSolvers, Plots\nplain(b) = cg(A, b, maxiter=200, reltol=1e-4, log=true)\ntime_plain = @elapsed x, hist1 = plain(b)\nprec(b) = cg(A, b, Pl=M, maxiter=200, reltol=1e-4, log=true)\ntime_prec = @elapsed x, hist2 = prec(b)\n@show time_plain, time_prec\n\nrr = hist1[:resnorm]\nplot(0:length(rr)-1, rr / rr[1], yscale=:log10, label=\"plain\")\nrr = hist2[:resnorm]\nplot!(0:length(rr)-1, rr / rr[1], yscale=:log10, label=\"preconditioned\")\ntitle!(\"Diagonal preconditioning in CG\")","visibility":"hide","key":"IiakPxJ6Tj"},{"type":"output","id":"mGScVlIP53Zi1oRw1N5J7","data":[{"output_type":"stream","name":"stdout","text":"(time_plain, time_prec) = (3.582813459, 1.212313208)"},{"output_type":"stream","name":"stdout","text":"\n"},{"output_type":"execute_result","execution_count":71,"metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"fa8c78a83abe11b2c18b47e01a5f6f04","path":"/build/fa8c78a83abe11b2c18b47e01a5f6f04.png"},"text/html":{"content_type":"text/html","hash":"4a1833b11f7c43b0987bf6a6f8e6d1bb","path":"/build/4a1833b11f7c43b0987bf6a6f8e6d1bb.html"},"image/svg+xml":{"content_type":"image/svg+xml","hash":"d86398d84d637bacce724a6543639564","path":"/build/d86398d84d637bacce724a6543639564.svg"}}}],"visibility":"show","key":"RK18nEmxTj"}],"data":{"tags":[]},"visibility":"show","key":"sm5BrolnOU"},{"type":"paragraph","position":{"start":{"line":862,"column":1},"end":{"line":862,"column":1}},"children":[{"type":"text","value":"The diagonal preconditioner cut down substantially on the number of iterations. The effect on the total time is less dramatic, but this is not a large version of the problem.","position":{"start":{"line":862,"column":1},"end":{"line":862,"column":1}},"key":"Jf2yA0U592"}],"key":"Lg7qVxsRbS"}],"label":"demo-precond-diagonal-julia","identifier":"demo-precond-diagonal-julia","html_id":"demo-precond-diagonal-julia","key":"WhTA2aX3y5"},{"type":"details","open":true,"children":[{"type":"summary","children":[{"type":"crossReference","identifier":"demo-precond-gmres","label":"demo-precond-gmres","kind":"proof:example","position":{"start":{"line":867,"column":1},"end":{"line":867,"column":20}},"children":[{"type":"text","value":"Example ","key":"eqVnHnFZk9"},{"type":"text","value":"8.8.2","key":"zDG9ACXil0"}],"template":"Example %s","enumerator":"8.8.2","resolved":true,"html_id":"demo-precond-gmres","remote":true,"url":"/precond","dataUrl":"/precond.json","key":"UPAufGg9T4"}],"key":"BBNhqh2tSn"},{"type":"paragraph","position":{"start":{"line":869,"column":1},"end":{"line":869,"column":1}},"children":[{"type":"text","value":"Here is a nonsymmetric matrix arising from a probabilistic model in computational chemistry.","position":{"start":{"line":869,"column":1},"end":{"line":869,"column":1}},"key":"m39Q36bHGp"}],"key":"rI5TrOYxH3"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"julia","executable":true,"value":"using SparseArrays\nA = sparse(matrixdepot(\"Watson/chem_master1\"))\nn = size(A, 1)\n@show n, nnz(A), issymmetric(A)","key":"O5iMtxQ28X"},{"type":"output","id":"30dQ-JdsuxxTlKWVbGwJ8","data":[{"output_type":"stream","name":"stderr","text":"\u001b[36m\u001b[1m[ \u001b[22m\u001b[39m\u001b[36m\u001b[1mInfo: \u001b[22m\u001b[39mdownloading: https://sparse.tamu.edu/MM/Watson/chem_master1.tar.gz\n"},{"output_type":"stream","name":"stdout","text":"(n, nnz(A), issymmetric(A)) = (40401, 201201, false)"},{"output_type":"stream","name":"stdout","text":"\n"},{"output_type":"execute_result","execution_count":72,"metadata":{},"data":{"text/plain":{"content":"(40401, 201201, false)","content_type":"text/plain"}}}],"key":"hxLrjJi9Ss"}],"key":"BhyXnr4dt7"},{"type":"paragraph","position":{"start":{"line":878,"column":1},"end":{"line":878,"column":1}},"children":[{"type":"text","value":"Without a preconditioner, GMRES makes essentially no progress after 100 iterations.","position":{"start":{"line":878,"column":1},"end":{"line":878,"column":1}},"key":"w7oAnoHiDg"}],"key":"NKW2rrEaZl"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"julia","executable":true,"value":"b = rand(40000)\nconst GMRES = IterativeSolvers.gmres\nx, history = GMRES(A, b, maxiter=100, reltol=1e-5, log=true)\nresnorm = history[:resnorm]\n@show resnorm[end] / resnorm[1];","key":"Qg9Cq8F88P"},{"type":"output","id":"iVTnFuCpZklcnal5Tv9kf","data":[{"output_type":"stream","name":"stdout","text":"resnorm[end] / resnorm[1] = 0.9691149528705503"},{"output_type":"stream","name":"stdout","text":"\n"}],"key":"xdorLzevNm"}],"key":"CYrrYWMO9a"},{"type":"paragraph","position":{"start":{"line":891,"column":1},"end":{"line":891,"column":1}},"children":[{"type":"text","value":"The following version of incomplete LU factorization drops all sufficiently small values (i.e., replaces them with zeros). This keeps the number of nonzeros in the factors under control.","position":{"start":{"line":891,"column":1},"end":{"line":891,"column":1}},"key":"cUV80xLVo3"}],"indexEntries":[{"entry":"Julia","subEntry":{"value":"ilu","kind":"entry"},"emphasis":true}],"label":"index-U7cxQyq5PQ","identifier":"index-u7cxqyq5pq","html_id":"index-u7cxqyq5pq","key":"OIgyfG4X3d"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"julia","executable":true,"value":"using IncompleteLU\niLU = ilu(A, τ=0.25)\n@show nnz(iLU) / nnz(A);","key":"HVXKDZWe2q"},{"type":"output","id":"ZWgluTc1-3DqSmK_dH-Xk","data":[{"output_type":"stream","name":"stdout","text":"nnz(iLU) / nnz(A) = 9.654509669435043"},{"output_type":"stream","name":"stdout","text":"\n"}],"key":"Uhx71ufJM3"}],"key":"rZihm5oef3"},{"type":"paragraph","position":{"start":{"line":899,"column":1},"end":{"line":899,"column":1}},"children":[{"type":"text","value":"The result is almost 10 times as dense as ","position":{"start":{"line":899,"column":1},"end":{"line":899,"column":1}},"key":"qpXsxwaKwr"},{"type":"inlineMath","value":"\\mathbf{A}","position":{"start":{"line":899,"column":1},"end":{"line":899,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi mathvariant=\"bold\">A</mi></mrow><annotation encoding=\"application/x-tex\">\\mathbf{A}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6861em;\"></span><span class=\"mord mathbf\">A</span></span></span></span>","key":"aKQZtf8IOT"},{"type":"text","value":" and yet still not a true factorization of it. However, it’s close enough for an approximate inverse in a preconditioner. The actual preconditioning matrix is ","position":{"start":{"line":899,"column":1},"end":{"line":899,"column":1}},"key":"izT1Vsjr4c"},{"type":"inlineMath","value":"\\mathbf{M}=\\mathbf{L}\\mathbf{U}","position":{"start":{"line":899,"column":1},"end":{"line":899,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi mathvariant=\"bold\">M</mi><mo>=</mo><mi mathvariant=\"bold\">L</mi><mi mathvariant=\"bold\">U</mi></mrow><annotation encoding=\"application/x-tex\">\\mathbf{M}=\\mathbf{L}\\mathbf{U}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6861em;\"></span><span class=\"mord mathbf\">M</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6861em;\"></span><span class=\"mord mathbf\">LU</span></span></span></span>","key":"JjoDcZ4X9Q"},{"type":"text","value":", but we just supply the factorization to ","position":{"start":{"line":899,"column":1},"end":{"line":899,"column":1}},"key":"i5gQcvpTlu"},{"type":"inlineCode","value":"gmres","position":{"start":{"line":899,"column":1},"end":{"line":899,"column":1}},"key":"koMGrmjaBC"},{"type":"text","value":".","position":{"start":{"line":899,"column":1},"end":{"line":899,"column":1}},"key":"yNYGLyr4D0"}],"key":"P8DMxWAiW2"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"julia","executable":true,"value":"_, history = GMRES(A, b, Pl=iLU, maxiter=100, reltol=1e-5, log=true)\nhistory","key":"zgOM3gb5WZ"},{"type":"output","id":"DqRV9-qvDrEm8rQKjqA7k","data":[{"output_type":"execute_result","execution_count":75,"metadata":{},"data":{"text/plain":{"content":"Converged after 7 iterations.","content_type":"text/plain"}}}],"key":"hrz00OuQTD"}],"key":"Sp6cDf6vWb"},{"type":"paragraph","position":{"start":{"line":906,"column":1},"end":{"line":906,"column":1}},"children":[{"type":"text","value":"The ","position":{"start":{"line":906,"column":1},"end":{"line":906,"column":1}},"key":"nOwMqLHUdl"},{"type":"text","value":"τ","position":{"start":{"line":906,"column":1},"end":{"line":906,"column":1}},"key":"IE3pKOF3vZ"},{"type":"text","value":" parameter in ","position":{"start":{"line":906,"column":1},"end":{"line":906,"column":1}},"key":"djMexN95BF"},{"type":"inlineCode","value":"ilu","position":{"start":{"line":906,"column":1},"end":{"line":906,"column":1}},"key":"FhE879NB6Z"},{"type":"text","value":" balances the accuracy of the iLU factorization with the time needed to compute it and invert it. As ","position":{"start":{"line":906,"column":1},"end":{"line":906,"column":1}},"key":"pwn47Lhgxy"},{"type":"inlineMath","value":"\\tau\\to 0","position":{"start":{"line":906,"column":1},"end":{"line":906,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>τ</mi><mo>→</mo><mn>0</mn></mrow><annotation encoding=\"application/x-tex\">\\tau\\to 0</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.1132em;\">τ</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">→</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">0</span></span></span></span>","key":"oOqeFBgO3A"},{"type":"text","value":", more of the elements are kept, making the preconditioner more effective but slower per iteration.","position":{"start":{"line":906,"column":1},"end":{"line":906,"column":1}},"key":"cTjCN3m1dt"}],"key":"uN6hTzKukB"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"julia","executable":true,"value":"plt = plot(0:40, resnorm[1:41] / resnorm[1];\n    label=\"no preconditioning\",  legend=:bottomright,\n    xaxis=(\"iteration number\"),\n    yaxis=(:log10, \"residual norm\"),\n    title=\"Incomplete LU preconditioning\")\nfor τ in [2, 1, 0.25, 0.1]\n    t = @elapsed iLU = ilu(A; τ)\n    t += @elapsed _, history = GMRES(A, b, Pl=iLU, maxiter=100,\n        reltol=1e-5, log=true)\n    resnorm = history[:resnorm]\n    label = \"τ = $τ, time = $(round(t,digits=3))\"\n    plot!(0:length(resnorm)-1, resnorm / resnorm[1]; label)\nend\nplt","visibility":"hide","key":"upqz6eKRCB"},{"type":"output","id":"Q9ZeuOLXkhVMOS9it6r2h","data":[{"output_type":"execute_result","execution_count":76,"metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"142e59a38a5d8a46557e63812691350f","path":"/build/142e59a38a5d8a46557e63812691350f.png"},"text/html":{"content_type":"text/html","hash":"2b2ab2b77e6133134dc4b22076f24812","path":"/build/2b2ab2b77e6133134dc4b22076f24812.html"},"image/svg+xml":{"content_type":"image/svg+xml","hash":"e8beb7ae001735bc9597d85ca8a7a56e","path":"/build/e8beb7ae001735bc9597d85ca8a7a56e.svg"}}}],"visibility":"show","key":"dcg7Cr6KBe"}],"data":{"tags":[]},"visibility":"show","key":"kYYrFXMkEe"},{"type":"paragraph","position":{"start":{"line":927,"column":1},"end":{"line":927,"column":1}},"children":[{"type":"text","value":"In any given problem, it’s impossible to know in advance where the right balance lies between fidelity and speed for the preconditioner.","position":{"start":{"line":927,"column":1},"end":{"line":927,"column":1}},"key":"R3sUTrrMPN"}],"key":"OnsqxbrOP5"}],"label":"demo-precond-gmres-julia","identifier":"demo-precond-gmres-julia","html_id":"demo-precond-gmres-julia","key":"D81DlZFd7z"}],"key":"p8C5bPV38Y"}],"key":"MTxQShSHaA"},"references":{"cite":{"order":[],"data":{}}},"footer":{"navigation":{"prev":{"title":"Chapter 7","url":"/chapter7","group":"Julia codes"},"next":{"title":"Chapter 9","url":"/chapter9","group":"Julia codes"}}},"domain":"http://localhost:3000"}