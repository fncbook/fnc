{"kind":"Notebook","sha256":"1978e460ab81afc155dcd447b264b3519b28ee8ca5f11ad2b4baf0aa3b013d77","slug":"solve-a-1","location":"/chapter12/section1/python/solve-a.ipynb","dependencies":[],"frontmatter":{"numbering":{"heading_1":{"enabled":false},"heading_2":{"enabled":false},"heading_3":{"enabled":false},"heading_4":{"enabled":false},"heading_5":{"enabled":false},"heading_6":{"enabled":false}},"kernelspec":{"name":"python3","display_name":"Python 3","language":"python"},"authors":[{"nameParsed":{"literal":"Tobin A. Driscoll","given":"Tobin A.","family":"Driscoll"},"name":"Tobin A. Driscoll","email":"driscoll@udel.edu","id":"contributors-myst-generated-uid-0","corresponding":true},{"nameParsed":{"literal":"Richard J. Braun","given":"Richard J.","family":"Braun"},"name":"Richard J. Braun","id":"contributors-myst-generated-uid-1"}],"github":"https://github.com/fncbook/fnc","math":{"\\float":{"macro":"\\mathbb{F}"},"\\real":{"macro":"\\mathbb{R}"},"\\complex":{"macro":"\\mathbb{C}"},"\\nat":{"macro":"\\mathbb{N}"},"\\integer":{"macro":"\\mathbb{Z}"},"\\rmn":{"macro":"\\mathbb{R}^{#1 \\times #2}"},"\\dd":{"macro":"\\frac{d #1}{d #2}"},"\\ddd":{"macro":"\\frac{d^2 #1}{d #2^2}"},"\\pp":{"macro":"\\frac{\\partial #1}{\\partial #2}"},"\\ppp":{"macro":"\\frac{\\partial^2 #1}{\\partial #2^2}"},"\\ppdd":{"macro":"\\frac{\\partial^2 #1}{\\partial #2 \\partial #3}"},"\\abs":{"macro":"\\left\\lvert #1 \\right\\rvert"},"\\norm":{"macro":"\\left\\lVert #1 \\right\\rVert"},"\\twonorm":{"macro":"\\norm{#1}_2"},"\\onenorm":{"macro":"\\norm{#1}_1"},"\\infnorm":{"macro":"\\norm{#1}_\\infty"},"\\anynorm":{"macro":"\\norm{#1}_#2"},"\\innerprod":{"macro":"\\langle #1,#2 \\rangle"},"\\pr":{"macro":"^{(#1)}"},"\\kron":{"macro":"#1 \\otimes #2"},"\\eye":{"macro":"\\mathbf{e}_#1"},"\\meye":{"macro":"\\mathbf{I}"},"\\Qhat":{"macro":"\\hat{\\mathbf{Q}}"},"\\Rhat":{"macro":"\\hat{\\mathbf{R}}"},"\\bfalpha":{"macro":"\\mathbf{alpha}"},"\\bfdelta":{"macro":"\\mathbf{delta}"},"\\bfzero":{"macro":"\\boldsymbol{0}"},"\\macheps":{"macro":"\\epsilon_\\text{mach}"},"\\fl":{"macro":"\\operatorname{fl}"},"\\diag":{"macro":"\\operatorname{diag}"},"\\ign":{"macro":"\\operatorname{sign}"},"\\Re":{"macro":"\\operatorname{Re}"},"\\Im":{"macro":"\\operatorname{Im}"},"\\ee":{"macro":"\\times 10^"},"\\lnorm":{"macro":"\\|"},"\\rnorm":{"macro":"\\|"},"\\floor":{"macro":"\\lfloor#1\\rfloor"},"\\cI":{"macro":"\\mathcal{I}"},"\\mtx":{"macro":"\\operatorname{mtx}"},"\\myvec":{"macro":"\\operatorname{vec}"},"\\argmin":{"macro":"\\operatorname{argmin}"}},"abbreviations":{"IVP":"initial-value problem","BVP":"boundary-value problem","ONC":"matrix with orthonormal columns","SVD":"singular value decomposition","EVD":"eigenvalue decomposition","SPD":"symmetric positive definite","HPD":"hermitian positive definite","PDE":"partial differential equation","ODE":"ordinary differential equation"},"exports":[{"format":"ipynb","filename":"solve-a.ipynb","url":"/fnc/build/solve-a-1a869bf7f0fc03f819f79114f00aeb2a.ipynb"}]},"widgets":{},"mdast":{"type":"root","children":[{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2025-01-09T21:28:58.247590Z","iopub.status.busy":"2025-01-09T21:28:58.247506Z","iopub.status.idle":"2025-01-09T21:28:58.694312Z","shell.execute_reply":"2025-01-09T21:28:58.694041Z"},"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"exec(open(\"../../../python/FNC_init.py\").read())","visibility":"show","key":"QUBqOtjpZW"},{"type":"output","id":"xfixPzKJ-SYwyqc27YQ2x","data":[],"visibility":"show","key":"yOhRhd3UQt"}],"visibility":"remove","key":"D2mrFWTzl0"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"crossReference","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"strong","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Demo ","key":"wYgpmdORPp"},{"type":"text","value":"12.1.2","key":"RIsieZGsOv"}],"key":"VTCfTeWzeq"}],"identifier":"demo-traffic-solve","label":"demo-traffic-solve","kind":"proof:example","template":"ExampleÂ %s","enumerator":"12.1.2","resolved":true,"html_id":"demo-traffic-solve","remote":true,"url":"/traffic","dataUrl":"/traffic.json","key":"dkMaYHdpcC"}],"key":"FNbPVF8TSb"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"The following are parameters and a function relevant to defining the problem.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"GvdIVCnaU3"}],"key":"Pq5wJz3IBa"}],"key":"hIaoEBMnWJ"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2025-01-09T21:28:58.695868Z","iopub.status.busy":"2025-01-09T21:28:58.695712Z","iopub.status.idle":"2025-01-09T21:28:58.697701Z","shell.execute_reply":"2025-01-09T21:28:58.697502Z"}},"children":[{"type":"code","lang":"python","executable":true,"value":"rho_c = 1080\nrho_m = 380\nq_m = 10000\nQ0prime = (\n    lambda rho: q_m\n    * 4\n    * rho_c**2\n    * (rho_c - rho_m)\n    * rho_m\n    * (rho_m - rho)\n    / (rho * (rho_c - 2 * rho_m) + rho_c * rho_m) ** 3\n)","key":"MT9ZwOCw7k"},{"type":"output","id":"CvUcw1n9ar2JpdWUcIaxQ","data":[],"key":"BVNPVDnSeg"}],"key":"WY2eTCfVfO"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Here we create a discretization on ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"ijQYb9GoZ1"},{"type":"inlineMath","value":"m=800","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>m</mi><mo>=</mo><mn>800</mn></mrow><annotation encoding=\"application/x-tex\">m=800</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">m</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">800</span></span></span></span>","key":"XtdKRohDeS"},{"type":"text","value":" points.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"IGLyWcxuPt"}],"key":"IWlpo9jWH0"}],"key":"XRjeyUF37M"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2025-01-09T21:28:58.698913Z","iopub.status.busy":"2025-01-09T21:28:58.698820Z","iopub.status.idle":"2025-01-09T21:28:58.702837Z","shell.execute_reply":"2025-01-09T21:28:58.702604Z"}},"children":[{"type":"code","lang":"python","executable":true,"value":"x, Dx, Dxx = FNC.diffper(800, [0, 4])","key":"bUegS4RkTy"},{"type":"output","id":"xUcvHJcryH8FFbHPBcSGD","data":[],"key":"obkEO3Wk05"}],"key":"EaFISqqvWq"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Next we define the ","key":"BcehgoRoFF"},{"type":"abbreviation","title":"ordinary differential equation","children":[{"type":"text","value":"ODE","key":"f1z89OmT2G"}],"key":"sh5MTbwtHR"},{"type":"text","value":" resulting from the method of lines.","key":"dZipDXkAnp"}],"key":"ZQ33Jv0M9G"}],"key":"uE4edZzSkw"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2025-01-09T21:28:58.704052Z","iopub.status.busy":"2025-01-09T21:28:58.703955Z","iopub.status.idle":"2025-01-09T21:28:58.705632Z","shell.execute_reply":"2025-01-09T21:28:58.705419Z"}},"children":[{"type":"code","lang":"python","executable":true,"value":"ode = lambda t, rho: -Q0prime(rho) * (Dx @ rho) + ep * (Dxx @ rho)","key":"BrOTFRMnQX"},{"type":"output","id":"Mrmx3NusA2shwr0YhSDpt","data":[],"key":"Bs2CEEWeNK"}],"key":"eTY2uJr0E9"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Our first initial condition has moderate density with a small bump. Because of the diffusion present, we use a stiff solver for the ","key":"q1CFPv9fQ7"},{"type":"abbreviation","title":"initial-value problem","children":[{"type":"text","value":"IVP","key":"mCU9mVGxzU"}],"key":"K63K2gTByk"},{"type":"text","value":".","key":"xMLDpnNAYL"}],"key":"HQB4XRJeRK"}],"key":"pKfpjWZiai"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2025-01-09T21:28:58.706709Z","iopub.status.busy":"2025-01-09T21:28:58.706623Z","iopub.status.idle":"2025-01-09T21:28:59.542173Z","shell.execute_reply":"2025-01-09T21:28:59.541837Z"}},"children":[{"type":"code","lang":"python","executable":true,"value":"from scipy.integrate import solve_ivp\nrho_init = 400 + 10 * exp(-20 * (x - 3) ** 2)\nep = 0.02\nsol = solve_ivp(ode, [0, 1.0], rho_init, method=\"Radau\", dense_output=True)","key":"nOhnFwKatM"},{"type":"output","id":"iyv8zHWHOMFWcDxYSPWWJ","data":[],"key":"VHsUZo27k0"}],"key":"IO3krsSgtN"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2025-01-09T21:28:59.543757Z","iopub.status.busy":"2025-01-09T21:28:59.543651Z","iopub.status.idle":"2025-01-09T21:28:59.717923Z","shell.execute_reply":"2025-01-09T21:28:59.717664Z"},"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"for t in linspace(0, 1, 6):\n    plot(x, sol.sol(t), label=f\"t = {t:.1f}\")\n\nxlabel(\"$x$\"),  ylabel(\"car density\")\nlegend(),  title(\"Traffic flow\");","visibility":"hide","key":"rOzAYt3t2t"},{"type":"output","id":"DFpMbM9ANl9xv7Seut_xx","data":[{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"c69af6eeb30e5b1f38cf3752419dda9d","path":"/fnc/build/c69af6eeb30e5b1f38cf3752419dda9d.png"},"text/plain":{"content":"<Figure size 700x400 with 1 Axes>","content_type":"text/plain"}}}],"visibility":"show","key":"EIUDDGXwZR"}],"visibility":"show","key":"q2gOr7GREt"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"The bump slowly moves backward on the roadway, spreading out and gradually fading away due to the presence of diffusion.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"IzIDebGCYe"}],"key":"mToJ3roEd6"}],"key":"ZOdum0ux8Q"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2025-01-09T21:28:59.719280Z","iopub.status.busy":"2025-01-09T21:28:59.719164Z","iopub.status.idle":"2025-01-09T21:29:01.836625Z","shell.execute_reply":"2025-01-09T21:29:01.836305Z"},"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"from matplotlib.animation import FuncAnimation\nfig, ax = subplots()\ncurve = ax.plot(x, rho_init)[0]\ntime_text = ax.text(0.05, 0.9, '', transform=ax.transAxes)\nax.set_xlabel(\"$x$\")\nax.set_ylabel(\"density\")\nax.set_ylim(400, 410)\nax.set_title(\"Traffic flow\")\ndef snapshot(t):\n    curve.set_ydata(sol.sol(t))\n    time_text.set_text(f\"t = {t:.2f}\")\n\nanim = FuncAnimation(fig, snapshot, frames=linspace(0, 1, 101))\nanim.save(\"traffic-small.mp4\", fps=30)\nclose()","visibility":"hide","key":"mrkOWMmATg"},{"type":"output","id":"h8B-ogWrfIzlIaxS4x342","data":[],"visibility":"show","key":"LTwyAJNoOn"}],"visibility":"show","key":"Ggwmya4lk3"}],"key":"OsEJlDqMCN"},"references":{"cite":{"order":[],"data":{}}},"footer":{"navigation":{"prev":{"title":"Advection","url":"/advection-4","group":"Chapter 12"},"next":{"title":"Solve B","url":"/solve-b-1","group":"Chapter 12"}}},"domain":"http://localhost:3000"}