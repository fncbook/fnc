{"kind":"Notebook","sha256":"17d37d8ebb5e977a46b3543b9b068dd67f53949383d7910699e76bc4898a5ba5","slug":"solve-9","location":"/chapter11/section1/python/solve.ipynb","dependencies":[],"frontmatter":{"numbering":{"heading_1":{"enabled":false},"heading_2":{"enabled":false},"heading_3":{"enabled":false},"heading_4":{"enabled":false},"heading_5":{"enabled":false},"heading_6":{"enabled":false}},"kernelspec":{"name":"python3","display_name":"Python 3","language":"python"},"authors":[{"nameParsed":{"literal":"Tobin A. Driscoll","given":"Tobin A.","family":"Driscoll"},"name":"Tobin A. Driscoll","email":"driscoll@udel.edu","id":"contributors-myst-generated-uid-0","corresponding":true},{"nameParsed":{"literal":"Richard J. Braun","given":"Richard J.","family":"Braun"},"name":"Richard J. Braun","id":"contributors-myst-generated-uid-1"}],"github":"https://github.com/fncbook/fnc","math":{"\\float":{"macro":"\\mathbb{F}"},"\\real":{"macro":"\\mathbb{R}"},"\\complex":{"macro":"\\mathbb{C}"},"\\nat":{"macro":"\\mathbb{N}"},"\\integer":{"macro":"\\mathbb{Z}"},"\\rmn":{"macro":"\\mathbb{R}^{#1 \\times #2}"},"\\dd":{"macro":"\\frac{d #1}{d #2}"},"\\ddd":{"macro":"\\frac{d^2 #1}{d #2^2}"},"\\pp":{"macro":"\\frac{\\partial #1}{\\partial #2}"},"\\ppp":{"macro":"\\frac{\\partial^2 #1}{\\partial #2^2}"},"\\ppdd":{"macro":"\\frac{\\partial^2 #1}{\\partial #2 \\partial #3}"},"\\abs":{"macro":"\\left\\lvert #1 \\right\\rvert"},"\\norm":{"macro":"\\left\\lVert #1 \\right\\rVert"},"\\twonorm":{"macro":"\\norm{#1}_2"},"\\onenorm":{"macro":"\\norm{#1}_1"},"\\infnorm":{"macro":"\\norm{#1}_\\infty"},"\\anynorm":{"macro":"\\norm{#1}_#2"},"\\innerprod":{"macro":"\\langle #1,#2 \\rangle"},"\\pr":{"macro":"^{(#1)}"},"\\kron":{"macro":"#1 \\otimes #2"},"\\eye":{"macro":"\\mathbf{e}_#1"},"\\meye":{"macro":"\\mathbf{I}"},"\\Qhat":{"macro":"\\hat{\\mathbf{Q}}"},"\\Rhat":{"macro":"\\hat{\\mathbf{R}}"},"\\bfalpha":{"macro":"\\mathbf{alpha}"},"\\bfdelta":{"macro":"\\mathbf{delta}"},"\\bfzero":{"macro":"\\boldsymbol{0}"},"\\macheps":{"macro":"\\epsilon_\\text{mach}"},"\\fl":{"macro":"\\operatorname{fl}"},"\\diag":{"macro":"\\operatorname{diag}"},"\\ign":{"macro":"\\operatorname{sign}"},"\\Re":{"macro":"\\operatorname{Re}"},"\\Im":{"macro":"\\operatorname{Im}"},"\\ee":{"macro":"\\times 10^"},"\\lnorm":{"macro":"\\|"},"\\rnorm":{"macro":"\\|"},"\\floor":{"macro":"\\lfloor#1\\rfloor"},"\\cI":{"macro":"\\mathcal{I}"},"\\mtx":{"macro":"\\operatorname{mtx}"},"\\myvec":{"macro":"\\operatorname{vec}"},"\\argmin":{"macro":"\\operatorname{argmin}"}},"abbreviations":{"IVP":"initial-value problem","BVP":"boundary-value problem","ONC":"matrix with orthonormal columns","SVD":"singular value decomposition","EVD":"eigenvalue decomposition","SPD":"symmetric positive definite","HPD":"hermitian positive definite","PDE":"partial differential equation","ODE":"ordinary differential equation"},"exports":[{"format":"ipynb","filename":"solve.ipynb","url":"/build/solve-a1baa872d6f0a5d67345a744c3de8426.ipynb"}]},"widgets":{},"mdast":{"type":"root","children":[{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2025-01-10T15:10:15.297821Z","iopub.status.busy":"2025-01-10T15:10:15.297730Z","iopub.status.idle":"2025-01-10T15:10:15.725095Z","shell.execute_reply":"2025-01-10T15:10:15.724831Z"},"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"exec(open(\"../../../python/FNC_init.py\").read())","visibility":"show","key":"TJevkDuaAS"},{"type":"output","id":"gb_us7UOVVBWwIpi-umWv","data":[],"visibility":"show","key":"MsmUnXebaS"}],"visibility":"remove","key":"CLZa6QPuIG"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"crossReference","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"strong","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Demo ","key":"yJCf42Ltc3"},{"type":"text","value":"11.1.2","key":"mOzvYgpijW"}],"key":"d8s0SX4GAf"}],"identifier":"demo-blackscholes-solve","label":"demo-blackscholes-solve","kind":"proof:example","template":"Example %s","enumerator":"11.1.2","resolved":true,"html_id":"demo-blackscholes-solve","remote":true,"url":"/blackscholes","dataUrl":"/blackscholes.json","key":"pZD4hPVxOT"}],"key":"adqRhGv36K"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"We consider the Black–Scholes problem for the following parameter values:","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"fzRYJZAqyI"}],"key":"mEGoe6ws3R"}],"key":"haX6dfJTYV"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2025-01-10T15:10:15.726596Z","iopub.status.busy":"2025-01-10T15:10:15.726449Z","iopub.status.idle":"2025-01-10T15:10:15.728247Z","shell.execute_reply":"2025-01-10T15:10:15.728020Z"}},"children":[{"type":"code","lang":"python","executable":true,"value":"Smax, T = 8, 6\nK = 3\nsigma = 0.06\nr = 0.08","key":"f6OsHNwQR0"},{"type":"output","id":"SlPz8hB0-xO8m20A0SVYO","data":[],"key":"A8Vnzh5Bku"}],"key":"Y6VSEudxM3"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"We discretize space and time.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"sbcjsyT3XJ"}],"key":"r7fxeeoIVU"}],"key":"UucEckZqMS"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2025-01-10T15:10:15.729415Z","iopub.status.busy":"2025-01-10T15:10:15.729311Z","iopub.status.idle":"2025-01-10T15:10:15.731207Z","shell.execute_reply":"2025-01-10T15:10:15.730990Z"}},"children":[{"type":"code","lang":"python","executable":true,"value":"m = 200\nh = Smax / m\nx = h * arange(m+1)\nn = 1000\ntau = T / n\nt = tau * arange(n+1)\nlamb, mu = tau / h**2, tau / h","key":"AiXkv5RnbC"},{"type":"output","id":"X2ktKzQYUAlbHCOxpjp0S","data":[],"key":"CKGAFvJ6Dw"}],"key":"ftKbvqDX4q"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"We set the initial condition and then march forward in time.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"Zphd3QTX8C"}],"key":"FRYzoCHMM4"}],"key":"gzTBHMduGW"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2025-01-10T15:10:15.732299Z","iopub.status.busy":"2025-01-10T15:10:15.732204Z","iopub.status.idle":"2025-01-10T15:10:16.087886Z","shell.execute_reply":"2025-01-10T15:10:16.087570Z"}},"children":[{"type":"code","lang":"python","executable":true,"value":"V = zeros([m + 1, n + 1])\nV[:, 0] = maximum(0, x - K)\nfor j in range(n):\n    # Fictitious value from Neumann condition.\n    Vfict = 2 * h + V[m-1, j]\n    Vj = hstack([V[:, j], Vfict])\n    # First row is zero by the Dirichlet condition.\n    for i in range(1, m+1):\n        diff1 = Vj[i+1] - Vj[i-1]\n        diff2 = Vj[i+1] - 2 * Vj[i] + Vj[i-1]\n        V[i, j+1] = (\n            Vj[i]\n            + (lamb * sigma**2 * x[i] ** 2 / 2) * diff2\n            + (r * x[i] * mu) / 2 * diff1\n            - r * tau * Vj[i]\n        )","key":"DMUJSsKoo5"},{"type":"output","id":"Pi1GG0nrNfCi6LjqUNjJi","data":[],"key":"gfbqq2ByFk"}],"key":"wLyBi2mmha"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Here is a plot of the solution after every 250 time steps.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"vz69Efey51"}],"key":"PA5I0pL8tR"}],"key":"xsmNUpQrG0"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2025-01-10T15:10:16.089535Z","iopub.status.busy":"2025-01-10T15:10:16.089430Z","iopub.status.idle":"2025-01-10T15:10:16.197263Z","shell.execute_reply":"2025-01-10T15:10:16.197003Z"}},"children":[{"type":"code","lang":"python","executable":true,"value":"select_times = 250 * arange(5)\nshow_times = t[select_times]\n\nfor j, col in enumerate(select_times):\n    plot(x, V[:, col], label=f\"t={show_times[j]:.1f}\")\n\nlegend()\nxlabel(\"stock price\"),  ylabel(\"option value\")\ntitle(\"Black-Scholes solution\");","key":"qdKccYW6Ce"},{"type":"output","id":"NGgtH5EjugJ4UlkZ3WWzl","data":[{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"0030d967f220be880b34c00fd80cd876","path":"/build/0030d967f220be880b34c00fd80cd876.png"},"text/plain":{"content":"<Figure size 700x400 with 1 Axes>","content_type":"text/plain"}}}],"key":"v7km1QWoxG"}],"key":"EM4zKwkKl7"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"paragraph","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"text","value":"Alternatively, here is an animation of the solution.","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"fKJQ9j5MOd"}],"indexEntries":[{"entry":"Python","subEntry":{"value":"animation","kind":"entry"},"emphasis":true}],"label":"index-bqasVGT7tB","identifier":"index-bqasvgt7tb","html_id":"index-bqasvgt7tb","key":"sFI2t76dvD"}],"key":"WMxK3o6XLW"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2025-01-10T15:10:16.198682Z","iopub.status.busy":"2025-01-10T15:10:16.198566Z","iopub.status.idle":"2025-01-10T15:10:18.785155Z","shell.execute_reply":"2025-01-10T15:10:18.784785Z"},"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"from matplotlib.animation import FuncAnimation\nfig = figure()\nax = fig.add_subplot(autoscale_on=False, xlim=(0, 8), ylim=(0, 6))\nax.grid()\nax.set_title(\"Black-Scholes solution\")\n\nline, = ax.plot([], [], '-', lw=2)\ntime_text = ax.text(0.05, 0.9, '', transform=ax.transAxes)\n\ndef animate(j):\n    line.set_data(x, V[:, j])\n    time_text.set_text(f\"t = {t[j]:.2f}\")\n    return line, time_text\n\nanim = FuncAnimation(fig, animate, frames=range(0, n+1, 10), blit=True);\nanim.save(\"black-scholes-6.mp4\", fps=30)\nclose()","visibility":"show","key":"pKUkTlBXMH"},{"type":"output","id":"xaPkeiQNa0uD4D1HRxBW1","data":[],"visibility":"remove","key":"bcDYYE06ZL"}],"visibility":"show","key":"TftBtMc26x"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"The results are easy to interpret, recalling that the time variable really means ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"E4NUhaUoBQ"},{"type":"emphasis","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"time until strike","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"S0XKwh9HCq"}],"key":"l2oXXpW5xw"},{"type":"text","value":". Say you are close to the option’s strike time. If the current stock price is, say, ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"tXKn84bvRK"},{"type":"inlineMath","value":"S=2","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>S</mi><mo>=</mo><mn>2</mn></mrow><annotation encoding=\"application/x-tex\">S=2</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.05764em;\">S</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">2</span></span></span></span>","key":"i7EXYb6ee9"},{"type":"text","value":", then it’s not likely that the stock will end up over the strike price ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"sKYsb7Tlmb"},{"type":"inlineMath","value":"K=3","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>K</mi><mo>=</mo><mn>3</mn></mrow><annotation encoding=\"application/x-tex\">K=3</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.07153em;\">K</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">3</span></span></span></span>","key":"crOlzLYpVP"},{"type":"text","value":", and therefore the option has little value. On the other hand, if presently ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"KcUwt9JWt3"},{"type":"inlineMath","value":"S=3","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>S</mi><mo>=</mo><mn>3</mn></mrow><annotation encoding=\"application/x-tex\">S=3</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.05764em;\">S</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">3</span></span></span></span>","key":"iPT6Ynryqf"},{"type":"text","value":", then there are good odds that the option will be exercised at the strike time, and you will need to pay a substantial portion of the stock price in order to take advantage. As the time to strike increases, there is an expectation that the stock price is more likely to rise somewhat, making the value of the option larger at each fixed ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"OREbm9uIcm"},{"type":"inlineMath","value":"S","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>S</mi></mrow><annotation encoding=\"application/x-tex\">S</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.05764em;\">S</span></span></span></span>","key":"z5LF4ACDSb"},{"type":"text","value":".","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"FQEhj7ehUg"}],"key":"IEwPIlNFMV"}],"key":"vulaei2wfr"}],"key":"R0Z6Xu52Lz"},"references":{"cite":{"order":[],"data":{}}},"footer":{"navigation":{"prev":{"title":"Fem","url":"/fem-2","group":"Chapter 10"},"next":{"title":"Unstable","url":"/unstable-8","group":"Chapter 11"}}},"domain":"http://localhost:3000"}