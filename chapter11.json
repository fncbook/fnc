{"kind":"Notebook","sha256":"2617f4c8d5d36212cab76dd4a6eb9ac2a5856d69d3640554891d00d8ea618164","slug":"chapter11","location":"/julia/chapter11.md","dependencies":[],"frontmatter":{"title":"Chapter 11","kernelspec":{"name":"julia-1.11","display_name":"Julia 1","language":"julia"},"content_includes_title":false,"authors":[{"nameParsed":{"literal":"Tobin A. Driscoll","given":"Tobin A.","family":"Driscoll"},"name":"Tobin A. Driscoll","email":"driscoll@udel.edu","id":"contributors-myst-generated-uid-0","corresponding":true},{"nameParsed":{"literal":"Richard J. Braun","given":"Richard J.","family":"Braun"},"name":"Richard J. Braun","id":"contributors-myst-generated-uid-1"}],"github":"https://github.com/fncbook/fnc","numbering":{"heading_1":{"enabled":true},"heading_2":{"enabled":true},"heading_3":{"enabled":false}},"math":{"\\float":{"macro":"\\mathbb{F}"},"\\real":{"macro":"\\mathbb{R}"},"\\complex":{"macro":"\\mathbb{C}"},"\\nat":{"macro":"\\mathbb{N}"},"\\integer":{"macro":"\\mathbb{Z}"},"\\rmn":{"macro":"\\mathbb{R}^{#1 \\times #2}"},"\\dd":{"macro":"\\frac{d #1}{d #2}"},"\\ddd":{"macro":"\\frac{d^2 #1}{d #2^2}"},"\\pp":{"macro":"\\frac{\\partial #1}{\\partial #2}"},"\\ppp":{"macro":"\\frac{\\partial^2 #1}{\\partial #2^2}"},"\\ppdd":{"macro":"\\frac{\\partial^2 #1}{\\partial #2 \\partial #3}"},"\\abs":{"macro":"\\left\\lvert #1 \\right\\rvert"},"\\norm":{"macro":"\\left\\lVert #1 \\right\\rVert"},"\\twonorm":{"macro":"\\norm{#1}_2"},"\\onenorm":{"macro":"\\norm{#1}_1"},"\\infnorm":{"macro":"\\norm{#1}_\\infty"},"\\anynorm":{"macro":"\\norm{#1}_#2"},"\\innerprod":{"macro":"\\langle #1,#2 \\rangle"},"\\pr":{"macro":"^{(#1)}"},"\\kron":{"macro":"#1 \\otimes #2"},"\\eye":{"macro":"\\mathbf{e}_#1"},"\\meye":{"macro":"\\mathbf{I}"},"\\Qhat":{"macro":"\\hat{\\mathbf{Q}}"},"\\Rhat":{"macro":"\\hat{\\mathbf{R}}"},"\\bfalpha":{"macro":"\\mathbf{alpha}"},"\\bfdelta":{"macro":"\\mathbf{delta}"},"\\bfzero":{"macro":"\\boldsymbol{0}"},"\\macheps":{"macro":"\\epsilon_\\text{mach}"},"\\fl":{"macro":"\\operatorname{fl}"},"\\diag":{"macro":"\\operatorname{diag}"},"\\ign":{"macro":"\\operatorname{sign}"},"\\Re":{"macro":"\\operatorname{Re}"},"\\Im":{"macro":"\\operatorname{Im}"},"\\ee":{"macro":"\\times 10^"},"\\lnorm":{"macro":"\\|"},"\\rnorm":{"macro":"\\|"},"\\floor":{"macro":"\\lfloor#1\\rfloor"},"\\cI":{"macro":"\\mathcal{I}"},"\\mtx":{"macro":"\\operatorname{mtx}"},"\\myvec":{"macro":"\\operatorname{vec}"},"\\argmin":{"macro":"\\operatorname{argmin}"}},"abbreviations":{"IVP":"initial-value problem","BVP":"boundary-value problem","ONC":"matrix with orthonormal columns","SVD":"singular value decomposition","EVD":"eigenvalue decomposition","SPD":"symmetric positive definite","HPD":"hermitian positive definite","PDE":"partial differential equation","ODE":"ordinary differential equation"},"exports":[{"format":"md","filename":"chapter11.md","url":"/fnc/build/chapter11-1aa17f52780c402d1df0518cc558ab93.md"}]},"mdast":{"type":"root","children":[{"type":"block","children":[{"type":"heading","depth":2,"position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"children":[{"type":"text","value":"Functions","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"key":"dA9tC9IdLa"}],"identifier":"functions","label":"Functions","html_id":"functions","implicit":true,"enumerator":"1","key":"tLwgwrU3pW"},{"type":"details","children":[{"type":"summary","children":[{"type":"text","value":"Differentiation matrices for periodic end conditions","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"key":"m2HBBnmoM2"}],"key":"BVzdtuwF2k"},{"type":"include","file":"package/src/chapter11.jl","literal":true,"filter":{"startAfter":"# begin diffper","endBefore":"# end diffper"},"children":[{"type":"code","value":"\"\"\"\n    diffper(n, xspan)\n\nConstruct 2nd-order differentiation matrices for functions with\nperiodic end conditions, using `n` unique nodes in the interval\n`xspan`. Returns a vector of nodes and the matrices for the first\nand second derivatives.\n\"\"\"\nfunction diffper(n, xspan)\n    a, b = xspan\n    h = (b - a) / n\n    x = @. a + h * (0:n-1)   # nodes, omitting the repeated data\n\n    # Construct Dx by diagonals, then correct the corners.\n    dp = fill(0.5 / h, n - 1)        # superdiagonal\n    dm = fill(-0.5 / h, n - 1)       # subdiagonal\n    Dx = diagm(-1 => dm, 1 => dp)\n    Dx[1, n] = -1 / (2 * h)\n    Dx[n, 1] = 1 / (2 * h)\n\n    # Construct Dxx by diagonals, then correct the corners.\n    d0 = fill(-2 / h^2, n)        # main diagonal\n    dp = ones(n - 1) / h^2         # superdiagonal and subdiagonal\n    Dxx = diagm(-1 => dp, 0 => d0, 1 => dp)\n    Dxx[1, n] = 1 / (h^2)\n    Dxx[n, 1] = 1 / (h^2)\n\n    return x, Dx, Dxx\nend","lang":"julia","showLineNumbers":true,"filename":"diffper.jl","key":"W9nu7chmWL"}],"key":"uoNTmgF6EH"}],"label":"function-diffper-julia","identifier":"function-diffper-julia","html_id":"function-diffper-julia","key":"koKTv7PSBO"},{"type":"details","children":[{"type":"summary","children":[{"type":"text","value":"Solution of parabolic ","key":"dx6367Lodq"},{"type":"abbreviation","title":"partial differential equation","children":[{"type":"text","value":"PDE","key":"cqr801MIWF"}],"key":"V7tYk8wT4w"},{"type":"text","value":"s by the method of lines","key":"Wqfz0sX6LK"}],"key":"Eh8gcVfwyy"},{"type":"include","file":"package/src/chapter11.jl","literal":true,"filter":{"startAfter":"# begin parabolic","endBefore":"# end parabolic"},"children":[{"type":"code","value":"\"\"\"\n    parabolic(ϕ, xspan, m, g₁, g₂, tspan, init)\n\nSolve a parabolic PDE by the method of lines. The PDE is\n∂u/∂t = `ϕ`(t, x, u, ∂u/∂x, ∂^2u/∂x^2), `xspan` gives the space\ndomain, m gives the degree of a Chebyshev spectral discretization,\n`g₁` and `g₂` are functions of (u,∂u/∂x) at the domain ends that\nshould be made zero, `tspan` is the time domain, and `init` is a\nfunction of x that gives the initial condition. Returns a vector\n`x` and a function of t that gives the semidiscrete solution at `x`.\n\"\"\"\nfunction parabolic(ϕ, xspan, m, g₁, g₂, tspan, init)\n    x, Dₓ, Dₓₓ = diffcheb(m, xspan)\n    int = 2:m    # indexes of interior nodes\n\n    function extend(v)\n        function objective(ubc)\n            u₀, uₘ = ubc\n            uₓ = Dₓ * [u₀; v; uₘ]\n            return [g₁(u₀, uₓ[1]), g₂(uₘ, uₓ[end])]\n        end\n        ubc = levenberg(objective, [0, 0])[end]\n        return [ubc[1]; v; ubc[2]]\n    end\n\n    function ode!(f, v, p, t)\n        u = extend(v)\n        uₓ, uₓₓ = Dₓ * u, Dₓₓ * u\n        @. f = ϕ(t, x[int], u[int], uₓ[int], uₓₓ[int])\n    end\n\n    ivp = ODEProblem(ode!, init.(x[int]), float.(tspan))\n    u = solve(ivp)\n\n    return x, t -> extend(u(t))\nend","lang":"julia","showLineNumbers":true,"filename":"parabolic.jl","key":"NpeuOHiK1G"}],"key":"kfyQgCQJCl"},{"type":"admonition","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"About the code","position":{"start":{"line":33,"column":1},"end":{"line":33,"column":1}},"key":"rAwzASJSWX"}],"key":"FGNrwLWjFm"},{"type":"paragraph","position":{"start":{"line":35,"column":1},"end":{"line":35,"column":1}},"children":[{"type":"text","value":"Line 29 uses the macro ","position":{"start":{"line":35,"column":1},"end":{"line":35,"column":1}},"key":"tY5WE48SOp"},{"type":"inlineCode","value":"@.","position":{"start":{"line":35,"column":1},"end":{"line":35,"column":1}},"key":"Yy34fl7oq6"},{"type":"text","value":" to assign into the vector ","position":{"start":{"line":35,"column":1},"end":{"line":35,"column":1}},"key":"K1y9csXnkj"},{"type":"inlineCode","value":"f","position":{"start":{"line":35,"column":1},"end":{"line":35,"column":1}},"key":"NTDR3PJvEO"},{"type":"text","value":" elementwise. Without it, the function would allocate space for the result of ","position":{"start":{"line":35,"column":1},"end":{"line":35,"column":1}},"key":"RduBNYskP6"},{"type":"inlineCode","value":"phi","position":{"start":{"line":35,"column":1},"end":{"line":35,"column":1}},"key":"dFn8qaSQ0y"},{"type":"text","value":" and then change ","position":{"start":{"line":35,"column":1},"end":{"line":35,"column":1}},"key":"xD3LFRRLvC"},{"type":"inlineCode","value":"f","position":{"start":{"line":35,"column":1},"end":{"line":35,"column":1}},"key":"zmz4HfCt40"},{"type":"text","value":" to point at that vector, and that would defeat the purpose of using the preallocated ","position":{"start":{"line":35,"column":1},"end":{"line":35,"column":1}},"key":"KNSZ0h7eyi"},{"type":"inlineCode","value":"f","position":{"start":{"line":35,"column":1},"end":{"line":35,"column":1}},"key":"IIyK0F0gh7"},{"type":"text","value":" for speed.","position":{"start":{"line":35,"column":1},"end":{"line":35,"column":1}},"key":"bScxt4WF5z"}],"key":"C9gB0Q4dCt"}],"class":"dropdown","key":"zLR3EHdxM9"}],"label":"function-parabolic-julia","identifier":"function-parabolic-julia","html_id":"function-parabolic-julia","key":"TrXAcg2kGz"},{"type":"heading","depth":2,"position":{"start":{"line":39,"column":1},"end":{"line":39,"column":1}},"children":[{"type":"text","value":"Examples","position":{"start":{"line":39,"column":1},"end":{"line":39,"column":1}},"key":"XPxbJBvOvB"}],"identifier":"examples","label":"Examples","html_id":"examples","implicit":true,"enumerator":"2","key":"wjmKVVxRNu"}],"key":"fSNfvHVRyx"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"julia","executable":true,"value":"include(\"FNC_init.jl\")","visibility":"show","key":"eJ08z8SNHo"},{"type":"output","id":"6S82h_lrcmb78q0GXNWmO","data":[{"output_type":"stream","name":"stderr","text":"\u001b[32m\u001b[1m  Activating\u001b[22m\u001b[39m "},{"output_type":"stream","name":"stderr","text":"project at `~/Documents/GitHub/fnc`\n"}],"visibility":"remove","key":"wQ8UbvRw7n"}],"data":{"tags":[]},"visibility":"show","key":"oZX7s2itXZ"},{"type":"block","children":[{"type":"heading","depth":3,"position":{"start":{"line":46,"column":1},"end":{"line":46,"column":1}},"children":[{"type":"text","value":"11.1 ","position":{"start":{"line":46,"column":1},"end":{"line":46,"column":1}},"key":"D0QwfEZ3nL"},{"type":"link","identifier":"section-diffusion-blackscholes","label":"section-diffusion-blackscholes","kind":"narrative","position":{"start":{"line":46,"column":6},"end":{"line":46,"column":37}},"url":"/blackscholes","internal":true,"dataUrl":"/blackscholes.json","children":[{"type":"text","value":"Black–Scholes equation","key":"Hhc5GXEkll"}],"key":"ulT4Ll0qxq"}],"identifier":"id-11-1","label":"11.1 ","html_id":"id-11-1","implicit":true,"key":"bPqsQGqdUJ"},{"type":"details","children":[{"type":"summary","children":[{"type":"crossReference","identifier":"demo-blackscholes-solve","label":"demo-blackscholes-solve","kind":"proof:example","position":{"start":{"line":49,"column":1},"end":{"line":49,"column":25}},"children":[{"type":"text","value":"Example ","key":"ocv9G9YxAM"},{"type":"text","value":"11.1.2","key":"AH5PCuTk42"}],"template":"Example %s","enumerator":"11.1.2","resolved":true,"html_id":"demo-blackscholes-solve","remote":true,"url":"/blackscholes","dataUrl":"/blackscholes.json","key":"jfZ2IpNMDb"}],"key":"E0TGykYipa"},{"type":"paragraph","position":{"start":{"line":50,"column":1},"end":{"line":50,"column":1}},"children":[{"type":"text","value":"We consider the Black–Scholes problem for the following parameter values:","position":{"start":{"line":50,"column":1},"end":{"line":50,"column":1}},"key":"QgOXneYlVk"}],"key":"FCSRkXLyeb"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"julia","executable":true,"value":"Smax = 8 \nT = 6\nK, σ, r = (3, 0.06, 0.08);","key":"zhGqYeI0pc"},{"type":"output","id":"kGU9xxYp9EqnmHLZZFESl","data":[],"key":"r9KxS04FVH"}],"data":{},"key":"DtlggwdGbn"},{"type":"paragraph","position":{"start":{"line":58,"column":1},"end":{"line":58,"column":1}},"children":[{"type":"text","value":"We discretize space and time.","position":{"start":{"line":58,"column":1},"end":{"line":58,"column":1}},"key":"Zh8X6ERigH"}],"key":"jTelCb5PBk"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"julia","executable":true,"value":"m = 200;  h = Smax / m;\nx = h * (0:m)\nn = 1000;  τ = T / n;\nt = τ * (0:n)\nλ = τ / h^2\nμ = τ / h","key":"El0tar8RTx"},{"type":"output","id":"HpXAveaeqnBoq1mv-VpNQ","data":[{"output_type":"execute_result","execution_count":3,"metadata":{},"data":{"text/plain":{"content":"0.15","content_type":"text/plain"}}}],"key":"ge3j2FdEFC"}],"data":{},"key":"lVwP49ZadF"},{"type":"paragraph","position":{"start":{"line":69,"column":1},"end":{"line":69,"column":1}},"children":[{"type":"text","value":"We set the initial condition and then march forward in time.","position":{"start":{"line":69,"column":1},"end":{"line":69,"column":1}},"key":"sGLIwN7MhU"}],"key":"R9BLuH6Inj"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"julia","executable":true,"value":"V = zeros(m+1, n+1)\nV[:, 1] = @. max(0, x - K)\nfor j in 1:n\n    # Fictitious value from Neumann condition.\n    Vfict = 2*h + V[m,j]\n    Vj = [ V[:, j]; Vfict ]\n    # First row is zero by the Dirichlet condition.\n    for i in 2:m+1 \n        diff1 = (Vj[i+1] - Vj[i-1])\n        diff2 = (Vj[i+1] - 2Vj[i] + Vj[i-1])\n        V[i,j+1] = Vj[i] +\n            (λ * σ^2 * x[i]^2 / 2) * diff2 \n            + (r * x[i] * μ) / 2 * diff1 \n            - (r * τ) * Vj[i]\n    end \nend","key":"uO6CXhwPFP"},{"type":"output","id":"PWoThCdC7jutY6wpO9Opm","data":[],"key":"C7Su6d9I1J"}],"data":{},"key":"GF4R5LcOeV"},{"type":"paragraph","position":{"start":{"line":90,"column":1},"end":{"line":90,"column":1}},"children":[{"type":"text","value":"Here is a plot of the solution after every 250 time steps.","position":{"start":{"line":90,"column":1},"end":{"line":90,"column":1}},"key":"TRd5HOtCxk"}],"key":"lAhqZTlk0a"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"julia","executable":true,"value":"using Plots\nidx = 1:250:n+1\nlabel = reshape([\"t = $t\" for t in t[idx]], 1, length(idx))\nplot(x, V[:, idx]; \n    label, legend=:topleft,\n    xaxis=(\"stock price\"),  yaxis=(\"option value\"),\n    title=\"Black–Scholes solution\")","key":"qMPU7y1fw4"},{"type":"output","id":"zR0t0LEFtb6VHjYfhjqJ_","data":[{"output_type":"execute_result","execution_count":5,"metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"5b3e15e58d7037f20df3c390f8bff2eb","path":"/fnc/build/5b3e15e58d7037f20df3c390f8bff2eb.png"},"text/html":{"content_type":"text/html","hash":"e9f67c50e22b5ed90773363ddf2b56c1","path":"/fnc/build/e9f67c50e22b5ed90773363ddf2b56c1.html"},"image/svg+xml":{"content_type":"image/svg+xml","hash":"339b7a2204af43d3f26ec69eac14e744","path":"/fnc/build/339b7a2204af43d3f26ec69eac14e744.svg"}}}],"key":"x3MIX9FYOP"}],"data":{},"key":"KC14enhHln"},{"type":"paragraph","position":{"start":{"line":105,"column":1},"end":{"line":105,"column":1}},"children":[{"type":"text","value":"Alternatively, here is an animation of the solution.","position":{"start":{"line":105,"column":1},"end":{"line":105,"column":1}},"key":"UjALFuXpzg"}],"indexEntries":[{"entry":"Julia","subEntry":{"value":"@animate","kind":"entry"},"emphasis":true}],"label":"index-q01DIBa91i","identifier":"index-q01diba91i","html_id":"index-q01diba91i","key":"WQzfthAUS3"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"julia","executable":true,"value":"anim = @animate for j in 1:10:n+1\n    plot(x, V[:, j];\n        xaxis=(L\"S\"),  yaxis=([0,6],L\"v(S,t)\"),\n        title=\"Black–Scholes solution\",\n        dpi=150,    \n        label=@sprintf(\"t = %.2f\", t[j]))\nend\nmp4(anim, \"figures/black-scholes-6.mp4\")","key":"VC3lH5TbuL"},{"type":"output","id":"gfLXMVpkugz5IT8qqUqC9","data":[{"output_type":"stream","name":"stderr","text":"\u001b[36m\u001b[1m[ \u001b[22m\u001b[39m\u001b[36m\u001b[1mInfo: \u001b[22m\u001b[39mSaved animation to /Users/driscoll/Dropbox/Mac/Documents/GitHub/fnc/julia/figures/black-scholes-6.mp4\n"},{"output_type":"execute_result","execution_count":6,"metadata":{},"data":{"text/plain":{"content":"Plots.AnimatedGif(\"/Users/driscoll/Dropbox/Mac/Documents/GitHub/fnc/julia/figures/black-scholes-6.mp4\")","content_type":"text/plain"},"text/html":{"content_type":"text/html","hash":"62eeb3953e877813ab0fb2c9919f82c5","path":"/fnc/build/62eeb3953e877813ab0fb2c9919f82c5.html"}}}],"key":"q1bwzIR9GS"}],"data":{},"key":"GKCVk4GWC1"},{"type":"paragraph","position":{"start":{"line":118,"column":1},"end":{"line":118,"column":1}},"children":[{"type":"text","value":"The results are easy to interpret, recalling that the time variable really means ","position":{"start":{"line":118,"column":1},"end":{"line":118,"column":1}},"key":"oXLwUK5lZ2"},{"type":"emphasis","position":{"start":{"line":118,"column":1},"end":{"line":118,"column":1}},"children":[{"type":"text","value":"time until strike","position":{"start":{"line":118,"column":1},"end":{"line":118,"column":1}},"key":"vw6dwrSkLx"}],"key":"uJw5KTLetz"},{"type":"text","value":". Say you are close to the option’s strike time. If the current stock price is, say, ","position":{"start":{"line":118,"column":1},"end":{"line":118,"column":1}},"key":"H0vkf2u0bl"},{"type":"inlineMath","value":"S=2","position":{"start":{"line":118,"column":1},"end":{"line":118,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>S</mi><mo>=</mo><mn>2</mn></mrow><annotation encoding=\"application/x-tex\">S=2</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.05764em;\">S</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">2</span></span></span></span>","key":"g5PYwCf6yA"},{"type":"text","value":", then it’s not likely that the stock will end up over the strike price ","position":{"start":{"line":118,"column":1},"end":{"line":118,"column":1}},"key":"nPnyFPms7x"},{"type":"inlineMath","value":"K=3","position":{"start":{"line":118,"column":1},"end":{"line":118,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>K</mi><mo>=</mo><mn>3</mn></mrow><annotation encoding=\"application/x-tex\">K=3</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.07153em;\">K</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">3</span></span></span></span>","key":"xwT6T5LKtB"},{"type":"text","value":", and therefore the option has little value. On the other hand, if presently ","position":{"start":{"line":118,"column":1},"end":{"line":118,"column":1}},"key":"K92qt2RVke"},{"type":"inlineMath","value":"S=3","position":{"start":{"line":118,"column":1},"end":{"line":118,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>S</mi><mo>=</mo><mn>3</mn></mrow><annotation encoding=\"application/x-tex\">S=3</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.05764em;\">S</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">3</span></span></span></span>","key":"zM3bcp3z1b"},{"type":"text","value":", then there are good odds that the option will be exercised at the strike time, and you will need to pay a substantial portion of the stock price in order to take advantage. As the time to strike increases, there is an expectation that the stock price is more likely to rise somewhat, making the value of the option larger at each fixed ","position":{"start":{"line":118,"column":1},"end":{"line":118,"column":1}},"key":"nCtzP97D3K"},{"type":"inlineMath","value":"S","position":{"start":{"line":118,"column":1},"end":{"line":118,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>S</mi></mrow><annotation encoding=\"application/x-tex\">S</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.05764em;\">S</span></span></span></span>","key":"b5WjPKKrqT"},{"type":"text","value":".","position":{"start":{"line":118,"column":1},"end":{"line":118,"column":1}},"key":"nDlVp2lo3Z"}],"key":"DekinrENt6"}],"label":"demo-blackscholes-solve-julia","identifier":"demo-blackscholes-solve-julia","html_id":"demo-blackscholes-solve-julia","key":"AePzI2SoF8"},{"type":"details","children":[{"type":"summary","children":[{"type":"crossReference","identifier":"demo-blackscholes-unstable","label":"demo-blackscholes-unstable","kind":"proof:example","position":{"start":{"line":122,"column":1},"end":{"line":122,"column":28}},"children":[{"type":"text","value":"Example ","key":"zFgDa82Xml"},{"type":"text","value":"11.1.3","key":"UBAYBxMLmC"}],"template":"Example %s","enumerator":"11.1.3","resolved":true,"html_id":"demo-blackscholes-unstable","remote":true,"url":"/blackscholes","dataUrl":"/blackscholes.json","key":"HVMAx6JsyD"}],"key":"ebsUkB8o6Q"},{"type":"paragraph","position":{"start":{"line":123,"column":1},"end":{"line":123,"column":1}},"children":[{"type":"text","value":"Let’s try to do everything the same as in ","position":{"start":{"line":123,"column":1},"end":{"line":123,"column":1}},"key":"J2dP1l2a9T"},{"type":"crossReference","kind":"proof:example","identifier":"demo-blackscholes-solve","label":"demo-blackscholes-solve","children":[{"type":"text","value":"Demo ","key":"kNtomUvJL4"},{"type":"text","value":"11.1.2","key":"cIlfMqPx2P"}],"template":"Example %s","enumerator":"11.1.2","resolved":true,"html_id":"demo-blackscholes-solve","remote":true,"url":"/blackscholes","dataUrl":"/blackscholes.json","key":"kXFVpUz1QO"},{"type":"text","value":", but extending the simulation time to ","position":{"start":{"line":123,"column":1},"end":{"line":123,"column":1}},"key":"pF01qSfISK"},{"type":"inlineMath","value":"T=8","position":{"start":{"line":123,"column":1},"end":{"line":123,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>T</mi><mo>=</mo><mn>8</mn></mrow><annotation encoding=\"application/x-tex\">T=8</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">T</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">8</span></span></span></span>","key":"bJ2KohbUde"},{"type":"text","value":".","position":{"start":{"line":123,"column":1},"end":{"line":123,"column":1}},"key":"EO9Xbt8QsY"}],"key":"nTD530RE3U"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"julia","executable":true,"value":"T = 8;\n\nm = 200;  h = Smax / m;\nx = h*(0:m)\nn = 1000;  τ = T / n;\nt = τ*(0:n)\nλ = τ / h^2;  μ = τ / h;\n\nfor j in 1:n\n    # Fictitious value from Neumann condition.\n    Vfict = 2h + V[m,j]\n    Vj = [ V[:, j]; Vfict ]\n    # First row is zero by the Dirichlet condition.\n    for i in 2:m+1 \n        diff1 = (Vj[i+1] - Vj[i-1])\n        diff2 = (Vj[i+1] - 2Vj[i] + Vj[i-1])\n        V[i,j+1] = Vj[i] +\n            (λ * σ^2 * x[i]^2 / 2) * diff2 \n            + (r * x[i] * μ) / 2 * diff1 \n            - (r * τ) * Vj[i]\n    end   \nend\n\nidx = 1:250:n+1\nlabel = reshape([\"t = $t\" for t in t[idx]], 1, length(idx))\nplot(x, V[:, idx];\n    label, legend=:topleft,\n    title=\"Black–Scholes solution\",\n    xaxis=(\"stock price\"),  yaxis=(\"option value\",[0, 6]))","key":"RwfMZXGdhW"},{"type":"output","id":"ET49MLI-QuSaA1Aul09Wi","data":[{"output_type":"execute_result","execution_count":7,"metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"f02ec468ce6a863d71e483ad1ffe378a","path":"/fnc/build/f02ec468ce6a863d71e483ad1ffe378a.png"},"text/html":{"content_type":"text/html","hash":"edf91ca4310e179ebe66994e359b3acd","path":"/fnc/build/edf91ca4310e179ebe66994e359b3acd.html"},"image/svg+xml":{"content_type":"image/svg+xml","hash":"a99487f97e2278c3c4dd33aaff0e3450","path":"/fnc/build/a99487f97e2278c3c4dd33aaff0e3450.svg"}}}],"key":"MHLHhCways"}],"data":{},"key":"I9IrZGRaPg"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"julia","executable":true,"value":"anim = @animate for j in 1:10:n+1 \n    plot(x, V[:, j];\n        xaxis=(L\"S\"),  yaxis=([0,6],L\"v(S,t)\"),\n        title=\"Black–Scholes solution...?\",\n        dpi=150,  label=@sprintf(\"t = %.2f\",t[j]))\nend\nmp4(anim, \"figures/black-scholes-8.mp4\")","key":"aiqxr2HTcU"},{"type":"output","id":"6BFyZ5nhwoV9DuED6jSUK","data":[{"output_type":"stream","name":"stderr","text":"\u001b[36m\u001b[1m[ \u001b[22m\u001b[39m\u001b[36m\u001b[1mInfo: \u001b[22m\u001b[39mSaved animation to /Users/driscoll/Dropbox/Mac/Documents/GitHub/fnc/julia/figures/black-scholes-8.mp4\n"},{"output_type":"execute_result","execution_count":8,"metadata":{},"data":{"text/plain":{"content":"Plots.AnimatedGif(\"/Users/driscoll/Dropbox/Mac/Documents/GitHub/fnc/julia/figures/black-scholes-8.mp4\")","content_type":"text/plain"},"text/html":{"content_type":"text/html","hash":"e9996adb24f49c7ed593669cced30282","path":"/fnc/build/e9996adb24f49c7ed593669cced30282.html"}}}],"key":"lsUKbeeGhU"}],"data":{},"key":"whmBJAv8Hp"},{"type":"paragraph","position":{"start":{"line":167,"column":1},"end":{"line":167,"column":1}},"children":[{"type":"text","value":"This so-called solution is nonsense!","position":{"start":{"line":167,"column":1},"end":{"line":167,"column":1}},"key":"H6AyXpTyOe"}],"key":"nBpb9PchcC"}],"label":"demo-blackscholes-unstable-julia","identifier":"demo-blackscholes-unstable-julia","html_id":"demo-blackscholes-unstable-julia","key":"N9ogJwZ3Lu"},{"type":"heading","depth":3,"position":{"start":{"line":170,"column":1},"end":{"line":170,"column":1}},"children":[{"type":"text","value":"11.2 ","position":{"start":{"line":170,"column":1},"end":{"line":170,"column":1}},"key":"F6LOYmUO5b"},{"type":"link","identifier":"section-diffusion-methodlines","label":"section-diffusion-methodlines","kind":"narrative","position":{"start":{"line":170,"column":6},"end":{"line":170,"column":36}},"url":"/methodlines","internal":true,"dataUrl":"/methodlines.json","children":[{"type":"text","value":"The method of lines","key":"Zq5Y9ZQan8"}],"key":"xJohZWnvoJ"}],"identifier":"id-11-2","label":"11.2 ","html_id":"id-11-2","implicit":true,"key":"CldDp1PLxZ"},{"type":"details","children":[{"type":"summary","children":[{"type":"crossReference","identifier":"demo-methodlines-heatfe","label":"demo-methodlines-heatFE","kind":"proof:example","position":{"start":{"line":173,"column":1},"end":{"line":173,"column":25}},"children":[{"type":"text","value":"Example ","key":"aySY9KHvAE"},{"type":"text","value":"11.2.2","key":"nLmFLrU7dR"}],"template":"Example %s","enumerator":"11.2.2","resolved":true,"html_id":"demo-methodlines-heatfe","remote":true,"url":"/methodlines","dataUrl":"/methodlines.json","key":"piAHH9OD1l"}],"key":"T5mjyJKmki"},{"type":"paragraph","position":{"start":{"line":174,"column":1},"end":{"line":174,"column":1}},"children":[{"type":"text","value":"Let’s implement the method of ","position":{"start":{"line":174,"column":1},"end":{"line":174,"column":1}},"key":"I2xY6wx4Xl"},{"type":"crossReference","kind":"proof:example","identifier":"example-methodlines-heatfe","label":"example-methodlines-heatFE","children":[{"type":"text","value":"Example ","key":"wrotow5QNi"},{"type":"text","value":"11.2.1","key":"BtmozZc8XJ"}],"template":"Example %s","enumerator":"11.2.1","resolved":true,"html_id":"example-methodlines-heatfe","remote":true,"url":"/methodlines","dataUrl":"/methodlines.json","key":"gNCLi1rEuN"},{"type":"text","value":" with second-order space semidiscretization.","position":{"start":{"line":174,"column":1},"end":{"line":174,"column":1}},"key":"omHedTopak"}],"key":"eUvEfA6cII"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"julia","executable":true,"value":"m = 100\nx, Dx, Dxx = FNC.diffper(m, [0, 1]);\ntfinal = 0.15 \nn = 2400           # number of time steps\nτ = tfinal / n     # time step    \nt = τ * (0:n)      # time values","key":"DTbzpsdfZO"},{"type":"output","id":"xCwEUJmjqFOpMSgWZWbBY","data":[{"output_type":"execute_result","execution_count":9,"metadata":{},"data":{"text/plain":{"content":"0.0:6.25e-5:0.15","content_type":"text/plain"}}}],"key":"glXrmtRTnm"}],"data":{},"key":"zOdIoeUX8c"},{"type":"paragraph","position":{"start":{"line":185,"column":1},"end":{"line":185,"column":1}},"children":[{"type":"text","value":"Next we set an initial condition. It isn’t mathematically periodic, but the end values and derivatives are so small that for numerical purposes it may as well be.","position":{"start":{"line":185,"column":1},"end":{"line":185,"column":1}},"key":"HJmXRCxQDe"}],"key":"VTaUU0RAm4"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"julia","executable":true,"value":"using Plots\nU = zeros(m, n+1);\nU[:, 1] = @. exp( -60 * (x - 0.5)^2 )\nplot(x, U[:, 1];\n    xaxis=(L\"x\"),  yaxis=(L\"u(x,0)\"),\n    title=\"Initial condition\")","key":"HZ7wGANXK2"},{"type":"output","id":"WoZxlOAzMVmKMNnoKYfSC","data":[{"output_type":"execute_result","execution_count":10,"metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"d1a9ee3095e8be27ad4ee5759ac6bdcc","path":"/fnc/build/d1a9ee3095e8be27ad4ee5759ac6bdcc.png"},"text/html":{"content_type":"text/html","hash":"a1581209ace0e4a1b2d8a859f34f1f6f","path":"/fnc/build/a1581209ace0e4a1b2d8a859f34f1f6f.html"},"image/svg+xml":{"content_type":"image/svg+xml","hash":"e936c5b75d340a7464dd227ad5412f9f","path":"/fnc/build/e936c5b75d340a7464dd227ad5412f9f.svg"}}}],"key":"cH4okxbFqX"}],"data":{},"key":"hEx2DBnMOK"},{"type":"paragraph","position":{"start":{"line":196,"column":1},"end":{"line":196,"column":1}},"children":[{"type":"text","value":"The Euler time stepping simply multiplies ","position":{"start":{"line":196,"column":1},"end":{"line":196,"column":1}},"key":"WvxCGG6ysc"},{"type":"inlineMath","value":"\\mathbf{u}_j","position":{"start":{"line":196,"column":1},"end":{"line":196,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi mathvariant=\"bold\">u</mi><mi>j</mi></msub></mrow><annotation encoding=\"application/x-tex\">\\mathbf{u}_j</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.7305em;vertical-align:-0.2861em;\"></span><span class=\"mord\"><span class=\"mord mathbf\">u</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3117em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.05724em;\">j</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.2861em;\"><span></span></span></span></span></span></span></span></span></span>","key":"j19CuIGbOM"},{"type":"text","value":" by the constant matrix in ","position":{"start":{"line":196,"column":1},"end":{"line":196,"column":1}},"key":"skhOx45sYu"},{"type":"crossReference","kind":"equation","identifier":"eulerxx","label":"Eulerxx","children":[{"type":"text","value":"(","key":"yMyEwh3QIH"},{"type":"text","value":"11.2.6","key":"USu1qhajnH"},{"type":"text","value":")","key":"z1IC4Sdeih"}],"template":"(%s)","enumerator":"11.2.6","resolved":true,"html_id":"eulerxx","remote":true,"url":"/methodlines","dataUrl":"/methodlines.json","key":"JMb9QrE8Ya"},{"type":"text","value":" at each time step. Since that matrix is sparse, we will declare it as such, even though the run-time savings may not be detectable for this small value of ","position":{"start":{"line":196,"column":1},"end":{"line":196,"column":1}},"key":"aPUAL4sid7"},{"type":"inlineMath","value":"m","position":{"start":{"line":196,"column":1},"end":{"line":196,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>m</mi></mrow><annotation encoding=\"application/x-tex\">m</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">m</span></span></span></span>","key":"pwOlciDk4Q"},{"type":"text","value":".","position":{"start":{"line":196,"column":1},"end":{"line":196,"column":1}},"key":"xuCLcoFjBP"}],"key":"Vw4XEHbZgR"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"julia","executable":true,"value":"using SparseArrays\nA = sparse(I + τ * Dxx)\nfor j in 1:n\n    U[:, j+1] = A * U[:, j]\nend\n\nplot_idx = 1:10:31\nplot_times = round.(t[plot_idx], digits=4)\nlabels = [\"t = $t\" for t in plot_times]\nplot(x, U[:, plot_idx];\n    label=reshape(labels, 1, :),  legend=:topleft,  \n    title=\"Heat equation by forward Euler\",\n    xaxis=(L\"x\"),  yaxis=(L\"u(x,0)\", [-0.25, 1]))","key":"z0Rpl4nGzb"},{"type":"output","id":"xJHaH6Bw1mSj5XIwZfnb_","data":[{"output_type":"execute_result","execution_count":11,"metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"8b4585cf2bce8ec7de13b9975e6fa8ab","path":"/fnc/build/8b4585cf2bce8ec7de13b9975e6fa8ab.png"},"text/html":{"content_type":"text/html","hash":"342b241fbea4c665f88c6e2b2c8b366c","path":"/fnc/build/342b241fbea4c665f88c6e2b2c8b366c.html"},"image/svg+xml":{"content_type":"image/svg+xml","hash":"bde1a000cfe2c6e897122af9f2364c80","path":"/fnc/build/bde1a000cfe2c6e897122af9f2364c80.svg"}}}],"key":"nHn7kWy9Qk"}],"data":{},"key":"UouhM5Dzjr"},{"type":"paragraph","position":{"start":{"line":214,"column":1},"end":{"line":214,"column":1}},"children":[{"type":"text","value":"Things seem to start well, with the initial peak widening and shrinking. But then there is a nonphysical growth in the solution.","position":{"start":{"line":214,"column":1},"end":{"line":214,"column":1}},"key":"L5opPZ4Wnj"}],"key":"RSITTKD2oB"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"julia","executable":true,"value":"anim = @animate for j in 1:101\n    plot(x, U[:, j];\n    label=@sprintf(\"t=%.5f\", t[j]),\n    xaxis=(L\"x\"),  yaxis=(L\"u(x,t)\", [-1, 2]),\n    dpi=150,  title=\"Heat equation by forward Euler\")\nend\nmp4(anim, \"figures/diffusionFE.mp4\")","visibility":"hide","key":"UCDyvCNx5u"},{"type":"output","id":"kkKi0WOO-UQK3lN0K5Oce","data":[{"output_type":"stream","name":"stderr","text":"\u001b[36m\u001b[1m[ \u001b[22m\u001b[39m\u001b[36m\u001b[1mInfo: \u001b[22m\u001b[39mSaved animation to /Users/driscoll/Dropbox/Mac/Documents/GitHub/fnc/julia/figures/diffusionFE.mp4\n"},{"output_type":"execute_result","execution_count":12,"metadata":{},"data":{"text/plain":{"content":"Plots.AnimatedGif(\"/Users/driscoll/Dropbox/Mac/Documents/GitHub/fnc/julia/figures/diffusionFE.mp4\")","content_type":"text/plain"},"text/html":{"content_type":"text/html","hash":"b3b9c7913b94254f791ed9015e7e5726","path":"/fnc/build/b3b9c7913b94254f791ed9015e7e5726.html"}}}],"visibility":"show","key":"AmbI0QyDGa"}],"data":{"tags":[]},"visibility":"show","key":"FQ83GOfITG"},{"type":"paragraph","position":{"start":{"line":227,"column":1},"end":{"line":227,"column":1}},"children":[{"type":"text","value":"The growth in norm is exponential in time.","position":{"start":{"line":227,"column":1},"end":{"line":227,"column":1}},"key":"EjpPl063mK"}],"key":"PDD4YZJMJG"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"julia","executable":true,"value":"M = vec( maximum(abs, U, dims=1) )   \nplot(t[1:1000], M[1:1000];\n    xaxis=(L\"t\"),  yaxis=(:log10, L\"\\max_x |u(x,t)|\"),\n    title=\"Nonphysical growth\")","key":"hqXozHOeQG"},{"type":"output","id":"ccLkx2nMlKgbhxcT_mZiR","data":[{"output_type":"execute_result","execution_count":13,"metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"bbdb1b394b224cdd0c399c0be028b2f1","path":"/fnc/build/bbdb1b394b224cdd0c399c0be028b2f1.png"},"text/html":{"content_type":"text/html","hash":"e06a53a62b5e2a0de2b909b201f4f02a","path":"/fnc/build/e06a53a62b5e2a0de2b909b201f4f02a.html"},"image/svg+xml":{"content_type":"image/svg+xml","hash":"5f1ea358a04dd56ec4862d6c1aa9c853","path":"/fnc/build/5f1ea358a04dd56ec4862d6c1aa9c853.svg"}}}],"key":"ivaRlaef9x"}],"data":{},"key":"CGYfrkRMVY"}],"label":"demo-methodlines-heatFE-julia","identifier":"demo-methodlines-heatfe-julia","html_id":"demo-methodlines-heatfe-julia","key":"w22EDIgwBI"},{"type":"details","children":[{"type":"summary","children":[{"type":"crossReference","identifier":"demo-methodlines-heatbe","label":"demo-methodlines-heatBE","kind":"proof:example","position":{"start":{"line":238,"column":1},"end":{"line":238,"column":25}},"children":[{"type":"text","value":"Example ","key":"RFgV4ZU5a0"},{"type":"text","value":"11.2.4","key":"odRa8MQsx9"}],"template":"Example %s","enumerator":"11.2.4","resolved":true,"html_id":"demo-methodlines-heatbe","remote":true,"url":"/methodlines","dataUrl":"/methodlines.json","key":"NQhjNOu4VG"}],"key":"PgguKP5IhV"},{"type":"paragraph","position":{"start":{"line":239,"column":1},"end":{"line":239,"column":1}},"children":[{"type":"text","value":"Now we apply backward Euler to the heat equation. We will reuse the setup from ","position":{"start":{"line":239,"column":1},"end":{"line":239,"column":1}},"key":"bnOAhauX4b"},{"type":"crossReference","kind":"proof:example","identifier":"demo-methodlines-heatfe","label":"demo-methodlines-heatFE","children":[{"type":"text","value":"Demo ","key":"jYEWkqlqqx"},{"type":"text","value":"11.2.2","key":"TRnNookE3A"}],"template":"Example %s","enumerator":"11.2.2","resolved":true,"html_id":"demo-methodlines-heatfe","remote":true,"url":"/methodlines","dataUrl":"/methodlines.json","key":"JSLLUeiXy6"},{"type":"text","value":". Since the matrix in ","position":{"start":{"line":239,"column":1},"end":{"line":239,"column":1}},"key":"f0TnG3Dcin"},{"type":"crossReference","kind":"equation","identifier":"bexx","label":"BExx","children":[{"type":"text","value":"(","key":"uzsc5Xq1Jc"},{"type":"text","value":"11.2.7","key":"cijS8DR4lK"},{"type":"text","value":")","key":"WZcjHIBPpg"}],"template":"(%s)","enumerator":"11.2.7","resolved":true,"html_id":"bexx","remote":true,"url":"/methodlines","dataUrl":"/methodlines.json","key":"RC5DNDoY4M"},{"type":"text","value":" never changes during the time stepping, we do the necessary LU factorization only once.","position":{"start":{"line":239,"column":1},"end":{"line":239,"column":1}},"key":"yDu7rfHfJE"}],"key":"UmiRJAfJvR"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"julia","executable":true,"value":"using SparseArrays\nB = sparse(I - τ * Dxx)\nfactor = lu(B)\nfor j in 1:n\n    U[:, j+1] = factor \\ U[:, j]\nend","key":"ZBEMG4XEuM"},{"type":"output","id":"nmoL8xNrXS6L7trv7GrDR","data":[],"key":"QRDCzwl9Fw"}],"data":{},"key":"wU9pfZW2mO"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"julia","executable":true,"value":"using Plots\nidx = 1:600:n+1\ntimes = round.(t[idx], digits=4)\nlabel = reshape([\"t = $t\" for t in times], 1, length(idx))\nplot(x,U[:, idx];\n    label, legend=:topleft,\n    title=\"Heat equation by backward Euler\",\n    xaxis=(L\"x\"),  yaxis=(L\"u(x,0)\", [0, 1]))","visibility":"hide","key":"kLfxau1f2X"},{"type":"output","id":"uF1-MHU-Po--10kuuK6dA","data":[{"output_type":"execute_result","execution_count":15,"metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"251aba88a4bd8733ceebb9ca2b62d58c","path":"/fnc/build/251aba88a4bd8733ceebb9ca2b62d58c.png"},"text/html":{"content_type":"text/html","hash":"81055aa84213034119dab80c67b30c0b","path":"/fnc/build/81055aa84213034119dab80c67b30c0b.html"},"image/svg+xml":{"content_type":"image/svg+xml","hash":"29aee6f2a7f69c5d02beac4cfc6adfb1","path":"/fnc/build/29aee6f2a7f69c5d02beac4cfc6adfb1.svg"}}}],"visibility":"show","key":"B2f75uBEtA"}],"data":{"tags":[]},"visibility":"show","key":"zgWA9MLG5q"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"julia","executable":true,"value":"anim = @animate for j in 1:20:n+1\n    plot(x, U[:, j];\n    label=@sprintf(\"t=%.5f\", t[j]),\n    xaxis=(L\"x\"),  yaxis=(L\"u(x,t)\", [0, 1]),\n    dpi=150,  title=\"Heat equation by backward Euler\")\nend\nmp4(anim, \"figures/diffusionBE.mp4\")","visibility":"hide","key":"a2vAflESWM"},{"type":"output","id":"v51AQFjbJrfXReihojOyG","data":[{"output_type":"stream","name":"stderr","text":"\u001b[36m\u001b[1m[ \u001b[22m\u001b[39m\u001b[36m\u001b[1mInfo: \u001b[22m\u001b[39mSaved animation to /Users/driscoll/Dropbox/Mac/Documents/GitHub/fnc/julia/figures/diffusionBE.mp4\n"},{"output_type":"execute_result","execution_count":16,"metadata":{},"data":{"text/plain":{"content":"Plots.AnimatedGif(\"/Users/driscoll/Dropbox/Mac/Documents/GitHub/fnc/julia/figures/diffusionBE.mp4\")","content_type":"text/plain"},"text/html":{"content_type":"text/html","hash":"17e134e5b491e08434efe141c002437b","path":"/fnc/build/17e134e5b491e08434efe141c002437b.html"}}}],"visibility":"show","key":"IOVZxbMgB1"}],"data":{"tags":[]},"visibility":"show","key":"VLmNyANAwK"},{"type":"paragraph","position":{"start":{"line":273,"column":1},"end":{"line":273,"column":1}},"children":[{"type":"text","value":"This solution looks physically plausible, as the large concentration in the center diffuses outward until the solution is essentially constant. Observe that the solution remains periodic in space for all time.","position":{"start":{"line":273,"column":1},"end":{"line":273,"column":1}},"key":"aVTjtGygjm"}],"key":"g9qo12JJ8V"}],"label":"demo-methodlines-heatBE-julia","identifier":"demo-methodlines-heatbe-julia","html_id":"demo-methodlines-heatbe-julia","key":"axhSLVrGmG"},{"type":"details","children":[{"type":"summary","children":[{"type":"crossReference","identifier":"demo-methodlines-auto","label":"demo-methodlines-auto","kind":"proof:example","position":{"start":{"line":277,"column":1},"end":{"line":277,"column":23}},"children":[{"type":"text","value":"Example ","key":"XeyoxguVoC"},{"type":"text","value":"11.2.5","key":"VRHtoeoS5C"}],"template":"Example %s","enumerator":"11.2.5","resolved":true,"html_id":"demo-methodlines-auto","remote":true,"url":"/methodlines","dataUrl":"/methodlines.json","key":"JjHpldvf8v"}],"key":"rvVUHvHocK"},{"type":"paragraph","position":{"start":{"line":278,"column":1},"end":{"line":278,"column":1}},"children":[{"type":"text","value":"We set up the semidiscretization and initial condition in ","position":{"start":{"line":278,"column":1},"end":{"line":278,"column":1}},"key":"OIA7lAuo5U"},{"type":"inlineMath","value":"x","position":{"start":{"line":278,"column":1},"end":{"line":278,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>x</mi></mrow><annotation encoding=\"application/x-tex\">x</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">x</span></span></span></span>","key":"Lqur4CKQhH"},{"type":"text","value":" just as before.","position":{"start":{"line":278,"column":1},"end":{"line":278,"column":1}},"key":"i9YWi0w5eE"}],"key":"utlvDe9Baw"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"julia","executable":true,"value":"m = 100\nx, Dx, Dxx = FNC.diffper(m, [0, 1])\nu0 = @. exp( -60*(x - 0.5)^2 );","key":"Xh0VibXNzc"},{"type":"output","id":"F-0UCXkUNES5XFVozncdu","data":[],"key":"Q7fO25s99S"}],"data":{},"key":"QCslrdS08J"},{"type":"paragraph","position":{"start":{"line":286,"column":1},"end":{"line":286,"column":1}},"children":[{"type":"text","value":"Now, however, we apply ","position":{"start":{"line":286,"column":1},"end":{"line":286,"column":1}},"key":"iHk2GClewn"},{"type":"crossReference","kind":"proof:algorithm","identifier":"function-rk23","label":"function-rk23","children":[{"type":"text","value":"Function ","key":"dOe2YuAQx6"},{"type":"text","value":"6.5.2","key":"tZ4ArN4r9m"}],"template":"Algorithm %s","enumerator":"6.5.2","resolved":true,"html_id":"function-rk23","remote":true,"url":"/adaptive-rk","dataUrl":"/adaptive-rk.json","key":"h8okHsqeoL"},{"type":"text","value":" (","position":{"start":{"line":286,"column":1},"end":{"line":286,"column":1}},"key":"OIMEUf0LLq"},{"type":"inlineCode","value":"rk23","position":{"start":{"line":286,"column":1},"end":{"line":286,"column":1}},"key":"A5LGhrK42r"},{"type":"text","value":") to the initial-value problem ","position":{"start":{"line":286,"column":1},"end":{"line":286,"column":1}},"key":"j5VCL8u0fD"},{"type":"inlineMath","value":"\\mathbf{u}'=\\mathbf{D}_{xx}\\mathbf{u}","position":{"start":{"line":286,"column":1},"end":{"line":286,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msup><mi mathvariant=\"bold\">u</mi><mo mathvariant=\"normal\" lspace=\"0em\" rspace=\"0em\">′</mo></msup><mo>=</mo><msub><mi mathvariant=\"bold\">D</mi><mrow><mi>x</mi><mi>x</mi></mrow></msub><mi mathvariant=\"bold\">u</mi></mrow><annotation encoding=\"application/x-tex\">\\mathbf{u}&#x27;=\\mathbf{D}_{xx}\\mathbf{u}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.7519em;\"></span><span class=\"mord\"><span class=\"mord mathbf\">u</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.7519em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">′</span></span></span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8361em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathbf\">D</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.1514em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">xx</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mord mathbf\">u</span></span></span></span>","key":"qluB0XMVI7"},{"type":"text","value":".","position":{"start":{"line":286,"column":1},"end":{"line":286,"column":1}},"key":"APEhllm4ZE"}],"key":"Dp9x9eGEKI"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"julia","executable":true,"value":"using OrdinaryDiffEq\ntfinal = 0.25\nODE = (u, p, t) -> Dxx * u  \nIVP = ODEProblem(ODE, u0, (0, tfinal))\nt, u = FNC.rk23(IVP, 1e-5);","key":"SkVyVKTwcB"},{"type":"output","id":"qrtAyTo2rkEp5cFuKSfxA","data":[],"key":"X4BM99E268"}],"data":{},"key":"oHgV0zdZol"},{"type":"paragraph","position":{"start":{"line":296,"column":1},"end":{"line":296,"column":1}},"children":[{"type":"text","value":"We check that the resulting solution looks realistic.","position":{"start":{"line":296,"column":1},"end":{"line":296,"column":1}},"key":"Ot1Qjiajpm"}],"key":"BplWl8FeZE"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"julia","executable":true,"value":"plt = plot(\n    title=\"Heat equation by rk23\",\n    legend=:topleft,  \n    xaxis=(L\"x\"),  yaxis=(L\"u(x,0)\", [0, 1]))\nfor idx in 1:600:n+1\n    plot!(x, u[idx]; label=\"t = $(round.(t[idx], digits=4))\")\nend\nplt","visibility":"hide","key":"eQF8dskq6N"},{"type":"output","id":"nr4GAKxMSmV7QHx7KTX7y","data":[{"output_type":"execute_result","execution_count":19,"metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"d0a1f5d1d99e42b7b9453294223cdbfe","path":"/fnc/build/d0a1f5d1d99e42b7b9453294223cdbfe.png"},"text/html":{"content_type":"text/html","hash":"f10bacdaa884ac2b1968c59be29f6a39","path":"/fnc/build/f10bacdaa884ac2b1968c59be29f6a39.html"},"image/svg+xml":{"content_type":"image/svg+xml","hash":"84d3c24332c81368931a1b0efc39eb6a","path":"/fnc/build/84d3c24332c81368931a1b0efc39eb6a.svg"}}}],"visibility":"show","key":"j7aP6CpAuR"}],"data":{"tags":[]},"visibility":"show","key":"g6wvcDO6dy"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"julia","executable":true,"value":"anim = @animate for j in 1:20:1600\n    plot(x, u[j];\n    label=@sprintf(\"t=%.4f\", t[j]),\n      xaxis=(L\"x\"),  yaxis=(L\"u(x,t)\", [0, 1]),\n      dpi=150,  title=\"Heat equation by rk23\")\nend\nmp4(anim, \"figures/diffusionRK23.mp4\")","visibility":"hide","key":"YEJwA32nAq"},{"type":"output","id":"QDRIV4gzhuebMFUdpE-00","data":[{"output_type":"stream","name":"stderr","text":"\u001b[36m\u001b[1m[ \u001b[22m\u001b[39m\u001b[36m\u001b[1mInfo: \u001b[22m\u001b[39mSaved animation to /Users/driscoll/Dropbox/Mac/Documents/GitHub/fnc/julia/figures/diffusionRK23.mp4\n"},{"output_type":"execute_result","execution_count":20,"metadata":{},"data":{"text/plain":{"content":"Plots.AnimatedGif(\"/Users/driscoll/Dropbox/Mac/Documents/GitHub/fnc/julia/figures/diffusionRK23.mp4\")","content_type":"text/plain"},"text/html":{"content_type":"text/html","hash":"e4d81f1cf5b98dcf6e80dc37d79537eb","path":"/fnc/build/e4d81f1cf5b98dcf6e80dc37d79537eb.html"}}}],"visibility":"show","key":"a1JCblolFr"}],"data":{"tags":[]},"visibility":"show","key":"rtrYfqNNbS"},{"type":"paragraph","position":{"start":{"line":321,"column":1},"end":{"line":321,"column":1}},"children":[{"type":"text","value":"The solution appears to be correct. But the number of time steps that were selected automatically is surprisingly large, considering how smoothly the solution changes.","position":{"start":{"line":321,"column":1},"end":{"line":321,"column":1}},"key":"lIGfoBN6Eg"}],"key":"ywVw6PzPF2"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"julia","executable":true,"value":"println(\"Number of time steps for rk23: $(length(t)-1)\")","key":"IRKWrgjmSj"},{"type":"output","id":"eHw7o8Pji-GlK2pJiqvU3","data":[{"output_type":"stream","name":"stdout","text":"Number of time steps for rk23: 3975\n"}],"key":"VhtvE1Whgw"}],"data":{},"key":"LwOt97usoV"},{"type":"paragraph","position":{"start":{"line":327,"column":1},"end":{"line":327,"column":1}},"children":[{"type":"text","value":"Now we apply a solver from ","position":{"start":{"line":327,"column":1},"end":{"line":327,"column":1}},"key":"kSHQwBqfSZ"},{"type":"inlineCode","value":"DifferentialEquations","position":{"start":{"line":327,"column":1},"end":{"line":327,"column":1}},"key":"mJGE34pYOs"},{"type":"text","value":".","position":{"start":{"line":327,"column":1},"end":{"line":327,"column":1}},"key":"tJXF0x7iM9"}],"key":"qemLsjJOjP"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"julia","executable":true,"value":"u = solve(IVP, Rodas4P());\nprintln(\"Number of time steps for Rodas4P: $(length(u.t) - 1)\")","key":"lNVwgAAbqY"},{"type":"output","id":"rnl2uaqN_t4VOp5AG7wtE","data":[{"output_type":"stream","name":"stdout","text":"Number of time steps for Rodas4P: 23\n"}],"key":"MXXiTOQIKZ"}],"data":{},"key":"cK78C7y6gc"},{"type":"paragraph","position":{"start":{"line":334,"column":1},"end":{"line":334,"column":1}},"children":[{"type":"text","value":"The number of steps selected is reduced by a factor of more than 100!","position":{"start":{"line":334,"column":1},"end":{"line":334,"column":1}},"key":"piOjPhHSvc"}],"key":"jvu4gRNud4"}],"label":"demo-methodlines-auto-julia","identifier":"demo-methodlines-auto-julia","html_id":"demo-methodlines-auto-julia","key":"bkBj5QsPwR"},{"type":"heading","depth":3,"position":{"start":{"line":337,"column":1},"end":{"line":337,"column":1}},"children":[{"type":"text","value":"11.3 ","position":{"start":{"line":337,"column":1},"end":{"line":337,"column":1}},"key":"dfljnPiGTm"},{"type":"link","identifier":"section-diffusion-absstab","label":"section-diffusion-absstab","kind":"narrative","position":{"start":{"line":337,"column":6},"end":{"line":337,"column":32}},"url":"/absstab-diffusion","internal":true,"dataUrl":"/absstab-diffusion.json","children":[{"type":"text","value":"Absolute stability","key":"JZYUp0i9SJ"}],"key":"MAk0SGGfDs"}],"identifier":"id-11-3","label":"11.3 ","html_id":"id-11-3","implicit":true,"key":"NNHURr07O8"},{"type":"details","children":[{"type":"summary","children":[{"type":"crossReference","identifier":"demo-absstab-regions","label":"demo-absstab-regions","kind":"proof:example","position":{"start":{"line":340,"column":1},"end":{"line":340,"column":22}},"children":[{"type":"text","value":"Example ","key":"i8KNNbSMSw"},{"type":"text","value":"11.3.5","key":"aOfnIorYvJ"}],"template":"Example %s","enumerator":"11.3.5","resolved":true,"html_id":"demo-absstab-regions","remote":true,"url":"/absstab-diffusion","dataUrl":"/absstab-diffusion.json","key":"DEvhHUi9Tf"}],"key":"nsBN5BfIFx"},{"type":"paragraph","position":{"start":{"line":341,"column":1},"end":{"line":341,"column":1}},"children":[{"type":"text","value":"Euler and Backward Euler time-stepping methods were used to solve ","position":{"start":{"line":341,"column":1},"end":{"line":341,"column":1}},"key":"FpK70D6BNA"},{"type":"inlineMath","value":"\\mathbf{u}'=\\mathbf{D}_{xx}\\mathbf{u}","position":{"start":{"line":341,"column":1},"end":{"line":341,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msup><mi mathvariant=\"bold\">u</mi><mo mathvariant=\"normal\" lspace=\"0em\" rspace=\"0em\">′</mo></msup><mo>=</mo><msub><mi mathvariant=\"bold\">D</mi><mrow><mi>x</mi><mi>x</mi></mrow></msub><mi mathvariant=\"bold\">u</mi></mrow><annotation encoding=\"application/x-tex\">\\mathbf{u}&#x27;=\\mathbf{D}_{xx}\\mathbf{u}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.7519em;\"></span><span class=\"mord\"><span class=\"mord mathbf\">u</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.7519em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">′</span></span></span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8361em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathbf\">D</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.1514em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">xx</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mord mathbf\">u</span></span></span></span>","key":"MMATLMEjrg"},{"type":"text","value":".","position":{"start":{"line":341,"column":1},"end":{"line":341,"column":1}},"key":"Ayz7uDFzoS"}],"key":"LSqLSHL3fo"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"julia","executable":true,"value":"m = 40\n_, _, Dₓₓ = FNC.diffper(m, [0, 1]);","key":"Qvi0y1QnqB"},{"type":"output","id":"Ps8ScYeS_76Vg-Yxk6cBK","data":[],"key":"OOCy24lHFg"}],"data":{},"key":"vdZ42y9CF2"},{"type":"paragraph","position":{"start":{"line":348,"column":1},"end":{"line":348,"column":1}},"children":[{"type":"text","value":"The eigenvalues of this matrix are real and negative:","position":{"start":{"line":348,"column":1},"end":{"line":348,"column":1}},"key":"N0E49ClPJX"}],"key":"j55fzebdaR"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"julia","executable":true,"value":"using Plots\nλ = eigvals(Dₓₓ)\nscatter(real(λ), imag(λ);\n    title=\"Eigenvalues\",\n    frame=:zerolines,  aspect_ratio=1,\n    xaxis=(\"Re λ\"),  yaxis=(\"Im λ\", (-1000, 1000)))","key":"BeCAgq243J"},{"type":"output","id":"Vrle3-q4ChBSFQzr_ea4X","data":[{"output_type":"execute_result","execution_count":24,"metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"d999635e204034b5e60c3528772af4ae","path":"/fnc/build/d999635e204034b5e60c3528772af4ae.png"},"text/html":{"content_type":"text/html","hash":"d500cfcf9800fc0a6a974b1626b232af","path":"/fnc/build/d500cfcf9800fc0a6a974b1626b232af.html"},"image/svg+xml":{"content_type":"image/svg+xml","hash":"a6e197e6f0452e3066e3d0c7aef3b741","path":"/fnc/build/a6e197e6f0452e3066e3d0c7aef3b741.svg"}}}],"key":"Tut3ODmB4m"}],"data":{},"key":"geiAs81pmm"},{"type":"paragraph","position":{"start":{"line":359,"column":1},"end":{"line":359,"column":1}},"children":[{"type":"text","value":"The Euler method is absolutely stable in the region ","position":{"start":{"line":359,"column":1},"end":{"line":359,"column":1}},"key":"rWQqcuXznH"},{"type":"inlineMath","value":"|\\zeta+1| \\le 1","position":{"start":{"line":359,"column":1},"end":{"line":359,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi mathvariant=\"normal\">∣</mi><mi>ζ</mi><mo>+</mo><mn>1</mn><mi mathvariant=\"normal\">∣</mi><mo>≤</mo><mn>1</mn></mrow><annotation encoding=\"application/x-tex\">|\\zeta+1| \\le 1</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord\">∣</span><span class=\"mord mathnormal\" style=\"margin-right:0.07378em;\">ζ</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord\">1∣</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">1</span></span></span></span>","key":"MQ3L9QawGa"},{"type":"text","value":" in the complex plane:","position":{"start":{"line":359,"column":1},"end":{"line":359,"column":1}},"key":"BthPEMmieu"}],"key":"jKdd5Xwgdo"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"julia","executable":true,"value":"phi = 2π * (0:360) / 360\nz = @. cis(phi) - 1;    # unit circle shifted to the left by 1\n\nplot(Shape(real(z), imag(z));\n    color=RGB(.8, .8, 1),\n    xaxis=(\"Re ζ\"),  yaxis=(\"Im ζ\"),\n    aspect_ratio=1,  frame=:zerolines,\n    title=\"Stability region\")","visibility":"hide","key":"Ow8zLjgbB6"},{"type":"output","id":"ptMkLPvDVoZ0B939i-9RJ","data":[{"output_type":"execute_result","execution_count":25,"metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"94eaec565a1c974251dda4107ea42cd0","path":"/fnc/build/94eaec565a1c974251dda4107ea42cd0.png"},"text/html":{"content_type":"text/html","hash":"e73d58c5af0e654ca911e97eea807291","path":"/fnc/build/e73d58c5af0e654ca911e97eea807291.html"},"image/svg+xml":{"content_type":"image/svg+xml","hash":"67d5121383191fe26724e496cef31fa2","path":"/fnc/build/67d5121383191fe26724e496cef31fa2.svg"}}}],"visibility":"show","key":"B2bciogqfE"}],"data":{"tags":[]},"visibility":"show","key":"zltQa07uXX"},{"type":"paragraph","position":{"start":{"line":373,"column":1},"end":{"line":373,"column":1}},"children":[{"type":"text","value":"In order to get inside this region, we have to find ","position":{"start":{"line":373,"column":1},"end":{"line":373,"column":1}},"key":"qslex9VRfJ"},{"type":"text","value":"τ","position":{"start":{"line":373,"column":1},"end":{"line":373,"column":1}},"key":"sD2fJs4UV5"},{"type":"text","value":" such that ","position":{"start":{"line":373,"column":1},"end":{"line":373,"column":1}},"key":"but6a6Btyj"},{"type":"inlineMath","value":"\\lambda \\tau > -2","position":{"start":{"line":373,"column":1},"end":{"line":373,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>λ</mi><mi>τ</mi><mo>&gt;</mo><mo>−</mo><mn>2</mn></mrow><annotation encoding=\"application/x-tex\">\\lambda \\tau &gt; -2</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.7335em;vertical-align:-0.0391em;\"></span><span class=\"mord mathnormal\">λ</span><span class=\"mord mathnormal\" style=\"margin-right:0.1132em;\">τ</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">&gt;</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.7278em;vertical-align:-0.0833em;\"></span><span class=\"mord\">−</span><span class=\"mord\">2</span></span></span></span>","key":"uxRQwUbROT"},{"type":"text","value":" for all eigenvalues ","position":{"start":{"line":373,"column":1},"end":{"line":373,"column":1}},"key":"sqJfOJRbLa"},{"type":"text","value":"λ","position":{"start":{"line":373,"column":1},"end":{"line":373,"column":1}},"key":"jyozQMGkLM"},{"type":"text","value":". This is an upper bound on ","position":{"start":{"line":373,"column":1},"end":{"line":373,"column":1}},"key":"BlVJwJhEFl"},{"type":"text","value":"τ","position":{"start":{"line":373,"column":1},"end":{"line":373,"column":1}},"key":"CG7UhhCgtx"},{"type":"text","value":".","position":{"start":{"line":373,"column":1},"end":{"line":373,"column":1}},"key":"DAJAHbUFDp"}],"key":"TMS5QuP99N"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"julia","executable":true,"value":"λ_min = minimum(λ)\n@show max_τ = -2 / λ_min;","key":"YMyi9MWTnc"},{"type":"output","id":"xT5WN-hRqeyrPO32c5O_h","data":[{"output_type":"stream","name":"stdout","text":"max_τ = -2 / λ_min = 0.0003125000000000001"},{"output_type":"stream","name":"stdout","text":"\n"}],"key":"VEsopJnvXH"}],"data":{},"key":"F1szcTkjqI"},{"type":"paragraph","position":{"start":{"line":380,"column":1},"end":{"line":380,"column":1}},"children":[{"type":"text","value":"Here we plot the resulting values of ","position":{"start":{"line":380,"column":1},"end":{"line":380,"column":1}},"key":"Af8T9S1O0T"},{"type":"inlineMath","value":"\\zeta=\\lambda \\tau","position":{"start":{"line":380,"column":1},"end":{"line":380,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>ζ</mi><mo>=</mo><mi>λ</mi><mi>τ</mi></mrow><annotation encoding=\"application/x-tex\">\\zeta=\\lambda \\tau</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8889em;vertical-align:-0.1944em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.07378em;\">ζ</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6944em;\"></span><span class=\"mord mathnormal\">λ</span><span class=\"mord mathnormal\" style=\"margin-right:0.1132em;\">τ</span></span></span></span>","key":"ZaLn54n8Ue"},{"type":"text","value":".","position":{"start":{"line":380,"column":1},"end":{"line":380,"column":1}},"key":"KwA9QkKohc"}],"key":"I50UFRKx0A"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"julia","executable":true,"value":"ζ = λ * max_τ\nscatter!(real(ζ), imag(ζ), title=\"Stability region and ζ values\")","key":"EzgzuhHHKN"},{"type":"output","id":"4FGC63yZsYprYnvWKdyl4","data":[{"output_type":"execute_result","execution_count":27,"metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"58e47c5a143f960c2db8510746b60bf1","path":"/fnc/build/58e47c5a143f960c2db8510746b60bf1.png"},"text/html":{"content_type":"text/html","hash":"d6d50bb440751d6a7c5ad5535735956a","path":"/fnc/build/d6d50bb440751d6a7c5ad5535735956a.html"},"image/svg+xml":{"content_type":"image/svg+xml","hash":"960e84656ee0f50175c28765e29cdc5a","path":"/fnc/build/960e84656ee0f50175c28765e29cdc5a.svg"}}}],"key":"TYK4OwKpfn"}],"data":{},"key":"l8oB6ZGCRu"},{"type":"paragraph","position":{"start":{"line":387,"column":1},"end":{"line":387,"column":1}},"children":[{"type":"text","value":"In backward Euler, the region is ","position":{"start":{"line":387,"column":1},"end":{"line":387,"column":1}},"key":"wOiQpeoGYa"},{"type":"inlineMath","value":"|\\zeta-1|\\ge 1","position":{"start":{"line":387,"column":1},"end":{"line":387,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi mathvariant=\"normal\">∣</mi><mi>ζ</mi><mo>−</mo><mn>1</mn><mi mathvariant=\"normal\">∣</mi><mo>≥</mo><mn>1</mn></mrow><annotation encoding=\"application/x-tex\">|\\zeta-1|\\ge 1</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord\">∣</span><span class=\"mord mathnormal\" style=\"margin-right:0.07378em;\">ζ</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord\">1∣</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">≥</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">1</span></span></span></span>","key":"uJDfK5qZ5k"},{"type":"text","value":". Because they are all on the negative real axis, all of the ","position":{"start":{"line":387,"column":1},"end":{"line":387,"column":1}},"key":"y9Wlu3xPWt"},{"type":"text","value":"ζ","position":{"start":{"line":387,"column":1},"end":{"line":387,"column":1}},"key":"tWiGLRafDj"},{"type":"text","value":" values will fit no matter what ","position":{"start":{"line":387,"column":1},"end":{"line":387,"column":1}},"key":"b7sFy5b2aj"},{"type":"text","value":"τ","position":{"start":{"line":387,"column":1},"end":{"line":387,"column":1}},"key":"hV5jdG2ekd"},{"type":"text","value":" is chosen.","position":{"start":{"line":387,"column":1},"end":{"line":387,"column":1}},"key":"NjIEZuzKVc"}],"key":"QYecrBwbCs"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"julia","executable":true,"value":"plot(Shape([-6, 6, 6, -6], [-6, -6, 6, 6]), color=RGB(.8, .8, 1))\nz = @. cis(phi) + 1;   # unit circle shifted right by 1\nplot!(Shape(real(z), imag(z)), color=:white)\n\nscatter!(real(ζ), imag(ζ);\n    xaxis=([-4, 2], \"Re ζ\"),  yaxis=([-3, 3], \"Im ζ\"),\n    aspect_ratio=1,  frame=:zerolines,\n    title=\"Stability region and ζ values\")","visibility":"hide","key":"nniX3AoVVk"},{"type":"output","id":"KFXCU1nW9jejHHifsZyg0","data":[{"output_type":"execute_result","execution_count":28,"metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"fea4526ce9de51afde7d2a84ef41d679","path":"/fnc/build/fea4526ce9de51afde7d2a84ef41d679.png"},"text/html":{"content_type":"text/html","hash":"0ab0a3c0e756214ba63307acd5aab9a9","path":"/fnc/build/0ab0a3c0e756214ba63307acd5aab9a9.html"},"image/svg+xml":{"content_type":"image/svg+xml","hash":"bff8261b82c3d55f8305f28f3550c616","path":"/fnc/build/bff8261b82c3d55f8305f28f3550c616.svg"}}}],"visibility":"show","key":"aDWbUaeXB0"}],"data":{"tags":[]},"visibility":"show","key":"ttytuDm1D1"}],"label":"demo-absstab-regions-julia","identifier":"demo-absstab-regions-julia","html_id":"demo-absstab-regions-julia","key":"zGXWs3smwc"},{"type":"heading","depth":3,"position":{"start":{"line":402,"column":1},"end":{"line":402,"column":1}},"children":[{"type":"text","value":"11.4 ","position":{"start":{"line":402,"column":1},"end":{"line":402,"column":1}},"key":"rTNZ20wIGz"},{"type":"link","identifier":"section-diffusion-stiffness","label":"section-diffusion-stiffness","kind":"narrative","position":{"start":{"line":402,"column":6},"end":{"line":402,"column":34}},"url":"/stiffness","internal":true,"dataUrl":"/stiffness.json","children":[{"type":"text","value":"Stiffness","key":"EQ8EiXPioK"}],"key":"po2GZvNVxB"}],"identifier":"id-11-4","label":"11.4 ","html_id":"id-11-4","implicit":true,"key":"VxEd3Ab1TF"},{"type":"details","children":[{"type":"summary","children":[{"type":"crossReference","identifier":"demo-stiffness-oregon","label":"demo-stiffness-oregon","kind":"proof:example","position":{"start":{"line":405,"column":1},"end":{"line":405,"column":23}},"children":[{"type":"text","value":"Example ","key":"kur65k5hy0"},{"type":"text","value":"11.4.2","key":"F0oGlG0n7Q"}],"template":"Example %s","enumerator":"11.4.2","resolved":true,"html_id":"demo-stiffness-oregon","remote":true,"url":"/stiffness","dataUrl":"/stiffness.json","key":"aXqNRd45by"}],"key":"fwNICHhdzE"},{"type":"paragraph","position":{"start":{"line":406,"column":1},"end":{"line":406,"column":1}},"children":[{"type":"text","value":"In ","position":{"start":{"line":406,"column":1},"end":{"line":406,"column":1}},"key":"GPGrF3NVeN"},{"type":"crossReference","kind":"proof:example","identifier":"example-stiffness-oregon","label":"example-stiffness-oregon","children":[{"type":"text","value":"Example ","key":"NiSFiSo61Y"},{"type":"text","value":"11.4.1","key":"XpEgey9bfh"}],"template":"Example %s","enumerator":"11.4.1","resolved":true,"html_id":"example-stiffness-oregon","remote":true,"url":"/stiffness","dataUrl":"/stiffness.json","key":"ZG5yBPKKRz"},{"type":"text","value":" we derived a Jacobian matrix for the Oregonator model. Here is a numerical solution of the ","key":"Fg8Q3NsRQ0"},{"type":"abbreviation","title":"ordinary differential equation","children":[{"type":"text","value":"ODE","key":"LRIIq7iduO"}],"key":"aHQeOHJg3P"},{"type":"text","value":".","key":"BEkxEWhQgd"}],"key":"scQWPG26db"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"julia","executable":true,"value":"using OrdinaryDiffEq, Plots\nfunction ode(u,p,t)\n    s,w,q = p\n    f = [ \n        s * ( u[2]*(1 - u[1]) + u[1]*(1 - q*u[1]) ),\n        (u[3] - u[2] - u[1] * u[2]) / s,   \n        w * (u[1] - u[3])\n        ]\n    return f\nend\ns, w, q = (77.27, .161, 8.375e-6)\noregon = ODEProblem(ode, [1., 2, 3], (0., 500.), [s, w, q])\nsol = solve(oregon)\nplot(sol, yscale=:log10, legend=:none, title=\"Solution of the Oregonator\")","visibility":"hide","key":"RP7Ydc4ZZ5"},{"type":"output","id":"55MLk4-clO2_iDmrCAnEG","data":[{"output_type":"execute_result","execution_count":29,"metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"7a2c719d8c3d5d1eb90ed414cf45e906","path":"/fnc/build/7a2c719d8c3d5d1eb90ed414cf45e906.png"},"text/html":{"content_type":"text/html","hash":"c8d476618d67f309a7443bc8e20930d4","path":"/fnc/build/c8d476618d67f309a7443bc8e20930d4.html"},"image/svg+xml":{"content_type":"image/svg+xml","hash":"6de7ae8150fd73c58a86aa5e97af7bab","path":"/fnc/build/6de7ae8150fd73c58a86aa5e97af7bab.svg"}}}],"visibility":"show","key":"TnHnSDct1v"}],"data":{"tags":[]},"visibility":"show","key":"sEGHL3Pjk7"},{"type":"paragraph","position":{"start":{"line":426,"column":1},"end":{"line":426,"column":1}},"children":[{"type":"text","value":"At each value of the numerical solution, we can compute the eigenvalues of the Jacobian. Here we plot all of those eigenvalues in the complex plane.","position":{"start":{"line":426,"column":1},"end":{"line":426,"column":1}},"key":"dhN6RqIgee"}],"key":"hxEWa5FgWy"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"julia","executable":true,"value":"t,u = sol.t[1:2:end], sol.u[1:2:end]\nλ = fill(0.0im, length(t), 3)\nfor (k, u) in enumerate(u)\n    J = [\n    s*(1-u[2]-2q*u[1]) s*(1-u[1])        0 \n         -u[2]/s       -(1+u[1])/s     1/s \n            w               0           -w\n        ]\n    λ[k, :] .= eigvals(J)\nend\n\nscatter(real(λ), imag(λ), t;\n    xaxis=(\"Re(λ)\", 25000*(-5:2:-1)),  ylabel=\"Im(λ)\",  zlabel=\"t\",\n    title=\"Oregonator eigenvalues\")","visibility":"hide","key":"NGqVmgsBOF"},{"type":"output","id":"i03dVUhPsI1f8UsmyrMDU","data":[{"output_type":"execute_result","execution_count":30,"metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"4745dc62b5fc61c980f1906cb0eff230","path":"/fnc/build/4745dc62b5fc61c980f1906cb0eff230.png"},"text/html":{"content_type":"text/html","hash":"442cc9f588f6d14afc326995fc16dad4","path":"/fnc/build/442cc9f588f6d14afc326995fc16dad4.html"},"image/svg+xml":{"content_type":"image/svg+xml","hash":"df9b4473f779ddd7ad9a43e0562bb3c9","path":"/fnc/build/df9b4473f779ddd7ad9a43e0562bb3c9.svg"}}}],"visibility":"show","key":"d6bWy3sRgl"}],"data":{"tags":[]},"visibility":"show","key":"CQpTVwT4u0"},{"type":"paragraph","position":{"start":{"line":446,"column":1},"end":{"line":446,"column":1}},"children":[{"type":"text","value":"You can see that there is one eigenvalue that ranges over a wide portion of the negative real axis and dominates stability considerations.","position":{"start":{"line":446,"column":1},"end":{"line":446,"column":1}},"key":"xAdswA0aTP"}],"key":"edJ0b2BEAG"}],"label":"demo-stiffness-oregon-julia","identifier":"demo-stiffness-oregon-julia","html_id":"demo-stiffness-oregon-julia","key":"Z5QxUdNMSB"},{"type":"details","children":[{"type":"summary","children":[{"type":"crossReference","identifier":"demo-stiffness-explicit","label":"demo-stiffness-explicit","kind":"proof:example","position":{"start":{"line":450,"column":1},"end":{"line":450,"column":25}},"children":[{"type":"text","value":"Example ","key":"LAfOmSRwit"},{"type":"text","value":"11.4.3","key":"QxfoeYRRRO"}],"template":"Example %s","enumerator":"11.4.3","resolved":true,"html_id":"demo-stiffness-explicit","remote":true,"url":"/stiffness","dataUrl":"/stiffness.json","key":"cQB6gwe0DY"}],"key":"Q02UkwPlMe"},{"type":"paragraph","position":{"start":{"line":451,"column":1},"end":{"line":451,"column":1}},"children":[{"type":"text","value":"The ","position":{"start":{"line":451,"column":1},"end":{"line":451,"column":1}},"key":"lTULrKKoHq"},{"type":"inlineCode","value":"Rodas4P","position":{"start":{"line":451,"column":1},"end":{"line":451,"column":1}},"key":"XuixE0VOzi"},{"type":"text","value":" solver is good for stiff problems, and needs few time steps to solve the Oregonator from ","position":{"start":{"line":451,"column":1},"end":{"line":451,"column":1}},"key":"lTXPAhQW0q"},{"type":"crossReference","kind":"proof:example","identifier":"demo-stiffness-oregon","label":"demo-stiffness-oregon","children":[{"type":"text","value":"Demo ","key":"QJbiOBIMYN"},{"type":"text","value":"11.4.2","key":"XoEXgeGMWV"}],"template":"Example %s","enumerator":"11.4.2","resolved":true,"html_id":"demo-stiffness-oregon","remote":true,"url":"/stiffness","dataUrl":"/stiffness.json","key":"EFhLVi8CE9"},{"type":"text","value":".","position":{"start":{"line":451,"column":1},"end":{"line":451,"column":1}},"key":"Z7IbasdzcD"}],"key":"epC6MHFjW8"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"julia","executable":true,"value":"oregon = remake(oregon, tspan=(0., 25.))\nsol = solve(oregon, Rodas4P())\nprintln(\"Number of time steps for Rodas4P: $(length(sol.t) - 1)\")","key":"nrhNDsaFIe"},{"type":"output","id":"roHGM6fbUNRGfJlXE3NaS","data":[{"output_type":"stream","name":"stdout","text":"Number of time steps for Rodas4P: 127\n"}],"key":"trCmMV2hC4"}],"data":{},"key":"QoyYQZ0tar"},{"type":"paragraph","position":{"start":{"line":459,"column":1},"end":{"line":459,"column":1}},"children":[{"type":"text","value":"But if we apply ","position":{"start":{"line":459,"column":1},"end":{"line":459,"column":1}},"key":"E7DH23bdbE"},{"type":"crossReference","kind":"proof:algorithm","identifier":"function-rk23","label":"function-rk23","children":[{"type":"text","value":"Function ","key":"aqM5Gf3qpa"},{"type":"text","value":"6.5.2","key":"e1tEb1bAtj"}],"template":"Algorithm %s","enumerator":"6.5.2","resolved":true,"html_id":"function-rk23","remote":true,"url":"/adaptive-rk","dataUrl":"/adaptive-rk.json","key":"VKM1XyyCC1"},{"type":"text","value":" to the problem, the step size will be made small enough to cope with the large negative eigenvalue.","position":{"start":{"line":459,"column":1},"end":{"line":459,"column":1}},"key":"sjcYNbOkSf"}],"key":"uQTSDcbJqy"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"julia","executable":true,"value":"t,u = FNC.rk23(oregon,1e-4)\nprintln(\"Number of time steps for RK23: $(length(t) - 1)\")","key":"IGEom8ltCg"},{"type":"output","id":"D2sAB40qpVyENJQagl7s2","data":[{"output_type":"stream","name":"stdout","text":"Number of time steps for RK23: 20773\n"}],"key":"uxgwjexgaR"}],"data":{},"key":"K68DBbAId7"},{"type":"paragraph","position":{"start":{"line":466,"column":1},"end":{"line":466,"column":1}},"children":[{"type":"text","value":"Starting from the eigenvalues of the Jacobian matrix, we can find an effective ","position":{"start":{"line":466,"column":1},"end":{"line":466,"column":1}},"key":"cmf84HcDWT"},{"type":"inlineMath","value":"\\zeta(t)","position":{"start":{"line":466,"column":1},"end":{"line":466,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>ζ</mi><mo stretchy=\"false\">(</mo><mi>t</mi><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">\\zeta(t)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.07378em;\">ζ</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">t</span><span class=\"mclose\">)</span></span></span></span>","key":"aFEGRyhVCT"},{"type":"text","value":" by multiplying with the local time step size. The values of ","position":{"start":{"line":466,"column":1},"end":{"line":466,"column":1}},"key":"wrKdkWO7F2"},{"type":"inlineMath","value":"\\zeta(t)","position":{"start":{"line":466,"column":1},"end":{"line":466,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>ζ</mi><mo stretchy=\"false\">(</mo><mi>t</mi><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">\\zeta(t)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.07378em;\">ζ</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">t</span><span class=\"mclose\">)</span></span></span></span>","key":"EmfNySzGrE"},{"type":"text","value":" for each time level are plotted below and color coded by component of the diagonalized system.","position":{"start":{"line":466,"column":1},"end":{"line":466,"column":1}},"key":"ldFfQaxgtf"}],"key":"jlPEXvcmAi"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"julia","executable":true,"value":"λ = fill(1.0im, length(t),3)\nfor (k, u) in enumerate(u)\n    J = [\n    s*(1-u[2]-2q*u[1]) s*(1-u[1])        0 \n         -u[2]/s       -(1+u[1])/s     1/s \n            w               0           -w\n        ]\n    λ[k, :] .= eigvals(J)\nend\n\nζ = diff(t) .* λ[1:end-1,:]\nscatter(real(ζ), imag(ζ), m=2,\n    xlabel=\"Re(ζ)\",  ylabel=\"Im(ζ)\",\n    title=\"Oregonator stability\")","visibility":"hide","key":"wnjbyP2DtU"},{"type":"output","id":"f7kj9sRKCHbhUE7fiKCPO","data":[{"output_type":"execute_result","execution_count":33,"metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"9d71b60212fa64075d1840a004f7f66f","path":"/fnc/build/9d71b60212fa64075d1840a004f7f66f.png"},"text/html":{"content_type":"text/html","hash":"c29cd1430c997a453bba68c093fa9627","path":"/fnc/build/c29cd1430c997a453bba68c093fa9627.html"},"image/svg+xml":{"content_type":"image/svg+xml","hash":"f159b81054bacf2b55b512c64d3200eb","path":"/fnc/build/f159b81054bacf2b55b512c64d3200eb.svg"}}}],"visibility":"show","key":"IPFvtJAqHh"}],"data":{"tags":[]},"visibility":"show","key":"dSnKLL0oQr"},{"type":"paragraph","position":{"start":{"line":486,"column":1},"end":{"line":486,"column":1}},"children":[{"type":"text","value":"Roughly speaking, the ","position":{"start":{"line":486,"column":1},"end":{"line":486,"column":1}},"key":"fF31UZwaOe"},{"type":"text","value":"ζ","position":{"start":{"line":486,"column":1},"end":{"line":486,"column":1}},"key":"tw08vyWlyz"},{"type":"text","value":" values stay within or close to the RK2 stability region in ","position":{"start":{"line":486,"column":1},"end":{"line":486,"column":1}},"key":"E9YRdvd8Ql"},{"type":"crossReference","kind":"figure","identifier":"figure-stabreg_bd_rk","label":"figure-stabreg_bd_rk","children":[{"type":"text","value":"Figure ","key":"qOV9fRxAPo"},{"type":"text","value":"11.3.2","key":"InImw2BQCi"}],"template":"Figure %s","enumerator":"11.3.2","resolved":true,"html_id":"figure-stabreg-bd-rk","remote":true,"url":"/absstab-diffusion","dataUrl":"/absstab-diffusion.json","key":"YRNEpNpQcB"},{"type":"text","value":". Momentary departures from the region are possible, but time stepping repeatedly in that situation would cause instability.","position":{"start":{"line":486,"column":1},"end":{"line":486,"column":1}},"key":"QwNZZPdxlB"}],"key":"j5opo1qRff"}],"label":"demo-stiffness-explicit-julia","identifier":"demo-stiffness-explicit-julia","html_id":"demo-stiffness-explicit-julia","key":"n0yztbNO3B"},{"type":"heading","depth":3,"position":{"start":{"line":490,"column":1},"end":{"line":490,"column":1}},"children":[{"type":"text","value":"11.5 ","position":{"start":{"line":490,"column":1},"end":{"line":490,"column":1}},"key":"dpZZe0Hjd1"},{"type":"link","identifier":"section-diffusion-boundaries","label":"section-diffusion-boundaries","kind":"narrative","position":{"start":{"line":490,"column":6},"end":{"line":490,"column":35}},"url":"/boundaries","internal":true,"dataUrl":"/boundaries.json","children":[{"type":"text","value":"Boundaries","key":"pb9dlwbOkp"}],"key":"kxUGuP7WGg"}],"identifier":"id-11-5","label":"11.5 ","html_id":"id-11-5","implicit":true,"key":"dQJNi5URiV"},{"type":"details","children":[{"type":"summary","children":[{"type":"crossReference","identifier":"demo-boundaries-heat","label":"demo-boundaries-heat","kind":"proof:example","position":{"start":{"line":493,"column":1},"end":{"line":493,"column":22}},"children":[{"type":"text","value":"Example ","key":"u7JQIvoMqj"},{"type":"text","value":"11.5.3","key":"trzq8cCTpZ"}],"template":"Example %s","enumerator":"11.5.3","resolved":true,"html_id":"demo-boundaries-heat","remote":true,"url":"/boundaries","dataUrl":"/boundaries.json","key":"CiWaXf5ioy"}],"key":"P4E04GVE2w"},{"type":"paragraph","position":{"start":{"line":494,"column":1},"end":{"line":494,"column":1}},"children":[{"type":"text","value":"First, we define functions for the ","key":"N81ImIPRHz"},{"type":"abbreviation","title":"partial differential equation","children":[{"type":"text","value":"PDE","key":"H9PwdJu6yC"}],"key":"EZG06Ubt0A"},{"type":"text","value":" and each boundary condition.","key":"l87TAdcfgM"}],"key":"gBQsUnjyR1"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"julia","executable":true,"value":"ϕ = (t, x, u, uₓ, uₓₓ) -> uₓₓ\ng₁ = (u, uₓ) -> u\ng₂ = (u, uₓ) -> u - 2;","key":"nB2P0F3Y6T"},{"type":"output","id":"0hnz7xEGu1Z12772S8I-g","data":[],"key":"b1ygtLQTdt"}],"data":{},"key":"J5I8JhFGEd"},{"type":"paragraph","position":{"start":{"line":502,"column":1},"end":{"line":502,"column":1}},"children":[{"type":"text","value":"Our next step is to write a function to define the initial condition. This one satisfies the boundary conditions exactly.","position":{"start":{"line":502,"column":1},"end":{"line":502,"column":1}},"key":"viSCLqMmg7"}],"key":"DHUKqxuEhO"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"julia","executable":true,"value":"init = x -> 1 + sinpi(x/2) + 3 * (1-x^2) * exp(-4x^2);","key":"Vk2KPS37Xd"},{"type":"output","id":"3Cg6TFQWVw8zEL2fXtood","data":[],"key":"Uxi2I3tMi3"}],"data":{},"key":"sZwcEExJNq"},{"type":"paragraph","position":{"start":{"line":508,"column":1},"end":{"line":508,"column":1}},"children":[{"type":"text","value":"Now we can use ","position":{"start":{"line":508,"column":1},"end":{"line":508,"column":1}},"key":"pBKsweUlDc"},{"type":"crossReference","kind":"proof:algorithm","identifier":"function-parabolic","label":"function-parabolic","children":[{"type":"text","value":"Function ","key":"AysuOASrj0"},{"type":"text","value":"11.5.2","key":"olSDH6tqk1"}],"template":"Algorithm %s","enumerator":"11.5.2","resolved":true,"html_id":"function-parabolic","remote":true,"url":"/boundaries","dataUrl":"/boundaries.json","key":"f3RT7I5M5E"},{"type":"text","value":" to solve the problem.","position":{"start":{"line":508,"column":1},"end":{"line":508,"column":1}},"key":"Fdb4EqJ0es"}],"key":"PIFDLuFiyy"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"julia","executable":true,"value":"using Plots\nx, u = FNC.parabolic(ϕ, (-1, 1), 60, g₁, g₂, (0, 0.75), init)\nplt = plot(\n    xlabel=L\"x\",  ylabel=L\"u(x,t)\",\n    legend=:topleft,  title=\"Solution of the heat equation\")\nfor t in 0:0.1:0.4\n    plot!(x, u(t), label=@sprintf(\"t=%.2f\", t))\nend\nplt","key":"Bp8lXSqju2"},{"type":"output","id":"8KbQ434cTKnP-6RsUT72Y","data":[{"output_type":"execute_result","execution_count":36,"metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"eef350b8cd29691420d5ac95850034ba","path":"/fnc/build/eef350b8cd29691420d5ac95850034ba.png"},"text/html":{"content_type":"text/html","hash":"c5ba6062b4e5981161c9154fbe144d80","path":"/fnc/build/c5ba6062b4e5981161c9154fbe144d80.html"},"image/svg+xml":{"content_type":"image/svg+xml","hash":"be5d411072008fadf38f62babfbd2382","path":"/fnc/build/be5d411072008fadf38f62babfbd2382.svg"}}}],"key":"kEkBNOZO6G"}],"data":{},"key":"wnAc8KSxCg"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"julia","executable":true,"value":"anim = @animate for t in range(0,0.75,length=201) \n    plot(x, u(t);\n        label=@sprintf(\"t=%.2f\", t),  legend=:topleft,\n        xaxis=(L\"x\"),  yaxis=(L\"u(x,t)\", (0, 4.2)), \n        title=\"Heat equation\",  dpi=150)\nend\nmp4(anim, \"figures/boundaries-heat.mp4\", fps=30)","visibility":"hide","key":"T6y7ZWqgDy"},{"type":"output","id":"HNenQZOaMYGgQSvO0lzRT","data":[{"output_type":"stream","name":"stderr","text":"\u001b[36m\u001b[1m[ \u001b[22m\u001b[39m\u001b[36m\u001b[1mInfo: \u001b[22m\u001b[39mSaved animation to /Users/driscoll/Dropbox/Mac/Documents/GitHub/fnc/julia/figures/boundaries-heat.mp4\n"},{"output_type":"execute_result","execution_count":37,"metadata":{},"data":{"text/plain":{"content":"Plots.AnimatedGif(\"/Users/driscoll/Dropbox/Mac/Documents/GitHub/fnc/julia/figures/boundaries-heat.mp4\")","content_type":"text/plain"},"text/html":{"content_type":"text/html","hash":"f7a1a27ea1f4c60de07636f68ee90446","path":"/fnc/build/f7a1a27ea1f4c60de07636f68ee90446.html"}}}],"visibility":"show","key":"vR5o7Y7nFr"}],"data":{"tags":[]},"visibility":"show","key":"sGLvWEifBF"}],"label":"demo-boundaries-heat-julia","identifier":"demo-boundaries-heat-julia","html_id":"demo-boundaries-heat-julia","key":"LAsHpYAQet"},{"type":"details","children":[{"type":"summary","children":[{"type":"crossReference","identifier":"demo-boundaries-bratu","label":"demo-boundaries-bratu","kind":"proof:example","position":{"start":{"line":535,"column":1},"end":{"line":535,"column":23}},"children":[{"type":"text","value":"Example ","key":"iFesKAJ9nx"},{"type":"text","value":"11.5.4","key":"foCB5ar7KC"}],"template":"Example %s","enumerator":"11.5.4","resolved":true,"html_id":"demo-boundaries-bratu","remote":true,"url":"/boundaries","dataUrl":"/boundaries.json","key":"NyDtNI7J9h"}],"key":"sD2BwwRN0p"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"julia","executable":true,"value":"ϕ = (t, x, u, uₓ, uₓₓ) -> u^2 + uₓₓ\ng₁ = (u, uₓ) -> u\ng₂ = (u, uₓ) -> uₓ\ninit = x -> 400x^4 * (1 - x)^2\nx, u = FNC.parabolic(ϕ, (0, 1), 60, g₁, g₂, (0, 0.1), init);","key":"HrQbx9OjIt"},{"type":"output","id":"7wC00gMiiaIbkh6Bumkha","data":[],"key":"u02EadytEH"}],"data":{},"key":"Ujgk93V7O2"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"julia","executable":true,"value":"anim = @animate for t in range(0, 0.1, length=101) \n    plot(x, u(t);\n        label=@sprintf(\"t=%.4f\", t),  legend=:topleft,\n        xaxis=(L\"x\"),  yaxis=(L\"u(x,t)\", (0, 10)),\n        dpi=150, title=\"Heat equation with source\")\nend\nmp4(anim, \"figures/boundaries-source.mp4\", fps=30)","visibility":"hide","key":"ohKb84T1Xq"},{"type":"output","id":"o2RYRCl58jsDBe2gTVNk0","data":[{"output_type":"stream","name":"stderr","text":"\u001b[36m\u001b[1m[ \u001b[22m\u001b[39m\u001b[36m\u001b[1mInfo: \u001b[22m\u001b[39mSaved animation to /Users/driscoll/Dropbox/Mac/Documents/GitHub/fnc/julia/figures/boundaries-source.mp4\n"},{"output_type":"execute_result","execution_count":39,"metadata":{},"data":{"text/plain":{"content":"Plots.AnimatedGif(\"/Users/driscoll/Dropbox/Mac/Documents/GitHub/fnc/julia/figures/boundaries-source.mp4\")","content_type":"text/plain"},"text/html":{"content_type":"text/html","hash":"4b65624d6636c70196431deb2c6d10cc","path":"/fnc/build/4b65624d6636c70196431deb2c6d10cc.html"}}}],"visibility":"show","key":"NN5myzu11Y"}],"data":{"tags":[]},"visibility":"show","key":"MDFfDQms6v"}],"label":"demo-boundaries-bratu-julia","identifier":"demo-boundaries-bratu-julia","html_id":"demo-boundaries-bratu-julia","key":"bGl4WbBQGO"},{"type":"details","children":[{"type":"summary","children":[{"type":"crossReference","identifier":"demo-boundaries-bs","label":"demo-boundaries-bs","kind":"proof:example","position":{"start":{"line":558,"column":1},"end":{"line":558,"column":20}},"children":[{"type":"text","value":"Example ","key":"UwDskjasAl"},{"type":"text","value":"11.5.5","key":"VZhhiT2Hrs"}],"template":"Example %s","enumerator":"11.5.5","resolved":true,"html_id":"demo-boundaries-bs","remote":true,"url":"/boundaries","dataUrl":"/boundaries.json","key":"FpkCBOOzSZ"}],"key":"tSd2DRsYzi"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"julia","executable":true,"value":"K = 3;  σ = 0.06;  r = 0.08;  Smax = 8;\nϕ = (t, x, u, uₓ, uₓₓ) -> σ^2/2 * (x^2 * uₓₓ) + r*x*uₓ - r*u\ng₁ = (u, uₓ) -> u\ng₂ = (u, uₓ) -> uₓ - 1;","key":"tZyBu8CFlY"},{"type":"output","id":"6SaFT4V7T2pU6-DDn6eRy","data":[],"key":"LXi4NunE7m"}],"data":{},"key":"ul5o1Vg1WK"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"julia","executable":true,"value":"u₀ = x -> max(0, x - K)\nx, u = FNC.parabolic(ϕ, (0, Smax), 80, g₁, g₂, (0, 15), u₀);","key":"TgYYSDyexU"},{"type":"output","id":"tUfn9XslupijTC0OIDAyC","data":[],"key":"kBuGWWJFgG"}],"data":{},"key":"EAmMvfWehv"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"julia","executable":true,"value":"anim = @animate for t in range(0, 15, 151) \n    plot(x, u(t);\n        label=@sprintf(\"t=%.4f\", t),  legend=:topleft,\n        xaxis=(L\"x\"),  yaxis=(L\"u(x,t)\", (-0.5, 8)), \n        dpi=150,  title=\"Black–Scholes equation\")\nend\nmp4(anim, \"figures/boundaries-bs.mp4\", fps=30)","visibility":"hide","key":"i7gTBimxiL"},{"type":"output","id":"0hDSNVGLDuV2MN3ZPsjTF","data":[{"output_type":"stream","name":"stderr","text":"\u001b[36m\u001b[1m[ \u001b[22m\u001b[39m\u001b[36m\u001b[1mInfo: \u001b[22m\u001b[39mSaved animation to /Users/driscoll/Dropbox/Mac/Documents/GitHub/fnc/julia/figures/boundaries-bs.mp4\n"},{"output_type":"execute_result","execution_count":42,"metadata":{},"data":{"text/plain":{"content":"Plots.AnimatedGif(\"/Users/driscoll/Dropbox/Mac/Documents/GitHub/fnc/julia/figures/boundaries-bs.mp4\")","content_type":"text/plain"},"text/html":{"content_type":"text/html","hash":"c5ef44b5827efb6d3d987b378ef8448e","path":"/fnc/build/c5ef44b5827efb6d3d987b378ef8448e.html"}}}],"visibility":"show","key":"NBdKNuaKGp"}],"data":{"tags":[]},"visibility":"show","key":"ehTd2msQSk"},{"type":"paragraph","position":{"start":{"line":583,"column":1},"end":{"line":583,"column":1}},"children":[{"type":"text","value":"Recall that ","position":{"start":{"line":583,"column":1},"end":{"line":583,"column":1}},"key":"Tb2hkpU0nK"},{"type":"inlineMath","value":"u","position":{"start":{"line":583,"column":1},"end":{"line":583,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>u</mi></mrow><annotation encoding=\"application/x-tex\">u</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">u</span></span></span></span>","key":"CIYGwPnEHH"},{"type":"text","value":" is the value of the call option, and time runs backward from the strike time. The longer the horizon, the more value the option has due to anticipated growth in the stock price.","position":{"start":{"line":583,"column":1},"end":{"line":583,"column":1}},"key":"OL6daJTTv4"}],"key":"mLfPWCUvoD"}],"label":"demo-boundaries-bs-julia","identifier":"demo-boundaries-bs-julia","html_id":"demo-boundaries-bs-julia","key":"JqOekVSvF1"}],"key":"xAeRIT1CZH"}],"key":"s9oSvJ8n61"},"references":{"cite":{"order":[],"data":{}}},"footer":{"navigation":{"prev":{"title":"Chapter 10","url":"/chapter10","group":"Julia codes"},"next":{"title":"Chapter 12","url":"/chapter12","group":"Julia codes"}}},"domain":"http://localhost:3000"}