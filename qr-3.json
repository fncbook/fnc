{"kind":"Notebook","sha256":"d7df7ca688aa592a79c6732b247277ebd408ca91f7c63b3ec4bfb843308ddd61","slug":"qr-3","location":"/chapter3/section4/python/qr.ipynb","dependencies":[],"frontmatter":{"numbering":{"heading_1":{"enabled":false},"heading_2":{"enabled":false},"heading_3":{"enabled":false},"heading_4":{"enabled":false},"heading_5":{"enabled":false},"heading_6":{"enabled":false}},"kernelspec":{"name":"python3","display_name":"Python 3","language":"python"},"authors":[{"nameParsed":{"literal":"Tobin A. Driscoll","given":"Tobin A.","family":"Driscoll"},"name":"Tobin A. Driscoll","email":"driscoll@udel.edu","id":"contributors-myst-generated-uid-0","corresponding":true},{"nameParsed":{"literal":"Richard J. Braun","given":"Richard J.","family":"Braun"},"name":"Richard J. Braun","id":"contributors-myst-generated-uid-1"}],"github":"https://github.com/fncbook/fnc","math":{"\\float":{"macro":"\\mathbb{F}"},"\\real":{"macro":"\\mathbb{R}"},"\\complex":{"macro":"\\mathbb{C}"},"\\nat":{"macro":"\\mathbb{N}"},"\\integer":{"macro":"\\mathbb{Z}"},"\\rmn":{"macro":"\\mathbb{R}^{#1 \\times #2}"},"\\dd":{"macro":"\\frac{d #1}{d #2}"},"\\ddd":{"macro":"\\frac{d^2 #1}{d #2^2}"},"\\pp":{"macro":"\\frac{\\partial #1}{\\partial #2}"},"\\ppp":{"macro":"\\frac{\\partial^2 #1}{\\partial #2^2}"},"\\ppdd":{"macro":"\\frac{\\partial^2 #1}{\\partial #2 \\partial #3}"},"\\abs":{"macro":"\\left\\lvert #1 \\right\\rvert"},"\\norm":{"macro":"\\left\\lVert #1 \\right\\rVert"},"\\twonorm":{"macro":"\\norm{#1}_2"},"\\onenorm":{"macro":"\\norm{#1}_1"},"\\infnorm":{"macro":"\\norm{#1}_\\infty"},"\\anynorm":{"macro":"\\norm{#1}_#2"},"\\innerprod":{"macro":"\\langle #1,#2 \\rangle"},"\\pr":{"macro":"^{(#1)}"},"\\kron":{"macro":"#1 \\otimes #2"},"\\eye":{"macro":"\\mathbf{e}_#1"},"\\meye":{"macro":"\\mathbf{I}"},"\\Qhat":{"macro":"\\hat{\\mathbf{Q}}"},"\\Rhat":{"macro":"\\hat{\\mathbf{R}}"},"\\bfalpha":{"macro":"\\mathbf{alpha}"},"\\bfdelta":{"macro":"\\mathbf{delta}"},"\\bfzero":{"macro":"\\boldsymbol{0}"},"\\macheps":{"macro":"\\epsilon_\\text{mach}"},"\\fl":{"macro":"\\operatorname{fl}"},"\\diag":{"macro":"\\operatorname{diag}"},"\\ign":{"macro":"\\operatorname{sign}"},"\\Re":{"macro":"\\operatorname{Re}"},"\\Im":{"macro":"\\operatorname{Im}"},"\\ee":{"macro":"\\times 10^"},"\\lnorm":{"macro":"\\|"},"\\rnorm":{"macro":"\\|"},"\\floor":{"macro":"\\lfloor#1\\rfloor"},"\\cI":{"macro":"\\mathcal{I}"},"\\mtx":{"macro":"\\operatorname{mtx}"},"\\myvec":{"macro":"\\operatorname{vec}"},"\\argmin":{"macro":"\\operatorname{argmin}"}},"abbreviations":{"IVP":"initial-value problem","BVP":"boundary-value problem","ONC":"matrix with orthonormal columns","SVD":"singular value decomposition","EVD":"eigenvalue decomposition","SPD":"symmetric positive definite","HPD":"hermitian positive definite","PDE":"partial differential equation","ODE":"ordinary differential equation"},"exports":[{"format":"ipynb","filename":"qr.ipynb","url":"/fnc/build/qr-f3dcba223fddfdb2888d662d2ef3ecc0.ipynb"}]},"widgets":{},"mdast":{"type":"root","children":[{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2025-01-11T17:34:08.298850Z","iopub.status.busy":"2025-01-11T17:34:08.298406Z","iopub.status.idle":"2025-01-11T17:34:08.622351Z","shell.execute_reply":"2025-01-11T17:34:08.621963Z"},"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"exec(open(\"../../../python/FNC_init.py\").read())","visibility":"show","key":"RVDEOnfmn5"},{"type":"output","id":"HTSWeljE8oephBOpKf5nn","data":[],"visibility":"show","key":"cEHbtn2nRp"}],"visibility":"remove","key":"d91oKHxCqk"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"crossReference","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"strong","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Demo ","key":"uqryjaLOb9"},{"type":"text","value":"3.4.1","key":"do4G6hzqtz"}],"key":"Hdya0hW1lN"}],"identifier":"demo-house-qr","label":"demo-house-qr","kind":"proof:example","template":"ExampleÂ %s","enumerator":"3.4.1","resolved":true,"html_id":"demo-house-qr","remote":true,"url":"/house","dataUrl":"/house.json","key":"o5uluI0RDp"}],"key":"JgvxHiGjiP"},{"type":"paragraph","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"text","value":"We will use Householder reflections to produce a QR factorization of a matrix.","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"oDoTElXohy"}],"key":"s7V61WvPRM"}],"key":"HHvvIctfjd"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2025-01-11T17:34:08.623989Z","iopub.status.busy":"2025-01-11T17:34:08.623868Z","iopub.status.idle":"2025-01-11T17:34:08.626079Z","shell.execute_reply":"2025-01-11T17:34:08.625810Z"}},"children":[{"type":"code","lang":"python","executable":true,"value":"A = 1.0 + floor(9 * random.rand(6,4))\nm, n = A.shape\nprint(A)","key":"sP6yXcvAn1"},{"type":"output","id":"8xlCPXXCu-LzLEL9gEDgK","data":[{"name":"stdout","output_type":"stream","text":"[[7. 5. 2. 8.]\n [6. 1. 3. 6.]\n [1. 9. 8. 6.]\n [6. 2. 4. 3.]\n [5. 1. 5. 2.]\n [2. 6. 3. 8.]]\n"}],"key":"Mmyt2sUOUV"}],"key":"sYxShfWkEL"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Our first step is to introduce zeros below the diagonal in column 1 by using ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"CshS8TS81C"},{"type":"crossReference","kind":"equation","identifier":"hhvector","label":"hhvector","children":[{"type":"text","value":"(","key":"cHXjb5z0KY"},{"type":"text","value":"3.4.4","key":"F2yTDuwsoJ"},{"type":"text","value":")","key":"OW6xDI8GiE"}],"template":"(%s)","enumerator":"3.4.4","resolved":true,"html_id":"hhvector","remote":true,"url":"/house","dataUrl":"/house.json","key":"WZSUp7VnSi"},{"type":"text","value":" and ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"dxoARyWU7m"},{"type":"crossReference","kind":"equation","identifier":"hhreflect","label":"hhreflect","children":[{"type":"text","value":"(","key":"T9jnmrKDW2"},{"type":"text","value":"3.4.1","key":"Zdy2VtT4Vj"},{"type":"text","value":")","key":"Tqb2MYs1NO"}],"template":"(%s)","enumerator":"3.4.1","resolved":true,"html_id":"hhreflect","remote":true,"url":"/house","dataUrl":"/house.json","key":"TTq8ZW09K8"},{"type":"text","value":".","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"iNsk0jPwv9"}],"key":"qI3XPqRCpa"}],"key":"DtTfBbtUAy"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2025-01-11T17:34:08.627285Z","iopub.status.busy":"2025-01-11T17:34:08.627195Z","iopub.status.idle":"2025-01-11T17:34:08.628967Z","shell.execute_reply":"2025-01-11T17:34:08.628746Z"}},"children":[{"type":"code","lang":"python","executable":true,"value":"z = A[:, 0]\nv = z - norm(z) * hstack([1, zeros(m-1)])\nP_1 = eye(m) - (2 / dot(v, v)) * outer(v, v)   # reflector","key":"npXGcNa73u"},{"type":"output","id":"DP95pLsNOz6tJFSXddI9m","data":[],"key":"Vh7ohFfjLm"}],"key":"amTQG4C7NV"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"We check that this reflector introduces zeros as it should:","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"YWFQNaWNV5"}],"key":"sWsi7mZapH"}],"key":"vLjvOGc6b7"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2025-01-11T17:34:08.630100Z","iopub.status.busy":"2025-01-11T17:34:08.630020Z","iopub.status.idle":"2025-01-11T17:34:08.631790Z","shell.execute_reply":"2025-01-11T17:34:08.631574Z"}},"children":[{"type":"code","lang":"python","executable":true,"value":"print(P_1 @ z)","key":"DoBqS9V26Z"},{"type":"output","id":"PGsJnCn7VDzD0lby9bvT9","data":[{"name":"stdout","output_type":"stream","text":"[ 1.22882057e+01  6.66133815e-16  0.00000000e+00  6.66133815e-16\n -8.88178420e-16  1.11022302e-16]\n"}],"key":"VavRuOgNTg"}],"key":"mTcFkZTTV5"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Now we replace ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"i1wZS6iaTy"},{"type":"inlineMath","value":"\\mathbf{A}","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi mathvariant=\"bold\">A</mi></mrow><annotation encoding=\"application/x-tex\">\\mathbf{A}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6861em;\"></span><span class=\"mord mathbf\">A</span></span></span></span>","key":"osoRRj5FtD"},{"type":"text","value":" by ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"B8PSYEYnnq"},{"type":"inlineMath","value":"\\mathbf{P}_1\\mathbf{A}","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi mathvariant=\"bold\">P</mi><mn>1</mn></msub><mi mathvariant=\"bold\">A</mi></mrow><annotation encoding=\"application/x-tex\">\\mathbf{P}_1\\mathbf{A}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8361em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathbf\">P</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3011em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">1</span></span></span></span><span class=\"vlist-s\">â</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mord mathbf\">A</span></span></span></span>","key":"d0d1XagS4h"},{"type":"text","value":".","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"sUnIJE48AW"}],"key":"Ug3jb4TBTa"}],"key":"QdQe9U0uwz"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2025-01-11T17:34:08.633076Z","iopub.status.busy":"2025-01-11T17:34:08.632989Z","iopub.status.idle":"2025-01-11T17:34:08.634803Z","shell.execute_reply":"2025-01-11T17:34:08.634567Z"}},"children":[{"type":"code","lang":"python","executable":true,"value":"A = P_1 @ A\nprint(A)","key":"SVey7XF1rl"},{"type":"output","id":"HDH62kH4lGD8Zo6EItR8H","data":[{"name":"stdout","output_type":"stream","text":"[[ 1.22882057e+01  6.42892882e+00  7.73099036e+00  1.15557961e+01]\n [ 4.44089210e-16 -6.21263125e-01 -3.50238359e+00  1.96559253e+00]\n [ 0.00000000e+00  8.72978948e+00  6.91626940e+00  5.32759876e+00]\n [ 4.44089210e-16  3.78736875e-01 -2.50238359e+00 -1.03440747e+00]\n [-8.88178420e-16 -3.51052605e-01 -4.18652993e-01 -1.36200622e+00]\n [ 1.11022302e-16  5.45957896e+00  8.32538803e-01  6.65519751e+00]]\n"}],"key":"JOQt3mcEnN"}],"key":"ejL6HICi3H"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"We are set to put zeros into column 2. We must not use row 1 in any way, lest it destroy the zeros we just introduced. So we leave it out of the next reflector.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"BCmMcbdJ3H"}],"key":"JlOGOZMzSk"}],"key":"fetBzFa2Ul"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2025-01-11T17:34:08.635877Z","iopub.status.busy":"2025-01-11T17:34:08.635799Z","iopub.status.idle":"2025-01-11T17:34:08.637616Z","shell.execute_reply":"2025-01-11T17:34:08.637401Z"}},"children":[{"type":"code","lang":"python","executable":true,"value":"z = A[1:, 1]\nv = z - norm(z) * hstack([1, zeros(m-2)])\nP_2 = eye(m-1) - (2 / dot(v, v)) * outer(v, v) ","key":"jLfNFIWXcb"},{"type":"output","id":"U6lW-lD8LtTsaxW6qkWG2","data":[],"key":"ZyG3NWFOn8"}],"key":"AlQi6X1jsx"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"We now apply this reflector to rows 2 and below only.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"d3AXEUfWzy"}],"key":"E5qxadb5J4"}],"key":"iFymMfOmuy"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2025-01-11T17:34:08.638722Z","iopub.status.busy":"2025-01-11T17:34:08.638649Z","iopub.status.idle":"2025-01-11T17:34:08.640423Z","shell.execute_reply":"2025-01-11T17:34:08.640192Z"}},"children":[{"type":"code","lang":"python","executable":true,"value":"A[1:, 1:] = P_2 @ A[1:, 1:]\nprint(A)","key":"A8m7vgrHHs"},{"type":"output","id":"yP0WktwXIg220r4Erjsa3","data":[{"name":"stdout","output_type":"stream","text":"[[ 1.22882057e+01  6.42892882e+00  7.73099036e+00  1.15557961e+01]\n [ 4.44089210e-16  1.03280625e+01  6.41921111e+00  7.91132021e+00]\n [ 0.00000000e+00 -1.19351358e-16 -9.94120360e-01  5.87128619e-01]\n [ 4.44089210e-16 -2.29786680e-17 -2.84557128e+00 -1.24007003e+00]\n [-8.88178420e-16  4.06604388e-17 -1.00551057e-01 -1.17137684e+00]\n [ 1.11022302e-16  0.00000000e+00 -4.11459052e+00  3.69052453e+00]]\n"}],"key":"UmyE5T7FT2"}],"key":"o8J5BOxhTX"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"We need to iterate the process for the last two columns.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"lk2FEWqRqR"}],"key":"Rrx0FVhKfx"}],"key":"B1jaU9wlqq"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2025-01-11T17:34:08.641592Z","iopub.status.busy":"2025-01-11T17:34:08.641513Z","iopub.status.idle":"2025-01-11T17:34:08.643398Z","shell.execute_reply":"2025-01-11T17:34:08.643110Z"}},"children":[{"type":"code","lang":"python","executable":true,"value":"for j in [2, 3]:\n    z = A[j:, j]\n    v = z - norm(z) * hstack([1, zeros(m-j-1)])\n    P = eye(m-j) - (2 / dot(v, v)) * outer(v, v)\n    A[j:, j:] = P @ A[j:, j:]","key":"eqXOCf7e4m"},{"type":"output","id":"gTO26yxVx_oSAB2Z1amIH","data":[],"key":"jVZalKp1a7"}],"key":"Tdq9dbuHZ1"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"We have now reduced the original to an upper triangular matrix using four orthogonal Householder reflections:","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"xccI1IBJhf"}],"key":"d7dgAMOmjW"}],"key":"xraX1mLEAd"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2025-01-11T17:34:08.644497Z","iopub.status.busy":"2025-01-11T17:34:08.644424Z","iopub.status.idle":"2025-01-11T17:34:08.646149Z","shell.execute_reply":"2025-01-11T17:34:08.645931Z"}},"children":[{"type":"code","lang":"python","executable":true,"value":"R = triu(A)\nprint(R)","key":"P8Z2dMrDxH"},{"type":"output","id":"atKYixZFzMaR3O-04BY-8","data":[{"name":"stdout","output_type":"stream","text":"[[12.28820573  6.42892882  7.73099036 11.55579611]\n [ 0.         10.32806246  6.41921111  7.91132021]\n [ 0.          0.          5.10152103 -2.37618993]\n [ 0.          0.          0.          3.35086707]\n [ 0.          0.          0.          0.        ]\n [ 0.          0.          0.          0.        ]]\n"}],"key":"V84JHLTgyd"}],"key":"wCwjvfnNmP"}],"key":"xxWmCHO3eZ"},"references":{"cite":{"order":[],"data":{}}},"footer":{"navigation":{"prev":{"title":"Stable","url":"/stable-5","group":"Chapter 3"},"next":{"title":"Bessel","url":"/bessel-2","group":"Chapter 4"}}},"domain":"http://localhost:3000"}