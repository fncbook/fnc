{"kind":"Notebook","sha256":"85051bdc3cf6025a30ede1c882c2be176e076df3eff8f5661baf1db7d9a60ba2","slug":"restart-2","location":"/chapter8/section5/python/restart.ipynb","dependencies":[],"frontmatter":{"numbering":{"heading_1":{"enabled":false},"heading_2":{"enabled":false},"heading_3":{"enabled":false},"heading_4":{"enabled":false},"heading_5":{"enabled":false},"heading_6":{"enabled":false}},"kernelspec":{"name":"python3","display_name":"Python 3","language":"python"},"authors":[{"nameParsed":{"literal":"Tobin A. Driscoll","given":"Tobin A.","family":"Driscoll"},"name":"Tobin A. Driscoll","email":"driscoll@udel.edu","id":"contributors-myst-generated-uid-0","corresponding":true},{"nameParsed":{"literal":"Richard J. Braun","given":"Richard J.","family":"Braun"},"name":"Richard J. Braun","id":"contributors-myst-generated-uid-1"}],"github":"https://github.com/fncbook/fnc","math":{"\\float":{"macro":"\\mathbb{F}"},"\\real":{"macro":"\\mathbb{R}"},"\\complex":{"macro":"\\mathbb{C}"},"\\nat":{"macro":"\\mathbb{N}"},"\\integer":{"macro":"\\mathbb{Z}"},"\\rmn":{"macro":"\\mathbb{R}^{#1 \\times #2}"},"\\dd":{"macro":"\\frac{d #1}{d #2}"},"\\ddd":{"macro":"\\frac{d^2 #1}{d #2^2}"},"\\pp":{"macro":"\\frac{\\partial #1}{\\partial #2}"},"\\ppp":{"macro":"\\frac{\\partial^2 #1}{\\partial #2^2}"},"\\ppdd":{"macro":"\\frac{\\partial^2 #1}{\\partial #2 \\partial #3}"},"\\abs":{"macro":"\\left\\lvert #1 \\right\\rvert"},"\\norm":{"macro":"\\left\\lVert #1 \\right\\rVert"},"\\twonorm":{"macro":"\\norm{#1}_2"},"\\onenorm":{"macro":"\\norm{#1}_1"},"\\infnorm":{"macro":"\\norm{#1}_\\infty"},"\\anynorm":{"macro":"\\norm{#1}_#2"},"\\innerprod":{"macro":"\\langle #1,#2 \\rangle"},"\\pr":{"macro":"^{(#1)}"},"\\kron":{"macro":"#1 \\otimes #2"},"\\eye":{"macro":"\\mathbf{e}_#1"},"\\meye":{"macro":"\\mathbf{I}"},"\\Qhat":{"macro":"\\hat{\\mathbf{Q}}"},"\\Rhat":{"macro":"\\hat{\\mathbf{R}}"},"\\bfalpha":{"macro":"\\mathbf{alpha}"},"\\bfdelta":{"macro":"\\mathbf{delta}"},"\\bfzero":{"macro":"\\boldsymbol{0}"},"\\macheps":{"macro":"\\epsilon_\\text{mach}"},"\\fl":{"macro":"\\operatorname{fl}"},"\\diag":{"macro":"\\operatorname{diag}"},"\\ign":{"macro":"\\operatorname{sign}"},"\\Re":{"macro":"\\operatorname{Re}"},"\\Im":{"macro":"\\operatorname{Im}"},"\\ee":{"macro":"\\times 10^"},"\\lnorm":{"macro":"\\|"},"\\rnorm":{"macro":"\\|"},"\\floor":{"macro":"\\lfloor#1\\rfloor"},"\\cI":{"macro":"\\mathcal{I}"},"\\mtx":{"macro":"\\operatorname{mtx}"},"\\myvec":{"macro":"\\operatorname{vec}"},"\\argmin":{"macro":"\\operatorname{argmin}"}},"abbreviations":{"IVP":"initial-value problem","BVP":"boundary-value problem","ONC":"matrix with orthonormal columns","SVD":"singular value decomposition","EVD":"eigenvalue decomposition","SPD":"symmetric positive definite","HPD":"hermitian positive definite","PDE":"partial differential equation","ODE":"ordinary differential equation"},"exports":[{"format":"ipynb","filename":"restart.ipynb","url":"/build/restart-1734f5f7b289b7bde5750b26ba1a7c92.ipynb"}]},"widgets":{},"mdast":{"type":"root","children":[{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2025-01-11T16:23:21.482168Z","iopub.status.busy":"2025-01-11T16:23:21.482044Z","iopub.status.idle":"2025-01-11T16:23:21.793926Z","shell.execute_reply":"2025-01-11T16:23:21.793633Z"},"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"exec(open(\"../../../python/FNC_init.py\").read())","visibility":"show","key":"uo7OfT5wwm"},{"type":"output","id":"9_CZc8n8eTlW74PETREzE","data":[],"visibility":"show","key":"nW7044c087"}],"visibility":"remove","key":"fmu05bXP5d"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"crossReference","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"strong","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Demo ","key":"gZn2n6y4aH"},{"type":"text","value":"8.5.2","key":"P6RhDhXFfC"}],"key":"Had84TX7ws"}],"identifier":"demo-gmres-restart","label":"demo-gmres-restart","kind":"proof:example","template":"Example %s","enumerator":"8.5.2","resolved":true,"html_id":"demo-gmres-restart","remote":true,"url":"/gmres","dataUrl":"/gmres.json","key":"SpW4UJ61YD"}],"key":"fnOz9XbPI2"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"The following experiments are based on a matrix resulting from discretization of a partial differential equation.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"Sl0Q3y3nHF"}],"key":"XcODVncEGu"}],"key":"aeCvoVpbbo"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2025-01-11T16:23:21.795534Z","iopub.status.busy":"2025-01-11T16:23:21.795415Z","iopub.status.idle":"2025-01-11T16:23:21.871454Z","shell.execute_reply":"2025-01-11T16:23:21.871175Z"}},"children":[{"type":"code","lang":"python","executable":true,"value":"d = 50;  n = d**2\nA = FNC.poisson2d(d)\nb = ones(n)\nspy(A);","key":"lmNTs3aXGr"},{"type":"output","id":"HR2NIELj17y12qwesaWAd","data":[{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"2f28202d37aec32e09f3f84a559b5d9f","path":"/build/2f28202d37aec32e09f3f84a559b5d9f.png"},"text/plain":{"content":"<Figure size 700x400 with 1 Axes>","content_type":"text/plain"}}}],"key":"YKozgkMn5r"}],"key":"vejHVwkKAD"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"paragraph","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"text","value":"We compare unrestarted GMRES with three different thresholds for restarting. Here we are using ","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"P2MzSespmR"},{"type":"inlineCode","value":"gmres","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"gER38jWZ0B"},{"type":"text","value":" from ","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"U2Wk8VXHvF"},{"type":"inlineCode","value":"scipy.sparse.linalg","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"Ad6E8HVn5z"},{"type":"text","value":", since our simple implementation does not offer restarting. We’re also using a trick to accumulate the vector of residual norms as it runs.","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"InMefFwgdC"}],"indexEntries":[{"entry":"Python","subEntry":{"value":"gmres","kind":"entry"},"emphasis":true}],"label":"index-aD5sjP5izo","identifier":"index-ad5sjp5izo","html_id":"index-ad5sjp5izo","key":"OIcM4LrtDH"}],"key":"HEq6VURlBq"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2025-01-11T16:23:21.872788Z","iopub.status.busy":"2025-01-11T16:23:21.872676Z","iopub.status.idle":"2025-01-11T16:23:22.068966Z","shell.execute_reply":"2025-01-11T16:23:22.068682Z"}},"children":[{"type":"code","lang":"python","executable":true,"value":"from scipy.sparse.linalg import gmres\nctr = lambda rvec: resid.append(norm(rvec))\nresid = [1.]\nx, flag = gmres(A, b, restart=None, rtol=1e-8, atol=1e-14, maxiter=120, callback=ctr)\nsemilogy(resid); \nxlabel(\"$m$\"), ylabel(\"residual norm\")\ntitle((\"Convergence of unrestarted GMRES\"));","key":"HuRt0X2egT"},{"type":"output","id":"d3jP-_PgnB-jOwSmbw6F9","data":[{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"64c2e4714ac90a8178a228acc4fd1138","path":"/build/64c2e4714ac90a8178a228acc4fd1138.png"},"text/plain":{"content":"<Figure size 700x400 with 1 Axes>","content_type":"text/plain"}}}],"key":"L7tDF8Jxl6"}],"key":"Rv6sokVVlU"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2025-01-11T16:23:22.072053Z","iopub.status.busy":"2025-01-11T16:23:22.071942Z","iopub.status.idle":"2025-01-11T16:23:22.370458Z","shell.execute_reply":"2025-01-11T16:23:22.370164Z"}},"children":[{"type":"code","lang":"python","executable":true,"value":"maxit = 120\nrtol = 1e-8\nrestarts = [maxit, 20, 40, 60]\nhist = lambda rvec: resid.append(norm(rvec))\nfor r in restarts:\n    resid = [1.]\n    x, flag = gmres(A, b, restart=r, rtol=rtol, atol=1e-14, maxiter=maxit, callback=hist)\n    semilogy(resid)\n\nylim(1e-8, 2)\nlegend([\"none\", \"20\", \"40\", \"60\"])\ntitle((\"Convergence of restarted GMRES\"));","key":"isiyDL2HfS"},{"type":"output","id":"0w02bmOIZiZPBOOxGhYQr","data":[{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"9df824ebcea1e928132c8bef193a50fc","path":"/build/9df824ebcea1e928132c8bef193a50fc.png"},"text/plain":{"content":"<Figure size 700x400 with 1 Axes>","content_type":"text/plain"}}}],"key":"RynP0gf3LH"}],"key":"N7xBkjSU4b"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"The “pure” GMRES curve is the lowest one. All of the other curves agree with it until the first restart. Decreasing the restart value makes the convergence per iteration generally worse, but the time required per iteration smaller as well.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"nntRwnV8Ge"}],"key":"SMSU3somXh"}],"key":"gkZmdKQDKX"}],"key":"KWKTQXIlgz"},"references":{"cite":{"order":[],"data":{}}},"footer":{"navigation":{"prev":{"title":"Intro","url":"/intro-2","group":"Chapter 8"},"next":{"title":"Indefinite","url":"/indefinite-2","group":"Chapter 8"}}},"domain":"http://localhost:3000"}