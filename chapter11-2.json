{"kind":"Notebook","sha256":"ea7a78c2e9cdf4f8bfffea8e7593358ffea71445f2a6a7f402db32e0b96b60e8","slug":"chapter11-2","location":"/python/chapter11.md","dependencies":[],"frontmatter":{"title":"Chapter 11","numbering":{"heading_1":{"enabled":false},"heading_2":{"enabled":false},"heading_3":{"enabled":false},"heading_4":{"enabled":false},"heading_5":{"enabled":false},"heading_6":{"enabled":false}},"kernelspec":{"name":"python3","display_name":"Python 3","language":"python"},"content_includes_title":false,"authors":[{"nameParsed":{"literal":"Tobin A. Driscoll","given":"Tobin A.","family":"Driscoll"},"name":"Tobin A. Driscoll","email":"driscoll@udel.edu","id":"contributors-myst-generated-uid-0","corresponding":true},{"nameParsed":{"literal":"Richard J. Braun","given":"Richard J.","family":"Braun"},"name":"Richard J. Braun","id":"contributors-myst-generated-uid-1"}],"github":"https://github.com/fncbook/fnc","math":{"\\float":{"macro":"\\mathbb{F}"},"\\real":{"macro":"\\mathbb{R}"},"\\complex":{"macro":"\\mathbb{C}"},"\\nat":{"macro":"\\mathbb{N}"},"\\integer":{"macro":"\\mathbb{Z}"},"\\rmn":{"macro":"\\mathbb{R}^{#1 \\times #2}"},"\\dd":{"macro":"\\frac{d #1}{d #2}"},"\\ddd":{"macro":"\\frac{d^2 #1}{d #2^2}"},"\\pp":{"macro":"\\frac{\\partial #1}{\\partial #2}"},"\\ppp":{"macro":"\\frac{\\partial^2 #1}{\\partial #2^2}"},"\\ppdd":{"macro":"\\frac{\\partial^2 #1}{\\partial #2 \\partial #3}"},"\\abs":{"macro":"\\left\\lvert #1 \\right\\rvert"},"\\norm":{"macro":"\\left\\lVert #1 \\right\\rVert"},"\\twonorm":{"macro":"\\norm{#1}_2"},"\\onenorm":{"macro":"\\norm{#1}_1"},"\\infnorm":{"macro":"\\norm{#1}_\\infty"},"\\anynorm":{"macro":"\\norm{#1}_#2"},"\\innerprod":{"macro":"\\langle #1,#2 \\rangle"},"\\pr":{"macro":"^{(#1)}"},"\\kron":{"macro":"#1 \\otimes #2"},"\\eye":{"macro":"\\mathbf{e}_#1"},"\\meye":{"macro":"\\mathbf{I}"},"\\Qhat":{"macro":"\\hat{\\mathbf{Q}}"},"\\Rhat":{"macro":"\\hat{\\mathbf{R}}"},"\\bfalpha":{"macro":"\\mathbf{alpha}"},"\\bfdelta":{"macro":"\\mathbf{delta}"},"\\bfzero":{"macro":"\\boldsymbol{0}"},"\\macheps":{"macro":"\\epsilon_\\text{mach}"},"\\fl":{"macro":"\\operatorname{fl}"},"\\diag":{"macro":"\\operatorname{diag}"},"\\ign":{"macro":"\\operatorname{sign}"},"\\Re":{"macro":"\\operatorname{Re}"},"\\Im":{"macro":"\\operatorname{Im}"},"\\ee":{"macro":"\\times 10^"},"\\lnorm":{"macro":"\\|"},"\\rnorm":{"macro":"\\|"},"\\floor":{"macro":"\\lfloor#1\\rfloor"},"\\cI":{"macro":"\\mathcal{I}"},"\\mtx":{"macro":"\\operatorname{mtx}"},"\\myvec":{"macro":"\\operatorname{vec}"},"\\argmin":{"macro":"\\operatorname{argmin}"}},"abbreviations":{"IVP":"initial-value problem","BVP":"boundary-value problem","ONC":"matrix with orthonormal columns","SVD":"singular value decomposition","EVD":"eigenvalue decomposition","SPD":"symmetric positive definite","HPD":"hermitian positive definite","PDE":"partial differential equation","ODE":"ordinary differential equation"},"exports":[{"format":"md","filename":"chapter11.md","url":"/build/chapter11-5043388859f7916c30ef2dd89380a9f7.md"}]},"mdast":{"type":"root","children":[{"type":"block","children":[{"type":"heading","depth":2,"position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"children":[{"type":"text","value":"Functions","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"key":"SosCOloSGz"}],"identifier":"functions","label":"Functions","html_id":"functions","implicit":true,"key":"C9ZkICct3g"},{"type":"details","open":true,"children":[{"type":"summary","children":[{"type":"text","value":"Differentiation matrices for periodic end conditions","position":{"start":{"line":14,"column":1},"end":{"line":14,"column":1}},"key":"tgNquz0jW4"}],"key":"Sl7MDqEEYN"},{"type":"include","file":"fncbook/fncbook/chapter11.py","literal":true,"filter":{"startAt":"def diffper","endAt":"return x, Dx, Dxx"},"children":[{"type":"code","value":"def diffper(n, xspan):\n    \"\"\"\n    diffper(n, xspan)\n\n    Construct 2nd-order differentiation matrices for functions with periodic end\n    conditions, using `n` unique nodes in the interval `xspan`. Return a vector of\n    nodes and the  matrices for the first and second derivatives.\n    \"\"\"\n    a, b = xspan\n    h = (b - a) / n\n    x = a + h * np.arange(n)  # nodes, omitting the repeated data\n\n    # Construct Dx by diagonals, then correct the corners.\n    dp = 0.5 / h * np.ones(n - 1)  # superdiagonal\n    dm = -0.5 / h * np.ones(n - 1)  # subdiagonal\n    Dx = np.diag(dm, -1) + np.diag(dp, 1)\n    Dx[0, -1] = -1 / (2 * h)\n    Dx[-1, 0] = 1 / (2 * h)\n\n    # Construct Dxx by diagonals, then correct the corners.\n    d0 = -2 / h**2 * np.ones(n)  # main diagonal\n    dp = np.ones(n - 1) / h**2  # superdiagonal and subdiagonal\n    Dxx = np.diag(d0) + np.diag(dp, -1) + np.diag(dp, 1)\n    Dxx[0, -1] = 1 / (h**2)\n    Dxx[-1, 0] = 1 / (h**2)\n\n    return x, Dx, Dxx","lang":"python","showLineNumbers":true,"filename":"diffper.py","key":"tV3pVtSunz"}],"key":"QZ8KoUDH1h"}],"label":"function-diffper-python","identifier":"function-diffper-python","html_id":"function-diffper-python","key":"xBTawzla0N"},{"type":"details","open":true,"children":[{"type":"summary","children":[{"type":"text","value":"Solution of parabolic ","key":"TDQbyl2WQd"},{"type":"abbreviation","title":"partial differential equation","children":[{"type":"text","value":"PDE","key":"RsESWYgKaX"}],"key":"nptNLa42Rq"},{"type":"text","value":"s by the method of lines","key":"l984gJD4OL"}],"key":"Gk1Jkaj0RP"},{"type":"include","file":"fncbook/fncbook/chapter11.py","literal":true,"filter":{"startAt":"def parabolic","endAt":"return x, lambda t"},"children":[{"type":"code","value":"def parabolic(phi, xspan, m, ga, gb, tspan, init):\n    \"\"\"\n        parabolic(phi, xspan, m, ga, gb, tspan, init)\n\n    Solve a parabolic PDE by the method of lines. The PDE is \n    ∂u/∂t = phi(t,x,u,∂u/∂x,∂^2u/∂x^2), xspan gives the space \n    domain, m gives the degree of a Chebyshev spectral discretization, ga and gb are functions of (u,∂u/∂x) at the domain ends that should be made zero, tspan is the time domain, and init is a function of x that gives the initial condition. Returns a vector x and a function of t that gives the semidiscrete solution at x. \n    \"\"\"   \n    x, Dx, Dxx = diffcheb(m, xspan)\n    int = range(1, m)    # indexes of interior nodes\n\n    def extend(v):\n        def objective(ubc):\n            u0, um = ubc\n            ux = Dx @ np.hstack([u0, v, um])\n            return np.array([ga(u0, ux[1]), gb(um, ux[-1])])\n        ubc = levenberg(objective, np.array([0, 0]))[-1]\n        return np.hstack([ubc[0], v, ubc[-1]])\n\n    def ode(t, v):\n        u = extend(v)\n        ux, uxx = Dx @ u, Dxx @ u\n        return phi(t, x[int], u[int], ux[int], uxx[int])\n\n    u0 = init(x[int])\n    sol = solve_ivp(ode, tspan, u0, method=\"BDF\", dense_output=True)\n\n    return x, lambda t: extend(sol.sol(t))","lang":"python","showLineNumbers":true,"filename":"parabolic.py","key":"ZVwMbIUHsh"}],"key":"U8m7wQPazD"}],"label":"function-parabolic-python","identifier":"function-parabolic-python","html_id":"function-parabolic-python","key":"f16E5SrL6b"},{"type":"heading","depth":2,"position":{"start":{"line":37,"column":1},"end":{"line":37,"column":1}},"children":[{"type":"text","value":"Examples","position":{"start":{"line":37,"column":1},"end":{"line":37,"column":1}},"key":"lpqWK1brxo"}],"identifier":"examples","label":"Examples","html_id":"examples","implicit":true,"key":"uVX0UuQQFr"}],"key":"zpiBxY3iK4"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"exec(open(\"FNC_init.py\").read())","visibility":"show","key":"a4MOtrnD6Z"},{"type":"output","id":"OFAljAV7bXtXmv2GGigAc","data":[],"visibility":"show","key":"IJNMyTkdne"}],"data":{"tags":[]},"visibility":"remove","key":"z9JITHMX7r"},{"type":"block","children":[{"type":"heading","depth":3,"position":{"start":{"line":44,"column":1},"end":{"line":44,"column":1}},"children":[{"type":"text","value":"11.1 ","position":{"start":{"line":44,"column":1},"end":{"line":44,"column":1}},"key":"oH36qaQId1"},{"type":"link","identifier":"section-diffusion-blackscholes","label":"section-diffusion-blackscholes","kind":"narrative","position":{"start":{"line":44,"column":6},"end":{"line":44,"column":37}},"url":"/blackscholes","internal":true,"dataUrl":"/blackscholes.json","children":[{"type":"text","value":"Black–Scholes equation","key":"QKG39EorYl"}],"key":"WPb3zKkFLs"}],"identifier":"id-11-1","label":"11.1 ","html_id":"id-11-1","implicit":true,"key":"WsENmxhLWQ"},{"type":"details","open":true,"children":[{"type":"summary","children":[{"type":"crossReference","identifier":"demo-blackscholes-solve","label":"demo-blackscholes-solve","kind":"proof:example","position":{"start":{"line":47,"column":1},"end":{"line":47,"column":25}},"children":[{"type":"text","value":"Example ","key":"QhjdKwCyYQ"},{"type":"text","value":"11.1.2","key":"jiDQhXG7ET"}],"template":"Example %s","enumerator":"11.1.2","resolved":true,"html_id":"demo-blackscholes-solve","remote":true,"url":"/blackscholes","dataUrl":"/blackscholes.json","key":"YWlg0B4yki"}],"key":"itN5MrjyVb"},{"type":"paragraph","position":{"start":{"line":49,"column":1},"end":{"line":49,"column":1}},"children":[{"type":"text","value":"We consider the Black–Scholes problem for the following parameter values:","position":{"start":{"line":49,"column":1},"end":{"line":49,"column":1}},"key":"ENGrY4OwRh"}],"key":"qweICiR530"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"Smax, T = 8, 6\nK = 3\nsigma = 0.06\nr = 0.08","key":"qh3hTQrXH3"},{"type":"output","id":"bbLSXZRbvXXm8XMtI3t0u","data":[],"key":"r3FL8KGVYq"}],"data":{},"key":"MTxhbB2XeN"},{"type":"paragraph","position":{"start":{"line":58,"column":1},"end":{"line":58,"column":1}},"children":[{"type":"text","value":"We discretize space and time.","position":{"start":{"line":58,"column":1},"end":{"line":58,"column":1}},"key":"k9KlQsQlY0"}],"key":"FB45btkSeV"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"m = 200\nh = Smax / m\nx = h * arange(m+1)\nn = 1000\ntau = T / n\nt = tau * arange(n+1)\nlamb, mu = tau / h**2, tau / h","key":"PCQXdrAngD"},{"type":"output","id":"RKRDXt1SRFv335xigDZD4","data":[],"key":"hRDI581vVf"}],"data":{},"key":"bQV20jBuWM"},{"type":"paragraph","position":{"start":{"line":70,"column":1},"end":{"line":70,"column":1}},"children":[{"type":"text","value":"We set the initial condition and then march forward in time.","position":{"start":{"line":70,"column":1},"end":{"line":70,"column":1}},"key":"nbttBc8R2i"}],"key":"W46pG2KLfq"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"V = zeros([m + 1, n + 1])\nV[:, 0] = maximum(0, x - K)\nfor j in range(n):\n    # Fictitious value from Neumann condition.\n    Vfict = 2 * h + V[m-1, j]\n    Vj = hstack([V[:, j], Vfict])\n    # First row is zero by the Dirichlet condition.\n    for i in range(1, m+1):\n        diff1 = Vj[i+1] - Vj[i-1]\n        diff2 = Vj[i+1] - 2 * Vj[i] + Vj[i-1]\n        V[i, j+1] = (\n            Vj[i]\n            + (lamb * sigma**2 * x[i] ** 2 / 2) * diff2\n            + (r * x[i] * mu) / 2 * diff1\n            - r * tau * Vj[i]\n        )","key":"P9s1AZedMM"},{"type":"output","id":"l-HBMP_hzgNYOBefBXOoZ","data":[],"key":"aKnrmQd6vu"}],"data":{},"key":"e5da4muXkm"},{"type":"paragraph","position":{"start":{"line":91,"column":1},"end":{"line":91,"column":1}},"children":[{"type":"text","value":"Here is a plot of the solution after every 250 time steps.","position":{"start":{"line":91,"column":1},"end":{"line":91,"column":1}},"key":"Zs5Y18I0PC"}],"key":"t8ChH6uKw4"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"select_times = 250 * arange(5)\nshow_times = t[select_times]\n\nfor j, col in enumerate(select_times):\n    plot(x, V[:, col], label=f\"t={show_times[j]:.1f}\")\n\nlegend()\nxlabel(\"stock price\"),  ylabel(\"option value\")\ntitle(\"Black-Scholes solution\");","key":"NK5nDCWXIy"},{"type":"output","id":"kyrJkVWTyDHq79qZGzQm1","data":[{"output_type":"display_data","metadata":{},"data":{"text/plain":{"content":"<Figure size 700x400 with 1 Axes>","content_type":"text/plain"},"image/png":{"content_type":"image/png","hash":"0030d967f220be880b34c00fd80cd876","path":"/build/0030d967f220be880b34c00fd80cd876.png"}}}],"key":"ZldHzePP41"}],"data":{},"key":"kr7kcnlICX"},{"type":"paragraph","position":{"start":{"line":108,"column":1},"end":{"line":108,"column":1}},"children":[{"type":"text","value":"Alternatively, here is an animation of the solution.","position":{"start":{"line":108,"column":1},"end":{"line":108,"column":1}},"key":"ydXpT23C3Q"}],"indexEntries":[{"entry":"Python","subEntry":{"value":"animation","kind":"entry"},"emphasis":true}],"label":"index-AszU6CEn2D","identifier":"index-aszu6cen2d","html_id":"index-aszu6cen2d","key":"hOk2L0mCom"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"from matplotlib import animation\nfig = figure()\nax = fig.add_subplot(autoscale_on=False, xlim=(0, 8), ylim=(0, 6))\nax.grid()\nax.set_title(\"Black-Scholes solution\")\n\nline, = ax.plot([], [], '-', lw=2)\ntime_text = ax.text(0.05, 0.9, '', transform=ax.transAxes)\n\ndef animate(j):\n    line.set_data(x, V[:, j])\n    time_text.set_text(f\"t = {t[j]:.2f}\")\n    return line, time_text\n\nanim = animation.FuncAnimation(\n    fig, animate, frames=range(0, n+1, 10), blit=True);\nanim.save(\"figures/black-scholes-6.mp4\", fps=30)\nclose()","visibility":"show","key":"S2aCxDyUK8"},{"type":"output","id":"JOQJn-KSZAnNP1K8w6Mmm","data":[],"visibility":"remove","key":"hWUp7YMoTp"}],"data":{"tags":[]},"visibility":"show","key":"xXkex32ega"},{"type":"image","url":"/build/black-scholes-6-38f0519328de4ce6f66781724c1fc99c.mp4","alt":"Black–Scholes solution","position":{"start":{"line":132,"column":1},"end":{"line":132,"column":1}},"key":"dJ1LEws9VV","urlSource":"figures/black-scholes-6.mp4"},{"type":"paragraph","position":{"start":{"line":134,"column":1},"end":{"line":134,"column":1}},"children":[{"type":"text","value":"The results are easy to interpret, recalling that the time variable really means ","position":{"start":{"line":134,"column":1},"end":{"line":134,"column":1}},"key":"KrTZrDhtzS"},{"type":"emphasis","position":{"start":{"line":134,"column":1},"end":{"line":134,"column":1}},"children":[{"type":"text","value":"time until strike","position":{"start":{"line":134,"column":1},"end":{"line":134,"column":1}},"key":"zhNxBoWFcC"}],"key":"HpAGHD4yiB"},{"type":"text","value":". Say you are close to the option’s strike time. If the current stock price is, say, ","position":{"start":{"line":134,"column":1},"end":{"line":134,"column":1}},"key":"VEcxaa1vrM"},{"type":"inlineMath","value":"S=2","position":{"start":{"line":134,"column":1},"end":{"line":134,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>S</mi><mo>=</mo><mn>2</mn></mrow><annotation encoding=\"application/x-tex\">S=2</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.05764em;\">S</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">2</span></span></span></span>","key":"YlnP8jSXf6"},{"type":"text","value":", then it’s not likely that the stock will end up over the strike price ","position":{"start":{"line":134,"column":1},"end":{"line":134,"column":1}},"key":"XcHtQiwVUK"},{"type":"inlineMath","value":"K=3","position":{"start":{"line":134,"column":1},"end":{"line":134,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>K</mi><mo>=</mo><mn>3</mn></mrow><annotation encoding=\"application/x-tex\">K=3</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.07153em;\">K</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">3</span></span></span></span>","key":"hlPts11yRK"},{"type":"text","value":", and therefore the option has little value. On the other hand, if presently ","position":{"start":{"line":134,"column":1},"end":{"line":134,"column":1}},"key":"usKqbHIm1g"},{"type":"inlineMath","value":"S=3","position":{"start":{"line":134,"column":1},"end":{"line":134,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>S</mi><mo>=</mo><mn>3</mn></mrow><annotation encoding=\"application/x-tex\">S=3</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.05764em;\">S</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">3</span></span></span></span>","key":"pdGNbtF0qa"},{"type":"text","value":", then there are good odds that the option will be exercised at the strike time, and you will need to pay a substantial portion of the stock price in order to take advantage. As the time to strike increases, there is an expectation that the stock price is more likely to rise somewhat, making the value of the option larger at each fixed ","position":{"start":{"line":134,"column":1},"end":{"line":134,"column":1}},"key":"fDJVc5jXYf"},{"type":"inlineMath","value":"S","position":{"start":{"line":134,"column":1},"end":{"line":134,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>S</mi></mrow><annotation encoding=\"application/x-tex\">S</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.05764em;\">S</span></span></span></span>","key":"ZIASgu0jQc"},{"type":"text","value":".","position":{"start":{"line":134,"column":1},"end":{"line":134,"column":1}},"key":"IxcGFTwUIf"}],"key":"B6sUv6itKw"}],"label":"demo-blackscholes-solve-python","identifier":"demo-blackscholes-solve-python","html_id":"demo-blackscholes-solve-python","key":"GPsHdNn63v"},{"type":"details","open":true,"children":[{"type":"summary","children":[{"type":"crossReference","identifier":"demo-blackscholes-unstable","label":"demo-blackscholes-unstable","kind":"proof:example","position":{"start":{"line":138,"column":1},"end":{"line":138,"column":28}},"children":[{"type":"text","value":"Example ","key":"JkUS54eq5f"},{"type":"text","value":"11.1.3","key":"QExVDj1sH0"}],"template":"Example %s","enumerator":"11.1.3","resolved":true,"html_id":"demo-blackscholes-unstable","remote":true,"url":"/blackscholes","dataUrl":"/blackscholes.json","key":"XcKo7NHga8"}],"key":"HfB3qSsUOz"},{"type":"paragraph","position":{"start":{"line":140,"column":1},"end":{"line":140,"column":1}},"children":[{"type":"text","value":"Let’s try to do everything the same as in ","position":{"start":{"line":140,"column":1},"end":{"line":140,"column":1}},"key":"akClt5ZeN5"},{"type":"crossReference","kind":"proof:example","identifier":"demo-blackscholes-solve","label":"demo-blackscholes-solve","children":[{"type":"text","value":"Demo ","key":"gnvrVEzdaK"},{"type":"text","value":"11.1.2","key":"ueKH7EITIQ"}],"template":"Example %s","enumerator":"11.1.2","resolved":true,"html_id":"demo-blackscholes-solve","remote":true,"url":"/blackscholes","dataUrl":"/blackscholes.json","key":"JwJB9cReo4"},{"type":"text","value":", but extending the simulation time to ","position":{"start":{"line":140,"column":1},"end":{"line":140,"column":1}},"key":"upmr2jzSUv"},{"type":"inlineMath","value":"T=8","position":{"start":{"line":140,"column":1},"end":{"line":140,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>T</mi><mo>=</mo><mn>8</mn></mrow><annotation encoding=\"application/x-tex\">T=8</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">T</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">8</span></span></span></span>","key":"JhE6B1sMqN"},{"type":"text","value":".","position":{"start":{"line":140,"column":1},"end":{"line":140,"column":1}},"key":"Sn6tRrZVED"}],"key":"lV1wGs9rad"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"T = 8\nn = 1000;  tau = T / n\nt = tau * arange(n + 1)\nlamb, mu = tau / h**2, tau / h\n\nV = zeros([m+1, n+1])\nV[:, 0] = maximum(0, x - K)\nfor j in range(n):\n    # Fictitious value from Neumann condition.\n    Vfict = 2 * h + V[m - 1, j]\n    Vj = hstack([V[:, j], Vfict])\n    # First row is zero by the Dirichlet condition.\n    for i in range(1, m + 1):\n        diff1 = Vj[i + 1] - Vj[i - 1]\n        diff2 = Vj[i + 1] - 2 * Vj[i] + Vj[i - 1]\n        V[i, j + 1] = (\n            Vj[i]\n            + (lamb * sigma**2 * x[i] ** 2 / 2) * diff2\n            + (r * x[i] * mu) / 2 * diff1\n            - r * tau * Vj[i]\n        )\n\nselect_times = 250 * arange(5)\nshow_times = t[select_times]\n\nfor j, col in enumerate(select_times):\n    plot(x, V[:, col], label=f\"t={show_times[j]:.1f}\")\n\nlegend()\nxlabel(\"stock price\")\nylim([0, 6]);  ylabel(\"option value\")\ntitle(\"Black-Scholes solution\");","key":"cq5CEnpjbM"},{"type":"output","id":"YvutZl9JguXq9sGxlYAFb","data":[{"output_type":"display_data","metadata":{},"data":{"text/plain":{"content":"<Figure size 700x400 with 1 Axes>","content_type":"text/plain"},"image/png":{"content_type":"image/png","hash":"b55b55710813bc2d7518e8af074967b1","path":"/build/b55b55710813bc2d7518e8af074967b1.png"}}}],"key":"CQELnvwblH"}],"data":{},"key":"zFmU2KCun5"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"from matplotlib import animation\nfig = figure()\nax = fig.add_subplot(autoscale_on=False, xlim=(0, 8), ylim=(0, 6))\nax.grid()\nax.set_title(\"Black-Scholes solution...?\")\n\nline, = ax.plot([], [], '-', lw=2)\ntime_text = ax.text(0.05, 0.9, '', transform=ax.transAxes)\n\ndef animate(j):\n    line.set_data(x, V[:, j])\n    time_text.set_text(f\"t = {t[j]:.2f}\")\n    return line, time_text\n\nanim = animation.FuncAnimation(\n    fig, animate, frames=range(0, n+1), blit=True);\nanim.save(\"figures/black-scholes-8.mp4\", fps=24)\nclose()","visibility":"show","key":"vKiMixfXeC"},{"type":"output","id":"8a6uHZ-N_CryZEPCLeBxx","data":[],"visibility":"remove","key":"QhEfBMxzSh"}],"data":{"tags":[]},"visibility":"show","key":"H09qR5CDUd"},{"type":"image","url":"/build/black-scholes-8-0acb1378e0f0e6be09728f3e4df9ccab.mp4","alt":"Trouble in Black–Scholes solution","position":{"start":{"line":199,"column":1},"end":{"line":199,"column":1}},"key":"MDiQoBZOXK","urlSource":"figures/black-scholes-8.mp4"},{"type":"paragraph","position":{"start":{"line":201,"column":1},"end":{"line":201,"column":1}},"children":[{"type":"text","value":"This so-called solution is nonsense!","position":{"start":{"line":201,"column":1},"end":{"line":201,"column":1}},"key":"pcAEgxvmdO"}],"key":"wtfdUEcftm"}],"label":"demo-blackscholes-unstable-python","identifier":"demo-blackscholes-unstable-python","html_id":"demo-blackscholes-unstable-python","key":"RdHjuQNCJ0"},{"type":"heading","depth":3,"position":{"start":{"line":204,"column":1},"end":{"line":204,"column":1}},"children":[{"type":"text","value":"11.2 ","position":{"start":{"line":204,"column":1},"end":{"line":204,"column":1}},"key":"QZd9XLR1Ce"},{"type":"link","identifier":"section-diffusion-methodlines","label":"section-diffusion-methodlines","kind":"narrative","position":{"start":{"line":204,"column":6},"end":{"line":204,"column":36}},"url":"/methodlines","internal":true,"dataUrl":"/methodlines.json","children":[{"type":"text","value":"The method of lines","key":"jU0sU6O8Zd"}],"key":"fmEw2Vh4Et"}],"identifier":"id-11-2","label":"11.2 ","html_id":"id-11-2","implicit":true,"key":"kIODwcTSNn"},{"type":"details","open":true,"children":[{"type":"summary","children":[{"type":"crossReference","identifier":"demo-methodlines-heatfe","label":"demo-methodlines-heatFE","kind":"proof:example","position":{"start":{"line":207,"column":1},"end":{"line":207,"column":25}},"children":[{"type":"text","value":"Example ","key":"E2kLNXP00c"},{"type":"text","value":"11.2.2","key":"oTO2ZW18lP"}],"template":"Example %s","enumerator":"11.2.2","resolved":true,"html_id":"demo-methodlines-heatfe","remote":true,"url":"/methodlines","dataUrl":"/methodlines.json","key":"EiHSdVtkxw"}],"key":"Lji7cOS6gx"},{"type":"paragraph","position":{"start":{"line":209,"column":1},"end":{"line":209,"column":1}},"children":[{"type":"text","value":"Let’s implement the method of ","position":{"start":{"line":209,"column":1},"end":{"line":209,"column":1}},"key":"mIbXWbo97M"},{"type":"crossReference","kind":"proof:example","identifier":"example-methodlines-heatfe","label":"example-methodlines-heatFE","children":[{"type":"text","value":"Example ","key":"acdIPnLkly"},{"type":"text","value":"11.2.1","key":"gGp4RdaNXz"}],"template":"Example %s","enumerator":"11.2.1","resolved":true,"html_id":"example-methodlines-heatfe","remote":true,"url":"/methodlines","dataUrl":"/methodlines.json","key":"RBigh07KmE"},{"type":"text","value":" with second-order space semidiscretization.","position":{"start":{"line":209,"column":1},"end":{"line":209,"column":1}},"key":"DnQHhDTiGg"}],"key":"K5bZA56lHI"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"m = 100\nx, Dx, Dxx = FNC.diffper(m, [0, 1])\n\ntfinal = 0.15  \nn = 2400                 # number of time steps  \ntau = tfinal / n         # time step\nt = tau * arange(n+1)    # time values","key":"eFzjjajiWz"},{"type":"output","id":"fvI9EQvihXRy1ZYdWcvnJ","data":[],"key":"bxnmdiwaD1"}],"data":{},"key":"yBKT44xfCv"},{"type":"paragraph","position":{"start":{"line":221,"column":1},"end":{"line":221,"column":1}},"children":[{"type":"text","value":"Next we set an initial condition. It isn’t mathematically periodic, but the end values and derivatives are so small that for numerical purposes it may as well be.","position":{"start":{"line":221,"column":1},"end":{"line":221,"column":1}},"key":"ZW6zgvXAxJ"}],"key":"YNvejOcbxY"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"U = zeros([m, n+1])\nU[:, 0] = exp(-60 * (x - 0.5) ** 2)\nplot(x, U[:, 0])\nxlabel(\"x\");  ylabel(\"u(x,0)\")\ntitle(\"Initial condition\");","key":"ispUXyKxmE"},{"type":"output","id":"er1yVkk9xZLm5P5bgx0Rd","data":[{"output_type":"display_data","metadata":{},"data":{"text/plain":{"content":"<Figure size 700x400 with 1 Axes>","content_type":"text/plain"},"image/png":{"content_type":"image/png","hash":"3b30ac66941328df5e4f6d7aee0bae39","path":"/build/3b30ac66941328df5e4f6d7aee0bae39.png"}}}],"key":"vDrHf14pDx"}],"data":{},"key":"ZFafeegbkI"},{"type":"paragraph","position":{"start":{"line":231,"column":1},"end":{"line":231,"column":1}},"children":[{"type":"text","value":"The Euler time stepping simply multiplies the solution vector by the constant matrix in ","position":{"start":{"line":231,"column":1},"end":{"line":231,"column":1}},"key":"uMa3M0Fhin"},{"type":"crossReference","kind":"equation","identifier":"eulerxx","label":"Eulerxx","children":[{"type":"text","value":"(","key":"dHWZRHkBOX"},{"type":"text","value":"11.2.6","key":"SGcJS0dDFB"},{"type":"text","value":")","key":"x9a0DQG2Qa"}],"template":"(%s)","enumerator":"11.2.6","resolved":true,"html_id":"eulerxx","remote":true,"url":"/methodlines","dataUrl":"/methodlines.json","key":"GlVdYcZtM1"},{"type":"text","value":" at each time step. Since that matrix is sparse, we will declare it as such, even though the run-time savings may not be detectable for this small value of ","position":{"start":{"line":231,"column":1},"end":{"line":231,"column":1}},"key":"URBBzuS2cs"},{"type":"inlineMath","value":"m","position":{"start":{"line":231,"column":1},"end":{"line":231,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>m</mi></mrow><annotation encoding=\"application/x-tex\">m</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">m</span></span></span></span>","key":"VN4CXgRBB8"},{"type":"text","value":".","position":{"start":{"line":231,"column":1},"end":{"line":231,"column":1}},"key":"GypMYiNFpM"}],"key":"ENAJrbGGns"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"import scipy.sparse as sp\nI = sp.eye(m)\nA = I + tau * sp.csr_array(Dxx)\nfor j in range(n):\n    U[:, j+1] = A @ U[:, j]\n\nplot(x, U[:, :31:10])\nylim([-0.25, 1])\nxlabel(\"$x$\");  ylabel(\"$u(x,t)$\")\nlegend([f\"$t={tj:.2e}$\" for tj in t[:60:20]])\ntitle(\"Heat equation by forward Euler\");","key":"EOimvbObrd"},{"type":"output","id":"xNVZ-8UEC0WOLOAQ3sueo","data":[{"output_type":"display_data","metadata":{},"data":{"text/plain":{"content":"<Figure size 700x400 with 1 Axes>","content_type":"text/plain"},"image/png":{"content_type":"image/png","hash":"e2d00a8edac1935004bd7b15ff41172e","path":"/build/e2d00a8edac1935004bd7b15ff41172e.png"}}}],"key":"mDc9njU0Rt"}],"data":{},"key":"LMDosgMMbf"},{"type":"paragraph","position":{"start":{"line":247,"column":1},"end":{"line":247,"column":1}},"children":[{"type":"text","value":"You see above that things seem to start well, with the initial peak widening and shrinking. But then there is a nonphysical growth in the solution.","position":{"start":{"line":247,"column":1},"end":{"line":247,"column":1}},"key":"hm1EM1IO89"}],"key":"K6hiV5k9t3"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"from matplotlib import animation\nfig = figure()\nax = fig.add_subplot(autoscale_on=False, xlim=(0, 1), ylim=(-1, 2))\nax.grid()\n\nline, = ax.plot([], [], '-', lw=2)\nax.set_title(\"Heat equation by forward Euler\")\ntime_text = ax.text(0.05, 0.9, '', transform=ax.transAxes)\n\ndef animate(j):\n    line.set_data(x, U[:, j])\n    time_text.set_text(f\"t = {t[j]:.2e}\")\n    return line, time_text\n\nanim = animation.FuncAnimation(\n    fig, animate, frames=range(0, 100), blit=True)\nanim.save(\"figures/diffusionFE.mp4\", fps=24)\nclose()","visibility":"hide","key":"gJLPTwg9nh"},{"type":"output","id":"Rjrzne6O5mw4R_q6P_z_x","data":[],"visibility":"show","key":"e2GcZJUKJn"}],"data":{"tags":[]},"visibility":"show","key":"uNfbmmpDca"},{"type":"image","url":"/build/diffusionFE-46d71cfdec22a9538e921bd070a6fc1a.mp4","alt":"Instability in Euler solution","position":{"start":{"line":271,"column":1},"end":{"line":271,"column":1}},"key":"c8I8ewIWNZ","urlSource":"figures/diffusionFE.mp4"},{"type":"paragraph","position":{"start":{"line":273,"column":1},"end":{"line":273,"column":1}},"children":[{"type":"text","value":"The growth in norm is exponential in time.","position":{"start":{"line":273,"column":1},"end":{"line":273,"column":1}},"key":"tq73C3neY0"}],"key":"udsZAbiPWL"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"M = abs(U).max(axis=0)  # max in each column\nsemilogy(t[:500], M[:500])\nxlabel(\"$t$\");  ylabel(\"$\\\\max_x |u(x,t)|$\")\ntitle(\"Nonphysical growth\");","key":"Sr78L0hfsv"},{"type":"output","id":"rvq5_ynuT5CW9997oPngD","data":[{"output_type":"display_data","metadata":{},"data":{"text/plain":{"content":"<Figure size 700x400 with 1 Axes>","content_type":"text/plain"},"image/png":{"content_type":"image/png","hash":"fd4925eb032e3e0184c839b034cd47d9","path":"/build/fd4925eb032e3e0184c839b034cd47d9.png"}}}],"key":"qjY8IIqR5k"}],"data":{},"key":"XthP54iSUw"}],"label":"demo-methodlines-heatFE-python","identifier":"demo-methodlines-heatfe-python","html_id":"demo-methodlines-heatfe-python","key":"JXqWJUv1Wd"},{"type":"details","open":true,"children":[{"type":"summary","children":[{"type":"crossReference","identifier":"demo-methodlines-heatbe","label":"demo-methodlines-heatBE","kind":"proof:example","position":{"start":{"line":284,"column":1},"end":{"line":284,"column":25}},"children":[{"type":"text","value":"Example ","key":"ocP00GhECR"},{"type":"text","value":"11.2.4","key":"QxAdZoHWzW"}],"template":"Example %s","enumerator":"11.2.4","resolved":true,"html_id":"demo-methodlines-heatbe","remote":true,"url":"/methodlines","dataUrl":"/methodlines.json","key":"z0jiUrSiya"}],"key":"gT33bVZ1qH"},{"type":"paragraph","position":{"start":{"line":286,"column":1},"end":{"line":286,"column":1}},"children":[{"type":"text","value":"Now we apply backward Euler to the heat equation. Mathematically this means multiplying by the ","position":{"start":{"line":286,"column":1},"end":{"line":286,"column":1}},"key":"luTBL5p7WY"},{"type":"emphasis","position":{"start":{"line":286,"column":1},"end":{"line":286,"column":1}},"children":[{"type":"text","value":"inverse","position":{"start":{"line":286,"column":1},"end":{"line":286,"column":1}},"key":"MajNIj0647"}],"key":"piDQLCxplj"},{"type":"text","value":" of a matrix, but we interpret that numerically as a linear system solution. We will reuse the setup from ","position":{"start":{"line":286,"column":1},"end":{"line":286,"column":1}},"key":"dfCmtFu7PO"},{"type":"crossReference","kind":"proof:example","identifier":"demo-methodlines-heatfe","label":"demo-methodlines-heatFE","children":[{"type":"text","value":"Demo ","key":"mVcbJHxeHs"},{"type":"text","value":"11.2.2","key":"e6aa82CjCa"}],"template":"Example %s","enumerator":"11.2.2","resolved":true,"html_id":"demo-methodlines-heatfe","remote":true,"url":"/methodlines","dataUrl":"/methodlines.json","key":"ky1vx2I3ph"},{"type":"text","value":".","position":{"start":{"line":286,"column":1},"end":{"line":286,"column":1}},"key":"HZFQhNodA8"}],"key":"N8iFsKYkG7"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"from scipy.sparse.linalg import spsolve\nB = sp.csr_matrix(I - tau * Dxx)\nfor j in range(n):\n    U[:, j + 1] = spsolve(B, U[:, j])\n\nplot(x, U[:, ::500])\nxlabel(\"$x$\")\nylabel(\"$u(x,t)$\")\nlegend([f\"$t={tj:.2g}$\" for tj in t[::500]])\ntitle(\"Heat equation by backward Euler\");","key":"S7sbE1dvuE"},{"type":"output","id":"ArKsWE9Pn1mcE2UF87uOT","data":[{"output_type":"display_data","metadata":{},"data":{"text/plain":{"content":"<Figure size 700x400 with 1 Axes>","content_type":"text/plain"},"image/png":{"content_type":"image/png","hash":"9567bbe0b5f8286b16a8bc35556b9c07","path":"/build/9567bbe0b5f8286b16a8bc35556b9c07.png"}}}],"key":"huwTVbTZRw"}],"data":{},"key":"befeWBC4zY"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"fig = figure()\nax = fig.add_subplot(autoscale_on=False, xlim=(0, 1), ylim=(-0.25, 1))\nax.grid()\n\nline, = ax.plot([], [], '-', lw=2)\nax.set_title(\"Backward Euler\")\ntime_text = ax.text(0.05, 0.9, '', transform=ax.transAxes)\n\nanim = animation.FuncAnimation(\n    fig, animate, frames=range(0, n+1, 20), blit=True)\nanim.save(\"figures/diffusionBE.mp4\", fps=30)\nclose()","visibility":"hide","key":"S6BZnyjaoX"},{"type":"output","id":"isoCXzOdfaJzKLYmtMZkl","data":[],"visibility":"show","key":"LduepNiCU6"}],"data":{"tags":[]},"visibility":"show","key":"lQWoB8Y7hd"},{"type":"image","url":"/build/diffusionBE-9b2c8e0818f8716e35134fca82cb8ee9.mp4","alt":"Stable Backward Euler solution","position":{"start":{"line":317,"column":1},"end":{"line":317,"column":1}},"key":"z8b9poj7HN","urlSource":"figures/diffusionBE.mp4"},{"type":"paragraph","position":{"start":{"line":319,"column":1},"end":{"line":319,"column":1}},"children":[{"type":"text","value":"This solution looks physically plausible, as the large concentration in the center diffuses outward until the solution is essentially constant. Observe that the solution remains periodic in space for all time.","position":{"start":{"line":319,"column":1},"end":{"line":319,"column":1}},"key":"a0CnDclTim"}],"key":"tmWu5rYibI"}],"label":"demo-methodlines-heatBE-python","identifier":"demo-methodlines-heatbe-python","html_id":"demo-methodlines-heatbe-python","key":"PH2qpr0f1S"},{"type":"details","open":true,"children":[{"type":"summary","children":[{"type":"crossReference","identifier":"demo-methodlines-auto","label":"demo-methodlines-auto","kind":"proof:example","position":{"start":{"line":322,"column":1},"end":{"line":322,"column":23}},"children":[{"type":"text","value":"Example ","key":"eHg1wzzkuJ"},{"type":"text","value":"11.2.5","key":"p6dIOno5Ze"}],"template":"Example %s","enumerator":"11.2.5","resolved":true,"html_id":"demo-methodlines-auto","remote":true,"url":"/methodlines","dataUrl":"/methodlines.json","key":"dQExVrjd3W"}],"key":"WhPOKQ4XmK"},{"type":"paragraph","position":{"start":{"line":324,"column":1},"end":{"line":324,"column":1}},"children":[{"type":"text","value":"We set up the semidiscretization and initial condition in ","position":{"start":{"line":324,"column":1},"end":{"line":324,"column":1}},"key":"ak5mYJWXjE"},{"type":"inlineMath","value":"x","position":{"start":{"line":324,"column":1},"end":{"line":324,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>x</mi></mrow><annotation encoding=\"application/x-tex\">x</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">x</span></span></span></span>","key":"zInuoaHmt2"},{"type":"text","value":" just as before.","position":{"start":{"line":324,"column":1},"end":{"line":324,"column":1}},"key":"hYQ997tKtU"}],"key":"T5SKbGQwpj"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"m = 100\nx, Dx, Dxx = FNC.diffper(m, [0, 1])\nu0 = exp(-60 * (x - 0.5) ** 2)","key":"yUnInwUA0J"},{"type":"output","id":"v7olLfzb9kTklkny1ZjsX","data":[],"key":"g3V371LZDC"}],"data":{},"key":"VaKkr0WQ6I"},{"type":"paragraph","position":{"start":{"line":332,"column":1},"end":{"line":332,"column":1}},"children":[{"type":"text","value":"Now, however, we apply a standard solver using ","position":{"start":{"line":332,"column":1},"end":{"line":332,"column":1}},"key":"mZ2oMLehU7"},{"type":"inlineCode","value":"solve_ivp","position":{"start":{"line":332,"column":1},"end":{"line":332,"column":1}},"key":"mG4eScrMZn"},{"type":"text","value":" to the initial-value problem ","position":{"start":{"line":332,"column":1},"end":{"line":332,"column":1}},"key":"sBvZuxlAP1"},{"type":"inlineMath","value":"\\mathbf{u}'=\\mathbf{D}_{xx}\\mathbf{u}","position":{"start":{"line":332,"column":1},"end":{"line":332,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msup><mi mathvariant=\"bold\">u</mi><mo mathvariant=\"normal\" lspace=\"0em\" rspace=\"0em\">′</mo></msup><mo>=</mo><msub><mi mathvariant=\"bold\">D</mi><mrow><mi>x</mi><mi>x</mi></mrow></msub><mi mathvariant=\"bold\">u</mi></mrow><annotation encoding=\"application/x-tex\">\\mathbf{u}&#x27;=\\mathbf{D}_{xx}\\mathbf{u}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.7519em;\"></span><span class=\"mord\"><span class=\"mord mathbf\">u</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.7519em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">′</span></span></span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8361em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathbf\">D</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.1514em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">xx</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mord mathbf\">u</span></span></span></span>","key":"sbenGDJoW1"},{"type":"text","value":".","position":{"start":{"line":332,"column":1},"end":{"line":332,"column":1}},"key":"e9cC52EWO1"}],"key":"UsvMCI1JGF"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"from scipy.integrate import solve_ivp\ntfinal = 0.05\nf = lambda t, u: Dxx @ u\nsol = solve_ivp(f, [0, tfinal], u0, method=\"RK45\", dense_output=True)\n\nt = linspace(0, 0.05, 5)\nplot(x, sol.sol(t))\nxlabel(\"$x$\"),  ylabel(\"$u(x,t)$\")\nlegend([f\"$t={tj:.4g}$\" for tj in t])\ntitle(\"Heat equation by RK45\");","key":"RVBttkxECp"},{"type":"output","id":"pzJZjpU0COR7L4XDguWsn","data":[{"output_type":"display_data","metadata":{},"data":{"text/plain":{"content":"<Figure size 700x400 with 1 Axes>","content_type":"text/plain"},"image/png":{"content_type":"image/png","hash":"074d7f40287fdf737534b8b437bac6c0","path":"/build/074d7f40287fdf737534b8b437bac6c0.png"}}}],"key":"L0r1nM8JW1"}],"data":{},"key":"lQa4THXHmD"},{"type":"paragraph","position":{"start":{"line":347,"column":1},"end":{"line":347,"column":1}},"children":[{"type":"text","value":"The solution appears to be correct. But the number of time steps that were selected automatically is surprisingly large, considering how smoothly the solution changes.","position":{"start":{"line":347,"column":1},"end":{"line":347,"column":1}},"key":"S19g0Qe7M2"}],"key":"adwfArEpgM"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"print(f\"RK45 took {len(sol.t) - 1} steps\")","key":"woXBPrd1FP"},{"type":"output","id":"Wfr-0E0ERd9OPL3KqgEl9","data":[{"output_type":"stream","name":"stdout","text":"RK45 took 602 steps\n"}],"key":"ZBjW17rLBB"}],"data":{},"key":"o1VOhUJelY"},{"type":"paragraph","position":{"start":{"line":353,"column":1},"end":{"line":353,"column":1}},"children":[{"type":"text","value":"Now we apply a different solver called ","position":{"start":{"line":353,"column":1},"end":{"line":353,"column":1}},"key":"gmaOHcJSgg"},{"type":"inlineCode","value":"BDF","position":{"start":{"line":353,"column":1},"end":{"line":353,"column":1}},"key":"PXeCF9Xugs"},{"type":"text","value":".","position":{"start":{"line":353,"column":1},"end":{"line":353,"column":1}},"key":"inxslZn4mS"}],"key":"LD6KP9r8qA"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"sol = solve_ivp(f, [0, tfinal], u0, method=\"BDF\")\nprint(f\"BDF took {len(sol.t) - 1} steps\")","key":"OFNjLxsEC3"},{"type":"output","id":"NmEKFjUni6F0GUgtmOkqK","data":[{"output_type":"stream","name":"stdout","text":"BDF took 34 steps\n"}],"key":"PBewhYsCah"}],"data":{},"key":"TyNJ5bqEto"},{"type":"paragraph","position":{"start":{"line":360,"column":1},"end":{"line":360,"column":1}},"children":[{"type":"text","value":"The number of steps selected was reduced by a factor of 20!","position":{"start":{"line":360,"column":1},"end":{"line":360,"column":1}},"key":"Nx4WfmJkQG"}],"key":"kEITVm2e4o"}],"label":"demo-methodlines-auto-python","identifier":"demo-methodlines-auto-python","html_id":"demo-methodlines-auto-python","key":"UGiO7CWjPP"},{"type":"heading","depth":3,"position":{"start":{"line":363,"column":1},"end":{"line":363,"column":1}},"children":[{"type":"text","value":"11.3 ","position":{"start":{"line":363,"column":1},"end":{"line":363,"column":1}},"key":"O1LalAr6PN"},{"type":"link","identifier":"section-diffusion-absstab","label":"section-diffusion-absstab","kind":"narrative","position":{"start":{"line":363,"column":6},"end":{"line":363,"column":32}},"url":"/absstab-diffusion","internal":true,"dataUrl":"/absstab-diffusion.json","children":[{"type":"text","value":"Absolute stability","key":"qrtnUaJ40J"}],"key":"B9my06wEwn"}],"identifier":"id-11-3","label":"11.3 ","html_id":"id-11-3","implicit":true,"key":"cc7EXxqNc2"},{"type":"details","open":true,"children":[{"type":"summary","children":[{"type":"crossReference","identifier":"demo-absstab-regions","label":"demo-absstab-regions","kind":"proof:example","position":{"start":{"line":365,"column":1},"end":{"line":365,"column":22}},"children":[{"type":"text","value":"Example ","key":"DHiEM5KIqF"},{"type":"text","value":"11.3.5","key":"SUN6UHhk9D"}],"template":"Example %s","enumerator":"11.3.5","resolved":true,"html_id":"demo-absstab-regions","remote":true,"url":"/absstab-diffusion","dataUrl":"/absstab-diffusion.json","key":"LpIFLlsLwk"}],"key":"AsqGPp2r3u"},{"type":"paragraph","position":{"start":{"line":367,"column":1},"end":{"line":367,"column":1}},"children":[{"type":"text","value":"Euler and Backward Euler time-stepping methods were used to solve ","position":{"start":{"line":367,"column":1},"end":{"line":367,"column":1}},"key":"LrU6Qhh4HV"},{"type":"inlineMath","value":"\\mathbf{u}'=\\mathbf{D}_{xx}\\mathbf{u}","position":{"start":{"line":367,"column":1},"end":{"line":367,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msup><mi mathvariant=\"bold\">u</mi><mo mathvariant=\"normal\" lspace=\"0em\" rspace=\"0em\">′</mo></msup><mo>=</mo><msub><mi mathvariant=\"bold\">D</mi><mrow><mi>x</mi><mi>x</mi></mrow></msub><mi mathvariant=\"bold\">u</mi></mrow><annotation encoding=\"application/x-tex\">\\mathbf{u}&#x27;=\\mathbf{D}_{xx}\\mathbf{u}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.7519em;\"></span><span class=\"mord\"><span class=\"mord mathbf\">u</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.7519em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">′</span></span></span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8361em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathbf\">D</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.1514em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">xx</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mord mathbf\">u</span></span></span></span>","key":"tJ7ginM1nl"},{"type":"text","value":".","position":{"start":{"line":367,"column":1},"end":{"line":367,"column":1}},"key":"yQ25VUiJiu"}],"key":"jqqwazdzqV"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"m = 40\nDxx = FNC.diffper(m, [0, 1])[2]","key":"fq8GrkasWV"},{"type":"output","id":"vAsaGiHsDRgnh9dqqP3G5","data":[],"key":"fxZCavdsLM"}],"data":{},"key":"x4CqmhSkjS"},{"type":"paragraph","position":{"start":{"line":374,"column":1},"end":{"line":374,"column":1}},"children":[{"type":"text","value":"The eigenvalues of this matrix are real and negative:","position":{"start":{"line":374,"column":1},"end":{"line":374,"column":1}},"key":"wftt5DCU3P"}],"key":"MRIOxBHtZP"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"from scipy.linalg import eigvals\nlamb = eigvals(Dxx)\nplot(real(lamb), imag(lamb), \"o\")\nxlabel(\"Re $\\\\lambda$\")\nylabel(\"Im $\\\\lambda$\")\ntitle(\"Eigenvalues\");","key":"dLOZ3iMZdM"},{"type":"output","id":"cf9hRikEvMeDSmYVfd5l0","data":[{"output_type":"display_data","metadata":{},"data":{"text/plain":{"content":"<Figure size 700x400 with 1 Axes>","content_type":"text/plain"},"image/png":{"content_type":"image/png","hash":"0bb2320d1a0010c8c1bcaa39dedd38b8","path":"/build/0bb2320d1a0010c8c1bcaa39dedd38b8.png"}}}],"key":"QSgoaFH76N"}],"data":{},"key":"lvzS9cVf1h"},{"type":"paragraph","position":{"start":{"line":385,"column":1},"end":{"line":385,"column":1}},"children":[{"type":"text","value":"The Euler method is absolutely stable in the region ","position":{"start":{"line":385,"column":1},"end":{"line":385,"column":1}},"key":"SDZ73IjQS4"},{"type":"inlineMath","value":"|\\zeta+1| \\le 1","position":{"start":{"line":385,"column":1},"end":{"line":385,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi mathvariant=\"normal\">∣</mi><mi>ζ</mi><mo>+</mo><mn>1</mn><mi mathvariant=\"normal\">∣</mi><mo>≤</mo><mn>1</mn></mrow><annotation encoding=\"application/x-tex\">|\\zeta+1| \\le 1</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord\">∣</span><span class=\"mord mathnormal\" style=\"margin-right:0.07378em;\">ζ</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord\">1∣</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">1</span></span></span></span>","key":"p9HoPt1vto"},{"type":"text","value":" in the complex plane:","position":{"start":{"line":385,"column":1},"end":{"line":385,"column":1}},"key":"umwIsecQmH"}],"key":"G3wLOdK4PM"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"phi = 2 * pi * arange(361) / 360\nz = exp(1j * phi) - 1  # unit circle shifted to the left by 1\n\nfill(real(z), imag(z), color=(0.8, 0.8, 1))\nxlabel(\"Re $\\\\lambda$\")\nylabel(\"Im $\\\\lambda$\")\naxis(\"equal\")\ntitle(\"Stability region\");","visibility":"hide","key":"trkJ8lHSdU"},{"type":"output","id":"FDy0JyLAHSuE2gJpbtxkT","data":[{"output_type":"display_data","metadata":{},"data":{"text/plain":{"content":"<Figure size 700x400 with 1 Axes>","content_type":"text/plain"},"image/png":{"content_type":"image/png","hash":"bb7c20d0f5569310b13ede2962c40c9a","path":"/build/bb7c20d0f5569310b13ede2962c40c9a.png"}}}],"visibility":"show","key":"bc7zlOpbfi"}],"data":{"tags":[]},"visibility":"show","key":"RsvF23VeVY"},{"type":"paragraph","position":{"start":{"line":399,"column":1},"end":{"line":399,"column":1}},"children":[{"type":"text","value":"In order to get inside this region, we have to find ","position":{"start":{"line":399,"column":1},"end":{"line":399,"column":1}},"key":"aIOToBx4qY"},{"type":"text","value":"τ","position":{"start":{"line":399,"column":1},"end":{"line":399,"column":1}},"key":"RyRhr7E1Dc"},{"type":"text","value":" such that ","position":{"start":{"line":399,"column":1},"end":{"line":399,"column":1}},"key":"Gx0cisr4jK"},{"type":"inlineMath","value":"\\lambda \\tau > -2","position":{"start":{"line":399,"column":1},"end":{"line":399,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>λ</mi><mi>τ</mi><mo>&gt;</mo><mo>−</mo><mn>2</mn></mrow><annotation encoding=\"application/x-tex\">\\lambda \\tau &gt; -2</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.7335em;vertical-align:-0.0391em;\"></span><span class=\"mord mathnormal\">λ</span><span class=\"mord mathnormal\" style=\"margin-right:0.1132em;\">τ</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">&gt;</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.7278em;vertical-align:-0.0833em;\"></span><span class=\"mord\">−</span><span class=\"mord\">2</span></span></span></span>","key":"hX7pnoJ6HJ"},{"type":"text","value":" for all eigenvalues ","position":{"start":{"line":399,"column":1},"end":{"line":399,"column":1}},"key":"GKRAjeJm3X"},{"type":"text","value":"λ","position":{"start":{"line":399,"column":1},"end":{"line":399,"column":1}},"key":"anaAqS9tzT"},{"type":"text","value":". This is an upper bound on ","position":{"start":{"line":399,"column":1},"end":{"line":399,"column":1}},"key":"lrnYOidnf0"},{"type":"text","value":"τ","position":{"start":{"line":399,"column":1},"end":{"line":399,"column":1}},"key":"qpzFyxiRkI"},{"type":"text","value":".","position":{"start":{"line":399,"column":1},"end":{"line":399,"column":1}},"key":"zVvxd8HJI6"}],"key":"Ce0CxN3oUW"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"lambda_min = min(real(lamb))\nmax_tau = -2 / lambda_min\nprint(f\"predicted max time step is {max_tau:.3e}\")","key":"RC1HcGikb4"},{"type":"output","id":"rYshcrRNJaACt4V3jNohy","data":[{"output_type":"stream","name":"stdout","text":"predicted max time step is 3.125e-04\n"}],"key":"wDhda6aCCr"}],"data":{},"key":"fpFMEXz4QS"},{"type":"paragraph","position":{"start":{"line":407,"column":1},"end":{"line":407,"column":1}},"children":[{"type":"text","value":"Here we plot the resulting values of ","position":{"start":{"line":407,"column":1},"end":{"line":407,"column":1}},"key":"l7DLzvqoji"},{"type":"inlineMath","value":"\\zeta=\\lambda \\tau","position":{"start":{"line":407,"column":1},"end":{"line":407,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>ζ</mi><mo>=</mo><mi>λ</mi><mi>τ</mi></mrow><annotation encoding=\"application/x-tex\">\\zeta=\\lambda \\tau</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8889em;vertical-align:-0.1944em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.07378em;\">ζ</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6944em;\"></span><span class=\"mord mathnormal\">λ</span><span class=\"mord mathnormal\" style=\"margin-right:0.1132em;\">τ</span></span></span></span>","key":"EQ4kLqcUVP"},{"type":"text","value":".","position":{"start":{"line":407,"column":1},"end":{"line":407,"column":1}},"key":"UsUpBhJtN5"}],"key":"L23J5NYOnh"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"zeta = lamb * max_tau\nfill(real(z), imag(z), color=(0.8, 0.8, 1))\nplot(real(zeta), imag(zeta), \"o\")\nxlabel(\"Re $\\\\lambda$\")\nylabel(\"Im $\\\\lambda$\")\naxis(\"equal\")\ntitle(\"Stability region and $\\zeta$ values\");","key":"kDsmSjbNFY"},{"type":"output","id":"A-cfAFWET51s23fxu2TlS","data":[{"output_type":"stream","name":"stderr","text":"<>:7: SyntaxWarning: invalid escape sequence '\\z'\n<>:7: SyntaxWarning: invalid escape sequence '\\z'\n/var/folders/gc/0752xrm56pnf0r0dsrn5370c0000gr/T/ipykernel_60652/2266119891.py:7: SyntaxWarning: invalid escape sequence '\\z'\n  title(\"Stability region and $\\zeta$ values\");\n"},{"output_type":"display_data","metadata":{},"data":{"text/plain":{"content":"<Figure size 700x400 with 1 Axes>","content_type":"text/plain"},"image/png":{"content_type":"image/png","hash":"951bbec1325b4483a18f2dc9985e23fb","path":"/build/951bbec1325b4483a18f2dc9985e23fb.png"}}}],"key":"iJs5eQbrne"}],"data":{},"key":"Ut6VuMD1hs"},{"type":"paragraph","position":{"start":{"line":419,"column":1},"end":{"line":419,"column":1}},"children":[{"type":"text","value":"In backward Euler, the region is ","position":{"start":{"line":419,"column":1},"end":{"line":419,"column":1}},"key":"dgL9CzOFwA"},{"type":"inlineMath","value":"|\\zeta-1|\\ge 1","position":{"start":{"line":419,"column":1},"end":{"line":419,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi mathvariant=\"normal\">∣</mi><mi>ζ</mi><mo>−</mo><mn>1</mn><mi mathvariant=\"normal\">∣</mi><mo>≥</mo><mn>1</mn></mrow><annotation encoding=\"application/x-tex\">|\\zeta-1|\\ge 1</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord\">∣</span><span class=\"mord mathnormal\" style=\"margin-right:0.07378em;\">ζ</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord\">1∣</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">≥</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">1</span></span></span></span>","key":"luCpKwbMPo"},{"type":"text","value":". Because they are all on the negative real axis, all of the ","position":{"start":{"line":419,"column":1},"end":{"line":419,"column":1}},"key":"jWz4TdNlrl"},{"type":"text","value":"ζ","position":{"start":{"line":419,"column":1},"end":{"line":419,"column":1}},"key":"Uu1I2hdsN1"},{"type":"text","value":" values will fit no matter what ","position":{"start":{"line":419,"column":1},"end":{"line":419,"column":1}},"key":"FMWjTgPsKG"},{"type":"text","value":"τ","position":{"start":{"line":419,"column":1},"end":{"line":419,"column":1}},"key":"MoWMR0mJ8z"},{"type":"text","value":" is chosen.","position":{"start":{"line":419,"column":1},"end":{"line":419,"column":1}},"key":"oCoB2owk5r"}],"key":"IUo0IZMFQV"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"fill([-6, 6, 6, -6], [-6, -6, 6, 6], color=(0.8, 0.8, 1))\nz = exp(1j * phi) + 1\n# unit circle shifted right by 1\nfill(real(z), imag(z), color=\"w\")\n\nplot(real(zeta), imag(zeta), \"o\")\naxis([-4, 2, -3, 3])\naxis(\"equal\")\nxlabel(\"Re $\\\\lambda$\")\nylabel(\"Im $\\\\lambda$\")\ntitle(\"Stability region and $\\\\zeta$ values\");","visibility":"hide","key":"EiKoVrDrdu"},{"type":"output","id":"rQa6bieb3F1k-VnvTjUh-","data":[{"output_type":"display_data","metadata":{},"data":{"text/plain":{"content":"<Figure size 700x400 with 1 Axes>","content_type":"text/plain"},"image/png":{"content_type":"image/png","hash":"053835080a0417db8f625192c67d1866","path":"/build/053835080a0417db8f625192c67d1866.png"}}}],"visibility":"show","key":"u8W1brwifb"}],"data":{"tags":[]},"visibility":"show","key":"MkIR7DeECB"}],"label":"demo-absstab-regions-python","identifier":"demo-absstab-regions-python","html_id":"demo-absstab-regions-python","key":"Pe1ErEmHMi"},{"type":"heading","depth":3,"position":{"start":{"line":438,"column":1},"end":{"line":438,"column":1}},"children":[{"type":"text","value":"11.4 ","position":{"start":{"line":438,"column":1},"end":{"line":438,"column":1}},"key":"RklqWfvKPV"},{"type":"link","identifier":"section-diffusion-stiffness","label":"section-diffusion-stiffness","kind":"narrative","position":{"start":{"line":438,"column":6},"end":{"line":438,"column":34}},"url":"/stiffness","internal":true,"dataUrl":"/stiffness.json","children":[{"type":"text","value":"Stiffness","key":"sEz1ibLNr1"}],"key":"OpUnuDMfOX"}],"identifier":"id-11-4","label":"11.4 ","html_id":"id-11-4","implicit":true,"key":"LmCNflf2tX"},{"type":"details","open":true,"children":[{"type":"summary","children":[{"type":"crossReference","identifier":"demo-stiffness-oregon","label":"demo-stiffness-oregon","kind":"proof:example","position":{"start":{"line":440,"column":1},"end":{"line":440,"column":23}},"children":[{"type":"text","value":"Example ","key":"LgqeZ1wrTc"},{"type":"text","value":"11.4.2","key":"PgQQmao0Pp"}],"template":"Example %s","enumerator":"11.4.2","resolved":true,"html_id":"demo-stiffness-oregon","remote":true,"url":"/stiffness","dataUrl":"/stiffness.json","key":"wtt2kiVGtE"}],"key":"XDBJlwVb5s"},{"type":"paragraph","position":{"start":{"line":442,"column":1},"end":{"line":442,"column":1}},"children":[{"type":"text","value":"In ","position":{"start":{"line":442,"column":1},"end":{"line":442,"column":1}},"key":"o6NR5R4Ipu"},{"type":"crossReference","kind":"proof:example","identifier":"example-stiffness-oregon","label":"example-stiffness-oregon","children":[{"type":"text","value":"Example ","key":"sjd9YE4Gqo"},{"type":"text","value":"11.4.1","key":"efIpRO8qyz"}],"template":"Example %s","enumerator":"11.4.1","resolved":true,"html_id":"example-stiffness-oregon","remote":true,"url":"/stiffness","dataUrl":"/stiffness.json","key":"dCwQLMrVp1"},{"type":"text","value":" we derived a Jacobian matrix for the Oregonator model. Here is a numerical solution of the ","key":"Q3kezeMP2x"},{"type":"abbreviation","title":"ordinary differential equation","children":[{"type":"text","value":"ODE","key":"R9lWIe38q0"}],"key":"BIH1fSt4Dx"},{"type":"text","value":".","key":"oZJlt48R7b"}],"key":"kJmUeWeTeq"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"from scipy.integrate import solve_ivp\nq, s, w = (8.375e-6, 77.27, 0.161)\n\ndef ode(t, u):\n    return array(\n        [\n            s * (u[1] - u[0] * u[1] + u[0] - q * u[0]**2),\n            (-u[1] - u[0] * u[1] + u[2]) / s,\n            w * (u[0] - u[2]),\n        ]\n    )\n\nu0 = array([1.0, 2.0, 3.0])\ntspan = (0, 500)\nstart = timer()\nsol = solve_ivp(ode, tspan, u0, method=\"BDF\")\nsemilogy(sol.t, sol.y.T)\nxlabel(\"$t$\"),  ylabel(\"$u(t)$\")\ntitle(\"Oregonator\");","visibility":"hide","key":"us3Np1qf08"},{"type":"output","id":"QYDp7kF9coymXCCrWoKcp","data":[{"output_type":"display_data","metadata":{},"data":{"text/plain":{"content":"<Figure size 700x400 with 1 Axes>","content_type":"text/plain"},"image/png":{"content_type":"image/png","hash":"5282df18c54c0dfe9d4350262352650d","path":"/build/5282df18c54c0dfe9d4350262352650d.png"}}}],"visibility":"show","key":"SsZHbmKIDx"}],"data":{"tags":[]},"visibility":"show","key":"iSCDs1iBby"},{"type":"paragraph","position":{"start":{"line":467,"column":1},"end":{"line":467,"column":1}},"children":[{"type":"text","value":"At each value of the numerical solution, we can compute the eigenvalues of the Jacobian. Here we plot all of those eigenvalues in the complex plane.","position":{"start":{"line":467,"column":1},"end":{"line":467,"column":1}},"key":"Sw2YE4S19P"}],"key":"hdUBKFXGXp"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"J = lambda u: array(\n    [\n        [-s * (u[1] + 1 - 2 * q * u[0]), s * (1 - u[0]), 0],\n        [-u[1] / s, (-1 - u[0]) / s, 1 / s],\n        [w, 0, -w],\n    ]\n)\n\nfrom scipy.linalg import eigvals\n\nlamb = array([eigvals(J(u)) for u in sol.y.T])\nax = figure().add_subplot(projection='3d')\nfor i in range(3):\n    ax.plot(real(lamb[:, i]), imag(lamb[:, i]), sol.t, \".\")\nax.set_xlabel(\"Re $\\\\lambda$\")\nax.set_ylabel(\"Im $\\\\lambda$\")\nax.set_zlabel(\"$t$\")\nax.set_title(\"Oregonator eigenvalues\");","visibility":"hide","key":"brN3yFShz1"},{"type":"output","id":"c-3GtYnWF92dcJtqepUQ3","data":[{"output_type":"display_data","metadata":{},"data":{"text/plain":{"content":"<Figure size 700x400 with 1 Axes>","content_type":"text/plain"},"image/png":{"content_type":"image/png","hash":"1eddf33e4ffcb2c01126cc161321a8bb","path":"/build/1eddf33e4ffcb2c01126cc161321a8bb.png"}}}],"visibility":"show","key":"Q4DMRJg6gP"}],"data":{"tags":[]},"visibility":"show","key":"Vc9B5qoHSP"},{"type":"paragraph","position":{"start":{"line":491,"column":1},"end":{"line":491,"column":1}},"children":[{"type":"text","value":"You can see that there is one eigenvalue that ranges over a wide portion of the negative real axis and dominates stability considerations.","position":{"start":{"line":491,"column":1},"end":{"line":491,"column":1}},"key":"zZXWcWOYGD"}],"key":"P1XmABQQop"}],"label":"demo-stiffness-oregon-python","identifier":"demo-stiffness-oregon-python","html_id":"demo-stiffness-oregon-python","key":"ct5NMwDsbk"},{"type":"details","open":true,"children":[{"type":"summary","children":[{"type":"crossReference","identifier":"demo-stiffness-explicit","label":"demo-stiffness-explicit","kind":"proof:example","position":{"start":{"line":495,"column":1},"end":{"line":495,"column":25}},"children":[{"type":"text","value":"Example ","key":"m9nL04aspR"},{"type":"text","value":"11.4.3","key":"wUsrtHJ8zR"}],"template":"Example %s","enumerator":"11.4.3","resolved":true,"html_id":"demo-stiffness-explicit","remote":true,"url":"/stiffness","dataUrl":"/stiffness.json","key":"W3Vg6WE3N4"}],"key":"kgHMP5TMyT"},{"type":"paragraph","position":{"start":{"line":497,"column":1},"end":{"line":497,"column":1}},"children":[{"type":"text","value":"The ","position":{"start":{"line":497,"column":1},"end":{"line":497,"column":1}},"key":"cqe3u53Sjr"},{"type":"inlineCode","value":"BDF","position":{"start":{"line":497,"column":1},"end":{"line":497,"column":1}},"key":"liZ6HGDubH"},{"type":"text","value":" solver is good for stiff problems and needs few time steps to solve the Oregonator from ","position":{"start":{"line":497,"column":1},"end":{"line":497,"column":1}},"key":"g0lxds1Pmx"},{"type":"crossReference","kind":"proof:example","identifier":"demo-stiffness-oregon","label":"demo-stiffness-oregon","children":[{"type":"text","value":"Demo ","key":"A4uyrfz2f2"},{"type":"text","value":"11.4.2","key":"Y38CyzAJw6"}],"template":"Example %s","enumerator":"11.4.2","resolved":true,"html_id":"demo-stiffness-oregon","remote":true,"url":"/stiffness","dataUrl":"/stiffness.json","key":"umCOQvG3oG"},{"type":"text","value":".","position":{"start":{"line":497,"column":1},"end":{"line":497,"column":1}},"key":"s8GLLcqisQ"}],"key":"ggP2dECskO"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"tspan = (0, 25)\nstart = timer()\nsol = solve_ivp(ode, tspan, u0, method=\"BDF\")\nprint(f\"stiff solver took {timer() - start:.3f} seconds with {len(sol.t) - 1} time steps\")","key":"iSFzstXtR5"},{"type":"output","id":"idL0i5Fr5zJHlm6WKmHQ4","data":[{"output_type":"stream","name":"stdout","text":"stiff solver took 0.078 seconds with 198 time steps\n"}],"key":"k6hnBVMhQB"}],"data":{},"key":"QhrQqBhH1C"},{"type":"paragraph","position":{"start":{"line":506,"column":1},"end":{"line":506,"column":1}},"children":[{"type":"text","value":"But if we apply ","position":{"start":{"line":506,"column":1},"end":{"line":506,"column":1}},"key":"XglIDvps5P"},{"type":"crossReference","kind":"proof:algorithm","identifier":"function-rk23","label":"function-rk23","children":[{"type":"text","value":"Function ","key":"pXsh5e7bsQ"},{"type":"text","value":"6.5.2","key":"JsdmHqYpnL"}],"template":"Algorithm %s","enumerator":"6.5.2","resolved":true,"html_id":"function-rk23","remote":true,"url":"/adaptive-rk","dataUrl":"/adaptive-rk.json","key":"B55bsxXmev"},{"type":"text","value":" to the problem, the step size will be made small enough to cope with the large negative eigenvalue.","position":{"start":{"line":506,"column":1},"end":{"line":506,"column":1}},"key":"jVDh6RelF5"}],"key":"TdYNPh7YF9"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"start = timer()\nt, u = FNC.rk23(ode, tspan, u0, 1e-6)\nprint(f\"rk23 solver took {timer() - start:.3f} seconds with {len(t) - 1} time steps\")","key":"whR90fXt9r"},{"type":"output","id":"aPnnuDLt_G7AqjMfN7deV","data":[{"output_type":"stream","name":"stdout","text":"rk23 solver took 2.521 seconds with 21388 time steps\n"}],"key":"sjH0pAyObE"}],"data":{},"key":"UCU2C1y9po"},{"type":"paragraph","position":{"start":{"line":514,"column":1},"end":{"line":514,"column":1}},"children":[{"type":"text","value":"Starting from the eigenvalues of the Jacobian matrix, we can find an effective ","position":{"start":{"line":514,"column":1},"end":{"line":514,"column":1}},"key":"ON5mg6gawZ"},{"type":"inlineMath","value":"\\zeta(t)","position":{"start":{"line":514,"column":1},"end":{"line":514,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>ζ</mi><mo stretchy=\"false\">(</mo><mi>t</mi><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">\\zeta(t)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.07378em;\">ζ</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">t</span><span class=\"mclose\">)</span></span></span></span>","key":"XLl5YI5FTj"},{"type":"text","value":" by multiplying with the local time step size. The values of ","position":{"start":{"line":514,"column":1},"end":{"line":514,"column":1}},"key":"yov5Q7FirC"},{"type":"inlineMath","value":"\\zeta(t)","position":{"start":{"line":514,"column":1},"end":{"line":514,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>ζ</mi><mo stretchy=\"false\">(</mo><mi>t</mi><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">\\zeta(t)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.07378em;\">ζ</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">t</span><span class=\"mclose\">)</span></span></span></span>","key":"Mfrb3Js0XD"},{"type":"text","value":" for each time level are plotted below and color coded by component of the diagonalized system.","position":{"start":{"line":514,"column":1},"end":{"line":514,"column":1}},"key":"sWwjJGFBa3"}],"key":"NSiYsEDyKG"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"zeta = zeros([len(t)- 1, 3]) + 0j    # complex array\nfor i in range(len(t) - 1):\n    dt = t[i+1] - t[i]\n    lamb = eigvals(J(u[:, i]))\n    zeta[i] = lamb * dt\nplot(real(zeta), imag(zeta), \".\")\naxis(\"equal\")\nxlabel(\"Re $\\\\zeta$\")\nylabel(\"Im $\\\\zeta$\")\ntitle(\"Oregonator stability\");","visibility":"hide","key":"D1S6uMVJQt"},{"type":"output","id":"1Nm6DPRBoH_JU8F-4WfpL","data":[{"output_type":"display_data","metadata":{},"data":{"text/plain":{"content":"<Figure size 700x400 with 1 Axes>","content_type":"text/plain"},"image/png":{"content_type":"image/png","hash":"38ddc3f80b02a0930f3222478dd9f41c","path":"/build/38ddc3f80b02a0930f3222478dd9f41c.png"}}}],"visibility":"show","key":"e4AYpLDyuC"}],"data":{"tags":[]},"visibility":"show","key":"HgrEaBSAjj"},{"type":"paragraph","position":{"start":{"line":530,"column":1},"end":{"line":530,"column":1}},"children":[{"type":"text","value":"Roughly speaking, the ","position":{"start":{"line":530,"column":1},"end":{"line":530,"column":1}},"key":"MRQctZyWc2"},{"type":"text","value":"ζ","position":{"start":{"line":530,"column":1},"end":{"line":530,"column":1}},"key":"FUtFHczHhP"},{"type":"text","value":" values stay within or close to the RK2 stability region in ","position":{"start":{"line":530,"column":1},"end":{"line":530,"column":1}},"key":"Z71HwuaNe5"},{"type":"crossReference","kind":"figure","identifier":"figure-stabreg_bd_rk","label":"figure-stabreg_bd_rk","children":[{"type":"text","value":"Figure ","key":"OtaFkOIh5l"},{"type":"text","value":"11.3.2","key":"MAGFFOIT2n"}],"template":"Figure %s","enumerator":"11.3.2","resolved":true,"html_id":"figure-stabreg-bd-rk","remote":true,"url":"/absstab-diffusion","dataUrl":"/absstab-diffusion.json","key":"h8LY0ghxhq"},{"type":"text","value":". Momentary departures from the region are possible, but time stepping repeatedly in that situation would cause instability.","position":{"start":{"line":530,"column":1},"end":{"line":530,"column":1}},"key":"c8hOXPpxDL"}],"key":"b94VdXalrO"}],"label":"demo-stiffness-explicit-python","identifier":"demo-stiffness-explicit-python","html_id":"demo-stiffness-explicit-python","key":"FWR7vFW4KG"},{"type":"heading","depth":3,"position":{"start":{"line":534,"column":1},"end":{"line":534,"column":1}},"children":[{"type":"text","value":"11.5 ","position":{"start":{"line":534,"column":1},"end":{"line":534,"column":1}},"key":"yWR8sZRlYd"},{"type":"link","identifier":"section-diffusion-boundaries","label":"section-diffusion-boundaries","kind":"narrative","position":{"start":{"line":534,"column":6},"end":{"line":534,"column":35}},"url":"/boundaries","internal":true,"dataUrl":"/boundaries.json","children":[{"type":"text","value":"Boundaries","key":"jYszcw2H5m"}],"key":"vmobBQ2a3P"}],"identifier":"id-11-5","label":"11.5 ","html_id":"id-11-5","implicit":true,"key":"bMVtoJYNBG"},{"type":"details","open":true,"children":[{"type":"summary","children":[{"type":"crossReference","identifier":"demo-boundaries-heat","label":"demo-boundaries-heat","kind":"proof:example","position":{"start":{"line":536,"column":1},"end":{"line":536,"column":22}},"children":[{"type":"text","value":"Example ","key":"hqigLm1ZF1"},{"type":"text","value":"11.5.3","key":"Gd5VDDD4OJ"}],"template":"Example %s","enumerator":"11.5.3","resolved":true,"html_id":"demo-boundaries-heat","remote":true,"url":"/boundaries","dataUrl":"/boundaries.json","key":"aMXK4a5CGS"}],"key":"kk7XLpTzY6"},{"type":"paragraph","position":{"start":{"line":538,"column":1},"end":{"line":538,"column":1}},"children":[{"type":"text","value":"First, we define functions for the ","key":"RIoyIV1Xxj"},{"type":"abbreviation","title":"partial differential equation","children":[{"type":"text","value":"PDE","key":"iTNWutIohl"}],"key":"cgRH7P35AU"},{"type":"text","value":" and each boundary condition.","key":"GbCDdOsFEe"}],"key":"cmU1teop6J"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"phi = lambda t, x, u, ux, uxx: uxx\nga = lambda u, ux: u\ngb = lambda u, ux: u - 2","key":"Xvbmgv28YU"},{"type":"output","id":"ebyS3VbuOh_a7VU4vtG14","data":[],"key":"UlUAkhA9MW"}],"data":{},"key":"qqAXPFIvQS"},{"type":"paragraph","position":{"start":{"line":546,"column":1},"end":{"line":546,"column":1}},"children":[{"type":"text","value":"Our next step is to write a function to define the initial condition. This one satisfies the boundary conditions exactly.","position":{"start":{"line":546,"column":1},"end":{"line":546,"column":1}},"key":"cBp0ijHKau"}],"key":"Z7GmAAfC0t"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"init = lambda x: 1 + sin(pi * x/2) + 3 * (1 - x**2) * exp(-4*x**2)","key":"WfpVbA1PIl"},{"type":"output","id":"GKsVqL8Geb5wQ75GcUoLk","data":[],"key":"a8GoVtoo4f"}],"data":{},"key":"vEBovpTWaV"},{"type":"paragraph","position":{"start":{"line":552,"column":1},"end":{"line":552,"column":1}},"children":[{"type":"text","value":"Now we can use ","position":{"start":{"line":552,"column":1},"end":{"line":552,"column":1}},"key":"goxk5Axpsd"},{"type":"crossReference","kind":"proof:algorithm","identifier":"function-parabolic","label":"function-parabolic","children":[{"type":"text","value":"Function ","key":"TWGXJbs6vC"},{"type":"text","value":"11.5.2","key":"v90ucP30Df"}],"template":"Algorithm %s","enumerator":"11.5.2","resolved":true,"html_id":"function-parabolic","remote":true,"url":"/boundaries","dataUrl":"/boundaries.json","key":"oUoK0ynXhi"},{"type":"text","value":" to solve the problem.","position":{"start":{"line":552,"column":1},"end":{"line":552,"column":1}},"key":"vAoKbiroyW"}],"key":"IQO0Visa1i"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"x, u = FNC.parabolic(phi, (-1, 1), 60, ga, gb, (0, 0.75), init)\n\nfor t in arange(0,0.5,0.1):\n    plot(x, u(t), label=f\"t={t:.2f}\")\nxlabel(\"$x$\"),  ylabel(\"$u(x,t)$\")\nlegend()\ntitle(\"Heat equation with Dirichlet boundaries\");","key":"Jlm8WOOKnn"},{"type":"output","id":"ybqtnOhuyB1FqrQs5strK","data":[{"output_type":"display_data","metadata":{},"data":{"text/plain":{"content":"<Figure size 700x400 with 1 Axes>","content_type":"text/plain"},"image/png":{"content_type":"image/png","hash":"0e464ea7b5d017fde9737a36e3e5cca2","path":"/build/0e464ea7b5d017fde9737a36e3e5cca2.png"}}}],"key":"lPELanSvap"}],"data":{},"key":"rM29AEGh0c"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"from matplotlib import animation\nfig = figure()\nax = fig.add_subplot(autoscale_on=False, xlim=(-1, 1), ylim=(0, 4.2))\n\nline, = ax.plot([], [], '-')\nax.set_title(\"Heat equation with Dirichlet boundaries\")\ntime_text = ax.text(0.05, 0.9, '', transform=ax.transAxes)\n\ndef animate(t):\n    line.set_data(x, u(t))\n    time_text.set_text(f\"t = {t:.2e}\")\n    return line, time_text\n\nanim = animation.FuncAnimation(\n    fig, animate, frames=linspace(0, 0.75, 201), blit=True)\nanim.save(\"figures/boundaries-heat.mp4\", fps=30)\nclose()","visibility":"hide","key":"d9EptOl7Rx"},{"type":"output","id":"V-y3Cp2mCHVT7GF1cF1L6","data":[],"visibility":"show","key":"VrQ3rbvt5p"}],"data":{"tags":[]},"visibility":"show","key":"gzuJuuaG39"},{"type":"image","url":"/build/boundaries-heat-9cc50bdb43861451ebce0181543ff17b.mp4","alt":"Heat equation with Dirichlet boundaries","position":{"start":{"line":584,"column":1},"end":{"line":584,"column":1}},"key":"yymhhXhUVU","urlSource":"figures/boundaries-heat.mp4"}],"label":"demo-boundaries-heat-python","identifier":"demo-boundaries-heat-python","html_id":"demo-boundaries-heat-python","key":"wm6IU0tbad"},{"type":"details","open":true,"children":[{"type":"summary","children":[{"type":"crossReference","identifier":"demo-boundaries-bratu","label":"demo-boundaries-bratu","kind":"proof:example","position":{"start":{"line":590,"column":1},"end":{"line":590,"column":23}},"children":[{"type":"text","value":"Example ","key":"tKLxJmmZo1"},{"type":"text","value":"11.5.4","key":"zLqcD9C4C8"}],"template":"Example %s","enumerator":"11.5.4","resolved":true,"html_id":"demo-boundaries-bratu","remote":true,"url":"/boundaries","dataUrl":"/boundaries.json","key":"oIY7sP9HfA"}],"key":"WCmu8Q5MSQ"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"phi = lambda t, x, u, ux, uxx: u**2 + uxx\nga = lambda u, ux: u\ngb = lambda u, ux: ux\ninit = lambda x: 400 * x**4 * (1 - x)**2\nx, u = FNC.parabolic(phi, (0, 1), 60, ga, gb, (0, 0.1), init);","key":"VpXGb3gjh4"},{"type":"output","id":"Mbl5IaUBie4lHTpXnBbMC","data":[],"key":"ZC5t74qxK4"}],"data":{},"key":"ol7zwNKAgx"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"fig = figure()\nax = fig.add_subplot(autoscale_on=False, xlim=(0, 1), ylim=(0, 10))\n\nline, = ax.plot([], [], '-')\nax.set_title(\"Heat equation with source\")\ntime_text = ax.text(0.05, 0.9, '', transform=ax.transAxes)\n\nanim = animation.FuncAnimation(\n    fig, animate, frames=linspace(0, 0.1, 101), blit=True)\nanim.save(\"figures/boundaries-source.mp4\", fps=30)\nclose()","visibility":"hide","key":"YkS2CBNTJM"},{"type":"output","id":"bs6_S2SGXMastqR5U9v0T","data":[],"visibility":"show","key":"PONr9U3UDu"}],"data":{"tags":[]},"visibility":"show","key":"ZBzsC8ttw1"},{"type":"image","url":"/build/boundaries-source-a7f4d213ad50358bd13aac85e1cd279b.mp4","alt":"Heat equation with source","position":{"start":{"line":616,"column":1},"end":{"line":616,"column":1}},"key":"m6OIc4uCwv","urlSource":"figures/boundaries-source.mp4"}],"label":"demo-boundaries-bratu-python","identifier":"demo-boundaries-bratu-python","html_id":"demo-boundaries-bratu-python","key":"xOSfcdDza4"},{"type":"details","open":true,"children":[{"type":"summary","children":[{"type":"crossReference","identifier":"demo-boundaries-bs","label":"demo-boundaries-bs","kind":"proof:example","position":{"start":{"line":620,"column":1},"end":{"line":620,"column":20}},"children":[{"type":"text","value":"Example ","key":"JYOYjjuLye"},{"type":"text","value":"11.5.5","key":"pOfeqX0pwH"}],"template":"Example %s","enumerator":"11.5.5","resolved":true,"html_id":"demo-boundaries-bs","remote":true,"url":"/boundaries","dataUrl":"/boundaries.json","key":"NSFSZA0Snp"}],"key":"IfC3YgHedI"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"K = 3;  sigma = 0.06;  r = 0.08;  Smax = 8;\nphi = lambda t, x, u, ux, uxx: sigma**2/2 * (x**2 * uxx) + r*x*ux - r*u\nga = lambda u, ux: u\ngb = lambda u, ux: ux - 1","key":"xVp6mieVsg"},{"type":"output","id":"WH4IksC0yc32zkNuDcwM4","data":[],"key":"R1JcposM76"}],"data":{},"key":"oaWL2TNww5"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"u0 = lambda x: maximum(0, x - K)\nx, u = FNC.parabolic(phi, (0, Smax), 80, ga, gb, (0, 15), u0);","key":"Zt11tJbprB"},{"type":"output","id":"EeQVfaOvUa_bUOF1RT4w5","data":[],"key":"n6M8kB3Yy1"}],"data":{},"key":"jlpRzzb3pn"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"fig = figure()\nax = fig.add_subplot(autoscale_on=False, xlim=(0, Smax), ylim=(-0.5, 8))\n\nline, = ax.plot([], [], '-')\nax.set_title(\"Black–Scholes equation with boundaries\")\ntime_text = ax.text(0.05, 0.9, '', transform=ax.transAxes)\n\nanim = animation.FuncAnimation(\n    fig, animate, frames=linspace(0, 15, 151), blit=True)\nanim.save(\"figures/boundaries-bs.mp4\", fps=30)\nclose()","visibility":"hide","key":"hLpAJEJnfZ"},{"type":"output","id":"sxxnIf6FMU9I9wusmZDLs","data":[],"visibility":"show","key":"Yx4ERjXR7D"}],"data":{"tags":[]},"visibility":"show","key":"cQLZSdHKwa"},{"type":"image","url":"/build/boundaries-bs-304643e987e12ff1ba4c31c99dacd539.mp4","alt":"Black–Scholes equation with boundaries","position":{"start":{"line":649,"column":1},"end":{"line":649,"column":1}},"key":"LJqPZGrlrC","urlSource":"figures/boundaries-bs.mp4"},{"type":"paragraph","position":{"start":{"line":651,"column":1},"end":{"line":651,"column":1}},"children":[{"type":"text","value":"Recall that ","position":{"start":{"line":651,"column":1},"end":{"line":651,"column":1}},"key":"JBlMljtODi"},{"type":"inlineMath","value":"u","position":{"start":{"line":651,"column":1},"end":{"line":651,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>u</mi></mrow><annotation encoding=\"application/x-tex\">u</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">u</span></span></span></span>","key":"fN9lA2Q0pK"},{"type":"text","value":" is the value of the call option, and time runs backward from the strike time. The longer the horizon, the more value the option has due to anticipated growth in the stock price.","position":{"start":{"line":651,"column":1},"end":{"line":651,"column":1}},"key":"e9u9FXLkty"}],"key":"qvAyHIK2EV"}],"label":"demo-boundaries-bs-python","identifier":"demo-boundaries-bs-python","html_id":"demo-boundaries-bs-python","key":"GPwSQaYxYA"}],"key":"pZdps2BkoJ"}],"key":"E9XpDtqZJC"},"references":{"cite":{"order":[],"data":{}}},"footer":{"navigation":{"prev":{"title":"Chapter 10","url":"/chapter10-2","group":"Python codes"},"next":{"title":"Chapter 12","url":"/chapter12-2","group":"Python codes"}}},"domain":"http://localhost:3000"}