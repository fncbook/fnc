{"kind":"Notebook","sha256":"00aa36b12979636e3a3fe363e130d5b9317751715874ddb85b5a0483aa923891","slug":"stiff-2","location":"/chapter6/section7/python/stiff.ipynb","dependencies":[],"frontmatter":{"numbering":{"heading_1":{"enabled":false},"heading_2":{"enabled":false},"heading_3":{"enabled":false},"heading_4":{"enabled":false},"heading_5":{"enabled":false},"heading_6":{"enabled":false}},"kernelspec":{"name":"python3","display_name":"Python 3","language":"python"},"authors":[{"nameParsed":{"literal":"Tobin A. Driscoll","given":"Tobin A.","family":"Driscoll"},"name":"Tobin A. Driscoll","email":"driscoll@udel.edu","id":"contributors-myst-generated-uid-0","corresponding":true},{"nameParsed":{"literal":"Richard J. Braun","given":"Richard J.","family":"Braun"},"name":"Richard J. Braun","id":"contributors-myst-generated-uid-1"}],"github":"https://github.com/fncbook/fnc","math":{"\\float":{"macro":"\\mathbb{F}"},"\\real":{"macro":"\\mathbb{R}"},"\\complex":{"macro":"\\mathbb{C}"},"\\nat":{"macro":"\\mathbb{N}"},"\\integer":{"macro":"\\mathbb{Z}"},"\\rmn":{"macro":"\\mathbb{R}^{#1 \\times #2}"},"\\dd":{"macro":"\\frac{d #1}{d #2}"},"\\ddd":{"macro":"\\frac{d^2 #1}{d #2^2}"},"\\pp":{"macro":"\\frac{\\partial #1}{\\partial #2}"},"\\ppp":{"macro":"\\frac{\\partial^2 #1}{\\partial #2^2}"},"\\ppdd":{"macro":"\\frac{\\partial^2 #1}{\\partial #2 \\partial #3}"},"\\abs":{"macro":"\\left\\lvert #1 \\right\\rvert"},"\\norm":{"macro":"\\left\\lVert #1 \\right\\rVert"},"\\twonorm":{"macro":"\\norm{#1}_2"},"\\onenorm":{"macro":"\\norm{#1}_1"},"\\infnorm":{"macro":"\\norm{#1}_\\infty"},"\\anynorm":{"macro":"\\norm{#1}_#2"},"\\innerprod":{"macro":"\\langle #1,#2 \\rangle"},"\\pr":{"macro":"^{(#1)}"},"\\kron":{"macro":"#1 \\otimes #2"},"\\eye":{"macro":"\\mathbf{e}_#1"},"\\meye":{"macro":"\\mathbf{I}"},"\\Qhat":{"macro":"\\hat{\\mathbf{Q}}"},"\\Rhat":{"macro":"\\hat{\\mathbf{R}}"},"\\bfalpha":{"macro":"\\mathbf{alpha}"},"\\bfdelta":{"macro":"\\mathbf{delta}"},"\\bfzero":{"macro":"\\boldsymbol{0}"},"\\macheps":{"macro":"\\epsilon_\\text{mach}"},"\\fl":{"macro":"\\operatorname{fl}"},"\\diag":{"macro":"\\operatorname{diag}"},"\\ign":{"macro":"\\operatorname{sign}"},"\\Re":{"macro":"\\operatorname{Re}"},"\\Im":{"macro":"\\operatorname{Im}"},"\\ee":{"macro":"\\times 10^"},"\\lnorm":{"macro":"\\|"},"\\rnorm":{"macro":"\\|"},"\\floor":{"macro":"\\lfloor#1\\rfloor"},"\\cI":{"macro":"\\mathcal{I}"},"\\mtx":{"macro":"\\operatorname{mtx}"},"\\myvec":{"macro":"\\operatorname{vec}"},"\\argmin":{"macro":"\\operatorname{argmin}"}},"abbreviations":{"IVP":"initial-value problem","BVP":"boundary-value problem","ONC":"matrix with orthonormal columns","SVD":"singular value decomposition","EVD":"eigenvalue decomposition","SPD":"symmetric positive definite","HPD":"hermitian positive definite","PDE":"partial differential equation","ODE":"ordinary differential equation"},"exports":[{"format":"ipynb","filename":"stiff.ipynb","url":"/build/stiff-6a05cf552518c061aa6170802892f2f5.ipynb"}]},"widgets":{},"mdast":{"type":"root","children":[{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2025-01-11T16:37:33.790051Z","iopub.status.busy":"2025-01-11T16:37:33.789886Z","iopub.status.idle":"2025-01-11T16:37:34.118077Z","shell.execute_reply":"2025-01-11T16:37:34.117750Z"},"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"exec(open(\"../../../python/FNC_init.py\").read())","visibility":"show","key":"i2w16UpDYM"},{"type":"output","id":"rqoWeNXGWBAKbK-wS58x1","data":[],"visibility":"show","key":"QndkfgEZkR"}],"visibility":"remove","key":"bkz5T1wZ4T"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"crossReference","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"strong","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Demo ","key":"pabqMmoNCD"},{"type":"text","value":"6.7.2","key":"OigQvME9N6"}],"key":"HVbcfRCiFE"}],"identifier":"demo-implicit-stiff","label":"demo-implicit-stiff","kind":"proof:example","template":"Example %s","enumerator":"6.7.2","resolved":true,"html_id":"demo-implicit-stiff","remote":true,"url":"/implicit","dataUrl":"/implicit.json","key":"etcbBE5TXQ"}],"key":"RtnMIs8sG8"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"The following simple ","key":"aLvH9QUCcg"},{"type":"abbreviation","title":"ordinary differential equation","children":[{"type":"text","value":"ODE","key":"TALlrs5gpJ"}],"key":"mEywfekAg7"},{"type":"text","value":" uncovers a surprise.","key":"fi5qTGcUuB"}],"key":"Qv8VKhS47a"}],"key":"eOCuobXI8R"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2025-01-11T16:37:34.119733Z","iopub.status.busy":"2025-01-11T16:37:34.119601Z","iopub.status.idle":"2025-01-11T16:37:34.121573Z","shell.execute_reply":"2025-01-11T16:37:34.121297Z"}},"children":[{"type":"code","lang":"python","executable":true,"value":"f = lambda t, u: u**2 - u**3\nu0 = array([0.005])\ntspan = [0, 400]","key":"AjR7l1mv1X"},{"type":"output","id":"5KAa_cr5oNMubYdgodMlo","data":[],"key":"V5lwrvEkkg"}],"key":"GWM6eDbNAz"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"We will solve the problem first with the implicit AM2 method using ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"KJVjneiD0Q"},{"type":"inlineMath","value":"n=200","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>n</mi><mo>=</mo><mn>200</mn></mrow><annotation encoding=\"application/x-tex\">n=200</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">n</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">200</span></span></span></span>","key":"OHCgvnm6HR"},{"type":"text","value":" steps.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"yg1sehOU59"}],"key":"WCPT5chLdF"}],"key":"UPhDONizZk"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2025-01-11T16:37:34.122827Z","iopub.status.busy":"2025-01-11T16:37:34.122746Z","iopub.status.idle":"2025-01-11T16:37:34.263316Z","shell.execute_reply":"2025-01-11T16:37:34.263043Z"}},"children":[{"type":"code","lang":"python","executable":true,"value":"tI, uI = FNC.am2(f, [0.0, 400.0], u0, 200)\nfig, ax = subplots()\nax.plot(tI, uI[0], label=\"AM2\")\nxlabel(\"$t$\"), ylabel(\"$y(t)$\");","key":"WxknSysln9"},{"type":"output","id":"VoEnk3b8mVF4aQ4iBSptp","data":[{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"fef8135e4aa29a89d4e5d72437989558","path":"/build/fef8135e4aa29a89d4e5d72437989558.png"},"text/plain":{"content":"<Figure size 700x400 with 1 Axes>","content_type":"text/plain"}}}],"key":"SHuP7ksXiF"}],"key":"Lkz0z3AJyM"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"So far, so good. Now we repeat the process using the explicit AB4 method.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"DJcuutxixL"}],"key":"n9MPP3EFbn"}],"key":"BSJgWRylKg"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2025-01-11T16:37:34.266864Z","iopub.status.busy":"2025-01-11T16:37:34.266753Z","iopub.status.idle":"2025-01-11T16:37:34.314828Z","shell.execute_reply":"2025-01-11T16:37:34.314567Z"}},"children":[{"type":"code","lang":"python","executable":true,"value":"tE, uE = FNC.ab4(f, [0.0, 400.0], u0, 200)\nax.scatter(tE, uE[0], label=\"AB4\")\nax.set_ylim([-4, 2]), ax.legend()\nfig","key":"hURUEdHvS6"},{"type":"output","id":"eLMFcF5VahzCRh4ReSaY2","data":[{"name":"stderr","output_type":"stream","text":"/var/folders/gc/0752xrm56pnf0r0dsrn5370c0000gr/T/ipykernel_25826/862619530.py:1: RuntimeWarning: overflow encountered in square\n  f = lambda t, u: u**2 - u**3\n/var/folders/gc/0752xrm56pnf0r0dsrn5370c0000gr/T/ipykernel_25826/862619530.py:1: RuntimeWarning: overflow encountered in power\n  f = lambda t, u: u**2 - u**3\n/var/folders/gc/0752xrm56pnf0r0dsrn5370c0000gr/T/ipykernel_25826/862619530.py:1: RuntimeWarning: invalid value encountered in subtract\n  f = lambda t, u: u**2 - u**3\n"},{"output_type":"execute_result","execution_count":4,"metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"c6c197110e00077b6daacac32ca51f40","path":"/build/c6c197110e00077b6daacac32ca51f40.png"},"text/plain":{"content":"<Figure size 700x400 with 1 Axes>","content_type":"text/plain"}}}],"key":"i8rbfu0uI5"}],"key":"lHsiQipwyf"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Once the solution starts to take off, the AB4 result goes catastrophically wrong.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"ppqWdKXaKw"}],"key":"skUC4vXmdr"}],"key":"nfVsIIOOEx"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2025-01-11T16:37:34.316174Z","iopub.status.busy":"2025-01-11T16:37:34.316076Z","iopub.status.idle":"2025-01-11T16:37:34.318220Z","shell.execute_reply":"2025-01-11T16:37:34.317967Z"}},"children":[{"type":"code","lang":"python","executable":true,"value":"uE[0, 104:111]","key":"IFCGR6kTkM"},{"type":"output","id":"yhDSwmo4TIMwoTTDe5OFz","data":[{"output_type":"execute_result","execution_count":5,"metadata":{},"data":{"text/plain":{"content":"array([ 7.55385780e-01,  1.43729703e+00, -3.28897685e+00,  2.14179113e+02,\n       -4.48208915e+07,  4.12689029e+23, -3.22144124e+71])","content_type":"text/plain"}}}],"key":"uleKj9DpjY"}],"key":"x0KIN0ojmK"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"We hope that AB4 will converge in the limit ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"fTWcr3m1PO"},{"type":"inlineMath","value":"h\\to 0","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>h</mi><mo>→</mo><mn>0</mn></mrow><annotation encoding=\"application/x-tex\">h\\to 0</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6944em;\"></span><span class=\"mord mathnormal\">h</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">→</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">0</span></span></span></span>","key":"yv2du2H9Wa"},{"type":"text","value":", so let’s try using more steps.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"Szl0zdVQir"}],"key":"vJ30eD29q1"}],"key":"BWMYpuf6zx"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2025-01-11T16:37:34.319448Z","iopub.status.busy":"2025-01-11T16:37:34.319365Z","iopub.status.idle":"2025-01-11T16:37:34.427465Z","shell.execute_reply":"2025-01-11T16:37:34.427212Z"}},"children":[{"type":"code","lang":"python","executable":true,"value":"plot(tI, uI[0], color=\"k\", label=\"AM2\")\ntE, uE = FNC.ab4(f, [0, 400], u0, 1000)\nplot(tE, uE[0], \".-\", label=\"AM4, n=1000\")\ntE, uE = FNC.ab4(f, [0, 400], u0, 1600)\nplot(tE, uE[0], \".-\", label=\"AM4, n=1600\")\nxlabel(\"$t$\"),  ylabel(\"$u(t)$\")\nlegend();","key":"Dlo1d7MmZ3"},{"type":"output","id":"0Kf2WstgUQn-3MxvvTA48","data":[{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"e2487bd3b5b88bea9b7573ef7ff0634b","path":"/build/e2487bd3b5b88bea9b7573ef7ff0634b.png"},"text/plain":{"content":"<Figure size 700x400 with 1 Axes>","content_type":"text/plain"}}}],"key":"kBLixzhNJf"}],"key":"Tq7qZl9B8U"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"So AB4, which is supposed to be ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"kWH6NnoAxa"},{"type":"emphasis","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"more","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"aIcQJllyFs"}],"key":"GW4ZuWAcdp"},{"type":"text","value":" accurate than AM2, actually needs something like 8 times as many steps to get a reasonable-looking answer!","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"tL0EfiL0gE"}],"key":"azdrrl6cm7"}],"key":"hymgEimLH2"}],"key":"Y86YW8htFI"},"references":{"cite":{"order":[],"data":{}}},"footer":{"navigation":{"prev":{"title":"Ab4","url":"/ab4-2","group":"Chapter 6"},"next":{"title":"LIAF","url":"/liaf-2","group":"Chapter 6"}}},"domain":"http://localhost:3000"}