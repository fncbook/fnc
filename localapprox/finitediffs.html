

<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <title>Finite differences &#8212; Fundamentals of Numerical Computation</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/all.min.css" integrity="sha384-KA6wR/X5RY4zFAHpv/CnoG2UW1uogYfdnP67Uv7eULvTveboZJg0qUpmJZb5VqzN" crossorigin="anonymous">
    <link href="../_static/css/index.css" rel="stylesheet">
    <link rel="stylesheet" href="../_static/sphinx-book-theme.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../_static/proof.css" />
    <link rel="stylesheet" type="text/css" href="../_static/custom.css" />
    <link rel="stylesheet" type="text/css" href="../_static/proof.css" />
    <link rel="stylesheet" type="text/css" href="../_static/jupyter-sphinx.css" />
    <script id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script src="../_static/sphinx-book-theme.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/language_data.js"></script>
    <script src="../_static/togglebutton.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script src="../_static/mystnb.js"></script>
    <script src="../_static/proof.js"></script>
    <script src="../_static/sphinx-book-theme.js"></script>
    <script >var togglebuttonSelector = '.toggle, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="https://unpkg.com/@jupyter-widgets/html-manager@^0.18.0/dist/embed-amd.js"></script>
    <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/x-mathjax-config">MathJax.Hub.Config({"TeX": {"Macros": {"float": ["\\mathbb{F}"], "real": ["\\mathbb{R}"], "complex": ["\\mathbb{C}"], "nat": ["\\mathbb{N}"], "integer": ["\\mathbb{Z}"], "rmn{([^}]*)}{([^}]*)}": ["\\mathbb{R}^{#1 \\times #2}", 2], "dd{([^}]*)}{([^}]*)}": ["\\frac{d #1}{d #2}", 2], "ddd{([^}]*)}{([^}]*)}": ["\\frac{d^2 #1}{d #2^2}", 2], "pp{([^}]*)}{([^}]*)}": ["\\frac{\\partial #1}{\\partial #2}", 2], "ppp{([^}]*)}{([^}]*)}": ["\\frac{\\partial^2 #1}{\\partial #2^2}", 2], "ppdd{([^}]*)}{([^}]*)}{([^}]*)}": ["\\frac{\\partial^2 #1}{\\partial #2 \\partial #3}", 3], "norm{([^}]*)}": ["\\| #1 \\|", 1], "twonorm{([^}]*)}": ["\\| #1 \\|_2", 1], "onenorm{([^}]*)}": ["\\| #1 \\|_1", 1], "infnorm{([^}]*)}": ["\\| #1 \\|_\\infty", 1], "anynorm{([^}]*)}{([^}]*)}": ["\\| #1 \\|_#2", 2], "innerprod{([^}]*)}{([^}]*)}": ["\\langle #1,#2 \\rangle", 2], "pr{([^}]*)}": ["^{(#1)}", 1], "kron{([^}]*)}{([^}]*)}": ["#1 \\otimes #2", 2], "eye{([^}]*)}": ["\\mathbf{e}_#1", 1], "meye": ["\\mathbf{I}"], "Qhat": ["\\hat{\\mathbf{Q}}"], "Rhat": ["\\hat{\\mathbf{R}}"], "bfalpha": ["\\mathbf{alpha}"], "bfdelta": ["\\mathbf{delta}"], "bfzero": ["\\boldsymbol{0}"], "macheps": ["\\epsilon_\\text{mach}"], "fl": ["\\operatorname{fl}"], "diag": ["\\operatorname{diag}"], "ign": ["\\operatorname{sign}"], "Re": ["\\operatorname{Re}"], "Im": ["\\operatorname{Im}"], "ee": ["\\times 10^"], "lnorm": ["\\|"], "rnorm": ["\\|"], "floor": ["\\lfloor#1\\rfloor", 1]}}})</script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Convergence of finite differences" href="fd-converge.html" />
    <link rel="prev" title="Cubic splines" href="splines.html" />

    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="docsearch:language" content="en">



  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
<a class="navbar-brand text-wrap" href="../index.html">
  
  <img src="../_static/logo.png" class="logo" alt="logo">
  
  
  <h1 class="site-logo" id="site-title">Fundamentals of Numerical Computation</h1>
  
</a>
</div>

<form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form>

<nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
  
  <ul class="nav sidenav_l1">
  <li class="">
    <a href="../frontmatter.html">Home</a>
  </li>
  <li class="">
    <a href="../intro/overview.html">Introduction</a>
  </li>
  <li class="">
    <a href="../linsys/overview.html">Square linear systems</a>
  </li>
  <li class="">
    <a href="../leastsq/overview.html">Overdetermined linear systems</a>
  </li>
  <li class="">
    <a href="../nonlineqn/overview.html">Roots of nonlinear equations</a>
  </li>
  <li class="active">
    <a href="overview.html">Piecewise interpolation</a>
  <ul class="nav sidenav_l2">
    <li class="">
      <a href="interpolation.html">The interpolation problem</a>
    </li>
    <li class="">
      <a href="pwlin.html">Piecewise linear interpolation</a>
    </li>
    <li class="">
      <a href="splines.html">Cubic splines</a>
    </li>
    <li class="active">
      <a href="">Finite differences</a>
    </li>
    <li class="">
      <a href="fd-converge.html">Convergence of finite differences</a>
    </li>
    <li class="">
      <a href="integration.html">Numerical integration</a>
    </li>
    <li class="">
      <a href="adaptive.html">Adaptive integration</a>
    </li>
    <li class="">
      <a href="next.html">Next steps</a>
    </li>
  </ul>
  </li>
  <li class="">
    <a href="../ivp/overview.html">Initial-value problems for ODEs</a>
  </li>
  <li class="">
    <a href="../appendix/linear-algebra.html">Review: Linear algebra</a>
  </li>
  <li class="">
    <a href="../appendix/demos.html">All demo notebooks</a>
  </li>
  <li class="">
    <a href="../refs.html">References</a>
  </li>
  <li class="">
    <a href="../genindex.html">Index</a>
  </li>
</ul>
</nav>

 <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="row topbar fixed-top container-xl">
    <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show">
    </div>
    <div class="col pl-2 topbar-main">
        
        <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse" data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu" aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation" title="Toggle navigation" data-toggle="tooltip" data-placement="left">
            <i class="fas fa-bars"></i>
            <i class="fas fa-arrow-left"></i>
            <i class="fas fa-arrow-up"></i>
        </button>
        
        <div class="dropdown-buttons-trigger">
            <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i class="fas fa-download"></i></button>

            
            <div class="dropdown-buttons">
                <!-- ipynb file if we had a myst markdown file -->
                
                <!-- Download raw file -->
                <a class="dropdown-buttons" href="../_sources/localapprox/finitediffs.md"><button type="button" class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip" data-placement="left">.md</button></a>
                <!-- Download PDF via print -->
                <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF" onClick="window.print()" data-toggle="tooltip" data-placement="left">.pdf</button>
            </div>
            
        </div>

        <!-- Edit this page -->
        

        <!-- Full screen (wrap in <a> to have style consistency -->
        <a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip" data-placement="bottom" onclick="toggleFullScreen()" title="Fullscreen mode"><i class="fas fa-expand"></i></button></a>

        <!-- Launch buttons -->
        
    </div>
    <div class="d-none d-md-block col-md-2 bd-toc show">
<div class="tocsection onthispage pt-5 pb-3">
    <i class="fas fa-list"></i> On this page
</div>

<nav id="bd-toc-nav">
    <ul class="nav section-nav flex-column">
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#higher-derivatives" class="nav-link">Higher derivatives</a>
        </li>
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#arbitrary-nodes" class="nav-link">Arbitrary nodes</a>
        </li>
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#exercises" class="nav-link">Exercises</a>
        </li>
    
    </ul>
</nav>


    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
        
              <div>
                
  <div class="section" id="finite-differences">
<h1>Finite differences<a class="headerlink" href="#finite-differences" title="Permalink to this headline">¶</a></h1>
<p>Much more can be said about interpolation. But now we turn to one of the most common and important applications of interpolants: finding derivatives. For the moment, we will continue to use <span class="math notranslate nohighlight">\(x\)</span> as the independent variable name and <span class="math notranslate nohighlight">\(a=t_0,\ldots,t_n=b\)</span> as the interpolation nodes. We also continue to use an equispaced grid, so that <span class="math notranslate nohighlight">\(t_i=a+i h\)</span> for <span class="math notranslate nohighlight">\(i=0,\ldots,n\)</span>, where <span class="math notranslate nohighlight">\(h=(b-a)/n\)</span>.</p>
<p>Considering the most common definition of a derivative,</p>
<div class="math notranslate nohighlight">
\[f'(x)=\lim_{h\to0} \frac{f(x+h)-f(x)}{h},\]</div>
<p id="index-0">it stands to reason that an approximation to <span class="math notranslate nohighlight">\(f'\)</span> at a node <span class="math notranslate nohighlight">\(t_i\)</span> should depend on the values of <span class="math notranslate nohighlight">\(f\)</span> at the nodes closest to <span class="math notranslate nohighlight">\(t_i\)</span>. Also, because differentiation is a linear operation, we will constrain ourselves to formulas that are linear in these nodal values. Consequently, the sort of formula we seek is the <a class="reference internal" href="overview.html#term-finite-difference"><span class="xref std std-term">finite difference</span></a> formula</p>
<div class="math notranslate nohighlight" id="equation-fdformula">
<span class="eqno">(130)<a class="headerlink" href="#equation-fdformula" title="Permalink to this equation">¶</a></span>\[  f'(t_i) \approx \frac{1}{h} \sum_{k=-p}^{q} a_k f(t_i+kh),\]</div>
<div class="margin sidebar">
<p class="sidebar-title"></p>
<p>Finite difference weights are independent of the function being differentiated.</p>
</div>
<p>where <span class="math notranslate nohighlight">\(p\)</span>, <span class="math notranslate nohighlight">\(q\)</span> are integers, and the <span class="math notranslate nohighlight">\(a_k\)</span>’s are constants known as the <strong>weights</strong> of the formula. Crucially, the finite difference weights are independent of <span class="math notranslate nohighlight">\(f\)</span>, although they do depend on the nodes. The factor of <span class="math notranslate nohighlight">\(h^{-1}\)</span> is present to make the expression more convenient in what follows.</p>
<p>Before deriving some finite difference formulas, we make an important observation about them. Define the new variable <span class="math notranslate nohighlight">\(s=x-t_i\)</span> and let <span class="math notranslate nohighlight">\(\tilde{f}(s) = f(x-t_i)\)</span>. Then it is elementary that</p>
<div class="math notranslate nohighlight">
\[  \left. \frac{d f}{d x} \right|_{x=t_i} = \left. \dd{\tilde{f}}{s} \right|_{s=0}.\]</div>
<p>Applying the change of variables to <a class="reference internal" href="#equation-fdformula">(130)</a> yields</p>
<div class="math notranslate nohighlight">
\[   f'(t_i) = \tilde{f}'(0) \approx \frac{1}{h} \sum_{k=i-p}^{i+q} a_k \tilde{f}(kh),\]</div>
<p>with the same constants as before. These manipulations express a property that is simpler than it may appear: we can always derive and write the finite difference formula <a class="reference internal" href="#equation-fdformula">(130)</a> with <span class="math notranslate nohighlight">\(t_i=0\)</span> without losing generality. In fact, <span class="math notranslate nohighlight">\(t_i\)</span> is just a “dummy” variable that we can replace by <span class="math notranslate nohighlight">\(x\)</span>, as in</p>
<div class="math notranslate nohighlight" id="equation-fdxformula">
<span class="eqno">(131)<a class="headerlink" href="#equation-fdxformula" title="Permalink to this equation">¶</a></span>\[f'(x) \approx \frac{1}{h} \sum_{k=-p}^{q} a_k f(x+kh).\]</div>
<p>This property is <em>translation invariance</em>. The formula combines values of the function at points always placed the same way relative to <span class="math notranslate nohighlight">\(x\)</span>.</p>
<p>An obvious candidate for a finite difference formula is based on the limit definition above:</p>
<div class="math notranslate nohighlight" id="equation-forwardfd11">
<span class="eqno">(132)<a class="headerlink" href="#equation-forwardfd11" title="Permalink to this equation">¶</a></span>\[  f'(x) \approx \frac{f(x+h)-f(x)}{h},\]</div>
<p>which is <a class="reference internal" href="#equation-fdxformula">(131)</a> with <span class="math notranslate nohighlight">\(p=0\)</span>, <span class="math notranslate nohighlight">\(q=1\)</span>, <span class="math notranslate nohighlight">\(a_0=-1\)</span>, and <span class="math notranslate nohighlight">\(a_1=1\)</span>. This is referred to as a <strong>forward difference formula</strong>, characterized by <span class="math notranslate nohighlight">\(p=0\)</span>, because <span class="math notranslate nohighlight">\(f\)</span> is evaluated only at points “forward” from <span class="math notranslate nohighlight">\(x\)</span>. Analogously, we could use the <strong>backward difference formula</strong></p>
<div class="math notranslate nohighlight" id="equation-backwardfd11">
<span class="eqno">(133)<a class="headerlink" href="#equation-backwardfd11" title="Permalink to this equation">¶</a></span>\[  f'(x) \approx \frac{f(x)-f(x-h)}{h},\]</div>
<p>in which <span class="math notranslate nohighlight">\(q=0\)</span>.</p>
<p>Both the forward and backward difference formulas surely become equalities in the limit <span class="math notranslate nohighlight">\(h\to 0\)</span>, provided <span class="math notranslate nohighlight">\(f\)</span> is differentiable at <span class="math notranslate nohighlight">\(x\)</span>. However, they are not the only possibilities. One aesthetic objection is the lack of symmetry about the point <span class="math notranslate nohighlight">\(x\)</span>. In response, we will derive a formula that uses <span class="math notranslate nohighlight">\(p=q=1\)</span>, i.e., in which <span class="math notranslate nohighlight">\(f(-h)\)</span>, <span class="math notranslate nohighlight">\(f(0)\)</span>, and <span class="math notranslate nohighlight">\(f(h)\)</span> are all available.</p>
<p id="index-1">The formula <a class="reference internal" href="#equation-forwardfd11">(132)</a> (with <span class="math notranslate nohighlight">\(x=0\)</span>) is simply the slope of the line through the points <span class="math notranslate nohighlight">\(\bigl(0,f(0)\bigr)\)</span> and <span class="math notranslate nohighlight">\(\bigl(h,f(h)\bigr)\)</span>. A similar observation holds for the backward difference formula. Thus one route to using three function values is to differentiate the quadratic polynomial that interpolates them (see <a class="reference internal" href="#problem-quadraticfd"><span class="std std-ref">this exercise</span></a>):</p>
<div class="math notranslate nohighlight" id="equation-fdinterp2">
<span class="eqno">(134)<a class="headerlink" href="#equation-fdinterp2" title="Permalink to this equation">¶</a></span>\[Q(x) = \frac{x(x-h)}{2h^2} f(-h) - \frac{x^2-h^2}{h^2} f(0) + \frac{x(x+h)}{2h^2} f(h).\]</div>
<p>We now use <span class="math notranslate nohighlight">\(f'(0)\approx Q'(0)\)</span> to get the <strong>centered finite difference formula</strong></p>
<div class="math notranslate nohighlight" id="equation-centerfd12">
<span class="eqno">(135)<a class="headerlink" href="#equation-centerfd12" title="Permalink to this equation">¶</a></span>\[f'(0) \approx \frac{f(h)-f(-h)}{2h}.\]</div>
<p>This result is equivalent to <a class="reference internal" href="#equation-fdxformula">(131)</a> with <span class="math notranslate nohighlight">\(p=q=1\)</span> and weights <span class="math notranslate nohighlight">\(a_{-1}=-1/2\)</span>, <span class="math notranslate nohighlight">\(a_0=0\)</span>, and <span class="math notranslate nohighlight">\(a_1=1/2\)</span>. Observe that while the value of <span class="math notranslate nohighlight">\(f(0)\)</span> was available during the derivation, its weight ends up being zero.</p>
<p>We can verify using L’Hôpital’s Rule that the approximation in <a class="reference internal" href="#equation-centerfd12">(135)</a> becomes an equality as <span class="math notranslate nohighlight">\(h\to 0\)</span>. Such an analysis does not, however, reveal a significant accuracy advantage of the centered variant, one that we will take up in <a class="reference internal" href="fd-converge.html"><span class="doc">Convergence of finite differences</span></a>.</p>
<div class="margin sidebar" id="index-2">
<p class="sidebar-title"></p>
<p>Finite difference formulas are derived by interpolating function values, followed by differentiation of the interpolant.</p>
</div>
<p>We can in principle derive any finite difference formula from the same process: Interpolate the given function values, then differentiate the interpolant exactly. Some results are given here for two important special cases. <a class="reference internal" href="#table-fdcenter"><span class="std std-numref">Table 2</span></a> is for <span class="math notranslate nohighlight">\(p=q\)</span>, or centered differences, while <a class="reference internal" href="#table-fdforward"><span class="std std-numref">Table 3</span></a> is for <span class="math notranslate nohighlight">\(p=0\)</span>, or forward differences. Both show the weights for estimating the derivative at zero, but they can be uniformly translated to any other point.</p>
<span id="table-fdcenter"></span><table class="colwidths-auto table" id="id1">
<caption><span class="caption-number">Table 2 </span><span class="caption-text">Weights for centered finite difference formulas.</span><a class="headerlink" href="#id1" title="Permalink to this table">¶</a></caption>
<thead>
<tr class="row-odd"><th class="text-align:center head"><p>order</p></th>
<th class="text-align:center head"><p><span class="math notranslate nohighlight">\(-4h\)</span></p></th>
<th class="text-align:center head"><p><span class="math notranslate nohighlight">\(-3h\)</span></p></th>
<th class="text-align:center head"><p><span class="math notranslate nohighlight">\(-2h\)</span></p></th>
<th class="text-align:center head"><p><span class="math notranslate nohighlight">\(-h\)</span></p></th>
<th class="text-align:center head"><p><span class="math notranslate nohighlight">\(0\)</span></p></th>
<th class="text-align:center head"><p><span class="math notranslate nohighlight">\(h\)</span></p></th>
<th class="text-align:center head"><p><span class="math notranslate nohighlight">\(2h\)</span></p></th>
<th class="text-align:center head"><p><span class="math notranslate nohighlight">\(3h\)</span></p></th>
<th class="text-align:center head"><p><span class="math notranslate nohighlight">\(4h\)</span></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td class="text-align:center"><p>2</p></td>
<td class="text-align:center"><p></p></td>
<td class="text-align:center"><p></p></td>
<td class="text-align:center"><p></p></td>
<td class="text-align:center"><p><span class="math notranslate nohighlight">\(-\frac{1}{2}\)</span></p></td>
<td class="text-align:center"><p><span class="math notranslate nohighlight">\(0\)</span></p></td>
<td class="text-align:center"><p><span class="math notranslate nohighlight">\(\frac{1}{2}\)</span></p></td>
<td class="text-align:center"><p></p></td>
<td class="text-align:center"><p></p></td>
<td class="text-align:center"><p></p></td>
</tr>
<tr class="row-odd"><td class="text-align:center"><p>4</p></td>
<td class="text-align:center"><p></p></td>
<td class="text-align:center"><p></p></td>
<td class="text-align:center"><p><span class="math notranslate nohighlight">\(\frac{1}{12}\)</span></p></td>
<td class="text-align:center"><p><span class="math notranslate nohighlight">\(-\frac{2}{3}\)</span></p></td>
<td class="text-align:center"><p><span class="math notranslate nohighlight">\(0\)</span></p></td>
<td class="text-align:center"><p><span class="math notranslate nohighlight">\(\frac{2}{3}\)</span></p></td>
<td class="text-align:center"><p><span class="math notranslate nohighlight">\(-\frac{1}{12}\)</span></p></td>
<td class="text-align:center"><p></p></td>
<td class="text-align:center"><p></p></td>
</tr>
<tr class="row-even"><td class="text-align:center"><p>6</p></td>
<td class="text-align:center"><p></p></td>
<td class="text-align:center"><p><span class="math notranslate nohighlight">\(-\frac{1}{60}\)</span></p></td>
<td class="text-align:center"><p><span class="math notranslate nohighlight">\(\frac{3}{20}\)</span></p></td>
<td class="text-align:center"><p><span class="math notranslate nohighlight">\(-\frac{3}{4}\)</span></p></td>
<td class="text-align:center"><p><span class="math notranslate nohighlight">\(0\)</span></p></td>
<td class="text-align:center"><p><span class="math notranslate nohighlight">\(\frac{3}{4}\)</span></p></td>
<td class="text-align:center"><p><span class="math notranslate nohighlight">\(-\frac{3}{20}\)</span></p></td>
<td class="text-align:center"><p><span class="math notranslate nohighlight">\(\frac{1}{60}\)</span></p></td>
<td class="text-align:center"><p></p></td>
</tr>
<tr class="row-odd"><td class="text-align:center"><p>8</p></td>
<td class="text-align:center"><p><span class="math notranslate nohighlight">\(\frac{1}{280}\)</span></p></td>
<td class="text-align:center"><p><span class="math notranslate nohighlight">\(-\frac{4}{105}\)</span></p></td>
<td class="text-align:center"><p><span class="math notranslate nohighlight">\(\frac{1}{5}\)</span></p></td>
<td class="text-align:center"><p><span class="math notranslate nohighlight">\(-\frac{4}{5}\)</span></p></td>
<td class="text-align:center"><p><span class="math notranslate nohighlight">\(0\)</span></p></td>
<td class="text-align:center"><p><span class="math notranslate nohighlight">\(\frac{4}{5}\)</span></p></td>
<td class="text-align:center"><p><span class="math notranslate nohighlight">\(-\frac{1}{5}\)</span></p></td>
<td class="text-align:center"><p><span class="math notranslate nohighlight">\(\frac{4}{105}\)</span></p></td>
<td class="text-align:center"><p><span class="math notranslate nohighlight">\(-\frac{1}{280}\)</span></p></td>
</tr>
</tbody>
</table>
<span id="table-fdforward"></span><table class="colwidths-auto table" id="id2">
<caption><span class="caption-number">Table 3 </span><span class="caption-text">Weights for forward finite difference formulas.</span><a class="headerlink" href="#id2" title="Permalink to this table">¶</a></caption>
<thead>
<tr class="row-odd"><th class="text-align:center head"><p>order</p></th>
<th class="text-align:center head"><p><span class="math notranslate nohighlight">\(0\)</span></p></th>
<th class="text-align:center head"><p><span class="math notranslate nohighlight">\(h\)</span></p></th>
<th class="text-align:center head"><p><span class="math notranslate nohighlight">\(2h\)</span></p></th>
<th class="text-align:center head"><p><span class="math notranslate nohighlight">\(3h\)</span></p></th>
<th class="text-align:center head"><p><span class="math notranslate nohighlight">\(4h\)</span></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td class="text-align:center"><p>1</p></td>
<td class="text-align:center"><p><span class="math notranslate nohighlight">\(-1\)</span></p></td>
<td class="text-align:center"><p><span class="math notranslate nohighlight">\(1\)</span></p></td>
<td class="text-align:center"><p></p></td>
<td class="text-align:center"><p></p></td>
<td class="text-align:center"><p></p></td>
</tr>
<tr class="row-odd"><td class="text-align:center"><p>2</p></td>
<td class="text-align:center"><p><span class="math notranslate nohighlight">\(-\frac{3}{2}\)</span></p></td>
<td class="text-align:center"><p>2</p></td>
<td class="text-align:center"><p><span class="math notranslate nohighlight">\(-\frac{1}{2}\)</span></p></td>
<td class="text-align:center"><p></p></td>
<td class="text-align:center"><p></p></td>
</tr>
<tr class="row-even"><td class="text-align:center"><p>3</p></td>
<td class="text-align:center"><p><span class="math notranslate nohighlight">\(-\frac{11}{6}\)</span></p></td>
<td class="text-align:center"><p>3</p></td>
<td class="text-align:center"><p><span class="math notranslate nohighlight">\(-\frac{3}{2}\)</span></p></td>
<td class="text-align:center"><p><span class="math notranslate nohighlight">\(\frac{1}{3}\)</span></p></td>
<td class="text-align:center"><p></p></td>
</tr>
<tr class="row-odd"><td class="text-align:center"><p>4</p></td>
<td class="text-align:center"><p><span class="math notranslate nohighlight">\(-\frac{25}{12}\)</span></p></td>
<td class="text-align:center"><p><span class="math notranslate nohighlight">\(4\)</span></p></td>
<td class="text-align:center"><p><span class="math notranslate nohighlight">\(-3\)</span></p></td>
<td class="text-align:center"><p><span class="math notranslate nohighlight">\(\frac{4}{3}\)</span></p></td>
<td class="text-align:center"><p><span class="math notranslate nohighlight">\(-\frac{1}{4}\)</span></p></td>
</tr>
</tbody>
</table>
<p>The main motivation for using more function values in a formula is to improve the accuracy. This is measured by <strong>order of accuracy</strong>, which is show in the tables and explained in <a class="reference internal" href="fd-converge.html"><span class="doc">Convergence of finite differences</span></a>. To get backward differences with <span class="math notranslate nohighlight">\(q=0\)</span>, you can use the change of variable <span class="math notranslate nohighlight">\(\hat{f}(x)=f(-x)\)</span>, which changes the sign and reverses the order of the coefficients in <a class="reference internal" href="#table-fdforward"><span class="std std-numref">Table 3</span></a>; see <a class="reference internal" href="#problem-backwardfd"><span class="std std-ref">this exercise</span></a>.</p>
<div class="proof proof-type-example" id="id3">

    <div class="proof-title">
        <span class="proof-type">Example 51</span>
        
    </div><div class="proof-content">
<p>According to the tables, here are two finite difference formulas:</p>
<div class="math notranslate nohighlight">
\[\begin{split}\begin{split}
f'(0) &amp;\approx h^{-1} \left[ \tfrac{1}{12} f(-2h)
- \tfrac{2}{3} f(-h) + \tfrac{2}{3} f(h) - \tfrac{1}{12} f(2h) \right], \\
f'(0) &amp;\approx h^{-1} \left[ \tfrac{1}{2} f(-2h) - 2 f(-h) + \tfrac{3}{2} f(0) \right]. \\	
\end{split}\end{split}\]</div>
</div></div><div class="section" id="higher-derivatives">
<h2>Higher derivatives<a class="headerlink" href="#higher-derivatives" title="Permalink to this headline">¶</a></h2>
<p>Many applications require the second derivative of a function. It’s tempting to use the finite difference of a finite difference. For example, applying <a class="reference internal" href="#equation-centerfd12">(135)</a> twice leads to</p>
<div class="math notranslate nohighlight" id="equation-fd-twocenter">
<span class="eqno">(136)<a class="headerlink" href="#equation-fd-twocenter" title="Permalink to this equation">¶</a></span>\[f''(0) \approx  \frac{ f(-2h) - 2 f(0) + f(2h) }{4h^2}.\]</div>
<p>This is a valid formula, but it uses values at <span class="math notranslate nohighlight">\(\pm 2h\)</span> rather than the closer values at <span class="math notranslate nohighlight">\(\pm h\)</span>. A better and more generalizable tactic is to return to the quadratic <span class="math notranslate nohighlight">\(Q(x)\)</span> in <a class="reference internal" href="#equation-fdinterp2">(134)</a> and use <span class="math notranslate nohighlight">\(Q''(0)\)</span> to approximate <span class="math notranslate nohighlight">\(f''(0)\)</span>. Doing so yields</p>
<div class="math notranslate nohighlight" id="equation-centerfd22">
<span class="eqno">(137)<a class="headerlink" href="#equation-centerfd22" title="Permalink to this equation">¶</a></span>\[  f''(0) \approx  \frac{ f(-h) - 2 f(0) + f(h) }{h^2},\]</div>
<p>which is the simplest <strong>centered second-difference formula</strong>. As with the first derivative, we can choose larger values of <span class="math notranslate nohighlight">\(p\)</span> and <span class="math notranslate nohighlight">\(q\)</span> in <a class="reference internal" href="#equation-fdformula">(130)</a> to get new formulas, such as</p>
<div class="math notranslate nohighlight" id="equation-forwardfd21">
<span class="eqno">(138)<a class="headerlink" href="#equation-forwardfd21" title="Permalink to this equation">¶</a></span>\[f''(0) \approx \frac{ f(0) - 2 f(h) + f(2h) }{h^2},\]</div>
<p>and</p>
<div class="math notranslate nohighlight" id="equation-forwardfd22">
<span class="eqno">(139)<a class="headerlink" href="#equation-forwardfd22" title="Permalink to this equation">¶</a></span>\[f''(0) \approx \frac{ 2f(0) - 5 f(h) + 4 f(2h) -f(3h) }{h^2}.\]</div>
</div>
<div class="section" id="arbitrary-nodes">
<h2>Arbitrary nodes<a class="headerlink" href="#arbitrary-nodes" title="Permalink to this headline">¶</a></h2>
<p>Although function values at equally spaced nodes are a common and convenient situation, the node locations may be arbitrary. The general form of a finite difference formula is</p>
<div class="math notranslate nohighlight" id="equation-fdgenformula">
<span class="eqno">(140)<a class="headerlink" href="#equation-fdgenformula" title="Permalink to this equation">¶</a></span>\[  f^{(m)}(0) \approx \sum_{k=0}^{r} c_{k,m} \,f(t_k).\]</div>
<div class="demo sidebar">
<p class="sidebar-title">Demo</p>
<p><a class="reference internal" href="demos/fd-weights.html"><span class="doc">FD at arbitrary nodes</span></a></p>
</div>
<p>We no longer assume equally spaced nodes, so there is no “<span class="math notranslate nohighlight">\(h\)</span>” to be used in the formula. As before, the weights may be applied after any translation of the independent variable. The weights again follow from the interpolate/differentiate recipe, but the algebra becomes complicated. Fortunately there is an elegant recursion known as <strong>Fornberg’s algorithm</strong> that can calculate these weights for any desired formula. We present it without derivation as <a class="reference internal" href="#function-fdweights"><span class="std std-ref">fdweights</span></a>.</p>
<div class="proof proof-type-function" id="id4">
<span id="function-fdweights"></span>
    <div class="proof-title">
        <span class="proof-type">Function 52</span>
        
            <span class="proof-title-name">(fdweights)</span>
        
    </div><div class="proof-content">
<p><strong>Fornberg’s algorithm for finite difference weights.</strong></p>
<div class="highlight-julia notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="s">&quot;&quot;&quot;</span>
<span class="s">fdweights(t,m)</span>

<span class="s">Return weights for the `m`th derivative of a function at zero using</span>
<span class="s">values at the nodes in vector `t`.</span>
<span class="s">&quot;&quot;&quot;</span>
<span class="k">function</span> <span class="n">fdweights</span><span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="n">m</span><span class="p">)</span>
    <span class="c"># This is a compact implementation, not an efficient one.</span>

    <span class="k">function</span> <span class="n">weight</span><span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="n">m</span><span class="p">,</span><span class="n">r</span><span class="p">,</span><span class="n">k</span><span class="p">)</span>
        <span class="c"># Recursion for one weight. Input: t   nodes (vector) m</span>
        <span class="c"># order of derivative sought r   number of nodes to use from</span>
        <span class="c"># t (&lt;= length(t)) k   index of node whose weight is found</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">m</span><span class="o">&lt;</span><span class="mi">0</span><span class="p">)</span> <span class="o">||</span> <span class="p">(</span><span class="n">m</span><span class="o">&gt;</span><span class="n">r</span><span class="p">)</span>        <span class="c"># undefined coeffs must be zero</span>
            <span class="n">c</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">elseif</span> <span class="p">(</span><span class="n">m</span><span class="o">==</span><span class="mi">0</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">r</span><span class="o">==</span><span class="mi">0</span><span class="p">)</span>  <span class="c"># base case of one-point interpolation</span>
            <span class="n">c</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">else</span>                     <span class="c"># generic recursion</span>
            <span class="k">if</span> <span class="n">k</span><span class="o">&lt;</span><span class="n">r</span>
                <span class="n">c</span> <span class="o">=</span> <span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="n">r</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">weight</span><span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="n">m</span><span class="p">,</span><span class="n">r</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">k</span><span class="p">)</span> <span class="o">-</span>
                    <span class="n">m</span><span class="o">*</span><span class="n">weight</span><span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="n">m</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">r</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">k</span><span class="p">))</span><span class="o">/</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="n">r</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">t</span><span class="p">[</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">])</span>
            <span class="k">else</span>
                <span class="n">numer</span> <span class="o">=</span> <span class="n">r</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="o">?</span> <span class="n">prod</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="n">r</span><span class="p">]</span><span class="o">-</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="kp">in</span> <span class="n">t</span><span class="p">[</span><span class="mi">1</span><span class="o">:</span><span class="n">r</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="o">:</span> <span class="mf">1.0</span>
                <span class="n">denom</span> <span class="o">=</span> <span class="n">r</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="o">?</span> <span class="n">prod</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="n">r</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="kp">in</span> <span class="n">t</span><span class="p">[</span><span class="mi">1</span><span class="o">:</span><span class="n">r</span><span class="p">])</span> <span class="o">:</span> <span class="mf">1.0</span>
                <span class="n">β</span> <span class="o">=</span> <span class="n">numer</span><span class="o">/</span><span class="n">denom</span>
                <span class="n">c</span> <span class="o">=</span> <span class="n">β</span><span class="o">*</span><span class="p">(</span><span class="n">m</span><span class="o">*</span><span class="n">weight</span><span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="n">m</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">r</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">r</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="n">t</span><span class="p">[</span><span class="n">r</span><span class="p">]</span><span class="o">*</span><span class="n">weight</span><span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="n">m</span><span class="p">,</span><span class="n">r</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">r</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span>
            <span class="k">end</span>
        <span class="k">end</span>
        <span class="k">return</span> <span class="n">c</span>
    <span class="k">end</span>

    <span class="n">r</span> <span class="o">=</span> <span class="n">length</span><span class="p">(</span><span class="n">t</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span>
    <span class="n">w</span> <span class="o">=</span> <span class="n">zeros</span><span class="p">(</span><span class="n">size</span><span class="p">(</span><span class="n">t</span><span class="p">))</span>
    <span class="k">return</span> <span class="p">[</span> <span class="n">weight</span><span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="n">m</span><span class="p">,</span><span class="n">r</span><span class="p">,</span><span class="n">k</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span><span class="o">=</span><span class="mi">0</span><span class="o">:</span><span class="n">r</span> <span class="p">]</span>
<span class="k">end</span>
</pre></div>
</td></tr></table></div>
</div></div></div>
<div class="section" id="exercises">
<h2>Exercises<a class="headerlink" href="#exercises" title="Permalink to this headline">¶</a></h2>
<ol id="problem-quadraticfd">
<li><p>✍ This problem refers to <span class="math notranslate nohighlight">\(Q(x)\)</span> defined by <a class="reference internal" href="#equation-fdinterp2">(134)</a>.</p>
<p><strong>(a)</strong> Show that <span class="math notranslate nohighlight">\(Q(x)\)</span> interpolates the three values of <span class="math notranslate nohighlight">\(f\)</span> at <span class="math notranslate nohighlight">\(x=-h\)</span>, <span class="math notranslate nohighlight">\(x=0\)</span>, and <span class="math notranslate nohighlight">\(x=h\)</span>.</p>
<p><strong>(b)</strong> Show that <span class="math notranslate nohighlight">\(Q'(0)\)</span> gives the finite difference formula defined by <a class="reference internal" href="#equation-centerfd12">(135)</a>.</p>
</li>
<li id="problem-backwardfd"><p><strong>(a)</strong> ✍ <a class="reference internal" href="#table-fdforward"><span class="std std-ref">Weights for forward finite difference formulas.</span></a> lists forward-difference formulas in which <span class="math notranslate nohighlight">\(p=0\)</span> in <a class="reference internal" href="#equation-fdxformula">(131)</a>. Show that the change of variable <span class="math notranslate nohighlight">\(g(x) = f(-x)\)</span> transforms these formulas into backward difference formulas with <span class="math notranslate nohighlight">\(q=0\)</span>, and write out the table analogous to <a class="reference internal" href="#table-fdforward"><span class="std std-ref">Weights for forward finite difference formulas.</span></a> for backward differences.</p>
<p><strong>(b)</strong> ⌨ Suppose you are given the nodes <span class="math notranslate nohighlight">\(t_0=0.9\)</span>, <span class="math notranslate nohighlight">\(t_1=1\)</span>, and <span class="math notranslate nohighlight">\(t_2=1.1\)</span>, and <span class="math notranslate nohighlight">\(f(x) = \sin(2x)\)</span>. Using formulas from <a class="reference internal" href="#table-fdcenter"><span class="std std-numref">Table 2</span></a> and <a class="reference internal" href="#table-fdforward"><span class="std std-numref">Table 3</span></a>, compute second-order accurate approximations to <span class="math notranslate nohighlight">\(f'\)</span> at each of the three nodes.</p>
</li>
<li><p>⌨ Using <a class="reference internal" href="#function-fdweights"><span class="std std-ref">fdweights</span></a> to get the necessary weights, find finite-difference approximations to the first, second, third, and fourth derivatives of <span class="math notranslate nohighlight">\(f(x)=e^{-x}\)</span> at <span class="math notranslate nohighlight">\(x=0.5\)</span>. In each case use a centered stencil of minimum possible width. Make a table showing the values and the errors in each case.</p>
</li>
<li><p>⌨ Use <a class="reference internal" href="#function-fdweights"><span class="std std-ref">fdweights</span></a> to write out a table analogous to <a class="reference internal" href="#table-fdcenter"><span class="std std-ref">Weights for centered finite difference formulas.</span></a> that lists centered finite difference weights for the second derivative <span class="math notranslate nohighlight">\(f''(0)\)</span>. (Hint: The “rat” command will let you express the results as exact rational numbers.)</p>
</li>
<li><p>⌨ For this problem, let <span class="math notranslate nohighlight">\(f(x)=\tan(2x)\)</span>.</p>
<p><strong>(a)</strong> ⌨ Apply <a class="reference internal" href="#function-fdweights"><span class="std std-ref">fdweights</span></a> to find a finite difference approximation to <span class="math notranslate nohighlight">\(f''(0.3)\)</span> using the five nodes <span class="math notranslate nohighlight">\(t_j=0.3+jh\)</span> for <span class="math notranslate nohighlight">\(j=-2,\ldots,2\)</span> and <span class="math notranslate nohighlight">\(h=0.05\)</span>. Compare to the exact value of <span class="math notranslate nohighlight">\(f''(0.3)\)</span>.</p>
<p><strong>(b)</strong> ⌨  Repeat part~(a) for <span class="math notranslate nohighlight">\(f''(0.75)\)</span> and <span class="math notranslate nohighlight">\(t_j=0.75+jh\)</span>. Why is the finite difference result so inaccurate?</p>
</li>
<li><p><strong>(a)</strong> ✍ Derive <a class="reference internal" href="#equation-fd-twocenter">(136)</a> by applying applying <a class="reference internal" href="#equation-centerfd12">(135)</a> twice (i.e., apply once to get <span class="math notranslate nohighlight">\(f'\)</span> values and then apply again to those values).</p>
<p><strong>(b)</strong> ✍ Find the formula for <span class="math notranslate nohighlight">\(f''(0)\)</span> that results from applying <a class="reference internal" href="#equation-forwardfd11">(132)</a> and then <a class="reference internal" href="#equation-backwardfd11">(133)</a>.</p>
</li>
<li><p><strong>(a)</strong> ✍ Show using L’Hôpital’s Rule that the centered formula approximation <a class="reference internal" href="#equation-centerfd12">(135)</a> converges to an equality as <span class="math notranslate nohighlight">\(h\to 0\)</span>.</p>
<p><strong>(b)</strong> ✍ Derive two conditions on the finite difference weights in <a class="reference internal" href="#equation-fdxformula">(131)</a> that arise from requiring convergence as <span class="math notranslate nohighlight">\(h\to 0\)</span>.</p>
</li>
</ol>
</div>
</div>


              </div>
              
        </div>
    </div>
    
    
    <div class='prev-next-bottom'>
        
    <a class='left-prev' id="prev-link" href="splines.html" title="previous page">Cubic splines</a>
    <a class='right-next' id="next-link" href="fd-converge.html" title="next page">Convergence of finite differences</a>

    </div>
    <footer class="footer mt-5 mt-md-0">
    <div class="container">
      <p>
        
          By Tobin A. Driscoll and Richard J. Braun<br/>
        
            &copy; Copyright 2020.<br/>
      </p>
    </div>
  </footer>
</main>


      </div>
    </div>

    <script src="../_static/js/index.js"></script>
    
  </body>
</html>