{"version":2,"kind":"Notebook","sha256":"9e49a46e2f81099939fa934c847fab912b104e859432e0fbed0bac8d03354898","slug":"chapter13-2","location":"/python/chapter13.md","dependencies":[],"frontmatter":{"title":"Chapter 13","numbering":{"heading_1":{"enabled":false},"heading_2":{"enabled":false},"heading_3":{"enabled":false},"heading_4":{"enabled":false},"heading_5":{"enabled":false},"heading_6":{"enabled":false},"title":{"offset":2}},"kernelspec":{"name":"python3","display_name":"Python 3","language":"python"},"content_includes_title":false,"authors":[{"nameParsed":{"literal":"Tobin A. Driscoll","given":"Tobin A.","family":"Driscoll"},"name":"Tobin A. Driscoll","email":"driscoll@udel.edu","id":"contributors-myst-generated-uid-0","corresponding":true},{"nameParsed":{"literal":"Richard J. Braun","given":"Richard J.","family":"Braun"},"name":"Richard J. Braun","id":"contributors-myst-generated-uid-1"}],"github":"https://github.com/fncbook/fnc","math":{"\\float":{"macro":"\\mathbb{F}"},"\\real":{"macro":"\\mathbb{R}"},"\\complex":{"macro":"\\mathbb{C}"},"\\nat":{"macro":"\\mathbb{N}"},"\\integer":{"macro":"\\mathbb{Z}"},"\\rmn":{"macro":"\\mathbb{R}^{#1 \\times #2}"},"\\dd":{"macro":"\\frac{d #1}{d #2}"},"\\ddd":{"macro":"\\frac{d^2 #1}{d #2^2}"},"\\pp":{"macro":"\\frac{\\partial #1}{\\partial #2}"},"\\ppp":{"macro":"\\frac{\\partial^2 #1}{\\partial #2^2}"},"\\ppdd":{"macro":"\\frac{\\partial^2 #1}{\\partial #2 \\partial #3}"},"\\abs":{"macro":"\\left\\lvert #1 \\right\\rvert"},"\\norm":{"macro":"\\left\\lVert #1 \\right\\rVert"},"\\twonorm":{"macro":"\\norm{#1}_2"},"\\onenorm":{"macro":"\\norm{#1}_1"},"\\infnorm":{"macro":"\\norm{#1}_\\infty"},"\\anynorm":{"macro":"\\norm{#1}_#2"},"\\innerprod":{"macro":"\\langle #1,#2 \\rangle"},"\\pr":{"macro":"^{(#1)}"},"\\kron":{"macro":"#1 \\otimes #2"},"\\eye":{"macro":"\\mathbf{e}_#1"},"\\meye":{"macro":"\\mathbf{I}"},"\\Qhat":{"macro":"\\hat{\\mathbf{Q}}"},"\\Rhat":{"macro":"\\hat{\\mathbf{R}}"},"\\bfalpha":{"macro":"\\mathbf{alpha}"},"\\bfdelta":{"macro":"\\mathbf{delta}"},"\\bfzero":{"macro":"\\boldsymbol{0}"},"\\macheps":{"macro":"\\epsilon_\\text{mach}"},"\\fl":{"macro":"\\operatorname{fl}"},"\\diag":{"macro":"\\operatorname{diag}"},"\\ign":{"macro":"\\operatorname{sign}"},"\\Re":{"macro":"\\operatorname{Re}"},"\\Im":{"macro":"\\operatorname{Im}"},"\\ee":{"macro":"\\times 10^"},"\\lnorm":{"macro":"\\|"},"\\rnorm":{"macro":"\\|"},"\\floor":{"macro":"\\lfloor#1\\rfloor"},"\\cI":{"macro":"\\mathcal{I}"},"\\mtx":{"macro":"\\operatorname{mtx}"},"\\myvec":{"macro":"\\operatorname{vec}"},"\\argmin":{"macro":"\\operatorname{argmin}"}},"abbreviations":{"IVP":"initial-value problem","BVP":"boundary-value problem","TPBVP":"two-point boundary-value problem","ONC":"matrix with orthonormal columns","SVD":"singular value decomposition","EVD":"eigenvalue decomposition","SPD":"symmetric positive definite","HPD":"hermitian positive definite","PDE":"partial differential equation","ODE":"ordinary differential equation"},"edit_url":"https://github.com/fncbook/fnc/blob/master/python/chapter13.md","exports":[{"format":"md","filename":"chapter13.md","url":"/build/chapter13-1b00ebfa36a2edfdec6a1db4a922e0b1.md"}]},"mdast":{"type":"root","children":[{"type":"block","children":[{"type":"heading","depth":2,"position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"children":[{"type":"text","value":"Functions","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"key":"ktUs5Oucoh"}],"identifier":"functions","label":"Functions","html_id":"functions","implicit":true,"key":"xmQPvGExFY"},{"type":"details","open":true,"children":[{"type":"summary","children":[{"type":"text","value":"Create a tensor-product grid","position":{"start":{"line":14,"column":1},"end":{"line":14,"column":1}},"key":"X3Bz8YVahW"}],"key":"uR3a2D2PAJ"},{"type":"include","file":"fncbook/fncbook/chapter13.py","literal":true,"filter":{"startAt":"def tensorgrid","endAt":"return mtx"},"children":[{"type":"code","value":"def tensorgrid(x, y):\n    \"\"\"\n    tensorgrid(x, y)\n\n    Create a tensor grid for a rectangle from its 1d projections x and y.\n    Returns a function to reshape a 2d array to a vector, a function to reshape \n    a vector into a 2d array, a function to evaluate a function on the grid, \n    two arrays to give the grid coordinates, and a boolean array to identify \n    the boundary points.\n    \"\"\"\n    m, n = len(x) - 1, len(y) - 1\n    vec = lambda U: U.T.flatten()\n    unvec = lambda u: np.reshape(u, (n+1, m+1)).T\n    mtx = lambda h: np.array([[h(xi ,yj) for yj in y] for xi in x])\n    X = mtx(lambda x, y: x)\n    Y = mtx(lambda x, y: y)\n\n    # Identify boundary points.\n    is_boundary = np.tile(True, (m+1, n+1))\n    is_boundary[1:-1, 1:-1] = False\n    \n    return mtx, X, Y, vec, unvec, is_boundary","lang":"python","showLineNumbers":true,"filename":"tensorgrid.py","key":"Hfqu6ldeIg"}],"key":"BQk57UlE9L"}],"label":"function-tensorgrid-python","identifier":"function-tensorgrid-python","html_id":"function-tensorgrid-python","key":"aUcRzAQm8c"},{"type":"details","open":true,"children":[{"type":"summary","children":[{"type":"text","value":"Solution of Poisson’s equation by finite differences","position":{"start":{"line":26,"column":1},"end":{"line":26,"column":1}},"key":"tY6kx0WQkj"}],"key":"qO91h3oXX9"},{"type":"include","file":"fncbook/fncbook/chapter13.py","literal":true,"filter":{"startAt":"def poissonfd","endAt":"return U"},"children":[{"type":"code","value":"def poissonfd(f, g, m, xspan, n, yspan):\n    \"\"\"\n    poissonfd(f, g, m, xspan, n, yspan)\n\n    Solve Poisson's equation on a rectangle by finite differences. Function f is the\n    forcing function and function g gives the  Dirichlet boundary condition. The rectangle\n    is the tensor product of intervals xspan and yspan,  and the discretization uses\n    m+1 and n+1 points in the two coordinates.\n\n    Return matrices of the solution values, and the coordinate functions, on the grid.\n    \"\"\"\n    # Discretize the domain.\n    x, Dx, Dxx = diffmat2(m, xspan)\n    y, Dy, Dyy = diffmat2(n, yspan)\n    mtx, X, Y, vec, unvec, is_boundary = tensorgrid(x, y)\n    N = (m+1) * (n+1)    # total number of unknowns\n\n    # Form the collocated PDE as a linear system.\n    Dxx = sp.lil_matrix(Dxx)\n    Dyy = sp.lil_matrix(Dyy)\n    A = sp.kron(sp.eye(n+1, format=\"lil\"), Dxx) + sp.kron(Dyy, sp.eye(m+1, format=\"lil\"))\n    b = vec(mtx(f))\n\n    # Apply Dirichlet condition.\n    idx = vec(is_boundary)\n    scale = np.max(abs(A[n+1, :]))\n    I = sp.eye(N, format=\"lil\")\n    A[idx, :] = scale * I[idx, :]         # Dirichet assignment\n    X_bd, Y_bd = vec(X)[idx], vec(Y)[idx]\n    b[idx] = scale * g(X_bd, Y_bd)    # assigned values\n\n    # Solve the linear sytem and reshape the output.\n    u = scipy.sparse.linalg.spsolve(A.tocsr(), b)\n    U = unvec(u)\n    return U, X, Y","lang":"python","showLineNumbers":true,"filename":"poissonfd.py","key":"hJR7Gisnla"}],"key":"NnccmcVTow"}],"label":"function-poissonfd-python","identifier":"function-poissonfd-python","html_id":"function-poissonfd-python","key":"aS2hBbHVDm"},{"type":"details","open":true,"children":[{"type":"summary","children":[{"type":"text","value":"Solution of elliptic ","key":"OypP0QnPup"},{"type":"abbreviation","title":"partial differential equation","children":[{"type":"text","value":"PDE","key":"AgMLuOh10n"}],"key":"yH1SDCN7p6"},{"type":"text","value":" by Chebyshev collocation","key":"lGJenJ6VQd"}],"key":"suQRUibtlu"},{"type":"include","file":"fncbook/fncbook/chapter13.py","literal":true,"filter":{"startAt":"def elliptic","endAt":"return np.vectorize(evaluate)"},"children":[{"type":"code","value":"def elliptic(f, g, m, xspan, n, yspan):\n    \"\"\"\n    newtonpde(f, g, m, xspan, n, yspan)\n\n    Newton's method with finite differences to solve the PDE f(u,x,y,disc)=0 on the\n    rectangle xspan \\times yspan, subject to g(x,y)=0 on the boundary. Use m+1\n    points in x by n+1 points in y.\n\n    Return matrices of the solution values, and the coordinate functions, on the grid.\n    \"\"\"\n    from scipy.sparse.linalg import spsolve\n    x, Dx, Dxx = diffcheb(m, xspan)\n    y, Dy, Dyy = diffcheb(n, yspan)\n    mtx, X, Y, vec, unvec, is_boundary = tensorgrid(x, y)\n\n    # Evaluate the boundary condition at the boundary nodes.\n    idx = vec(is_boundary)\n    X_bd, Y_bd = vec(X)[idx], vec(Y)[idx]\n    g_bd = g(X_bd, Y_bd)\n\n    # Evaluate the PDE+BC residual.\n    def residual(u):\n        U = unvec(u)\n        R = f(X, Y, U, Dx @ U, Dxx @ U, U @ Dy.T, U @ Dyy.T)    # PDE\n        r = vec(R)\n        r[idx] = u[idx] - g_bd                                  # BC\n        return r\n    \n    # Solve the equation.\n    u = levenberg(residual, vec(np.zeros(X.shape)))[-1]\n    U = unvec(u)\n\n    def evaluate(xi, eta):\n        v = [chebinterp(y, u, eta) for u in U]\n        return chebinterp(x, v, xi)\n    \n    return np.vectorize(evaluate)","lang":"python","showLineNumbers":true,"filename":"elliptic.py","key":"WJjglp09Y4"}],"key":"I6jvkwk59r"}],"label":"function-elliptic-python","identifier":"function-elliptic-python","html_id":"function-elliptic-python","key":"A1gHqHRdIi"},{"type":"heading","depth":2,"position":{"start":{"line":49,"column":1},"end":{"line":49,"column":1}},"children":[{"type":"text","value":"Examples","position":{"start":{"line":49,"column":1},"end":{"line":49,"column":1}},"key":"DmDOxscgNV"}],"identifier":"examples","label":"Examples","html_id":"examples","implicit":true,"key":"r9Sxe2tsCX"}],"key":"O0WN1s4442"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"exec(open(\"FNC_init.py\").read())","visibility":"show","key":"FRTcBcIJ4b"},{"type":"output","id":"hJkwYwJPaEf7veWjUNBds","data":[],"visibility":"show","key":"oDidq30p52"}],"data":{"tags":[]},"visibility":"remove","key":"si4dVmdhXo"},{"type":"block","children":[{"type":"heading","depth":3,"position":{"start":{"line":56,"column":1},"end":{"line":56,"column":1}},"children":[{"type":"text","value":"13.1 ","position":{"start":{"line":56,"column":1},"end":{"line":56,"column":1}},"key":"QJ26PAY0jN"},{"type":"link","identifier":"section-twodim-tensorprod","label":"section-twodim-tensorprod","kind":"narrative","position":{"start":{"line":56,"column":6},"end":{"line":56,"column":32}},"url":"/tensorprod","internal":true,"dataUrl":"/tensorprod.json","children":[{"type":"text","value":"Tensor-product discretizations","key":"jLty3R4p4G"}],"key":"Ey3gzisZwU"}],"identifier":"id-13-1","label":"13.1 ","html_id":"id-13-1","implicit":true,"key":"SgRXrZDevY"},{"type":"details","open":true,"children":[{"type":"summary","children":[{"type":"crossReference","identifier":"demo-tensorprod-gridfun","label":"demo-tensorprod-gridfun","kind":"proof:example","position":{"start":{"line":59,"column":1},"end":{"line":59,"column":25}},"children":[{"type":"text","value":"Example ","key":"v8IdM64kzf"},{"type":"text","value":"13.1.2","key":"eBof2St7lV"}],"template":"Example %s","enumerator":"13.1.2","resolved":true,"html_id":"demo-tensorprod-gridfun","remote":true,"url":"/tensorprod","dataUrl":"/tensorprod.json","key":"XHZEW6iMiM"}],"key":"BbXwuaSZ4s"},{"type":"paragraph","position":{"start":{"line":61,"column":1},"end":{"line":61,"column":1}},"children":[{"type":"text","value":"Here is the grid from ","position":{"start":{"line":61,"column":1},"end":{"line":61,"column":1}},"key":"MFzGUEMOXG"},{"type":"crossReference","kind":"proof:example","identifier":"example-tensorprod-smallgrid","label":"example-tensorprod-smallgrid","children":[{"type":"text","value":"Example ","key":"xhLJTvfqzb"},{"type":"text","value":"13.1.1","key":"mReb4AZQ3i"}],"template":"Example %s","enumerator":"13.1.1","resolved":true,"html_id":"example-tensorprod-smallgrid","remote":true,"url":"/tensorprod","dataUrl":"/tensorprod.json","key":"eQfuMHFl4r"},{"type":"text","value":".","position":{"start":{"line":61,"column":1},"end":{"line":61,"column":1}},"key":"qnc57fNNkP"}],"key":"alRjXfFFft"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"m = 4\nx = linspace(0, 2, m+1)\nn = 2\ny = linspace(1, 3, n+1)","key":"Y69oHGwNeX"},{"type":"output","id":"bUuTn7LWuRqypsuPO79CM","data":[],"key":"XzA3OnKCwH"}],"key":"fIaH8uJLUW"},{"type":"paragraph","position":{"start":{"line":70,"column":1},"end":{"line":70,"column":1}},"children":[{"type":"text","value":"For a given ","position":{"start":{"line":70,"column":1},"end":{"line":70,"column":1}},"key":"AWnXV0bNBK"},{"type":"inlineMath","value":"f(x,y)","position":{"start":{"line":70,"column":1},"end":{"line":70,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>f</mi><mo stretchy=\"false\">(</mo><mi>x</mi><mo separator=\"true\">,</mo><mi>y</mi><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">f(x,y)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.10764em;\">f</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">x</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">y</span><span class=\"mclose\">)</span></span></span></span>","key":"BRJmJfcdph"},{"type":"text","value":" we can find ","position":{"start":{"line":70,"column":1},"end":{"line":70,"column":1}},"key":"NeYmX7bJoj"},{"type":"inlineMath","value":"\\operatorname{mtx}(f)","position":{"start":{"line":70,"column":1},"end":{"line":70,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi mathvariant=\"normal\">mtx</mi><mo>⁡</mo><mo stretchy=\"false\">(</mo><mi>f</mi><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">\\operatorname{mtx}(f)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mop\"><span class=\"mord mathrm\">mtx</span></span><span class=\"mopen\">(</span><span class=\"mord mathnormal\" style=\"margin-right:0.10764em;\">f</span><span class=\"mclose\">)</span></span></span></span>","key":"vBBMpr7I2l"},{"type":"text","value":" by using a comprehension syntax.","position":{"start":{"line":70,"column":1},"end":{"line":70,"column":1}},"key":"oVyOk3HBlG"}],"key":"HnTPNqohhK"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"f = lambda x, y: cos(pi * x * y - y)\nF = array( [ [f(xi, yj) for yj in y] for xi in x ] )\nprint(F)","key":"jBtIYlgiy7"},{"type":"output","id":"gSsgJVGRgzqub_x1F6Z_E","data":[{"output_type":"stream","name":"stdout","text":"[[ 0.54030231 -0.41614684 -0.9899925 ]\n [ 0.84147098  0.41614684 -0.14112001]\n [-0.54030231 -0.41614684  0.9899925 ]\n [-0.84147098  0.41614684  0.14112001]\n [ 0.54030231 -0.41614684 -0.9899925 ]]\n"}],"key":"N4IoPsck1K"}],"key":"BqwO94XE70"},{"type":"paragraph","position":{"start":{"line":78,"column":1},"end":{"line":78,"column":1}},"children":[{"type":"text","value":"We can make a nice plot of the function by first choosing a much finer grid. However, the contour and surface plotting functions expect the ","position":{"start":{"line":78,"column":1},"end":{"line":78,"column":1}},"key":"Dl7NWqvL1q"},{"type":"emphasis","position":{"start":{"line":78,"column":1},"end":{"line":78,"column":1}},"children":[{"type":"text","value":"transpose","position":{"start":{"line":78,"column":1},"end":{"line":78,"column":1}},"key":"L6WbXmYEZt"}],"key":"sOlbFTQUbq"},{"type":"text","value":" of mtx(","position":{"start":{"line":78,"column":1},"end":{"line":78,"column":1}},"key":"Hj8hcrl9KD"},{"type":"inlineMath","value":"f","position":{"start":{"line":78,"column":1},"end":{"line":78,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>f</mi></mrow><annotation encoding=\"application/x-tex\">f</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8889em;vertical-align:-0.1944em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.10764em;\">f</span></span></span></span>","key":"HO1o17gb47"},{"type":"text","value":").","position":{"start":{"line":78,"column":1},"end":{"line":78,"column":1}},"key":"aOYjIJ6wTi"}],"key":"Wp1Gs9C8qz"},{"type":"admonition","kind":"tip","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"Tip","key":"ciL8HZt6Mb"}],"key":"YJrvNKrAqw"},{"type":"paragraph","position":{"start":{"line":81,"column":1},"end":{"line":81,"column":1}},"children":[{"type":"text","value":"To emphasize departures from a zero level, use a colormap such as ","position":{"start":{"line":81,"column":1},"end":{"line":81,"column":1}},"key":"NCHUo7LvIr"},{"type":"inlineCode","value":"RdBu","position":{"start":{"line":81,"column":1},"end":{"line":81,"column":1}},"key":"AsLilI48tD"},{"type":"text","value":" and set the color limits to be symmetric around zero.","position":{"start":{"line":81,"column":1},"end":{"line":81,"column":1}},"key":"TTCUbjPgFI"}],"key":"epz4Js77mJ"}],"class":"dropdown","key":"hsep7nBulH"},{"type":"admonition","kind":"warning","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"Warning","key":"txdTJJICtE"}],"key":"v4ve1iwii1"},{"type":"paragraph","position":{"start":{"line":85,"column":1},"end":{"line":85,"column":1}},"children":[{"type":"text","value":"The contour and surface plotting functions in ","position":{"start":{"line":85,"column":1},"end":{"line":85,"column":1}},"key":"tm3pdByogm"},{"type":"inlineCode","value":"matplotlib","position":{"start":{"line":85,"column":1},"end":{"line":85,"column":1}},"key":"aHFFNSTXkV"},{"type":"text","value":" expect the ","position":{"start":{"line":85,"column":1},"end":{"line":85,"column":1}},"key":"UUtMzNd3K9"},{"type":"emphasis","position":{"start":{"line":85,"column":1},"end":{"line":85,"column":1}},"children":[{"type":"text","value":"transpose","position":{"start":{"line":85,"column":1},"end":{"line":85,"column":1}},"key":"UhudnUG8Rr"}],"key":"Yg6v7QDUIh"},{"type":"text","value":" of the outputs of ","position":{"start":{"line":85,"column":1},"end":{"line":85,"column":1}},"key":"aakqm9OIvZ"},{"type":"inlineCode","value":"mtx","position":{"start":{"line":85,"column":1},"end":{"line":85,"column":1}},"key":"wgSacBRItV"},{"type":"text","value":". If you forget to do that, the ","position":{"start":{"line":85,"column":1},"end":{"line":85,"column":1}},"key":"HPCT5DzApG"},{"type":"inlineMath","value":"x","position":{"start":{"line":85,"column":1},"end":{"line":85,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>x</mi></mrow><annotation encoding=\"application/x-tex\">x</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">x</span></span></span></span>","key":"ys1WyyQsfz"},{"type":"text","value":" and ","position":{"start":{"line":85,"column":1},"end":{"line":85,"column":1}},"key":"qCdIZDRSSS"},{"type":"inlineMath","value":"y","position":{"start":{"line":85,"column":1},"end":{"line":85,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>y</mi></mrow><annotation encoding=\"application/x-tex\">y</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.625em;vertical-align:-0.1944em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">y</span></span></span></span>","key":"bK7mXuKtpW"},{"type":"text","value":" axes will be swapped.","position":{"start":{"line":85,"column":1},"end":{"line":85,"column":1}},"key":"BJtwVeSPhZ"}],"key":"yRvQHP7xnW"}],"key":"Rg0rnMwejY"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"m, n = 80, 70\nx = linspace(0, 2, m+1)\ny = linspace(1, 3, n+1)\nmtx, X, Y, _, _, _ = FNC.tensorgrid(x, y)\nF = mtx(f)\n\npcolormesh(X.T, Y.T, F.T, cmap=\"RdBu\", vmin=-1, vmax=1, shading=\"gouraud\")\naxis(\"equal\"),  colorbar()\nxlabel(\"$x$\"),  ylabel(\"$y$\");","key":"vAZkFsL591"},{"type":"output","id":"wtPp9YPQUX9hEbrn4jCOt","data":[{"output_type":"display_data","metadata":{},"data":{"text/plain":{"content":"<Figure size 700x400 with 2 Axes>","content_type":"text/plain"},"image/png":{"content_type":"image/png","hash":"7f2b82f79e39c522bbd6e365a7bb56b9","path":"/build/7f2b82f79e39c522bbd6e365a7bb56b9.png"}}}],"key":"xu5gyx4gXz"}],"key":"Xz5mkoH0Eu"}],"label":"demo-tensorprod-gridfun-python","identifier":"demo-tensorprod-gridfun-python","html_id":"demo-tensorprod-gridfun-python","key":"aBCweC2fPU"},{"type":"details","open":true,"children":[{"type":"summary","children":[{"type":"crossReference","identifier":"demo-tensorprod-disksphere","label":"demo-tensorprod-disksphere","kind":"proof:example","position":{"start":{"line":102,"column":1},"end":{"line":102,"column":28}},"children":[{"type":"text","value":"Example ","key":"zp9YJxsHbc"},{"type":"text","value":"13.1.3","key":"GKEwaNAPLu"}],"template":"Example %s","enumerator":"13.1.3","resolved":true,"html_id":"demo-tensorprod-disksphere","remote":true,"url":"/tensorprod","dataUrl":"/tensorprod.json","key":"f2qOAJbiqs"}],"key":"hKFIUq1E05"},{"type":"paragraph","position":{"start":{"line":104,"column":1},"end":{"line":104,"column":1}},"children":[{"type":"text","value":"For a function given in polar form, such as ","position":{"start":{"line":104,"column":1},"end":{"line":104,"column":1}},"key":"KfJc6YwbqB"},{"type":"inlineMath","value":"f(r,\\theta)=1-r^4","position":{"start":{"line":104,"column":1},"end":{"line":104,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>f</mi><mo stretchy=\"false\">(</mo><mi>r</mi><mo separator=\"true\">,</mo><mi>θ</mi><mo stretchy=\"false\">)</mo><mo>=</mo><mn>1</mn><mo>−</mo><msup><mi>r</mi><mn>4</mn></msup></mrow><annotation encoding=\"application/x-tex\">f(r,\\theta)=1-r^4</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.10764em;\">f</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">r</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">θ</span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.7278em;vertical-align:-0.0833em;\"></span><span class=\"mord\">1</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8141em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">r</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">4</span></span></span></span></span></span></span></span></span></span></span>","key":"iuMB0sNoDq"},{"type":"text","value":", construction of a function over the unit disk is straightforward using a grid in ","position":{"start":{"line":104,"column":1},"end":{"line":104,"column":1}},"key":"J3d729wwyZ"},{"type":"inlineMath","value":"(r,\\theta)","position":{"start":{"line":104,"column":1},"end":{"line":104,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mo stretchy=\"false\">(</mo><mi>r</mi><mo separator=\"true\">,</mo><mi>θ</mi><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">(r,\\theta)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mopen\">(</span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">r</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">θ</span><span class=\"mclose\">)</span></span></span></span>","key":"sTh7FqYJm9"},{"type":"text","value":" space.","position":{"start":{"line":104,"column":1},"end":{"line":104,"column":1}},"key":"FWg75xxsF7"}],"key":"TEcujmDnTI"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"r = linspace(0, 1, 41)\ntheta = linspace(0, 2*pi, 121)\nmtx, R, Theta, _, _, _ = FNC.tensorgrid(r, theta)\n\nF = mtx(lambda r, theta: 1 - r**4)    \n\ncontourf(R.T, Theta.T, F.T, levels=20)\ncolorbar()\nxlabel(\"$r$\"),  ylabel(\"$\\\\theta$\");","key":"TOZpUYJYwo"},{"type":"output","id":"-LJoJkiMudn8PBUvI0ymI","data":[{"output_type":"display_data","metadata":{},"data":{"text/plain":{"content":"<Figure size 700x400 with 2 Axes>","content_type":"text/plain"},"image/png":{"content_type":"image/png","hash":"2c7f34a0ffcc9703a9cc56446fab2695","path":"/build/2c7f34a0ffcc9703a9cc56446fab2695.png"}}}],"key":"r6NdgdpOPy"}],"key":"nrTxdrspxT"},{"type":"paragraph","position":{"start":{"line":118,"column":1},"end":{"line":118,"column":1}},"children":[{"type":"text","value":"Of course, we are used to seeing such plots over the ","position":{"start":{"line":118,"column":1},"end":{"line":118,"column":1}},"key":"FddsyDS4ff"},{"type":"inlineMath","value":"(x,y)","position":{"start":{"line":118,"column":1},"end":{"line":118,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mo stretchy=\"false\">(</mo><mi>x</mi><mo separator=\"true\">,</mo><mi>y</mi><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">(x,y)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">x</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">y</span><span class=\"mclose\">)</span></span></span></span>","key":"YXwTmWW7yJ"},{"type":"text","value":" plane, not the ","position":{"start":{"line":118,"column":1},"end":{"line":118,"column":1}},"key":"qW6PqcxDfo"},{"type":"inlineMath","value":"(r,\\theta)","position":{"start":{"line":118,"column":1},"end":{"line":118,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mo stretchy=\"false\">(</mo><mi>r</mi><mo separator=\"true\">,</mo><mi>θ</mi><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">(r,\\theta)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mopen\">(</span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">r</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">θ</span><span class=\"mclose\">)</span></span></span></span>","key":"syI5ybFjP2"},{"type":"text","value":" plane. For this we create matrices for the coordinate functions ","position":{"start":{"line":118,"column":1},"end":{"line":118,"column":1}},"key":"DPH2Itlsny"},{"type":"inlineMath","value":"x","position":{"start":{"line":118,"column":1},"end":{"line":118,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>x</mi></mrow><annotation encoding=\"application/x-tex\">x</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">x</span></span></span></span>","key":"eZsYPXIhRz"},{"type":"text","value":" and ","position":{"start":{"line":118,"column":1},"end":{"line":118,"column":1}},"key":"woIiti5mAV"},{"type":"inlineMath","value":"y","position":{"start":{"line":118,"column":1},"end":{"line":118,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>y</mi></mrow><annotation encoding=\"application/x-tex\">y</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.625em;vertical-align:-0.1944em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">y</span></span></span></span>","key":"GiZqqefpny"},{"type":"text","value":".","position":{"start":{"line":118,"column":1},"end":{"line":118,"column":1}},"key":"rr6OvgJ6H5"}],"key":"ZpC6UwJFtc"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"X, Y = R * cos(Theta), R * sin(Theta)\ncontourf(X.T, Y.T, F.T, levels=20)\ncolorbar(),  axis(\"equal\")\nxlabel(\"$x$\"),  ylabel(\"$y$\");","key":"Uj4g1knCqj"},{"type":"output","id":"v-NoMuH7fLCvLhfS7QLnp","data":[{"output_type":"display_data","metadata":{},"data":{"text/plain":{"content":"<Figure size 700x400 with 2 Axes>","content_type":"text/plain"},"image/png":{"content_type":"image/png","hash":"33c4800b1ece4a9f0a22374e811eaeb2","path":"/build/33c4800b1ece4a9f0a22374e811eaeb2.png"}}}],"key":"ss5JMv5ga0"}],"key":"j70B5cXbar"},{"type":"paragraph","position":{"start":{"line":127,"column":1},"end":{"line":127,"column":1}},"children":[{"type":"text","value":"In such functions the values along the line ","position":{"start":{"line":127,"column":1},"end":{"line":127,"column":1}},"key":"u6in5tnq94"},{"type":"inlineMath","value":"r=0","position":{"start":{"line":127,"column":1},"end":{"line":127,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>r</mi><mo>=</mo><mn>0</mn></mrow><annotation encoding=\"application/x-tex\">r=0</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">r</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">0</span></span></span></span>","key":"S1adYKNBJy"},{"type":"text","value":" must be identical, and the values on the line ","position":{"start":{"line":127,"column":1},"end":{"line":127,"column":1}},"key":"lAVn2H9T3q"},{"type":"inlineMath","value":"\\theta=0","position":{"start":{"line":127,"column":1},"end":{"line":127,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>θ</mi><mo>=</mo><mn>0</mn></mrow><annotation encoding=\"application/x-tex\">\\theta=0</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6944em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">θ</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">0</span></span></span></span>","key":"YXtor8K3Pd"},{"type":"text","value":" should be identical to those on ","position":{"start":{"line":127,"column":1},"end":{"line":127,"column":1}},"key":"A4FFpy3pFI"},{"type":"inlineMath","value":"\\theta=2\\pi","position":{"start":{"line":127,"column":1},"end":{"line":127,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>θ</mi><mo>=</mo><mn>2</mn><mi>π</mi></mrow><annotation encoding=\"application/x-tex\">\\theta=2\\pi</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6944em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">θ</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">2</span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">π</span></span></span></span>","key":"Eb2Xz9sLVk"},{"type":"text","value":". Otherwise the interpretation of the domain as the unit disk is nonsensical. If the function is defined in terms of ","position":{"start":{"line":127,"column":1},"end":{"line":127,"column":1}},"key":"j4fKntc5dN"},{"type":"inlineMath","value":"x","position":{"start":{"line":127,"column":1},"end":{"line":127,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>x</mi></mrow><annotation encoding=\"application/x-tex\">x</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">x</span></span></span></span>","key":"jpiqV1XHEh"},{"type":"text","value":" and ","position":{"start":{"line":127,"column":1},"end":{"line":127,"column":1}},"key":"oKOF0gdmNv"},{"type":"inlineMath","value":"y","position":{"start":{"line":127,"column":1},"end":{"line":127,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>y</mi></mrow><annotation encoding=\"application/x-tex\">y</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.625em;vertical-align:-0.1944em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">y</span></span></span></span>","key":"LNk93w87KE"},{"type":"text","value":", then those can be defined in terms of ","position":{"start":{"line":127,"column":1},"end":{"line":127,"column":1}},"key":"tpt1VZAgqm"},{"type":"inlineMath","value":"r","position":{"start":{"line":127,"column":1},"end":{"line":127,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>r</mi></mrow><annotation encoding=\"application/x-tex\">r</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">r</span></span></span></span>","key":"WERrR6u4a5"},{"type":"text","value":" and ","position":{"start":{"line":127,"column":1},"end":{"line":127,"column":1}},"key":"Gih12knSre"},{"type":"inlineMath","value":"\\theta","position":{"start":{"line":127,"column":1},"end":{"line":127,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>θ</mi></mrow><annotation encoding=\"application/x-tex\">\\theta</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6944em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">θ</span></span></span></span>","key":"H4bwGpCdb4"},{"type":"text","value":" using ","position":{"start":{"line":127,"column":1},"end":{"line":127,"column":1}},"key":"Wp2ewCozAy"},{"type":"crossReference","kind":"equation","identifier":"unitdiskparam","label":"unitdiskparam","children":[{"type":"text","value":"(","key":"APxnPdBap4"},{"type":"text","value":"13.1.5","key":"LJWxa0wbqS"},{"type":"text","value":")","key":"nyGvFKkATR"}],"template":"(%s)","enumerator":"13.1.5","resolved":true,"html_id":"unitdiskparam","remote":true,"url":"/tensorprod","dataUrl":"/tensorprod.json","key":"jIREQtrk6c"},{"type":"text","value":".","position":{"start":{"line":127,"column":1},"end":{"line":127,"column":1}},"key":"wkHwNfW8Hx"}],"key":"GXKx6ws1I7"}],"label":"demo-tensorprod-disksphere-python","identifier":"demo-tensorprod-disksphere-python","html_id":"demo-tensorprod-disksphere-python","key":"e8PItIU7Rf"},{"type":"details","open":true,"children":[{"type":"summary","children":[{"type":"crossReference","identifier":"demo-tensorprod-diff","label":"demo-tensorprod-diff","kind":"proof:example","position":{"start":{"line":132,"column":1},"end":{"line":132,"column":22}},"children":[{"type":"text","value":"Example ","key":"al4yACEQaS"},{"type":"text","value":"13.1.4","key":"Ysh8X3Oqmn"}],"template":"Example %s","enumerator":"13.1.4","resolved":true,"html_id":"demo-tensorprod-diff","remote":true,"url":"/tensorprod","dataUrl":"/tensorprod.json","key":"Ls40O6nuRe"}],"key":"Sgz8n5HLNv"},{"type":"paragraph","position":{"start":{"line":134,"column":1},"end":{"line":134,"column":1}},"children":[{"type":"text","value":"We define a function and, for reference, its two exact partial derivatives.","position":{"start":{"line":134,"column":1},"end":{"line":134,"column":1}},"key":"wJKgMm2nJu"}],"key":"u5vARciO7T"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"u = lambda x, y: sin(pi * x * y - y)\ndu_dx = lambda x, y: pi * y * cos(pi * x * y - y)\ndu_dy = lambda x, y: (pi * x - 1) * cos(pi * x * y - y)","key":"OoXMvQikqH"},{"type":"output","id":"I6EvRWcJoFX7pj-XMu9UH","data":[],"key":"Sv636hUOAz"}],"key":"cIRFO65gwI"},{"type":"paragraph","position":{"start":{"line":142,"column":1},"end":{"line":142,"column":1}},"children":[{"type":"text","value":"We will use an equispaced grid and second-order finite differences as implemented by ","position":{"start":{"line":142,"column":1},"end":{"line":142,"column":1}},"key":"YlWJ8pMmqa"},{"type":"inlineCode","value":"diffmat2","position":{"start":{"line":142,"column":1},"end":{"line":142,"column":1}},"key":"FbIjPU7EsF"},{"type":"text","value":". First, we have a look at a plots of the exact partial derivatives.","position":{"start":{"line":142,"column":1},"end":{"line":142,"column":1}},"key":"Y1Sh8iYb3r"}],"key":"Go1IfkXdTu"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"m, n = 80, 70\nx, Dx, Dxx = FNC.diffmat2(m, [0, 2])\ny, Dy, Dyy = FNC.diffmat2(n, [1, 3])\nmtx, X, Y, _, _, _ = FNC.tensorgrid(x, y)\n\nU = mtx(u)\ndU_dX = mtx(du_dx)\ndU_dY = mtx(du_dy)\n\nsubplot(1, 2, 1)\ncontourf(X, Y, dU_dX)\ntitle(\"$u$\"),  axis(\"equal\")\nsubplot(1, 2, 2)\ncontourf(X, Y, dU_dY)\ntitle(\"$\\\\partial u/\\\\partial y$\"),  axis(\"equal\");","key":"a0bp3nbGk8"},{"type":"output","id":"OYt0OHltj8bgXmMH5pNT1","data":[{"output_type":"display_data","metadata":{},"data":{"text/plain":{"content":"<Figure size 700x400 with 2 Axes>","content_type":"text/plain"},"image/png":{"content_type":"image/png","hash":"a43ee68856080b028db67ae192d2938b","path":"/build/a43ee68856080b028db67ae192d2938b.png"}}}],"key":"wAqaSEpBR7"}],"key":"SWmUJpahJF"},{"type":"paragraph","position":{"start":{"line":162,"column":1},"end":{"line":162,"column":1}},"children":[{"type":"text","value":"Now we compare the exact partial derivatives with their finite-difference approximations. Since these are signed errors, we use a colormap that is symmetric around zero.","position":{"start":{"line":162,"column":1},"end":{"line":162,"column":1}},"key":"iOGhVBPeZb"}],"key":"d1ciZQi6pR"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"subplot(1, 2, 1)\nerr_x = Dx @ U - dU_dX\nM = max(abs(err_x))\npcolormesh(X, Y, err_x, shading=\"gouraud\", cmap=\"RdBu\", vmin=-M, vmax=M)\ncolorbar()\ntitle(\"error in $\\\\partial u/\\\\partial x$\"),  axis(\"equal\")\n\nsubplot(1, 2, 2)\nerr_y = U @ Dy.T - dU_dY\nM = max(abs(err_y))\npcolormesh(X, Y, err_y, shading=\"gouraud\", cmap=\"RdBu\", vmin=-M, vmax=M)\ncolorbar()\ntitle(\"error in $\\\\partial u/\\\\partial y$\"),  axis(\"equal\");","key":"QZnwIoiFF9"},{"type":"output","id":"LeKYEITOTMQl9J_heBtoJ","data":[{"output_type":"display_data","metadata":{},"data":{"text/plain":{"content":"<Figure size 700x400 with 4 Axes>","content_type":"text/plain"},"image/png":{"content_type":"image/png","hash":"8ff8200f97c8ff91474294c1e7d27c3b","path":"/build/8ff8200f97c8ff91474294c1e7d27c3b.png"}}}],"key":"MrA1oK5FJj"}],"key":"DcPKKGfBBe"},{"type":"paragraph","position":{"start":{"line":180,"column":1},"end":{"line":180,"column":1}},"children":[{"type":"text","value":"Not surprisingly, the errors are largest where the derivatives themselves are largest.","position":{"start":{"line":180,"column":1},"end":{"line":180,"column":1}},"key":"MwUWRlcHD6"}],"key":"xjjUF9qAsu"}],"label":"demo-tensorprod-diff-python","identifier":"demo-tensorprod-diff-python","html_id":"demo-tensorprod-diff-python","key":"Wr85zFhsXo"},{"type":"heading","depth":3,"position":{"start":{"line":183,"column":1},"end":{"line":183,"column":1}},"children":[{"type":"text","value":"13.2 ","position":{"start":{"line":183,"column":1},"end":{"line":183,"column":1}},"key":"LNeDv9rdRF"},{"type":"link","identifier":"section-twodim-diffadv","label":"section-twodim-diffadv","kind":"narrative","position":{"start":{"line":183,"column":6},"end":{"line":183,"column":29}},"url":"/diffadv","internal":true,"dataUrl":"/diffadv.json","children":[{"type":"text","value":"Two-dimensional diffusion and advection","key":"oBClKZO0rB"}],"key":"atZ4cKBnnD"}],"identifier":"id-13-2","label":"13.2 ","html_id":"id-13-2","implicit":true,"key":"sIFqJd4uLU"},{"type":"details","open":true,"children":[{"type":"summary","children":[{"type":"crossReference","identifier":"demo-diffadv-vec","label":"demo-diffadv-vec","kind":"proof:example","position":{"start":{"line":186,"column":1},"end":{"line":186,"column":18}},"children":[{"type":"text","value":"Example ","key":"s1SQiY82w9"},{"type":"text","value":"13.2.1","key":"PLSAW8hvVz"}],"template":"Example %s","enumerator":"13.2.1","resolved":true,"html_id":"demo-diffadv-vec","remote":true,"url":"/diffadv","dataUrl":"/diffadv.json","key":"XSM9yNgwrF"}],"key":"i1aRomqxVu"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"m, n = 4, 3\nx = linspace(0, 2, m+1)\ny = linspace(-3, 0, n+1)\n\nf = lambda x, y: cos(0.75 * pi * x * y - 0.5 * pi * y)\nmtx, X, Y, vec, unvec, _ = FNC.tensorgrid(x, y)\nF = mtx(f)\nprint(f\"function on a {m}x{n} grid:\")\nwith printoptions(precision=4, suppress=True):\n    print(F)\n\nprint(\"vec(F):\")\nwith printoptions(precision=4, suppress=True):\n    print(vec(F))","key":"AxVLeyyBGR"},{"type":"output","id":"-r6gHN3fR_wRGAEJEWI7L","data":[{"output_type":"stream","name":"stdout","text":"function on a 4x3 grid:\n[[-0.     -1.      0.      1.    ]\n [ 0.3827  0.7071  0.9239  1.    ]\n [-0.7071  0.      0.7071  1.    ]\n [ 0.9239 -0.7071 -0.3827  1.    ]\n [-1.      1.     -1.      1.    ]]\nvec(F):\n[-0.      0.3827 -0.7071  0.9239 -1.     -1.      0.7071  0.     -0.7071\n  1.      0.      0.9239  0.7071 -0.3827 -1.      1.      1.      1.\n  1.      1.    ]\n"}],"key":"I1LwiyuY6J"}],"key":"gpJeT4ZyaZ"},{"type":"paragraph","position":{"start":{"line":206,"column":1},"end":{"line":206,"column":1}},"children":[{"type":"text","value":"The ","position":{"start":{"line":206,"column":1},"end":{"line":206,"column":1}},"key":"yDqiPY3Sql"},{"type":"inlineCode","value":"unvec","position":{"start":{"line":206,"column":1},"end":{"line":206,"column":1}},"key":"QO9Ws6mcVX"},{"type":"text","value":" operation is the inverse of vec.","position":{"start":{"line":206,"column":1},"end":{"line":206,"column":1}},"key":"dh8huRrtSQ"}],"key":"pxdrSlggBG"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"print(\"unvec(vec(F)):\")\nwith printoptions(precision=4, suppress=True):\n    print(unvec(vec(F)))","key":"MiEdvtn4Ze"},{"type":"output","id":"N0iOMx3quFO0eUw4LAKcr","data":[{"output_type":"stream","name":"stdout","text":"unvec(vec(F)):\n[[-0.     -1.      0.      1.    ]\n [ 0.3827  0.7071  0.9239  1.    ]\n [-0.7071  0.      0.7071  1.    ]\n [ 0.9239 -0.7071 -0.3827  1.    ]\n [-1.      1.     -1.      1.    ]]\n"}],"key":"dtKDsf2rLa"}],"key":"rkD6O5p3qp"}],"label":"demo-diffadv-vec-python","identifier":"demo-diffadv-vec-python","html_id":"demo-diffadv-vec-python","key":"rzwTVHQT0C"},{"type":"details","open":true,"children":[{"type":"summary","children":[{"type":"crossReference","identifier":"demo-diffadv-heat","label":"demo-diffadv-heat","kind":"proof:example","position":{"start":{"line":216,"column":1},"end":{"line":216,"column":19}},"children":[{"type":"text","value":"Example ","key":"vJzeShaYo9"},{"type":"text","value":"13.2.2","key":"s0cTNb3GTe"}],"template":"Example %s","enumerator":"13.2.2","resolved":true,"html_id":"demo-diffadv-heat","remote":true,"url":"/diffadv","dataUrl":"/diffadv.json","key":"KVQL1QEpz8"}],"key":"V817pp1gaY"},{"type":"paragraph","position":{"start":{"line":219,"column":1},"end":{"line":219,"column":1}},"children":[{"type":"text","value":"We start by defining the discretization of the rectangle.","position":{"start":{"line":219,"column":1},"end":{"line":219,"column":1}},"key":"d449Mt8Cnc"}],"key":"e7jC4SYz7J"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"m, n = 60, 40\nx, Dx, Dxx = FNC.diffper(m, [-1, 1])\ny, Dy, Dyy = FNC.diffper(n, [-1, 1])\nmtx, X, Y, vec, unvec, _ = FNC.tensorgrid(x, y)","key":"EUAT0Pq2l6"},{"type":"output","id":"SGN-NxWqCj2HkBGtSe6N5","data":[],"key":"gGrJiVunxM"}],"key":"fDODEEjBsX"},{"type":"paragraph","position":{"start":{"line":228,"column":1},"end":{"line":228,"column":1}},"children":[{"type":"text","value":"Here is the initial condition, evaluated on the grid.","position":{"start":{"line":228,"column":1},"end":{"line":228,"column":1}},"key":"yYMVIGI3p4"}],"key":"sNtyas9vsh"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"u_init = lambda x, y: sin(4 * pi * x) * exp(cos(pi * y))\nU0 = mtx(u_init)\nmx = max(abs(U0))\npcolormesh(X, Y, U0, vmin=-mx, vmax=mx, cmap=\"RdBu\", shading=\"gouraud\")\naxis(\"equal\"),  colorbar()\nxlabel(\"$x$\"),  ylabel(\"$y$\")\ntitle(\"Initial condition\");","key":"BqaSsLi4lP"},{"type":"output","id":"sy8yB-RPxnG1jNUs1-2iJ","data":[{"output_type":"display_data","metadata":{},"data":{"text/plain":{"content":"<Figure size 700x400 with 2 Axes>","content_type":"text/plain"},"image/png":{"content_type":"image/png","hash":"e650318cc53b6e83be8f47627ed3aa6b","path":"/build/e650318cc53b6e83be8f47627ed3aa6b.png"}}}],"key":"sS3FXQPVSg"}],"key":"GsuJfGwPHt"},{"type":"paragraph","position":{"start":{"line":240,"column":1},"end":{"line":240,"column":1}},"children":[{"type":"text","value":"The following function computes the time derivative for the unknowns, which have a vector shape. The actual calculations, however, take place using the matrix shape.","position":{"start":{"line":240,"column":1},"end":{"line":240,"column":1}},"key":"RXALAzlERn"}],"key":"RRxfWbE9Sb"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"alpha = 0.1\ndef du_dt(t, u):\n    U = unvec(u)\n    Uyy = Dxx @ U\n    Uxx = U @ Dyy.T\n    dU_dt = alpha * (Uxx + Uyy)  # PDE\n    return vec(dU_dt)","key":"Yti5Z47nX8"},{"type":"output","id":"J9KkPlf3s_GmpbFaSvBqK","data":[],"key":"yZAUvnN1gy"}],"key":"r58abJdRTQ"},{"type":"paragraph","position":{"start":{"line":252,"column":1},"end":{"line":252,"column":1}},"children":[{"type":"text","value":"Since this problem is parabolic, a stiff time integrator is appropriate.","position":{"start":{"line":252,"column":1},"end":{"line":252,"column":1}},"key":"ORyIWYjx5M"}],"key":"ELjMgaqx1X"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"from scipy.integrate import solve_ivp\nsol = solve_ivp(du_dt, (0, 0.2), vec(U0), method=\"BDF\", dense_output=True)\nU = lambda t: unvec(sol.sol(t))","key":"CEIz4LeO2a"},{"type":"output","id":"pUDs7dxweQiiMpyZWEkij","data":[],"key":"v89GjPvoBJ"}],"key":"FlWjhN3bEf"},{"type":"paragraph","position":{"start":{"line":260,"column":1},"end":{"line":260,"column":1}},"children":[{"type":"text","value":"We can use the function ","position":{"start":{"line":260,"column":1},"end":{"line":260,"column":1}},"key":"Pazg3lzW20"},{"type":"inlineCode","value":"U","position":{"start":{"line":260,"column":1},"end":{"line":260,"column":1}},"key":"O2hot7vErJ"},{"type":"text","value":" defined above to get the solution at any time. Its output is a matrix of values on the grid.","position":{"start":{"line":260,"column":1},"end":{"line":260,"column":1}},"key":"BJlX3mGl3a"}],"key":"vgUN5x1pw6"},{"type":"admonition","kind":"tip","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"Tip","key":"wqRItSyrFq"}],"key":"ALLfvGrKLP"},{"type":"paragraph","position":{"start":{"line":264,"column":1},"end":{"line":264,"column":1}},"children":[{"type":"text","value":"To plot the solution at any time, we use the same color scale as with the initial condition, so that the pictures are more easily compared.","position":{"start":{"line":264,"column":1},"end":{"line":264,"column":1}},"key":"Wx1Cuw6mcu"}],"key":"Bhe7RqB8Kb"}],"class":"dropdown","key":"eq4LUT3XUq"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"pcolormesh(X.T, Y.T, U(0.02).T, \n    vmin=-mx, vmax=mx, cmap=\"RdBu\", shading=\"gouraud\")\naxis(\"equal\"),  colorbar()\nxlabel(\"$x$\"),  ylabel(\"$y$\")\ntitle(\"Heat equation, t=0.02\");","key":"KGXlz9TyRE"},{"type":"output","id":"33hE1tt4EgEbYTON3Xcsz","data":[{"output_type":"display_data","metadata":{},"data":{"text/plain":{"content":"<Figure size 700x400 with 2 Axes>","content_type":"text/plain"},"image/png":{"content_type":"image/png","hash":"7d3c1ca99a27556f3565a0934764f255","path":"/build/7d3c1ca99a27556f3565a0934764f255.png"}}}],"key":"PFULUdG3no"}],"key":"NtJWIjk20E"},{"type":"paragraph","position":{"start":{"line":275,"column":1},"end":{"line":275,"column":1}},"children":[{"type":"text","value":"An animation shows convergence toward a uniform value.","position":{"start":{"line":275,"column":1},"end":{"line":275,"column":1}},"key":"eXoP6PRozs"}],"key":"dGsiNwGTFO"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"from matplotlib import animation\nfig, ax = subplots()\nobj = ax.pcolormesh(X, Y, U(0), vmin=-mx, vmax=mx, cmap=\"RdBu\", shading=\"gouraud\")\ntime_text = ax.text(0.05, 0.9, '', transform=ax.transAxes)\nax.set_xlabel(\"$x$\"),  ax.set_ylabel(\"$y$\")\nax.set_aspect(\"equal\")\nax.set_title(\"Heat equation on a periodic domain\")\ndef snapshot(t):\n    global obj\n    obj.remove()\n    obj = ax.pcolormesh(X, Y, U(t), vmin=-mx, vmax=mx, cmap=\"RdBu\", shading=\"gouraud\")\n    time_text.set_text(f\"t = {t:.2f}\")\n\nanim = animation.FuncAnimation(fig, snapshot, frames=linspace(0, 0.2, 41))\nanim.save(\"figures/heat-2d.mp4\", fps=30)\nclose()","key":"L9auExTSvH"},{"type":"output","id":"525v2h9nWYiFOMbdCztcy","data":[],"key":"Lf7g6jdRx0"}],"key":"iKh34asJIr"},{"type":"image","url":"/build/heat-2d-599b84676d99f911083e6ca502f00894.mp4","alt":"Heat equation in 2d","position":{"start":{"line":296,"column":1},"end":{"line":296,"column":1}},"key":"sNsfJx5e3B","urlSource":"figures/heat-2d.mp4"}],"label":"demo-diffadv-heat-python","identifier":"demo-diffadv-heat-python","html_id":"demo-diffadv-heat-python","key":"RwQ1vCFQ0s"},{"type":"details","open":true,"children":[{"type":"summary","children":[{"type":"crossReference","identifier":"demo-diffadv-advdiff","label":"demo-diffadv-advdiff","kind":"proof:example","position":{"start":{"line":301,"column":1},"end":{"line":301,"column":22}},"children":[{"type":"text","value":"Example ","key":"u46nw2Z1Fh"},{"type":"text","value":"13.2.3","key":"UgajOv7Nh5"}],"template":"Example %s","enumerator":"13.2.3","resolved":true,"html_id":"demo-diffadv-advdiff","remote":true,"url":"/diffadv","dataUrl":"/diffadv.json","key":"s5kSuQPOOV"}],"key":"lMhLuv0M4Y"},{"type":"paragraph","position":{"start":{"line":304,"column":1},"end":{"line":304,"column":1}},"children":[{"type":"text","value":"The first step is to define a discretization of the domain.","position":{"start":{"line":304,"column":1},"end":{"line":304,"column":1}},"key":"vAFoOoqxIu"}],"key":"ABQMcBwuCo"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"m, n = 50, 36\nx, Dx, Dxx = FNC.diffcheb(m, [-1, 1])\ny, Dy, Dyy = FNC.diffcheb(n, [-1, 1])\nmtx, X, Y, _, _, _ = FNC.tensorgrid(x, y)\nu_init = lambda x, y: (1 + y) * (1 - x)**4 * (1 + x)**2 * (1 - y**4)","key":"csKVX0eqZB"},{"type":"output","id":"KQYDXwZFYlzLgNOCpU3XC","data":[],"key":"bxXy4s6KVB"}],"key":"ueGoWmQJ4Q"},{"type":"paragraph","position":{"start":{"line":314,"column":1},"end":{"line":314,"column":1}},"children":[{"type":"text","value":"We define functions ","position":{"start":{"line":314,"column":1},"end":{"line":314,"column":1}},"key":"Js7ld2qUop"},{"type":"inlineCode","value":"extend","position":{"start":{"line":314,"column":1},"end":{"line":314,"column":1}},"key":"XDLOBzzQys"},{"type":"text","value":" and ","position":{"start":{"line":314,"column":1},"end":{"line":314,"column":1}},"key":"IMP4568CNv"},{"type":"inlineCode","value":"chop","position":{"start":{"line":314,"column":1},"end":{"line":314,"column":1}},"key":"xUeaucHUlO"},{"type":"text","value":" to deal with the Dirichlet boundary conditions.","position":{"start":{"line":314,"column":1},"end":{"line":314,"column":1}},"key":"xgA7kEEG3v"}],"key":"lc9RXTFFrC"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"def chop(U):\n    return U[1:-1, 1:-1]\n\ndef extend(W):\n    U = zeros((m+1, n+1))\n    U[1:-1, 1:-1] = W\n    return U","key":"gWKDgVwBWe"},{"type":"output","id":"qA6wrvOlLLgRyVEQYf0kQ","data":[],"key":"tp4kNpAJmY"}],"key":"ogKrF2blSJ"},{"type":"paragraph","position":{"start":{"line":326,"column":1},"end":{"line":326,"column":1}},"children":[{"type":"text","value":"Now we define the ","position":{"start":{"line":326,"column":1},"end":{"line":326,"column":1}},"key":"hvdQcuoBz1"},{"type":"inlineCode","value":"pack","position":{"start":{"line":326,"column":1},"end":{"line":326,"column":1}},"key":"zb4oZrwWzD"},{"type":"text","value":" and ","position":{"start":{"line":326,"column":1},"end":{"line":326,"column":1}},"key":"ialX95T0QK"},{"type":"inlineCode","value":"unpack","position":{"start":{"line":326,"column":1},"end":{"line":326,"column":1}},"key":"JUm33aU3u4"},{"type":"text","value":" functions, using another call to ","position":{"start":{"line":326,"column":1},"end":{"line":326,"column":1}},"key":"keizd5njrS"},{"type":"crossReference","identifier":"function-tensorgrid","label":"function-tensorgrid","kind":"proof:algorithm","position":{"start":{"line":326,"column":72},"end":{"line":326,"column":92}},"children":[{"type":"text","value":"Algorithm ","key":"j4Qx2v1IDE"},{"type":"text","value":"13.2.1","key":"p8qiQS7MVx"}],"template":"Algorithm %s","enumerator":"13.2.1","resolved":true,"html_id":"function-tensorgrid","remote":true,"url":"/diffadv","dataUrl":"/diffadv.json","key":"EXX7V8yowK"},{"type":"text","value":" to get reshaping functions for the interior points.","position":{"start":{"line":326,"column":1},"end":{"line":326,"column":1}},"key":"k0hd4EebfP"}],"key":"wftXN6G4R3"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"_, _, _, vec, unvec, _ = FNC.tensorgrid(x[1:-1], y[1:-1])\npack = lambda U: vec(chop(U))          # restrict to interior, then vectorize\nunpack = lambda w: extend(unvec(w))    # reshape, then extend to boundary","key":"alzNGN0H3N"},{"type":"output","id":"QpwJS8rrZb_1MoCSUs66Y","data":[],"key":"Qxmj4Cl4t6"}],"key":"O1Nyyhd1yA"},{"type":"paragraph","position":{"start":{"line":334,"column":1},"end":{"line":334,"column":1}},"children":[{"type":"text","value":"Now we can define and solve the ","key":"qvvjXUsab0"},{"type":"abbreviation","title":"initial-value problem","children":[{"type":"text","value":"IVP","key":"anUnrx4DBs"}],"key":"ucix24kHYa"},{"type":"text","value":" using a stiff solver.","key":"uJ9XAGZxXS"}],"key":"Zmba0kviJG"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"ep = 0.05\ndef dw_dt(t, w):\n    U = unpack(w)\n    Uyy = Dxx @ U\n    Uxx = U @ Dyy.T \n    dU_dt = 1 - Dx @ U + ep * (Uxx + Uyy)\n    return pack(dU_dt)\n\nU0 = mtx(u_init)\nsol = solve_ivp(dw_dt, (0, 2), pack(U0), method=\"BDF\", dense_output=True)","key":"OMexLoWLa8"},{"type":"output","id":"AcwB3VAiEgHDlQEPJZjPf","data":[],"key":"DNRsoiFtaC"}],"key":"bdXFqxFKAL"},{"type":"paragraph","position":{"start":{"line":349,"column":1},"end":{"line":349,"column":1}},"children":[{"type":"text","value":"When we evaluate the solution at a particular value of ","position":{"start":{"line":349,"column":1},"end":{"line":349,"column":1}},"key":"ECmFnY87qr"},{"type":"inlineMath","value":"t","position":{"start":{"line":349,"column":1},"end":{"line":349,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>t</mi></mrow><annotation encoding=\"application/x-tex\">t</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6151em;\"></span><span class=\"mord mathnormal\">t</span></span></span></span>","key":"TBs5HvkRyX"},{"type":"text","value":", we get a vector of the interior grid values. The ","position":{"start":{"line":349,"column":1},"end":{"line":349,"column":1}},"key":"IhGNK1H4ky"},{"type":"inlineCode","value":"unpack","position":{"start":{"line":349,"column":1},"end":{"line":349,"column":1}},"key":"FPf7lGGxL4"},{"type":"text","value":" converts this to a complete matrix of grid values.","position":{"start":{"line":349,"column":1},"end":{"line":349,"column":1}},"key":"S7h4E6CThA"}],"key":"IwSBbMqG5k"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"U = lambda t: unpack(sol.sol(t))    # matrix-valued function of time\n\npcolormesh(X.T, Y.T, U(0.5).T, cmap=\"Blues\", shading=\"gouraud\")\ncolorbar()\nxlabel(\"$x$\"),  ylabel(\"$y$\")\naxis(\"equal\"),  title(\"Solution at t=0.5\");","key":"qstIJFRVLw"},{"type":"output","id":"MnwT0b4wW0Ihrqcale6H8","data":[{"output_type":"display_data","metadata":{},"data":{"text/plain":{"content":"<Figure size 700x400 with 2 Axes>","content_type":"text/plain"},"image/png":{"content_type":"image/png","hash":"62b96d6e69b97bf0c13ceb53ae20a342","path":"/build/62b96d6e69b97bf0c13ceb53ae20a342.png"}}}],"key":"XqO3vwJdaR"}],"key":"qMhkacA8AW"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"mx = max([max(U(t)) for t in linspace(0, 2, 21)])\nfig, ax = subplots()\nobj = ax.pcolormesh(X.T, Y.T, U(0).T, vmin=0, vmax=2, cmap=\"Blues\", shading=\"gouraud\")\ntime_text = ax.text(0.05, 0.9, '', transform=ax.transAxes)\nax.set_xlabel(\"$x$\"),  ax.set_ylabel(\"$y$\")\nax.set_aspect(\"equal\")\nax.set_title(\"Advection-diffusion in 2d\")\ndef snapshot(t):\n    global obj\n    obj.remove()\n    obj = ax.pcolormesh(X.T, Y.T, U(t).T, vmin=0, vmax=mx, cmap=\"Blues\", shading=\"gouraud\")\n    time_text.set_text(f\"t = {t:.2f}\")\n\nanim = animation.FuncAnimation(fig, snapshot, frames=linspace(0, 2, 81))\nanim.save(\"figures/advdiff-2d.mp4\", fps=30)\nclose()","key":"dtKNWKZXtD"},{"type":"output","id":"3ETDBoHzB6p8QZ7OvCPw5","data":[],"key":"MG1exU28Km"}],"key":"wrQCnVVO4S"},{"type":"image","url":"/build/advdiff-2d-841b7cad43dade5d515e8854b6f63bc0.mp4","alt":"Advection-diffusion in 2d","position":{"start":{"line":379,"column":1},"end":{"line":379,"column":1}},"key":"rtMY0k7paN","urlSource":"figures/advdiff-2d.mp4"}],"label":"demo-diffadv-advdiff-python","identifier":"demo-diffadv-advdiff-python","html_id":"demo-diffadv-advdiff-python","key":"dQi3L6z0pp"},{"type":"details","open":true,"children":[{"type":"summary","children":[{"type":"crossReference","identifier":"demo-diffadv-wave","label":"demo-diffadv-wave","kind":"proof:example","position":{"start":{"line":383,"column":1},"end":{"line":383,"column":19}},"children":[{"type":"text","value":"Example ","key":"qVPCaT01P3"},{"type":"text","value":"13.2.4","key":"ZejiZ3geyC"}],"template":"Example %s","enumerator":"13.2.4","resolved":true,"html_id":"demo-diffadv-wave","remote":true,"url":"/diffadv","dataUrl":"/diffadv.json","key":"DcE4UFM4A8"}],"key":"EbpTzerduS"},{"type":"paragraph","position":{"start":{"line":385,"column":1},"end":{"line":385,"column":1}},"children":[{"type":"text","value":"We start with the discretization and initial condition.","position":{"start":{"line":385,"column":1},"end":{"line":385,"column":1}},"key":"pzWJHGWnXg"}],"key":"IQvtwFvf2E"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"m, n = 40, 42\nx, Dx, Dxx = FNC.diffcheb(m, [-2, 2])\ny, Dy, Dyy = FNC.diffcheb(n, [-2, 2])\nmtx, X, Y, _, _, _ = FNC.tensorgrid(x, y)\n\nU0 = mtx(lambda x, y: (x + 0.2) * exp(-12 * (x**2 + y**2)))\nV0 = zeros(U0.shape)","key":"OVxLYWFTE7"},{"type":"output","id":"wMb6o-APsvCJyIwwxHRhd","data":[],"key":"JQB61guUug"}],"key":"Zf1USZLCeK"},{"type":"paragraph","position":{"start":{"line":397,"column":1},"end":{"line":397,"column":1}},"children":[{"type":"text","value":"We need to define chopping and extension for the ","position":{"start":{"line":397,"column":1},"end":{"line":397,"column":1}},"key":"yM44MUW7Ae"},{"type":"inlineMath","value":"u","position":{"start":{"line":397,"column":1},"end":{"line":397,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>u</mi></mrow><annotation encoding=\"application/x-tex\">u</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">u</span></span></span></span>","key":"GMT8XYrVUn"},{"type":"text","value":" component. This looks the same as in ","position":{"start":{"line":397,"column":1},"end":{"line":397,"column":1}},"key":"RTooFWKkWq"},{"type":"crossReference","identifier":"demo-diffadv-advdiff","label":"demo-diffadv-advdiff","kind":"proof:example","position":{"start":{"line":397,"column":91},"end":{"line":397,"column":112}},"children":[{"type":"text","value":"Example ","key":"qy4O95kHGA"},{"type":"text","value":"13.2.3","key":"WijL6VJ1At"}],"template":"Example %s","enumerator":"13.2.3","resolved":true,"html_id":"demo-diffadv-advdiff","remote":true,"url":"/diffadv","dataUrl":"/diffadv.json","key":"IXlHvbil2b"},{"type":"text","value":".","position":{"start":{"line":397,"column":1},"end":{"line":397,"column":1}},"key":"E3f9tqmhUS"}],"key":"TkjTREouNu"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"def extend(U):\n    UU = zeros((m+1, n+1))\n    UU[1:-1, 1:-1] = U\n    return UU\n\ndef chop(U):\n    return U[1:-1, 1:-1]","key":"mWLtz5YC1P"},{"type":"output","id":"I0zZXuzbhbX6Mgq9h_XYL","data":[],"key":"yKMk3yvteo"}],"key":"QWv5aVRMHz"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"_, _, _, vec_v, unvec_v, _ = FNC.tensorgrid(x, y)\n_, _, _, vec_u, unvec_u, _ = FNC.tensorgrid(x[1:-1], y[1:-1])\nN = (m-1) * (n-1)    # number of interior points\n\ndef pack(U, V): \n    return hstack([vec_u(chop(U)), vec_v(V)])\n\ndef unpack(w):\n    U = extend(unvec_u(w[:N]))\n    V = unvec_v(w[N:])\n    return U, V","key":"jatTXjhTxa"},{"type":"output","id":"_lpfFkgbf6lE2Lz7NMm6y","data":[],"key":"BQ2SSY9Lts"}],"key":"tJS8cQpewh"},{"type":"paragraph","position":{"start":{"line":423,"column":1},"end":{"line":423,"column":1}},"children":[{"type":"text","value":"We can now define and solve the ","key":"MXgzZrCfTn"},{"type":"abbreviation","title":"initial-value problem","children":[{"type":"text","value":"IVP","key":"JLSi3oiDcv"}],"key":"BOavu2Nxlc"},{"type":"text","value":". Since this problem is hyperbolic, a nonstiff integrator is faster than a stiff one.","key":"xGWUnQsJ2G"}],"key":"pQ92bnp2ob"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"def dw_dt(t, w):\n    U, V = unpack(w)\n    dU_dt = V\n    dV_dt = Dxx @ U + U @ Dyy.T\n    return pack(dU_dt, dV_dt)\n\nfrom scipy.integrate import solve_ivp\nsol = solve_ivp(dw_dt, (0, 4), pack(U0, V0), method=\"RK45\", dense_output=True)\nU = lambda t: unpack(sol.sol(t))[0]","key":"YshZvgDPZv"},{"type":"output","id":"QMgEsvyM0uqepUNKLR0Xz","data":[],"key":"JPQiDRN57o"}],"key":"JiMTJapRg2"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"fig, ax = subplots()\nobj = ax.pcolormesh(X, Y, U(0), vmin=-0.1, vmax=0.1, cmap=\"RdBu\", shading=\"gouraud\")\ntime_text = ax.text(0.05, 0.9, '', transform=ax.transAxes)\nax.set_xlabel(\"$x$\"),  ax.set_ylabel(\"$y$\")\nax.set_aspect(\"equal\")\nax.set_title(\"Wave equation in 2d\")\n\ndef snapshot(t):\n    global obj\n    obj.remove()\n    obj = ax.pcolormesh(X, Y, U(t), vmin=-0.1, vmax=0.1, cmap=\"RdBu\", shading=\"gouraud\")\n    time_text.set_text(f\"t = {t:.2f}\")\n\nanim = animation.FuncAnimation(fig, snapshot, frames=linspace(0, 4, 91))\nanim.save(\"figures/wave-2d.mp4\", fps=30);\nclose()","key":"NOtwavqUs9"},{"type":"output","id":"OaBW5HjP6nfHH8-a9BJNJ","data":[],"key":"zeKrQr81lC"}],"key":"CfHOOgSkOh"},{"type":"image","url":"/build/wave-2d-b258740e5aec1e3212a90ff42a4fe40b.mp4","alt":"Wave equation in 2d","position":{"start":{"line":456,"column":1},"end":{"line":456,"column":1}},"key":"JHD3hkLysT","urlSource":"figures/wave-2d.mp4"}],"label":"demo-diffadv-wave-python","identifier":"demo-diffadv-wave-python","html_id":"demo-diffadv-wave-python","key":"kTxoVRZoGP"},{"type":"heading","depth":3,"position":{"start":{"line":459,"column":1},"end":{"line":459,"column":1}},"children":[{"type":"text","value":"13.3 ","position":{"start":{"line":459,"column":1},"end":{"line":459,"column":1}},"key":"ml3EM8dNWu"},{"type":"link","identifier":"section-twodim-laplace","label":"section-twodim-laplace","kind":"narrative","position":{"start":{"line":459,"column":6},"end":{"line":459,"column":29}},"url":"/laplace","internal":true,"dataUrl":"/laplace.json","children":[{"type":"text","value":"Laplace and Poisson equations","key":"v2r4kUBzOu"}],"key":"THoDee9SHZ"}],"identifier":"id-13-3","label":"13.3 ","html_id":"id-13-3","implicit":true,"key":"RiV7GgjUJP"},{"type":"details","open":true,"children":[{"type":"summary","children":[{"type":"crossReference","identifier":"demo-laplace-kron","label":"demo-laplace-kron","kind":"proof:example","position":{"start":{"line":462,"column":1},"end":{"line":462,"column":19}},"children":[{"type":"text","value":"Example ","key":"CHxTWdz1eY"},{"type":"text","value":"13.3.1","key":"w9VmhYHzJS"}],"template":"Example %s","enumerator":"13.3.1","resolved":true,"html_id":"demo-laplace-kron","remote":true,"url":"/laplace","dataUrl":"/laplace.json","key":"wfbsBoHOev"}],"key":"fG9lWDjetS"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"A = array([[1, 2], [-2, 0]])\nB = array([[1, 10, 100], [-5, 5, 3]])\nprint(\"A:\")\nprint(A)\nprint(\"B:\")\nprint(B)","key":"WOnJaETP3v"},{"type":"output","id":"gNJxfM1k8jGZkZ5IzU46j","data":[{"output_type":"stream","name":"stdout","text":"A:\n[[ 1  2]\n [-2  0]]\nB:\n[[  1  10 100]\n [ -5   5   3]]\n"}],"key":"cV5R14BVcL"}],"key":"OTWXa5uVhK"},{"type":"paragraph","position":{"start":{"line":474,"column":1},"end":{"line":474,"column":1}},"children":[{"type":"text","value":"Applying the definition manually, we get","position":{"start":{"line":474,"column":1},"end":{"line":474,"column":1}},"key":"RPOro5OcRV"}],"key":"vYwx4xkQ1D"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"A_kron_B = vstack([ hstack([A[0, 0] * B, A[0, 1] * B]), hstack([A[1, 0] * B, A[1, 1] * B]) ])\nprint(A_kron_B)","key":"WU0HBp2fjK"},{"type":"output","id":"vvl35SNdgCZCu0aLIQ2lu","data":[{"output_type":"stream","name":"stdout","text":"[[   1   10  100    2   20  200]\n [  -5    5    3  -10   10    6]\n [  -2  -20 -200    0    0    0]\n [  10  -10   -6    0    0    0]]\n"}],"key":"tWrvny9evT"}],"key":"IIsvhc2GUo"},{"type":"paragraph","position":{"start":{"line":484,"column":1},"end":{"line":484,"column":1}},"children":[{"type":"text","value":"But it makes more sense to use ","position":{"start":{"line":484,"column":1},"end":{"line":484,"column":1}},"key":"gnpMGPjkax"},{"type":"inlineCode","value":"kron","position":{"start":{"line":484,"column":1},"end":{"line":484,"column":1}},"key":"Bwx90ScfjJ"},{"type":"text","value":" from NumPy, or the ","position":{"start":{"line":484,"column":1},"end":{"line":484,"column":1}},"key":"S2sDwbPzn2"},{"type":"inlineCode","value":"scipy.sparse","position":{"start":{"line":484,"column":1},"end":{"line":484,"column":1}},"key":"lO94NfaPBu"},{"type":"text","value":" version when sparsity is to be preserved.","position":{"start":{"line":484,"column":1},"end":{"line":484,"column":1}},"key":"hk3kUN4IIc"}],"indexEntries":[{"entry":"Python","subEntry":{"value":"kron","kind":"entry"},"emphasis":true}],"label":"index-KhF1VQGvG7","identifier":"index-khf1vqgvg7","html_id":"index-khf1vqgvg7","key":"twSUqdiV5w"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"kron(A, B)","key":"wVbvkSWyuQ"},{"type":"output","id":"RBrx3JnYbsapDB_m4A2AQ","data":[{"output_type":"execute_result","execution_count":31,"metadata":{},"data":{"text/plain":{"content":"array([[   1,   10,  100,    2,   20,  200],\n       [  -5,    5,    3,  -10,   10,    6],\n       [  -2,  -20, -200,    0,    0,    0],\n       [  10,  -10,   -6,    0,    0,    0]])","content_type":"text/plain"}}}],"key":"GwDO112kRI"}],"key":"PaVfhpFjQy"}],"label":"demo-laplace-kron-python","identifier":"demo-laplace-kron-python","html_id":"demo-laplace-kron-python","key":"vwmAndXJiB"},{"type":"details","open":true,"children":[{"type":"summary","children":[{"type":"crossReference","identifier":"demo-laplace-fd","label":"demo-laplace-fd","kind":"proof:example","position":{"start":{"line":492,"column":1},"end":{"line":492,"column":17}},"children":[{"type":"text","value":"Example ","key":"Q1NacG8LzA"},{"type":"text","value":"13.3.2","key":"rrHfqlR7ja"}],"template":"Example %s","enumerator":"13.3.2","resolved":true,"html_id":"demo-laplace-fd","remote":true,"url":"/laplace","dataUrl":"/laplace.json","key":"MdFSdkqlNG"}],"key":"NYrkrdFKou"},{"type":"paragraph","position":{"start":{"line":494,"column":1},"end":{"line":494,"column":1}},"children":[{"type":"text","value":"We make a crude discretization for illustrative purposes.","position":{"start":{"line":494,"column":1},"end":{"line":494,"column":1}},"key":"wlwrFsKpcx"}],"key":"vd0CqeVRXg"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"m, n = 5, 6\nx, Dx, Dxx = FNC.diffmat2(m, [0, 3])\ny, Dy, Dyy = FNC.diffmat2(n, [-1, 1])\nmtx, X, Y, vec, unvec, is_boundary = FNC.tensorgrid(x, y)","key":"zDDnde9pLx"},{"type":"output","id":"ALOTyFxKNERW4csUVwI3l","data":[],"key":"cZdEGd1DdG"}],"key":"S98ab8xFdq"},{"type":"paragraph","position":{"start":{"line":503,"column":1},"end":{"line":503,"column":1}},"children":[{"type":"text","value":"Here is a look at the matrix we called ","position":{"start":{"line":503,"column":1},"end":{"line":503,"column":1}},"key":"DagmRxmUDo"},{"type":"inlineMath","value":"\\mathbf{L}","position":{"start":{"line":503,"column":1},"end":{"line":503,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi mathvariant=\"bold\">L</mi></mrow><annotation encoding=\"application/x-tex\">\\mathbf{L}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6861em;\"></span><span class=\"mord mathbf\">L</span></span></span></span>","key":"HC1FZ9RylM"},{"type":"text","value":" (the discrete Laplacian), before any modifications are made for the boundary conditions. The combination of Kronecker products and finite differences produces a characteristic sparsity pattern.","position":{"start":{"line":503,"column":1},"end":{"line":503,"column":1}},"key":"JfbW0w0BB3"}],"key":"mFtuhfFQAE"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"import scipy.sparse as sp\nDxx = sp.lil_matrix(Dxx)\nDyy = sp.lil_matrix(Dyy)\nIx = sp.eye(m+1)\nIy = sp.eye(n+1)\nA = sp.kron(Iy, Dxx) + sp.kron(Dyy, Ix)\n\nspy(A)\ntitle(\"Matrix before imposing BC\");","key":"Gkuzdkw0ST"},{"type":"output","id":"gPBEMruickz5zSn9i0pVW","data":[{"output_type":"display_data","metadata":{},"data":{"text/plain":{"content":"<Figure size 700x400 with 1 Axes>","content_type":"text/plain"},"image/png":{"content_type":"image/png","hash":"34a9a363a4089f740f57969fc85aa17c","path":"/build/34a9a363a4089f740f57969fc85aa17c.png"}}}],"key":"EcXwjMI6Rj"}],"key":"llSJZE321z"},{"type":"paragraph","position":{"start":{"line":517,"column":1},"end":{"line":517,"column":1}},"children":[{"type":"text","value":"The number of equations is equal to ","position":{"start":{"line":517,"column":1},"end":{"line":517,"column":1}},"key":"Gl5SvjCuJi"},{"type":"inlineMath","value":"(m+1)(n+1)","position":{"start":{"line":517,"column":1},"end":{"line":517,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mo stretchy=\"false\">(</mo><mi>m</mi><mo>+</mo><mn>1</mn><mo stretchy=\"false\">)</mo><mo stretchy=\"false\">(</mo><mi>n</mi><mo>+</mo><mn>1</mn><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">(m+1)(n+1)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">m</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord\">1</span><span class=\"mclose\">)</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">n</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord\">1</span><span class=\"mclose\">)</span></span></span></span>","key":"URaFslPBVB"},{"type":"text","value":", which is the total number of points on the grid.","position":{"start":{"line":517,"column":1},"end":{"line":517,"column":1}},"key":"GueXy5OAUE"}],"key":"KwQVaaSC3L"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"N = (m+1) * (n+1)","key":"E7aT2OS2Yc"},{"type":"output","id":"vf2UhGDay7oypdnGSBN0V","data":[],"key":"yD8apcTRSk"}],"key":"t8MNhCSJRq"},{"type":"paragraph","position":{"start":{"line":523,"column":1},"end":{"line":523,"column":1}},"children":[{"type":"text","value":"We now use the final output from ","position":{"start":{"line":523,"column":1},"end":{"line":523,"column":1}},"key":"ykVG6MgQos"},{"type":"crossReference","identifier":"function-tensorgrid","label":"function-tensorgrid","kind":"proof:algorithm","position":{"start":{"line":523,"column":34},"end":{"line":523,"column":54}},"children":[{"type":"text","value":"Algorithm ","key":"nzD8S2IVMx"},{"type":"text","value":"13.2.1","key":"P8Aj5WoMko"}],"template":"Algorithm %s","enumerator":"13.2.1","resolved":true,"html_id":"function-tensorgrid","remote":true,"url":"/diffadv","dataUrl":"/diffadv.json","key":"jihbEOpJ5V"},{"type":"text","value":", which is a Boolean array indicating where the boundary points lie in the grid.","position":{"start":{"line":523,"column":1},"end":{"line":523,"column":1}},"key":"sakB9bopRf"}],"key":"wb3fHfRrvg"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"spy(is_boundary)\ntitle(\"Boundary points\");","key":"m4QIotnAcz"},{"type":"output","id":"sYiyZK_T0QbFbS8Lprk6V","data":[{"output_type":"display_data","metadata":{},"data":{"text/plain":{"content":"<Figure size 700x400 with 1 Axes>","content_type":"text/plain"},"image/png":{"content_type":"image/png","hash":"e4d26ac0406f3da97f3132f51b3ecfe5","path":"/build/e4d26ac0406f3da97f3132f51b3ecfe5.png"}}}],"key":"HFmMh7jnGl"}],"key":"rvL1OK1xKT"},{"type":"paragraph","position":{"start":{"line":530,"column":1},"end":{"line":530,"column":1}},"children":[{"type":"text","value":"In order to impose Dirichlet boundary conditions, we use the boundary indicator to index into the rows of the system.","position":{"start":{"line":530,"column":1},"end":{"line":530,"column":1}},"key":"E5vSZp73OR"}],"key":"r5hj1yLgbj"},{"type":"admonition","kind":"tip","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"Tip","key":"ZMaYxWSjGT"}],"key":"pc2q7IaNrJ"},{"type":"paragraph","position":{"start":{"line":534,"column":1},"end":{"line":534,"column":1}},"children":[{"type":"text","value":"Changing rows of a sparse array requires that the operands be in a particular sparse representation called ","position":{"start":{"line":534,"column":1},"end":{"line":534,"column":1}},"key":"OPiBRZGrrM"},{"type":"inlineCode","value":"lil","position":{"start":{"line":534,"column":1},"end":{"line":534,"column":1}},"key":"HnZOecCogO"},{"type":"text","value":". The conversion isn’t done automatically because it can be slow and you are encouraged to avoid it when possible. We’re just trying to keep things conceptually simple here.","position":{"start":{"line":534,"column":1},"end":{"line":534,"column":1}},"key":"kg3LI2OC4P"}],"key":"FUyKim5tGo"}],"class":"dropdown","key":"dFK8jUIko8"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"I = sp.eye(N, format=\"lil\")\nidx = vec(is_boundary)\nA = A.tolil()\nA[idx, :] = I[idx, :];    # Dirichlet conditions\n\nspy(A)\ntitle(\"Matrix with Dirichlet BC imposed\");","key":"MtReIBXugI"},{"type":"output","id":"W8YEZb1EyaP1pnnCbmznm","data":[{"output_type":"display_data","metadata":{},"data":{"text/plain":{"content":"<Figure size 700x400 with 1 Axes>","content_type":"text/plain"},"image/png":{"content_type":"image/png","hash":"d0cad2f398240f67ee0c21e46710a909","path":"/build/d0cad2f398240f67ee0c21e46710a909.png"}}}],"key":"oMEFM2wOKA"}],"key":"zJAc12ycpR"},{"type":"paragraph","position":{"start":{"line":547,"column":1},"end":{"line":547,"column":1}},"children":[{"type":"text","value":"Next, we evaluate ","position":{"start":{"line":547,"column":1},"end":{"line":547,"column":1}},"key":"pBI9edXU9o"},{"type":"inlineMath","value":"\\phi","position":{"start":{"line":547,"column":1},"end":{"line":547,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>ϕ</mi></mrow><annotation encoding=\"application/x-tex\">\\phi</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8889em;vertical-align:-0.1944em;\"></span><span class=\"mord mathnormal\">ϕ</span></span></span></span>","key":"mo3DrNcdXN"},{"type":"text","value":" on the grid to get the forcing vector of the linear system, and then modify the boundary rows to hold the boundary values—in this case, zero.","position":{"start":{"line":547,"column":1},"end":{"line":547,"column":1}},"key":"nFnhxZ81lY"}],"key":"eYEuB96bN0"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"f = lambda x, y: x**2 - y + 2\nb = vec(mtx(f))\nb[idx] = 0","key":"snpZaNqIkM"},{"type":"output","id":"zCjhVpD6Zt6W2BZfQ1kFf","data":[],"key":"W4ZhDJxc0t"}],"key":"zZS2LMDkYj"},{"type":"paragraph","position":{"start":{"line":555,"column":1},"end":{"line":555,"column":1}},"children":[{"type":"text","value":"Now we can solve for ","position":{"start":{"line":555,"column":1},"end":{"line":555,"column":1}},"key":"dqhwZMIu8a"},{"type":"inlineMath","value":"\\mathbf{u}","position":{"start":{"line":555,"column":1},"end":{"line":555,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi mathvariant=\"bold\">u</mi></mrow><annotation encoding=\"application/x-tex\">\\mathbf{u}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4444em;\"></span><span class=\"mord mathbf\">u</span></span></span></span>","key":"vFiQM3rSPf"},{"type":"text","value":" and reinterpret it as the matrix-shaped ","position":{"start":{"line":555,"column":1},"end":{"line":555,"column":1}},"key":"q1vMhpNr3G"},{"type":"inlineMath","value":"\\mathbf{U}","position":{"start":{"line":555,"column":1},"end":{"line":555,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi mathvariant=\"bold\">U</mi></mrow><annotation encoding=\"application/x-tex\">\\mathbf{U}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6861em;\"></span><span class=\"mord mathbf\">U</span></span></span></span>","key":"Cawp1uAHLF"},{"type":"text","value":", the solution on our grid.","position":{"start":{"line":555,"column":1},"end":{"line":555,"column":1}},"key":"RW9iwBNmJB"}],"key":"GpO6em67VC"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"from scipy.sparse.linalg import spsolve\nu = spsolve(A.tocsr(), b)\nU = unvec(u)\nwith printoptions(precision=4, suppress=True):\n    print(U)","key":"wSlzdmpxtl"},{"type":"output","id":"MWg_UZAZNeESm6AThdPqs","data":[{"output_type":"stream","name":"stdout","text":"[[ 0.      0.      0.      0.      0.      0.      0.    ]\n [ 0.     -0.5512 -0.8252 -0.8791 -0.7476 -0.451   0.    ]\n [ 0.     -0.9109 -1.3939 -1.5092 -1.3003 -0.7928  0.    ]\n [ 0.     -1.1788 -1.7957 -1.9513 -1.7021 -1.0607  0.    ]\n [ 0.     -1.1409 -1.6859 -1.8182 -1.6083 -1.0407  0.    ]\n [ 0.      0.      0.      0.      0.      0.      0.    ]]\n"}],"key":"Oj7bZ3mS1o"}],"key":"Oq3GsEdZO8"}],"label":"demo-laplace-fd-python","identifier":"demo-laplace-fd-python","html_id":"demo-laplace-fd-python","key":"cVv1lWh3SS"},{"type":"details","open":true,"children":[{"type":"summary","children":[{"type":"crossReference","identifier":"demo-laplace-poisson","label":"demo-laplace-poisson","kind":"proof:example","position":{"start":{"line":567,"column":1},"end":{"line":567,"column":22}},"children":[{"type":"text","value":"Example ","key":"R6ymgfZHe0"},{"type":"text","value":"13.3.3","key":"zGM9iSu2Ow"}],"template":"Example %s","enumerator":"13.3.3","resolved":true,"html_id":"demo-laplace-poisson","remote":true,"url":"/laplace","dataUrl":"/laplace.json","key":"MZsG0h5ne0"}],"key":"v6H1IEGNXm"},{"type":"paragraph","position":{"start":{"line":570,"column":1},"end":{"line":570,"column":1}},"children":[{"type":"text","value":"First we define the problem on ","position":{"start":{"line":570,"column":1},"end":{"line":570,"column":1}},"key":"Tb0uxKUTE2"},{"type":"inlineMath","value":"[0,1]\\times[0,2]","position":{"start":{"line":570,"column":1},"end":{"line":570,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mo stretchy=\"false\">[</mo><mn>0</mn><mo separator=\"true\">,</mo><mn>1</mn><mo stretchy=\"false\">]</mo><mo>×</mo><mo stretchy=\"false\">[</mo><mn>0</mn><mo separator=\"true\">,</mo><mn>2</mn><mo stretchy=\"false\">]</mo></mrow><annotation encoding=\"application/x-tex\">[0,1]\\times[0,2]</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mopen\">[</span><span class=\"mord\">0</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord\">1</span><span class=\"mclose\">]</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">×</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mopen\">[</span><span class=\"mord\">0</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord\">2</span><span class=\"mclose\">]</span></span></span></span>","key":"Bl8uzUtEJA"},{"type":"text","value":".","position":{"start":{"line":570,"column":1},"end":{"line":570,"column":1}},"key":"XBAde9pafK"}],"key":"koiAJ8TCI4"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"f = lambda x, y: -sin(3 * x * y - 4 * y) * (9 * y**2 + (3 * x - 4) ** 2)\ng = lambda x, y: sin(3 * x * y - 4 * y)\nxspan = [0, 1]\nyspan = [0, 2]","key":"cddek46LGk"},{"type":"output","id":"d6RVaTr_2CNyfy2qCCEOA","data":[],"key":"fhylXMVrhg"}],"key":"Jmp5k9BZWO"},{"type":"paragraph","position":{"start":{"line":579,"column":1},"end":{"line":579,"column":1}},"children":[{"type":"text","value":"Here is the finite-difference solution.","position":{"start":{"line":579,"column":1},"end":{"line":579,"column":1}},"key":"m76kFVGQtD"}],"key":"qhRASQSwf6"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"U, X, Y = FNC.poissonfd(f, g, 50, xspan, 80, yspan)","key":"zdQr1jHZIE"},{"type":"output","id":"0ZKG740Um-C-NLgKe043G","data":[],"key":"XC9THyAbQW"}],"key":"nN7QOzWSi6"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"pcolormesh(X.T, Y.T, U.T, cmap=\"viridis\")\nxlabel(\"$x$\"),  ylabel(\"$y$\"),  axis(\"equal\")\ncolorbar(), title(\"Solution of Poisson's equation\");","visibility":"hide","key":"aKDAqU5lu5"},{"type":"output","id":"BZRexmnc5Q28M98oyERSh","data":[{"output_type":"display_data","metadata":{},"data":{"text/plain":{"content":"<Figure size 700x400 with 2 Axes>","content_type":"text/plain"},"image/png":{"content_type":"image/png","hash":"2fc7760661e14c55cd787bf16aea1205","path":"/build/2fc7760661e14c55cd787bf16aea1205.png"}}}],"visibility":"show","key":"iUrAWt7RQc"}],"data":{"tags":[]},"visibility":"show","key":"looIn9AnfS"},{"type":"paragraph","position":{"start":{"line":592,"column":1},"end":{"line":592,"column":1}},"children":[{"type":"text","value":"Since this is an artificial problem with a known solution, we can plot the error, which is a smooth function of ","position":{"start":{"line":592,"column":1},"end":{"line":592,"column":1}},"key":"aAV9qdclC2"},{"type":"inlineMath","value":"x","position":{"start":{"line":592,"column":1},"end":{"line":592,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>x</mi></mrow><annotation encoding=\"application/x-tex\">x</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">x</span></span></span></span>","key":"PSBe3ZtbuD"},{"type":"text","value":" and ","position":{"start":{"line":592,"column":1},"end":{"line":592,"column":1}},"key":"kncltG6y6t"},{"type":"inlineMath","value":"y","position":{"start":{"line":592,"column":1},"end":{"line":592,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>y</mi></mrow><annotation encoding=\"application/x-tex\">y</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.625em;vertical-align:-0.1944em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">y</span></span></span></span>","key":"NMDkopEnkG"},{"type":"text","value":". It must be zero on the boundary; otherwise, we have implemented boundary conditions incorrectly.","position":{"start":{"line":592,"column":1},"end":{"line":592,"column":1}},"key":"kESWXDYd9m"}],"key":"CCYZcQrNRK"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"error = g(X, Y) - U    # because we set up g as the exact solution\nM = max(abs(error))\n\npcolormesh(X.T, Y.T, error.T, vmin=-M, vmax=M, cmap=\"RdBu\")\nxlabel(\"$x$\"),  ylabel(\"$y$\"),  axis(\"equal\")\ncolorbar(),  title(\"Error\");","key":"gIFpTKOvNr"},{"type":"output","id":"A6biFLnGr_l-FT7U4HHk7","data":[{"output_type":"display_data","metadata":{},"data":{"text/plain":{"content":"<Figure size 700x400 with 2 Axes>","content_type":"text/plain"},"image/png":{"content_type":"image/png","hash":"f0ab8f520d51ae057d95b1574983d260","path":"/build/f0ab8f520d51ae057d95b1574983d260.png"}}}],"key":"qZZMMEMwHV"}],"key":"y4b6J7yXLO"}],"label":"demo-laplace-poisson-python","identifier":"demo-laplace-poisson-python","html_id":"demo-laplace-poisson-python","key":"zcXe2nLOMz"},{"type":"heading","depth":3,"position":{"start":{"line":604,"column":1},"end":{"line":604,"column":1}},"children":[{"type":"text","value":"13.4 ","position":{"start":{"line":604,"column":1},"end":{"line":604,"column":1}},"key":"PP1iVZ4cH1"},{"type":"link","identifier":"section-twodim-nonlinear","label":"section-twodim-nonlinear","kind":"narrative","position":{"start":{"line":604,"column":6},"end":{"line":604,"column":31}},"url":"/nonlinear-1","internal":true,"dataUrl":"/nonlinear-1.json","children":[{"type":"text","value":"Nonlinear elliptic PDEs","key":"fMMOmaE7mq"}],"key":"nnjJoefOQJ"}],"identifier":"id-13-4","label":"13.4 ","html_id":"id-13-4","implicit":true,"key":"MIZvSzsEOg"},{"type":"details","open":true,"children":[{"type":"summary","children":[{"type":"crossReference","identifier":"demo-nonlinear2d-mems","label":"demo-nonlinear2d-mems","kind":"proof:example","position":{"start":{"line":607,"column":1},"end":{"line":607,"column":23}},"children":[{"type":"text","value":"Example ","key":"IDpUBm7Mjp"},{"type":"text","value":"13.4.2","key":"KtkZYE11it"}],"template":"Example %s","enumerator":"13.4.2","resolved":true,"html_id":"demo-nonlinear2d-mems","remote":true,"url":"/nonlinear-1","dataUrl":"/nonlinear-1.json","key":"akUkQ1trko"}],"key":"oP7LH0kQxI"},{"type":"paragraph","position":{"start":{"line":609,"column":1},"end":{"line":609,"column":1}},"children":[{"type":"text","value":"All we need to define are ","position":{"start":{"line":609,"column":1},"end":{"line":609,"column":1}},"key":"DD8AkQtX08"},{"type":"inlineMath","value":"\\phi","position":{"start":{"line":609,"column":1},"end":{"line":609,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>ϕ</mi></mrow><annotation encoding=\"application/x-tex\">\\phi</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8889em;vertical-align:-0.1944em;\"></span><span class=\"mord mathnormal\">ϕ</span></span></span></span>","key":"QHXXWZumKx"},{"type":"text","value":" from ","position":{"start":{"line":609,"column":1},"end":{"line":609,"column":1}},"key":"c6CSOnpnQ9"},{"type":"crossReference","kind":"equation","identifier":"nonlinpdepde","label":"nonlinpdepde","children":[{"type":"text","value":"(","key":"WkgJrrKGPp"},{"type":"text","value":"13.4.2","key":"aAtMF2rkNO"},{"type":"text","value":")","key":"Z89cFfufgK"}],"template":"(%s)","enumerator":"13.4.2","resolved":true,"html_id":"nonlinpdepde","remote":true,"url":"/nonlinear-1","dataUrl":"/nonlinear-1.json","key":"mhgikqnKi9"},{"type":"text","value":" for the ","key":"S3WsKIRiOP"},{"type":"abbreviation","title":"partial differential equation","children":[{"type":"text","value":"PDE","key":"QQeIpElOcR"}],"key":"kdWuVyZw1V"},{"type":"text","value":", and a trivial zero function for the boundary condition.","key":"SMnWIViS7S"}],"key":"hRdGTOxYVs"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"lamb = 1.5\nphi = lambda x, y, u, ux, uxx, uy, uyy: uxx + uyy - lamb / (u + 1)**2\ng = lambda x, y: 0","key":"evCSDigE8h"},{"type":"output","id":"u-C_dBE73MQA6rrL1FcIQ","data":[],"key":"JHUDHWbGam"}],"key":"ONky6z1rDQ"},{"type":"paragraph","position":{"start":{"line":617,"column":1},"end":{"line":617,"column":1}},"children":[{"type":"text","value":"Here is the solution for ","position":{"start":{"line":617,"column":1},"end":{"line":617,"column":1}},"key":"pyUPuehCtF"},{"type":"inlineMath","value":"m=15","position":{"start":{"line":617,"column":1},"end":{"line":617,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>m</mi><mo>=</mo><mn>15</mn></mrow><annotation encoding=\"application/x-tex\">m=15</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">m</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">15</span></span></span></span>","key":"YVXv4YuuIz"},{"type":"text","value":", ","position":{"start":{"line":617,"column":1},"end":{"line":617,"column":1}},"key":"sEVboLFl7W"},{"type":"inlineMath","value":"n=8","position":{"start":{"line":617,"column":1},"end":{"line":617,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>n</mi><mo>=</mo><mn>8</mn></mrow><annotation encoding=\"application/x-tex\">n=8</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">n</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">8</span></span></span></span>","key":"fCJHDD5P5o"},{"type":"text","value":".","position":{"start":{"line":617,"column":1},"end":{"line":617,"column":1}},"key":"SC6GGwexz5"}],"key":"jipcPptTju"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"u = FNC.elliptic(phi, g, 15, [0, 2.5], 8, [0, 1])\n\nprint(f\"solution at (2, 0.6) is {u(2, 0.6):.7f}\")","key":"v9b1FwmcMB"},{"type":"output","id":"zoxA27Ain3n9RYSwJVYbV","data":[{"output_type":"stream","name":"stdout","text":"solution at (2, 0.6) is -0.2264594\n"}],"key":"A9vTrnliap"}],"key":"YjGo4dkbwP"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"x = linspace(0, 2.5, 90)\ny = linspace(0, 1, 60)\nmtx, X, Y, _, _, _ = FNC.tensorgrid(x, y)\nU = mtx(u)\n\npcolormesh(X.T, Y.T, U.T, cmap=\"viridis\")\nxlabel(\"$x$\"),  ylabel(\"$y$\"),  axis(\"equal\")\ncolorbar()\ntitle(\"Solution of the MEMS equation in 2d\");","visibility":"hide","key":"dVC4KPUOW6"},{"type":"output","id":"FiSFaq1Z2cRo964G9HuQW","data":[{"output_type":"display_data","metadata":{},"data":{"text/plain":{"content":"<Figure size 700x400 with 2 Axes>","content_type":"text/plain"},"image/png":{"content_type":"image/png","hash":"5feace83e5bd9d5f78b5ef631de8544b","path":"/build/5feace83e5bd9d5f78b5ef631de8544b.png"}}}],"visibility":"show","key":"JKhLE7DcqC"}],"data":{"tags":[]},"visibility":"show","key":"mObC0VzQAM"},{"type":"paragraph","position":{"start":{"line":638,"column":1},"end":{"line":638,"column":1}},"children":[{"type":"text","value":"In the absence of an exact solution, how can we be confident that the solution is accurate? First, the Levenberg iteration converged without issuing a warning, so we should feel confident that the discrete equations were solved. We can check the boundary values easily. For example,","position":{"start":{"line":638,"column":1},"end":{"line":638,"column":1}},"key":"AoBJ5QMfNA"}],"key":"s0DhakDUrt"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"err = norm(u(x, 0) - g(x, 0), inf)\nprint(f\"max error on bottom edge: {err:.2e}\")","key":"gFI3KbU1DF"},{"type":"output","id":"24BAqUybNRGlUVuKyju6w","data":[{"output_type":"stream","name":"stdout","text":"max error on bottom edge: 9.56e-23\n"}],"key":"VwZjC1zU7I"}],"key":"xwy2cpYfqI"},{"type":"paragraph","position":{"start":{"line":645,"column":1},"end":{"line":645,"column":1}},"children":[{"type":"text","value":"Assuming that we encoded the ","key":"zkpeztB7nI"},{"type":"abbreviation","title":"partial differential equation","children":[{"type":"text","value":"PDE","key":"yVxKfTpTga"}],"key":"l7y6vQp9K5"},{"type":"text","value":" correctly, the remaining source error is truncation from the discretization. We can estimate that by refining the grid a bit and seeing how much the numerical solution changes.","key":"oeaLa78jFT"}],"key":"jp4jDwcirA"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"x_test = linspace(0, 2.5, 6)\ny_test = linspace(0, 1, 6)\nmtx_test, X_test, Y_test, _, _, _ = FNC.tensorgrid(x_test, y_test)\n\nwith printoptions(precision=7, suppress=True):\n    print(mtx_test(u))","key":"EMZw96VIqU"},{"type":"output","id":"deTO6jxoQLqk8taD0CX8v","data":[{"output_type":"stream","name":"stdout","text":"[[ 0.         0.         0.         0.         0.         0.       ]\n [ 0.        -0.1479641 -0.2264594 -0.2264594 -0.1479641  0.       ]\n [ 0.        -0.1958612 -0.3059492 -0.3059492 -0.1958612  0.       ]\n [ 0.        -0.1958612 -0.3059492 -0.3059492 -0.1958612  0.       ]\n [ 0.        -0.1479641 -0.2264594 -0.2264594 -0.1479641  0.       ]\n [-0.         0.         0.         0.         0.         0.       ]]\n"}],"key":"LuDJG6Otgf"}],"key":"ZawlEiahs0"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"u = FNC.elliptic(phi, g, 25, [0, 2.5], 14, [0, 1])\nwith printoptions(precision=7, suppress=True):\n    print(mtx_test(u))","key":"WhUFPC0VCt"},{"type":"output","id":"lt4BLQYyxC0e2GCJWivZO","data":[{"output_type":"stream","name":"stdout","text":"[[ 0.        -0.        -0.        -0.         0.         0.       ]\n [-0.        -0.1479584 -0.226453  -0.226453  -0.1479584  0.       ]\n [ 0.        -0.195861  -0.3059293 -0.3059293 -0.195861   0.       ]\n [-0.        -0.195861  -0.3059293 -0.3059293 -0.195861  -0.       ]\n [-0.        -0.1479584 -0.226453  -0.226453  -0.1479584 -0.       ]\n [-0.        -0.        -0.         0.        -0.         0.       ]]\n"}],"key":"wREq0y5Cs6"}],"key":"nxCgvPOaLI"},{"type":"paragraph","position":{"start":{"line":662,"column":1},"end":{"line":662,"column":1}},"children":[{"type":"text","value":"The original solution seems to be accurate to about four digits.","position":{"start":{"line":662,"column":1},"end":{"line":662,"column":1}},"key":"KlfQ3VruGX"}],"key":"XL1X6rmcLu"}],"label":"demo-nonlinear2d-mems-python","identifier":"demo-nonlinear2d-mems-python","html_id":"demo-nonlinear2d-mems-python","key":"mmZ3ojaFR8"},{"type":"details","open":true,"children":[{"type":"summary","children":[{"type":"crossReference","identifier":"demo-nonlinear-advdiff","label":"demo-nonlinear-advdiff","kind":"proof:example","position":{"start":{"line":667,"column":1},"end":{"line":667,"column":24}},"children":[{"type":"text","value":"Example ","key":"L0lGPwJk82"},{"type":"text","value":"13.4.3","key":"K73UcbR2QJ"}],"template":"Example %s","enumerator":"13.4.3","resolved":true,"html_id":"demo-nonlinear-advdiff","remote":true,"url":"/nonlinear-1","dataUrl":"/nonlinear-1.json","key":"suQ3vpvfzU"}],"key":"MJL33wuhYL"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"phi = lambda x, y, u, ux, uxx, uy, uyy: 1 - ux - 2*uy + 0.05 * (uxx + uyy)\ng = lambda x, y: 0\nu = FNC.elliptic(phi, g, 32, [-1, 1], 32, [-1, 1])","key":"JkH6RXYNbD"},{"type":"output","id":"PgafEmq7xH07TLdUo6mO7","data":[],"key":"RopJx0Ufvx"}],"key":"KZ9dvnI3UT"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"x = y = linspace(-1, 1, 70)\nmtx, X, Y, _, _, _ = FNC.tensorgrid(x, y)\nU = mtx(u)\n\npcolormesh(X.T, Y.T, U.T, cmap=\"viridis\")\nxlabel(\"$x$\"),  ylabel(\"$y$\"),  axis(\"equal\")\ncolorbar()\ntitle(\"Steady advection–diffusion\");","key":"fj9HQ0sjq7"},{"type":"output","id":"hViXijVWGCVLOYO_oUR4N","data":[{"output_type":"display_data","metadata":{},"data":{"text/plain":{"content":"<Figure size 700x400 with 2 Axes>","content_type":"text/plain"},"image/png":{"content_type":"image/png","hash":"21494393f3613e9650534039b27e1db5","path":"/build/21494393f3613e9650534039b27e1db5.png"}}}],"key":"v57Dk7tfTV"}],"key":"dspmDZdbbo"}],"label":"demo-nonlinear-advdiff-python","identifier":"demo-nonlinear-advdiff-python","html_id":"demo-nonlinear-advdiff-python","key":"IK7tLu7ihM"},{"type":"details","open":true,"children":[{"type":"summary","children":[{"type":"crossReference","identifier":"demo-nonlinear2d-allencahn","label":"demo-nonlinear2d-allencahn","kind":"proof:example","position":{"start":{"line":690,"column":1},"end":{"line":690,"column":28}},"children":[{"type":"text","value":"Example ","key":"kwzUD6ODLe"},{"type":"text","value":"13.4.4","key":"xEwAcH8BzJ"}],"template":"Example %s","enumerator":"13.4.4","resolved":true,"html_id":"demo-nonlinear2d-allencahn","remote":true,"url":"/nonlinear-1","dataUrl":"/nonlinear-1.json","key":"SjajhODxtd"}],"key":"y6DnFlyTow"},{"type":"paragraph","position":{"start":{"line":693,"column":1},"end":{"line":693,"column":1}},"children":[{"type":"text","value":"The following defines the ","key":"redYyTlTTA"},{"type":"abbreviation","title":"partial differential equation","children":[{"type":"text","value":"PDE","key":"wT9beSxXZ9"}],"key":"WaJtpLrRQD"},{"type":"text","value":" and a nontrivial Dirichlet boundary condition for the square ","key":"DOfQN6pAMi"},{"type":"inlineMath","value":"[0,1]^2","position":{"start":{"line":693,"column":1},"end":{"line":693,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mo stretchy=\"false\">[</mo><mn>0</mn><mo separator=\"true\">,</mo><mn>1</mn><msup><mo stretchy=\"false\">]</mo><mn>2</mn></msup></mrow><annotation encoding=\"application/x-tex\">[0,1]^2</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1.0641em;vertical-align:-0.25em;\"></span><span class=\"mopen\">[</span><span class=\"mord\">0</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord\">1</span><span class=\"mclose\"><span class=\"mclose\">]</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span></span></span></span></span></span></span></span>","key":"CIbA6YVbLA"},{"type":"text","value":".","position":{"start":{"line":693,"column":1},"end":{"line":693,"column":1}},"key":"rpfPYIeKWr"}],"key":"cnlP30iWnl"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"phi = lambda x, y, u, ux, uxx, uy, uyy: u * (1 - u**2) + 0.05 * (uxx + uyy)\ng = lambda x, y: tanh(5 * (x + 2*y - 1))","key":"yUleV27tme"},{"type":"output","id":"_zGE_2TT5JP5iQvxH9oYZ","data":[],"key":"WLWbU9w5lt"}],"key":"APW1KDXcPW"},{"type":"paragraph","position":{"start":{"line":700,"column":1},"end":{"line":700,"column":1}},"children":[{"type":"text","value":"We solve the ","key":"vZcWGy7P22"},{"type":"abbreviation","title":"partial differential equation","children":[{"type":"text","value":"PDE","key":"rhQgJBxeoS"}],"key":"DoVNDqTW1C"},{"type":"text","value":" and then plot the result.","key":"XRCPuOHa6L"}],"key":"sUT2krT6SB"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"u = FNC.elliptic(phi, g, 36, [0, 1], 36, [0, 1])","key":"yBV1gsZ4RF"},{"type":"output","id":"chNb0qUd-RFeNCYASgoiF","data":[],"key":"HkFiGFE2dR"}],"key":"X4I5QeXHL0"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"x = y = linspace(0, 1, 70)\nmtx, X, Y, _, _, _ = FNC.tensorgrid(x, y)\nU = mtx(u)\npcolormesh(X.T, Y.T, U.T, cmap=\"viridis\")\nxlabel(\"$x$\"),  ylabel(\"$y$\"),  axis(\"equal\")\ncolorbar(),  title(\"Steady Allen–Cahn equation\");","visibility":"hide","key":"I5KikLE0oe"},{"type":"output","id":"9-3SuvLr9Wzp-ptgj7zOW","data":[{"output_type":"display_data","metadata":{},"data":{"text/plain":{"content":"<Figure size 700x400 with 2 Axes>","content_type":"text/plain"},"image/png":{"content_type":"image/png","hash":"bafe0e3bc72201353b12a3ed08e01449","path":"/build/bafe0e3bc72201353b12a3ed08e01449.png"}}}],"visibility":"show","key":"STo8QE8wWd"}],"data":{"tags":[]},"visibility":"show","key":"PzlVb7CPwF"}],"label":"demo-nonlinear2d-allencahn-python","identifier":"demo-nonlinear2d-allencahn-python","html_id":"demo-nonlinear2d-allencahn-python","key":"vNPrFxK4hn"}],"key":"OhYw1Gdxas"}],"key":"juU4fMzJhk"},"references":{"cite":{"order":[],"data":{}}},"footer":{"navigation":{"prev":{"title":"Chapter 12","url":"/chapter12-2","group":"Python codes"},"next":{"title":"Glossary","url":"/glossary","group":"Python codes"}}},"domain":"http://localhost:3000"}