{"kind":"Notebook","sha256":"4ef3316059b58ccd63580ce8ef0b7a9e501e1b65e1d315fc733980760bcd0b3a","slug":"converge-27","location":"/chapter6/section4/python/converge.ipynb","dependencies":[],"frontmatter":{"numbering":{"heading_1":{"enabled":false},"heading_2":{"enabled":false},"heading_3":{"enabled":false},"heading_4":{"enabled":false},"heading_5":{"enabled":false},"heading_6":{"enabled":false}},"kernelspec":{"name":"python3","display_name":"Python 3","language":"python"},"authors":[{"nameParsed":{"literal":"Tobin A. Driscoll","given":"Tobin A.","family":"Driscoll"},"name":"Tobin A. Driscoll","email":"driscoll@udel.edu","id":"contributors-myst-generated-uid-0","corresponding":true},{"nameParsed":{"literal":"Richard J. Braun","given":"Richard J.","family":"Braun"},"name":"Richard J. Braun","id":"contributors-myst-generated-uid-1"}],"github":"https://github.com/fncbook/fnc","math":{"\\float":{"macro":"\\mathbb{F}"},"\\real":{"macro":"\\mathbb{R}"},"\\complex":{"macro":"\\mathbb{C}"},"\\nat":{"macro":"\\mathbb{N}"},"\\integer":{"macro":"\\mathbb{Z}"},"\\rmn":{"macro":"\\mathbb{R}^{#1 \\times #2}"},"\\dd":{"macro":"\\frac{d #1}{d #2}"},"\\ddd":{"macro":"\\frac{d^2 #1}{d #2^2}"},"\\pp":{"macro":"\\frac{\\partial #1}{\\partial #2}"},"\\ppp":{"macro":"\\frac{\\partial^2 #1}{\\partial #2^2}"},"\\ppdd":{"macro":"\\frac{\\partial^2 #1}{\\partial #2 \\partial #3}"},"\\abs":{"macro":"\\left\\lvert #1 \\right\\rvert"},"\\norm":{"macro":"\\left\\lVert #1 \\right\\rVert"},"\\twonorm":{"macro":"\\norm{#1}_2"},"\\onenorm":{"macro":"\\norm{#1}_1"},"\\infnorm":{"macro":"\\norm{#1}_\\infty"},"\\anynorm":{"macro":"\\norm{#1}_#2"},"\\innerprod":{"macro":"\\langle #1,#2 \\rangle"},"\\pr":{"macro":"^{(#1)}"},"\\kron":{"macro":"#1 \\otimes #2"},"\\eye":{"macro":"\\mathbf{e}_#1"},"\\meye":{"macro":"\\mathbf{I}"},"\\Qhat":{"macro":"\\hat{\\mathbf{Q}}"},"\\Rhat":{"macro":"\\hat{\\mathbf{R}}"},"\\bfalpha":{"macro":"\\mathbf{alpha}"},"\\bfdelta":{"macro":"\\mathbf{delta}"},"\\bfzero":{"macro":"\\boldsymbol{0}"},"\\macheps":{"macro":"\\epsilon_\\text{mach}"},"\\fl":{"macro":"\\operatorname{fl}"},"\\diag":{"macro":"\\operatorname{diag}"},"\\ign":{"macro":"\\operatorname{sign}"},"\\Re":{"macro":"\\operatorname{Re}"},"\\Im":{"macro":"\\operatorname{Im}"},"\\ee":{"macro":"\\times 10^"},"\\lnorm":{"macro":"\\|"},"\\rnorm":{"macro":"\\|"},"\\floor":{"macro":"\\lfloor#1\\rfloor"},"\\cI":{"macro":"\\mathcal{I}"},"\\mtx":{"macro":"\\operatorname{mtx}"},"\\myvec":{"macro":"\\operatorname{vec}"},"\\argmin":{"macro":"\\operatorname{argmin}"}},"abbreviations":{"IVP":"initial-value problem","BVP":"boundary-value problem","ONC":"matrix with orthonormal columns","SVD":"singular value decomposition","EVD":"eigenvalue decomposition","SPD":"symmetric positive definite","HPD":"hermitian positive definite","PDE":"partial differential equation","ODE":"ordinary differential equation"},"exports":[{"format":"ipynb","filename":"converge.ipynb","url":"/fnc/build/converge-790258611ce248b6e7e5a267899b42ec.ipynb"}]},"widgets":{},"mdast":{"type":"root","children":[{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2025-01-11T16:37:26.790640Z","iopub.status.busy":"2025-01-11T16:37:26.790520Z","iopub.status.idle":"2025-01-11T16:37:27.131666Z","shell.execute_reply":"2025-01-11T16:37:27.131399Z"},"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"exec(open(\"../../../python/FNC_init.py\").read())","visibility":"show","key":"dimulEuwJG"},{"type":"output","id":"TWzlej3K8ZCeWRNCrra40","data":[],"visibility":"show","key":"u7mvCZf1JJ"}],"visibility":"remove","key":"qqJ0ZSYlLw"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"crossReference","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"strong","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Demo ","key":"ccfHE7btYy"},{"type":"text","value":"6.4.1","key":"OTEvZ5029F"}],"key":"iDTVX7K71h"}],"identifier":"demo-rk-converge","label":"demo-rk-converge","kind":"proof:example","template":"Example %s","enumerator":"6.4.1","resolved":true,"html_id":"demo-rk-converge","remote":true,"url":"/rk","dataUrl":"/rk.json","key":"KoUDKGYpaR"}],"key":"uuaHBMymgV"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"We solve the ","key":"dMPlz5VfS5"},{"type":"abbreviation","title":"initial-value problem","children":[{"type":"text","value":"IVP","key":"l0nY4MyvER"}],"key":"k6aWkYKoIg"},{"type":"text","value":" ","key":"cR4p2orb9B"},{"type":"inlineMath","value":"u'=\\sin[(u+t)^2]","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msup><mi>u</mi><mo mathvariant=\"normal\" lspace=\"0em\" rspace=\"0em\">′</mo></msup><mo>=</mo><mi>sin</mi><mo>⁡</mo><mo stretchy=\"false\">[</mo><mo stretchy=\"false\">(</mo><mi>u</mi><mo>+</mo><mi>t</mi><msup><mo stretchy=\"false\">)</mo><mn>2</mn></msup><mo stretchy=\"false\">]</mo></mrow><annotation encoding=\"application/x-tex\">u&#x27;=\\sin[(u+t)^2]</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.7519em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">u</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.7519em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">′</span></span></span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mop\">sin</span><span class=\"mopen\">[(</span><span class=\"mord mathnormal\">u</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1.0641em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\">t</span><span class=\"mclose\"><span class=\"mclose\">)</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span></span></span></span></span><span class=\"mclose\">]</span></span></span></span>","key":"xXgqB435ER"},{"type":"text","value":" over ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"rVCND8yx6h"},{"type":"inlineMath","value":"0\\le t \\le 4","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>0</mn><mo>≤</mo><mi>t</mi><mo>≤</mo><mn>4</mn></mrow><annotation encoding=\"application/x-tex\">0\\le t \\le 4</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.7804em;vertical-align:-0.136em;\"></span><span class=\"mord\">0</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.7719em;vertical-align:-0.136em;\"></span><span class=\"mord mathnormal\">t</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">4</span></span></span></span>","key":"PMSFf9z8FD"},{"type":"text","value":", with ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"DJLk5O6wOy"},{"type":"inlineMath","value":"u(0)=-1","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>u</mi><mo stretchy=\"false\">(</mo><mn>0</mn><mo stretchy=\"false\">)</mo><mo>=</mo><mo>−</mo><mn>1</mn></mrow><annotation encoding=\"application/x-tex\">u(0)=-1</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\">u</span><span class=\"mopen\">(</span><span class=\"mord\">0</span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.7278em;vertical-align:-0.0833em;\"></span><span class=\"mord\">−</span><span class=\"mord\">1</span></span></span></span>","key":"GgHkXtxZmD"},{"type":"text","value":". We start by getting a reference solution to validate against.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"yERaBIlQLt"}],"key":"jEVEZFm2vV"}],"key":"cpSFe7bMBV"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2025-01-11T16:37:27.133124Z","iopub.status.busy":"2025-01-11T16:37:27.132984Z","iopub.status.idle":"2025-01-11T16:37:27.149419Z","shell.execute_reply":"2025-01-11T16:37:27.149172Z"}},"children":[{"type":"code","lang":"python","executable":true,"value":"from scipy.integrate import solve_ivp\ndu_dt = lambda t, u: sin((t + u)**2)\ntspan = (0.0, 4.0)\nu0 = -1.0\nsol = solve_ivp(du_dt, tspan, [u0], dense_output=True, atol=1e-13, rtol=1e-13)\nu_ref = sol.sol","key":"CjktbkKev7"},{"type":"output","id":"kcPwewDnB2djGlebeKxtI","data":[],"key":"DeLdw2FRt4"}],"key":"wE0CnG0TIz"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Now we perform a convergence study of our two Runge–Kutta implementations.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"Vht7MowQ3D"}],"key":"Xux57rrEMS"}],"key":"zD4oSOMsiu"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2025-01-11T16:37:27.150795Z","iopub.status.busy":"2025-01-11T16:37:27.150700Z","iopub.status.idle":"2025-01-11T16:37:27.198678Z","shell.execute_reply":"2025-01-11T16:37:27.198413Z"}},"children":[{"type":"code","lang":"python","executable":true,"value":"n = array([int(2 * 10**k) for k in linspace(0, 3, 7)])\nerr = {\"IE2\" : [], \"RK4\" : []}\nresults = PrettyTable([\"n\", \"IE2 error\", \"RK4 error\"])\nfor k in range(len(n)):\n    t, u = FNC.ie2(du_dt, tspan, u0, n[k])\n    err[\"IE2\"].append( abs(u_ref(4)[0] - u[0][-1]) )\n    t, u = FNC.rk4(du_dt, tspan, u0, n[k])\n    err[\"RK4\"].append( abs(u_ref(4)[0] - u[0][-1]) )\n    results.add_row([n[k], err[\"IE2\"][-1], err[\"RK4\"][-1]])\n\nprint(results)","key":"hgvpOXXzJy"},{"type":"output","id":"G2imtzvFWyDxMjfiFomLe","data":[{"name":"stdout","output_type":"stream","text":"+------+------------------------+------------------------+\n|  n   |       IE2 error        |       RK4 error        |\n+------+------------------------+------------------------+\n|  2   |   1.7690264118810441   |   0.8206513302232612   |\n|  6   |   0.5126838225133257   |   0.7919245473433536   |\n|  20  |  0.002966971266360252  | 4.0177650143746746e-05 |\n|  63  | 0.00021416270501584123 | 3.581705267929891e-07  |\n| 200  | 1.951309601522233e-05  | 3.326041442264227e-09  |\n| 632  | 1.9058382192405077e-06 | 3.2657876403163755e-11 |\n| 2000 | 1.8883901087285437e-07 | 2.6711965972481266e-13 |\n+------+------------------------+------------------------+\n"}],"key":"auoXPJPlNF"}],"key":"l5sUDXgwfr"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"The amount of computational work at each time step is assumed to be proportional to the number of stages. Let’s compare on an apples-to-apples basis by using the number of ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"lvlzL7FuRF"},{"type":"inlineMath","value":"f","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>f</mi></mrow><annotation encoding=\"application/x-tex\">f</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8889em;vertical-align:-0.1944em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.10764em;\">f</span></span></span></span>","key":"cdNhwEmn61"},{"type":"text","value":"-evaluations on the horizontal axis.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"J69J5TxdKC"}],"key":"RADeBM26F6"}],"key":"tkBiEehWIe"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2025-01-11T16:37:27.199984Z","iopub.status.busy":"2025-01-11T16:37:27.199893Z","iopub.status.idle":"2025-01-11T16:37:27.437750Z","shell.execute_reply":"2025-01-11T16:37:27.437464Z"}},"children":[{"type":"code","lang":"python","executable":true,"value":"loglog(2 * n, err[\"IE2\"], \"-o\", label=\"IE2\")\nloglog(4 * n, err[\"RK4\"], \"-o\", label=\"RK4\")\nplot(2 * n, 0.5 * err[\"IE2\"][-1] * (n / n[-1])**(-2), \"--\", label=\"2nd order\")\nplot(4 * n, 0.5 * err[\"RK4\"][-1] * (n / n[-1])**(-4), \"--\", label=\"4th order\")\n\nxlabel(\"f-evaluations\"),  ylabel(\"inf-norm error\")\nlegend()\ntitle(\"Convergence of RK methods\");","key":"ETAC4th1u7"},{"type":"output","id":"T0WyJ5K2jBh5I6VbK_eI0","data":[{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"cd6cb29a14523b483894d43b7161d2d8","path":"/fnc/build/cd6cb29a14523b483894d43b7161d2d8.png"},"text/plain":{"content":"<Figure size 700x400 with 1 Axes>","content_type":"text/plain"}}}],"key":"BqFDcYJqFz"}],"key":"H8EyCAy4qM"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"The fourth-order variant is more efficient in this problem over a wide range of accuracy.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"dQOBrc3WSO"}],"key":"PjO89RXKrm"}],"key":"L2js4ugikN"}],"key":"sQAG4s49xh"},"references":{"cite":{"order":[],"data":{}}},"footer":{"navigation":{"prev":{"title":"Coupledpendula","url":"/coupledpendula-2","group":"Chapter 6"},"next":{"title":"Basic","url":"/basic-2","group":"Chapter 6"}}},"domain":"http://localhost:3000"}