{"kind":"Notebook","sha256":"c59c79a15c9fd2cee12067ed7534c82ff94317ded96d6c35ad3f1a32bc38a079","slug":"heat-5","location":"/chapter13/section2/python/heat.ipynb","dependencies":[],"frontmatter":{"numbering":{"heading_1":{"enabled":false},"heading_2":{"enabled":false},"heading_3":{"enabled":false},"heading_4":{"enabled":false},"heading_5":{"enabled":false},"heading_6":{"enabled":false}},"kernelspec":{"name":"python3","display_name":"myst","language":"python"},"authors":[{"nameParsed":{"literal":"Tobin A. Driscoll","given":"Tobin A.","family":"Driscoll"},"name":"Tobin A. Driscoll","email":"driscoll@udel.edu","id":"contributors-myst-generated-uid-0","corresponding":true},{"nameParsed":{"literal":"Richard J. Braun","given":"Richard J.","family":"Braun"},"name":"Richard J. Braun","id":"contributors-myst-generated-uid-1"}],"github":"https://github.com/fncbook/fnc","math":{"\\float":{"macro":"\\mathbb{F}"},"\\real":{"macro":"\\mathbb{R}"},"\\complex":{"macro":"\\mathbb{C}"},"\\nat":{"macro":"\\mathbb{N}"},"\\integer":{"macro":"\\mathbb{Z}"},"\\rmn":{"macro":"\\mathbb{R}^{#1 \\times #2}"},"\\dd":{"macro":"\\frac{d #1}{d #2}"},"\\ddd":{"macro":"\\frac{d^2 #1}{d #2^2}"},"\\pp":{"macro":"\\frac{\\partial #1}{\\partial #2}"},"\\ppp":{"macro":"\\frac{\\partial^2 #1}{\\partial #2^2}"},"\\ppdd":{"macro":"\\frac{\\partial^2 #1}{\\partial #2 \\partial #3}"},"\\abs":{"macro":"\\left\\lvert #1 \\right\\rvert"},"\\norm":{"macro":"\\left\\lVert #1 \\right\\rVert"},"\\twonorm":{"macro":"\\norm{#1}_2"},"\\onenorm":{"macro":"\\norm{#1}_1"},"\\infnorm":{"macro":"\\norm{#1}_\\infty"},"\\anynorm":{"macro":"\\norm{#1}_#2"},"\\innerprod":{"macro":"\\langle #1,#2 \\rangle"},"\\pr":{"macro":"^{(#1)}"},"\\kron":{"macro":"#1 \\otimes #2"},"\\eye":{"macro":"\\mathbf{e}_#1"},"\\meye":{"macro":"\\mathbf{I}"},"\\Qhat":{"macro":"\\hat{\\mathbf{Q}}"},"\\Rhat":{"macro":"\\hat{\\mathbf{R}}"},"\\bfalpha":{"macro":"\\mathbf{alpha}"},"\\bfdelta":{"macro":"\\mathbf{delta}"},"\\bfzero":{"macro":"\\boldsymbol{0}"},"\\macheps":{"macro":"\\epsilon_\\text{mach}"},"\\fl":{"macro":"\\operatorname{fl}"},"\\diag":{"macro":"\\operatorname{diag}"},"\\ign":{"macro":"\\operatorname{sign}"},"\\Re":{"macro":"\\operatorname{Re}"},"\\Im":{"macro":"\\operatorname{Im}"},"\\ee":{"macro":"\\times 10^"},"\\lnorm":{"macro":"\\|"},"\\rnorm":{"macro":"\\|"},"\\floor":{"macro":"\\lfloor#1\\rfloor"},"\\cI":{"macro":"\\mathcal{I}"},"\\mtx":{"macro":"\\operatorname{mtx}"},"\\myvec":{"macro":"\\operatorname{vec}"},"\\argmin":{"macro":"\\operatorname{argmin}"}},"abbreviations":{"IVP":"initial-value problem","BVP":"boundary-value problem","ONC":"matrix with orthonormal columns","SVD":"singular value decomposition","EVD":"eigenvalue decomposition","SPD":"symmetric positive definite","HPD":"hermitian positive definite","PDE":"partial differential equation","ODE":"ordinary differential equation"},"exports":[{"format":"ipynb","filename":"heat.ipynb","url":"/fnc/build/heat-7ffbfe7c0bf12c64c1145fdcd3410b9a.ipynb"}]},"widgets":{},"mdast":{"type":"root","children":[{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2025-01-09T20:31:27.870854Z","iopub.status.busy":"2025-01-09T20:31:27.870758Z","iopub.status.idle":"2025-01-09T20:31:28.356853Z","shell.execute_reply":"2025-01-09T20:31:28.356558Z"},"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"exec(open(\"../../../python/FNC_init.py\").read())","visibility":"show","key":"tGUGKExmeO"},{"type":"output","id":"2uhA_y1Y8KL5g4bYLZ0HX","data":[],"visibility":"show","key":"Zff8fWViKs"}],"visibility":"remove","key":"Z7imlBtGjT"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"crossReference","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"strong","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Demo ","key":"pOHc2rkJlN"},{"type":"text","value":"13.2.2","key":"IdbsYJ7Ypo"}],"key":"hUNJGq9xXp"}],"identifier":"demo-diffadv-heat","label":"demo-diffadv-heat","kind":"proof:example","template":"ExampleÂ %s","enumerator":"13.2.2","resolved":true,"html_id":"demo-diffadv-heat","remote":true,"url":"/diffadv","dataUrl":"/diffadv.json","key":"eBWfI1EiN6"}],"key":"jVrRTAp3AO"}],"key":"pm6uZVYBQU"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2025-01-09T20:31:28.358635Z","iopub.status.busy":"2025-01-09T20:31:28.358453Z","iopub.status.idle":"2025-01-09T20:31:28.361739Z","shell.execute_reply":"2025-01-09T20:31:28.361468Z"}},"children":[{"type":"code","lang":"python","executable":true,"value":"m, n = 60, 40\nx, Dx, Dxx = FNC.diffper(m, [-1, 1])\ny, Dy, Dyy = FNC.diffper(n, [-1, 1])\nmtx, X, Y, vec, unvec, _ = FNC.tensorgrid(x, y)","key":"QZK4YLPb6O"},{"type":"output","id":"QMgBCb1XvyhSzxTAqM-1A","data":[],"key":"ex6IJBVTwq"}],"key":"RsuLy5VVRP"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Note that the initial condition should also be periodic on the domain.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"mnClSnCWjd"}],"key":"CAiHathyO5"}],"key":"f2WL6825R5"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2025-01-09T20:31:28.363142Z","iopub.status.busy":"2025-01-09T20:31:28.363028Z","iopub.status.idle":"2025-01-09T20:31:28.624024Z","shell.execute_reply":"2025-01-09T20:31:28.623725Z"}},"children":[{"type":"code","lang":"python","executable":true,"value":"u_init = lambda x, y: sin(4 * pi * x) * exp(cos(pi * y))\nU0 = mtx(u_init)\nmx = max(abs(U0))\npcolormesh(X, Y, U0, vmin=-mx, vmax=mx, cmap=\"RdBu\", shading=\"gouraud\")\naxis(\"equal\"),  colorbar()\nxlabel(\"$x$\"),  ylabel(\"$y$\")\ntitle(\"Initial condition\");","key":"djkfWI6rCa"},{"type":"output","id":"ycx0_S8of71hRv2yJAkJE","data":[{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"7097a172375616d3915f63c7e233b3fd","path":"/fnc/build/7097a172375616d3915f63c7e233b3fd.png"},"text/plain":{"content":"<Figure size 700x400 with 2 Axes>","content_type":"text/plain"}}}],"key":"p2DgnNNoXI"}],"key":"zoG93e1yY3"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"This function computes the time derivative for the unknowns. The actual calculations take place using the matrix shape.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"Uyzc1EIRdb"}],"key":"mJGgzVESQ9"}],"key":"tmbLmq9xVW"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2025-01-09T20:31:28.625701Z","iopub.status.busy":"2025-01-09T20:31:28.625599Z","iopub.status.idle":"2025-01-09T20:31:28.627810Z","shell.execute_reply":"2025-01-09T20:31:28.627532Z"}},"children":[{"type":"code","lang":"python","executable":true,"value":"alpha = 0.1\ndef du_dt(t, u):\n    U = unvec(u)\n    Uyy = Dxx @ U\n    Uxx = U @ Dyy.T\n    dU_dt = alpha * (Uxx + Uyy)  # PDE\n    return vec(dU_dt)","key":"sFVyTbJRcJ"},{"type":"output","id":"FgnL1tdHLO1Dr90StIqTk","data":[],"key":"K6j9JrwXg8"}],"key":"g7keNtSQ0I"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Since this problem is parabolic, a stiff integrator is appropriate.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"U1bdXoNDN0"}],"key":"fLIQ57N2XU"}],"key":"GdbRANDT96"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2025-01-09T20:31:28.629116Z","iopub.status.busy":"2025-01-09T20:31:28.629026Z","iopub.status.idle":"2025-01-09T20:31:30.498560Z","shell.execute_reply":"2025-01-09T20:31:30.498243Z"}},"children":[{"type":"code","lang":"python","executable":true,"value":"from scipy.integrate import solve_ivp\nsol = solve_ivp(du_dt, (0, 0.2), vec(U0), method=\"BDF\", dense_output=True)\nU = lambda t: unvec(sol.sol(t))\n\npcolormesh(X.T, Y.T, U(0.02).T, \n    vmin=-mx, vmax=mx, cmap=\"RdBu\", shading=\"gouraud\")\naxis(\"equal\"),  colorbar()\nxlabel(\"$x$\"),  ylabel(\"$y$\")\ntitle(\"Heat equation, t=0.02\")","key":"yLdR7g6wli"},{"type":"output","id":"l6Pn18gxehoLJMrIxfvPG","data":[{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"00ce65773ac430c68cfbaaef4cab4cd9","path":"/fnc/build/00ce65773ac430c68cfbaaef4cab4cd9.png"},"text/plain":{"content":"<Figure size 700x400 with 2 Axes>","content_type":"text/plain"}}}],"key":"GhhjGVTC9O"}],"key":"Nbv9Go6tbS"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Here is an animation of the solution.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"dffJKRgFjd"}],"key":"piViYEn1M4"},{"type":"admonition","kind":"tip","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"Tip","key":"pakb4l1KoJ"}],"key":"m5lhi4vuc3"},{"type":"paragraph","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"text","value":"Here ","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"uxBK9VqoIs"},{"type":"inlineCode","value":"clims","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"MONVYnBfrJ"},{"type":"text","value":" are set so that colors remain at fixed values throughout the animation.","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"fWMEw2Q5SG"}],"key":"yn8phmGgQ8"}],"class":"dropdown","key":"sBgPzQMZws"}],"key":"K5oqKLxrHl"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2025-01-09T20:31:30.500458Z","iopub.status.busy":"2025-01-09T20:31:30.500318Z","iopub.status.idle":"2025-01-09T20:31:32.520393Z","shell.execute_reply":"2025-01-09T20:31:32.519934Z"}},"children":[{"type":"code","lang":"python","executable":true,"value":"from matplotlib import animation\nfig, ax = subplots()\nobj = ax.pcolormesh(X, Y, U(0), vmin=-mx, vmax=mx, cmap=\"RdBu\", shading=\"gouraud\")\ntime_text = ax.text(0.05, 0.9, '', transform=ax.transAxes)\nax.set_xlabel(\"$x$\"),  ax.set_ylabel(\"$y$\")\nax.set_aspect(\"equal\")\nax.set_title(\"Heat equation on a periodic domain\")\ndef snapshot(t):\n    global obj\n    obj.remove()\n    obj = ax.pcolormesh(X, Y, U(t), vmin=-mx, vmax=mx, cmap=\"RdBu\", shading=\"gouraud\")\n    time_text.set_text(f\"t = {t:.2f}\")\n\nanim = animation.FuncAnimation(fig, snapshot, frames=linspace(0, 0.2, 121))\nanim.save(\"heat-2d.mp4\", fps=30)\nclose()\n","key":"YNBUKhMlFG"},{"type":"output","id":"AkNDToBSMf07wRF3wQM9Y","data":[{"ename":"AttributeError","evalue":"'Axes' object has no attribute 'surface'","output_type":"error","traceback":"\u001b[0;31m---------------------------------------------------------------------------\u001b[0m\n\u001b[0;31mAttributeError\u001b[0m                            Traceback (most recent call last)\nCell \u001b[0;32mIn[18], line 3\u001b[0m\n\u001b[1;32m      1\u001b[0m \u001b[38;5;28;01mfrom\u001b[39;00m \u001b[38;5;21;01mmatplotlib\u001b[39;00m \u001b[38;5;28;01mimport\u001b[39;00m animation\n\u001b[1;32m      2\u001b[0m fig, ax \u001b[38;5;241m=\u001b[39m subplots()\n\u001b[0;32m----> 3\u001b[0m obj \u001b[38;5;241m=\u001b[39m \u001b[43max\u001b[49m\u001b[38;5;241;43m.\u001b[39;49m\u001b[43msurface\u001b[49m(X, Y, U(\u001b[38;5;241m0\u001b[39m), vmin\u001b[38;5;241m=\u001b[39m\u001b[38;5;241m-\u001b[39mmx, vmax\u001b[38;5;241m=\u001b[39mmx, cmap\u001b[38;5;241m=\u001b[39m\u001b[38;5;124m\"\u001b[39m\u001b[38;5;124mRdBu\u001b[39m\u001b[38;5;124m\"\u001b[39m, shading\u001b[38;5;241m=\u001b[39m\u001b[38;5;124m\"\u001b[39m\u001b[38;5;124mgouraud\u001b[39m\u001b[38;5;124m\"\u001b[39m)\n\u001b[1;32m      4\u001b[0m time_text \u001b[38;5;241m=\u001b[39m ax\u001b[38;5;241m.\u001b[39mtext(\u001b[38;5;241m0.05\u001b[39m, \u001b[38;5;241m0.9\u001b[39m, \u001b[38;5;124m'\u001b[39m\u001b[38;5;124m'\u001b[39m, transform\u001b[38;5;241m=\u001b[39max\u001b[38;5;241m.\u001b[39mtransAxes)\n\u001b[1;32m      5\u001b[0m ax\u001b[38;5;241m.\u001b[39mset_xlabel(\u001b[38;5;124m\"\u001b[39m\u001b[38;5;124m$x$\u001b[39m\u001b[38;5;124m\"\u001b[39m),  ax\u001b[38;5;241m.\u001b[39mset_ylabel(\u001b[38;5;124m\"\u001b[39m\u001b[38;5;124m$y$\u001b[39m\u001b[38;5;124m\"\u001b[39m)\n\n\u001b[0;31mAttributeError\u001b[0m: 'Axes' object has no attribute 'surface'"},{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"254a70947f8fed19d6730b9988d38419","path":"/fnc/build/254a70947f8fed19d6730b9988d38419.png"},"text/plain":{"content":"<Figure size 700x400 with 1 Axes>","content_type":"text/plain"}}}],"key":"Oo2L8fy8S3"}],"key":"hslNhdrRPz"}],"key":"jtmak85Kdv"},"references":{"cite":{"order":[],"data":{}}},"footer":{"navigation":{"prev":{"title":"Vec","url":"/vec-2","group":"Chapter 13"},"next":{"title":"Advdiff","url":"/advdiff-7","group":"Chapter 13"}}},"domain":"http://localhost:3000"}