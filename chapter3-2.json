{"kind":"Notebook","sha256":"18c66a8151e7b86b71a1cf3783e38de710ed53ee6c885e28e1c0c461ae7c9f02","slug":"chapter3-2","location":"/python/chapter3.md","dependencies":[],"frontmatter":{"title":"Chapter 3","numbering":{"heading_1":{"enabled":false},"heading_2":{"enabled":false},"heading_3":{"enabled":false},"heading_4":{"enabled":false},"heading_5":{"enabled":false},"heading_6":{"enabled":false}},"kernelspec":{"name":"python3","display_name":"Python 3","language":"python"},"content_includes_title":false,"authors":[{"nameParsed":{"literal":"Tobin A. Driscoll","given":"Tobin A.","family":"Driscoll"},"name":"Tobin A. Driscoll","email":"driscoll@udel.edu","id":"contributors-myst-generated-uid-0","corresponding":true},{"nameParsed":{"literal":"Richard J. Braun","given":"Richard J.","family":"Braun"},"name":"Richard J. Braun","id":"contributors-myst-generated-uid-1"}],"github":"https://github.com/fncbook/fnc","math":{"\\float":{"macro":"\\mathbb{F}"},"\\real":{"macro":"\\mathbb{R}"},"\\complex":{"macro":"\\mathbb{C}"},"\\nat":{"macro":"\\mathbb{N}"},"\\integer":{"macro":"\\mathbb{Z}"},"\\rmn":{"macro":"\\mathbb{R}^{#1 \\times #2}"},"\\dd":{"macro":"\\frac{d #1}{d #2}"},"\\ddd":{"macro":"\\frac{d^2 #1}{d #2^2}"},"\\pp":{"macro":"\\frac{\\partial #1}{\\partial #2}"},"\\ppp":{"macro":"\\frac{\\partial^2 #1}{\\partial #2^2}"},"\\ppdd":{"macro":"\\frac{\\partial^2 #1}{\\partial #2 \\partial #3}"},"\\abs":{"macro":"\\left\\lvert #1 \\right\\rvert"},"\\norm":{"macro":"\\left\\lVert #1 \\right\\rVert"},"\\twonorm":{"macro":"\\norm{#1}_2"},"\\onenorm":{"macro":"\\norm{#1}_1"},"\\infnorm":{"macro":"\\norm{#1}_\\infty"},"\\anynorm":{"macro":"\\norm{#1}_#2"},"\\innerprod":{"macro":"\\langle #1,#2 \\rangle"},"\\pr":{"macro":"^{(#1)}"},"\\kron":{"macro":"#1 \\otimes #2"},"\\eye":{"macro":"\\mathbf{e}_#1"},"\\meye":{"macro":"\\mathbf{I}"},"\\Qhat":{"macro":"\\hat{\\mathbf{Q}}"},"\\Rhat":{"macro":"\\hat{\\mathbf{R}}"},"\\bfalpha":{"macro":"\\mathbf{alpha}"},"\\bfdelta":{"macro":"\\mathbf{delta}"},"\\bfzero":{"macro":"\\boldsymbol{0}"},"\\macheps":{"macro":"\\epsilon_\\text{mach}"},"\\fl":{"macro":"\\operatorname{fl}"},"\\diag":{"macro":"\\operatorname{diag}"},"\\ign":{"macro":"\\operatorname{sign}"},"\\Re":{"macro":"\\operatorname{Re}"},"\\Im":{"macro":"\\operatorname{Im}"},"\\ee":{"macro":"\\times 10^"},"\\lnorm":{"macro":"\\|"},"\\rnorm":{"macro":"\\|"},"\\floor":{"macro":"\\lfloor#1\\rfloor"},"\\cI":{"macro":"\\mathcal{I}"},"\\mtx":{"macro":"\\operatorname{mtx}"},"\\myvec":{"macro":"\\operatorname{vec}"},"\\argmin":{"macro":"\\operatorname{argmin}"}},"abbreviations":{"LU":"lower triangular times upper triangular","QR":"orthogonal times upper triangular"},"exports":[{"format":"md","filename":"chapter3.md","url":"/fnc/build/chapter3-0d74158a906b82f2b64e776d9c1e6783.md"}]},"mdast":{"type":"root","children":[{"type":"block","children":[{"type":"paragraph","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"children":[{"type":"text","value":"Python implementations","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"key":"FCI5WilJRp"}],"key":"A5yUDuFDqx"},{"type":"heading","depth":2,"position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"children":[{"type":"text","value":"Functions","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"key":"Bvm6XGaw7n"}],"identifier":"functions","label":"Functions","html_id":"functions","implicit":true,"key":"IXsNhqqvGW"},{"type":"details","children":[{"type":"summary","children":[{"type":"text","value":"Solution of least squares by the normal equations","position":{"start":{"line":16,"column":1},"end":{"line":16,"column":1}},"key":"WBAmYRLlIg"}],"key":"axwRMUdaoc"},{"type":"include","file":"../python/pkg/FNC/FNC03.py","literal":true,"filter":{"lines":[[7,19]]},"children":[{"type":"code","value":"    lsnormal(A,b)\n    \n    Solve a linear least squares problem by the normal equations. Returns the\n    minimizer of ||b-Ax||.\n    \"\"\"\n    N = A.T @ A\n    z = A.T @ b\n    R = scipy.linalg.cholesky(N)\n    w = forwardsub(R.T, z)                   # solve R'z=c\n    x = backsub(R, w)                        # solve Rx=z\n    return x\n\ndef lsqrfact(A,b):","lang":"python","showLineNumbers":true,"filename":"lsnormal.py","key":"ZpQY2zKv59"}],"key":"Gh3w0eiuYF"},{"type":"admonition","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"About the code","position":{"start":{"line":24,"column":1},"end":{"line":24,"column":1}},"key":"KjOIezfCOK"}],"key":"jUeAxF0mjK"},{"type":"paragraph","position":{"start":{"line":26,"column":1},"end":{"line":26,"column":1}},"children":[{"type":"inlineCode","value":"cholesky","position":{"start":{"line":26,"column":1},"end":{"line":26,"column":1}},"key":"rmvzFJINLn"},{"type":"text","value":" is imported from ","position":{"start":{"line":26,"column":1},"end":{"line":26,"column":1}},"key":"y4mLQv6YJj"},{"type":"inlineCode","value":"scipy.linalg","position":{"start":{"line":26,"column":1},"end":{"line":26,"column":1}},"key":"XZuKzL5Yzb"},{"type":"text","value":".","position":{"start":{"line":26,"column":1},"end":{"line":26,"column":1}},"key":"e1k3Jmy7Ce"}],"key":"Ru7hLmqgU8"}],"class":"dropdown","key":"ffUmzo1wLi"}],"label":"function-lsnormal-python","identifier":"function-lsnormal-python","html_id":"function-lsnormal-python","key":"DMFwj71ebX"},{"type":"details","children":[{"type":"summary","children":[{"type":"text","value":"Solution of least squares by ","key":"Bkf7cFk44I"},{"type":"abbreviation","title":"orthogonal times upper triangular","children":[{"type":"text","value":"QR","key":"h9BoWSxuem"}],"key":"vAmh2FG8Ny"},{"type":"text","value":" factorization","key":"BySeWc81X7"}],"key":"ewCNP1KEOk"},{"type":"include","file":"../python/pkg/FNC/FNC03.py","literal":true,"filter":{"lines":[[21,31]]},"children":[{"type":"code","value":"    lsqrfact(A,b)\n    \n    Solve a linear least squares problem by QR factorization. Returns the\n    minimizer of ||b-Ax||.\n    \"\"\"\n    Q, R = np.linalg.qr(A)\n    c = Q.T @ b\n    x = backsub(R, c)\n    return x\n\ndef qrfact(A):","lang":"python","showLineNumbers":true,"filename":"lsqrfact.py","key":"AO9ZChCYHe"}],"key":"YMBcEAN7Vk"}],"label":"function-lsqrfact-python","identifier":"function-lsqrfact-python","html_id":"function-lsqrfact-python","key":"BIDK2yzBQK"},{"type":"details","children":[{"type":"summary","children":[{"type":"abbreviation","title":"orthogonal times upper triangular","children":[{"type":"text","value":"QR","key":"N3dk85245E"}],"key":"mjbzOvBd5E"},{"type":"text","value":" factorization by Householder reflections","key":"hpvdLa2zpY"}],"key":"KSSP4HjHaL"},{"type":"include","file":"../python/pkg/FNC/FNC03.py","literal":true,"filter":{"lines":[[33,53]]},"children":[{"type":"code","value":"        qrfact(A)\n\n    QR factorization by Householder reflections. Returns Q and R.\n    \"\"\"\n    m, n = A.shape\n    Qt = np.eye(m)\n    R = np.copy(A)\n    for k in range(n):\n        z = R[k:, k]\n        w = np.stack((-np.sign(z[0]) * np.linalg.norm(z) - z[0], -z[1:]))\n        nrmw = np.linalg.norm(w)\n        if nrmw < np.finfo(float).eps: continue    # skip this iteration\n        v = w / nrmw\n        # Apply the reflection to each relevant column of R and Q\n        for j in range(k, n):\n            R[k:, j] -= 2 * np.dot(v, R[k:, j]) * v\n        for j in range(m):\n            Qt[k:, j] -= 2 * np.dot(v, Qt[k:, j]) * v \n    return Qt.T, np.triu(R)\n","lang":"python","showLineNumbers":true,"filename":"qrfact.py","key":"t6r1oCylxZ"}],"key":"W2u8Domr5A"}],"label":"function-qrfact-python","identifier":"function-qrfact-python","html_id":"function-qrfact-python","key":"p3XERsl45H"},{"type":"heading","depth":2,"position":{"start":{"line":50,"column":1},"end":{"line":50,"column":1}},"children":[{"type":"text","value":"Examples","position":{"start":{"line":50,"column":1},"end":{"line":50,"column":1}},"key":"MVoZdY8iPZ"}],"identifier":"examples","label":"Examples","html_id":"examples","implicit":true,"key":"dlRAeoliRA"}],"key":"mdKveoEwA7"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"from numpy import *\nfrom matplotlib.pyplot import *\nfrom numpy.linalg import solve, norm\nimport scipy.sparse as sparse\nfrom scipy.sparse.linalg import splu\nfrom timeit import default_timer as timer\nimport FNC","key":"tqid0Zn94K"},{"type":"output","id":"FUP84IJB5aEK0D1JCl64K","data":[],"key":"atWCHKAYDh"}],"data":{},"key":"RvWPbpPkFQ"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# This (optional) block is for improving the display of plots.\nrcParams[\"figure.figsize\"] = [7, 4]\nrcParams[\"lines.linewidth\"] = 2\nrcParams[\"lines.markersize\"] = 4\nrcParams['animation.html'] = \"jshtml\"  # or try \"html5\"","visibility":"show","key":"TIKTChfcSm"},{"type":"output","id":"1-kSnK-nJxy0e4Kr33k04","data":[],"visibility":"show","key":"XaiHitIPQS"}],"data":{"tags":[]},"visibility":"remove","key":"WYUN5XUxFI"},{"type":"block","children":[{"type":"heading","depth":3,"position":{"start":{"line":71,"column":1},"end":{"line":71,"column":1}},"children":[{"type":"text","value":"Section 3.1","position":{"start":{"line":71,"column":1},"end":{"line":71,"column":1}},"key":"yb9nwG2vGv"}],"identifier":"section-3-1","label":"Section 3.1","html_id":"section-3-1","implicit":true,"key":"htbsFRBGO1"},{"type":"details","children":[{"type":"summary","children":[{"type":"text","value":"Interpolating temperature data","position":{"start":{"line":73,"column":1},"end":{"line":73,"column":1}},"key":"zemNP5fhpH"}],"key":"OEwuLc0ZMz"},{"type":"paragraph","position":{"start":{"line":74,"column":1},"end":{"line":74,"column":1}},"children":[{"type":"text","value":"Here are 5-year averages of the worldwide temperature anomaly as compared to the 1951–1980 average (source: NASA).","position":{"start":{"line":74,"column":1},"end":{"line":74,"column":1}},"key":"rybNnqHRTU"}],"key":"Dz31YlwJYe"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"year = arange(1955,2005,5)\ny = array([ -0.0480, -0.0180, -0.0360, -0.0120, -0.0040,\n    0.1180, 0.2100, 0.3320, 0.3340, 0.4560 ])\n\nfig, ax = subplots()\nax.scatter(year, y, color=\"k\", label=\"data\")\nxlabel(\"year\")\nylabel(\"anomaly (degrees C)\")\ntitle(\"World temperature anomaly\");","key":"rNHGVInHEu"},{"type":"output","id":"eKuiVUMj2WQJsYiesVAXq","data":[{"output_type":"display_data","metadata":{},"data":{"text/plain":{"content":"<Figure size 700x400 with 1 Axes>","content_type":"text/plain"},"image/png":{"content_type":"image/png","hash":"5dbe24ecc5c1a3f64cc164b3dee7df8c","path":"/fnc/build/5dbe24ecc5c1a3f64cc164b3dee7df8c.png"}}}],"key":"GBqtCRnO7n"}],"data":{},"key":"DOHCNVtgNy"},{"type":"paragraph","position":{"start":{"line":88,"column":1},"end":{"line":88,"column":1}},"children":[{"type":"text","value":"A polynomial interpolant can be used to fit the data. Here we build one using a Vandermonde matrix. First, though, we express time as decades since 1950, as it improves the condition number of the matrix.","position":{"start":{"line":88,"column":1},"end":{"line":88,"column":1}},"key":"j8dhRHQqW2"}],"key":"L9AJuzA8Zm"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"t = (year - 1950) / 10\nV = vander(t)\nc = solve(V, y)\nprint(c)","key":"RCXciMqJVR"},{"type":"output","id":"ttP903yjEQ8BP3VO8An1n","data":[{"output_type":"stream","name":"stdout","text":"[ 1.03111111e-02 -2.54666667e-01  2.69480635e+00 -1.59628889e+01\n  5.80155778e+01 -1.33273472e+02  1.91960567e+02 -1.65455972e+02\n  7.63617381e+01 -1.41140000e+01]\n"}],"key":"tombvjFcUv"}],"data":{},"key":"zlqEIcBoxt"},{"type":"paragraph","position":{"start":{"line":100,"column":1},"end":{"line":100,"column":1}},"children":[{"type":"text","value":"The coefficients in vector ","position":{"start":{"line":100,"column":1},"end":{"line":100,"column":1}},"key":"h3hlHCDQV6"},{"type":"inlineCode","value":"c","position":{"start":{"line":100,"column":1},"end":{"line":100,"column":1}},"key":"FzmyEK2fHN"},{"type":"text","value":" are used to create a polynomial. Then we create a function that evaluates the polynomial after changing the time variable as we did for the Vandermonde matrix.","position":{"start":{"line":100,"column":1},"end":{"line":100,"column":1}},"key":"ydDLvweydw"}],"indexEntries":[{"entry":"Python","subEntry":{"value":"plotting functions","kind":"entry"},"emphasis":false}],"label":"index-lu9qgBNteS","identifier":"index-lu9qgbntes","html_id":"index-lu9qgbntes","key":"lTK5OPtynU"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"p = poly1d(c)    # convert to a polynomial\ntt = linspace(1955, 2000, 500)\nax.plot(tt, p((tt - 1950) / 10), label=\"interpolant\")\nax.legend();\nfig","key":"d4rVkqZhwr"},{"type":"output","id":"aqwlfe_udLvczhNwHLOw3","data":[{"output_type":"execute_result","execution_count":5,"metadata":{},"data":{"text/plain":{"content":"<Figure size 700x400 with 1 Axes>","content_type":"text/plain"},"image/png":{"content_type":"image/png","hash":"de196f707cff163f3efa6ff60288b3e2","path":"/fnc/build/de196f707cff163f3efa6ff60288b3e2.png"}}}],"key":"VopF6k60ce"}],"data":{},"key":"co5XIQEBEq"},{"type":"paragraph","position":{"start":{"line":110,"column":1},"end":{"line":110,"column":1}},"children":[{"type":"text","value":"As you can see, the interpolant does represent the data, in a sense. However it’s a crazy-looking curve for the application. Trying too hard to reproduce all the data exactly is known as ","position":{"start":{"line":110,"column":1},"end":{"line":110,"column":1}},"key":"kovpVgXnSW"},{"type":"emphasis","position":{"start":{"line":110,"column":1},"end":{"line":110,"column":1}},"children":[{"type":"text","value":"overfitting","position":{"start":{"line":110,"column":1},"end":{"line":110,"column":1}},"key":"vVStsKXIc6"}],"key":"BeuCyVpabb"},{"type":"text","value":".","position":{"start":{"line":110,"column":1},"end":{"line":110,"column":1}},"key":"dmBOxYxHbS"}],"key":"JfsXgSq58L"}],"label":"demo-fitting-tempinterp-python","identifier":"demo-fitting-tempinterp-python","html_id":"demo-fitting-tempinterp-python","key":"CcF7kUwNC8"},{"type":"details","children":[{"type":"summary","children":[{"type":"text","value":"Fitting temperature data","position":{"start":{"line":115,"column":1},"end":{"line":115,"column":1}},"key":"Qs1D0fisyN"}],"key":"gKRW9irzxR"},{"type":"paragraph","position":{"start":{"line":116,"column":1},"end":{"line":116,"column":1}},"children":[{"type":"text","value":"Here are the 5-year temperature averages again.","position":{"start":{"line":116,"column":1},"end":{"line":116,"column":1}},"key":"MYcJsYEIL8"}],"key":"RQ2L3DYBBy"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"year = arange(1955, 2005, 5)\ny = array([-0.0480, -0.0180, -0.0360, -0.0120, -0.0040,\n    0.1180, 0.2100, 0.3320, 0.3340, 0.4560])\nt = (year - 1950) / 10","key":"bRcGvi7ftq"},{"type":"output","id":"GLR2ZNw3WDsgf5hmEVaJK","data":[],"key":"q5hAt4mvmF"}],"data":{},"key":"bqETgbDedu"},{"type":"grid","columns":[1,1,2,2],"children":[{"type":"paragraph","position":{"start":{"line":127,"column":1},"end":{"line":127,"column":1}},"children":[{"type":"text","value":"The standard best-fit line results from using a linear polynomial that meets the least-squares criterion.","position":{"start":{"line":127,"column":1},"end":{"line":127,"column":1}},"key":"Fgs8lxLEkP"}],"key":"jicryxvjzz"},{"type":"card","children":[{"type":"paragraph","position":{"start":{"line":129,"column":1},"end":{"line":129,"column":1}},"children":[{"type":"text","value":"Backslash solves overdetermined linear systems in a least-squares sense.","position":{"start":{"line":129,"column":1},"end":{"line":129,"column":1}},"key":"xAbcMcx8mn"}],"key":"fTYmp1ZvFi"}],"key":"j3KbMJzuoL"}],"key":"T1ddWvvrhJ"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"V = array([ [t[i], 1] for i in range(t.size) ])    # Vandermonde-ish matrix\nprint(V.shape)","key":"kpyboMP2Db"},{"type":"output","id":"9zNYh8k0UHTimHyT8r9U0","data":[{"output_type":"stream","name":"stdout","text":"(10, 2)\n"}],"key":"pPiyrjArWb"}],"data":{},"key":"eSJfoNJyAF"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"from numpy.linalg import lstsq\nc, res, rank, sv = lstsq(V, y)\np = poly1d(c)\nf = lambda year: p((year - 1950) / 10)","key":"g78RubsPzM"},{"type":"output","id":"DU_ut31XFq0hjcuQUdmLk","data":[],"key":"umMYZXL244"}],"data":{},"indexEntries":[{"entry":"Python","subEntry":{"value":"lstsq","kind":"entry"},"emphasis":true}],"label":"index-MpGayWmeJK","identifier":"index-mpgaywmejk","html_id":"index-mpgaywmejk","key":"SpILu8HJIp"},{"type":"code","lang":"","value":"\n```{code-cell}\nfig, ax = subplots()\nax.scatter(year, y, color=\"k\", label=\"data\")\nyr = linspace(1955, 2000, 500)\nax.plot(yr, f(yr), label=\"linear fit\")\n\nxlabel(\"year\")\nylabel(\"anomaly (degrees C)\")\ntitle(\"World temperature anomaly\");\nax.legend();","position":{"start":{"line":147,"column":1},"end":{"line":159,"column":1}},"key":"Lkz01XWrwh"},{"type":"paragraph","position":{"start":{"line":161,"column":1},"end":{"line":161,"column":1}},"children":[{"type":"text","value":"If we use a global cubic polynomial, the points are fit more closely.","position":{"start":{"line":161,"column":1},"end":{"line":161,"column":1}},"key":"W8RApZ6NoH"}],"key":"Om7Z4pzBVH"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"V = array([ [t[i]**3,t[i]**2,t[i],1] for i in range(t.size) ])    # Vandermonde-ish matrix\nprint(V.shape)","key":"ovLG8cgAmj"},{"type":"output","id":"Bvdhw8sOqX86z-lf9bKNT","data":[{"output_type":"stream","name":"stdout","text":"(10, 4)\n"}],"key":"XxNVHwYIFE"}],"data":{},"key":"ZEoco3LgA5"},{"type":"grid","columns":[1,1,2,2],"children":[{"type":"paragraph","position":{"start":{"line":169,"column":1},"end":{"line":169,"column":1}},"children":[{"type":"text","value":"Now we solve the new least-squares problem to redefine the fitting polynomial.","position":{"start":{"line":169,"column":1},"end":{"line":169,"column":1}},"key":"Nib49vL5cP"}],"key":"xhOPwr8Uqk"},{"type":"card","children":[{"type":"paragraph","position":{"start":{"line":171,"column":1},"end":{"line":171,"column":1}},"children":[{"type":"text","value":"The definition of ","position":{"start":{"line":171,"column":1},"end":{"line":171,"column":1}},"key":"tH00F8ioXq"},{"type":"inlineCode","value":"f","position":{"start":{"line":171,"column":1},"end":{"line":171,"column":1}},"key":"pGTBK9d2Sa"},{"type":"text","value":" above is in terms of ","position":{"start":{"line":171,"column":1},"end":{"line":171,"column":1}},"key":"m5mkgDHMRl"},{"type":"inlineCode","value":"c","position":{"start":{"line":171,"column":1},"end":{"line":171,"column":1}},"key":"M9PQBdKSta"},{"type":"text","value":". When ","position":{"start":{"line":171,"column":1},"end":{"line":171,"column":1}},"key":"BOr3aPFobn"},{"type":"inlineCode","value":"c","position":{"start":{"line":171,"column":1},"end":{"line":171,"column":1}},"key":"ZDZEjhRrgg"},{"type":"text","value":" is changed, ","position":{"start":{"line":171,"column":1},"end":{"line":171,"column":1}},"key":"EQqOhQczWe"},{"type":"inlineCode","value":"f","position":{"start":{"line":171,"column":1},"end":{"line":171,"column":1}},"key":"aTnzc4VHP4"},{"type":"text","value":" is updated with it.","position":{"start":{"line":171,"column":1},"end":{"line":171,"column":1}},"key":"z45XHi8cp9"}],"key":"SKWxcAdg9Y"}],"key":"vFtgJABIdV"}],"key":"MFC5RsswXw"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"c, res, rank, sv = lstsq(V, y, rcond=None)\nyr = linspace(1955, 2000, 500)\nax.plot(yr, f(yr), label=\"cubic fit\")\nfig","key":"tBhblUMsQt"},{"type":"output","id":"SYHL7mlk1L-A-IdCsyTye","data":[{"output_type":"execute_result","execution_count":10,"metadata":{},"data":{"text/plain":{"content":"<Figure size 700x400 with 1 Axes>","content_type":"text/plain"},"image/png":{"content_type":"image/png","hash":"e394fe68f341bc4bb1d1f42c740cbaca","path":"/fnc/build/e394fe68f341bc4bb1d1f42c740cbaca.png"}}}],"key":"ompb3xu6s6"}],"data":{},"key":"LKAD8BFXGp"},{"type":"paragraph","position":{"start":{"line":182,"column":1},"end":{"line":182,"column":1}},"children":[{"type":"text","value":"If we were to continue increasing the degree of the polynomial, the residual at the data points would get smaller, but overfitting would increase.","position":{"start":{"line":182,"column":1},"end":{"line":182,"column":1}},"key":"icFIWNOeKA"}],"key":"xYL3sV3G5j"}],"label":"demo-fitting-tempfit-python","identifier":"demo-fitting-tempfit-python","html_id":"demo-fitting-tempfit-python","key":"Cw9OIjtQrA"},{"type":"details","children":[{"type":"summary","children":[{"type":"text","value":"Fitting a power law","position":{"start":{"line":186,"column":1},"end":{"line":186,"column":1}},"key":"dY2n5V40xe"}],"key":"Y1WAuwbOFD"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"a = array([1 / (k+1)**2 for k in range(100)])\ns = cumsum(a)        # cumulative summation\np = sqrt(6*s)\n\nplot(range(100), p, \"o\")\nxlabel(\"$k$\") \nylabel(\"$p_k$\") \ntitle(\"Sequence convergence\");","key":"vWZW0OwEfK"},{"type":"output","id":"5OxuUe7e74opzmBLc3RKy","data":[{"output_type":"display_data","metadata":{},"data":{"text/plain":{"content":"<Figure size 700x400 with 1 Axes>","content_type":"text/plain"},"image/png":{"content_type":"image/png","hash":"9226f6ce5a5d912b3554df89510b527c","path":"/fnc/build/9226f6ce5a5d912b3554df89510b527c.png"}}}],"key":"vt8H33x1uK"}],"data":{},"key":"jiKXm4Kmsk"},{"type":"paragraph","position":{"start":{"line":198,"column":1},"end":{"line":198,"column":1}},"children":[{"type":"text","value":"This graph suggests that maybe ","position":{"start":{"line":198,"column":1},"end":{"line":198,"column":1}},"key":"jT7n7qnmeD"},{"type":"inlineMath","value":"p_k\\to \\pi","position":{"start":{"line":198,"column":1},"end":{"line":198,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>p</mi><mi>k</mi></msub><mo>→</mo><mi>π</mi></mrow><annotation encoding=\"application/x-tex\">p_k\\to \\pi</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.625em;vertical-align:-0.1944em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">p</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3361em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03148em;\">k</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">→</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">π</span></span></span></span>","key":"Hc1D1Kwj9f"},{"type":"text","value":", but it’s far from clear how close the sequence gets. It’s more informative to plot the sequence of errors, ","position":{"start":{"line":198,"column":1},"end":{"line":198,"column":1}},"key":"YKLMgwUs0e"},{"type":"inlineMath","value":"\\epsilon_k= |\\pi-p_k|","position":{"start":{"line":198,"column":1},"end":{"line":198,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>ϵ</mi><mi>k</mi></msub><mo>=</mo><mi mathvariant=\"normal\">∣</mi><mi>π</mi><mo>−</mo><msub><mi>p</mi><mi>k</mi></msub><mi mathvariant=\"normal\">∣</mi></mrow><annotation encoding=\"application/x-tex\">\\epsilon_k= |\\pi-p_k|</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.5806em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">ϵ</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3361em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03148em;\">k</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord\">∣</span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">π</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">p</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3361em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03148em;\">k</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mord\">∣</span></span></span></span>","key":"VGN9rGc07y"},{"type":"text","value":". By plotting the error sequence on a log-log scale, we can see a nearly linear relationship.","position":{"start":{"line":198,"column":1},"end":{"line":198,"column":1}},"key":"VpXKH8130N"}],"key":"V3hRPkzwvO"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"ep = abs(pi - p)    # error sequence\nloglog(range(100), ep, \"o\")\nxlabel(\"$k$\") \nylabel(\"error\") \ntitle(\"Sequence convergence\");","key":"PulIARxnTJ"},{"type":"output","id":"gc8Qng-dPX4DsUhPZN2_n","data":[{"output_type":"display_data","metadata":{},"data":{"text/plain":{"content":"<Figure size 700x400 with 1 Axes>","content_type":"text/plain"},"image/png":{"content_type":"image/png","hash":"2d3fb304a7a5438a575e1e35edd0182a","path":"/fnc/build/2d3fb304a7a5438a575e1e35edd0182a.png"}}}],"key":"nq468UrFvq"}],"data":{},"key":"weDRAqBMGH"},{"type":"paragraph","position":{"start":{"line":208,"column":1},"end":{"line":208,"column":1}},"children":[{"type":"text","value":"The straight line on the log-log scale suggests a power-law relationship where ","position":{"start":{"line":208,"column":1},"end":{"line":208,"column":1}},"key":"YLtwoVK2B2"},{"type":"inlineMath","value":"\\epsilon_k\\approx a k^b","position":{"start":{"line":208,"column":1},"end":{"line":208,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>ϵ</mi><mi>k</mi></msub><mo>≈</mo><mi>a</mi><msup><mi>k</mi><mi>b</mi></msup></mrow><annotation encoding=\"application/x-tex\">\\epsilon_k\\approx a k^b</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6331em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">ϵ</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3361em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03148em;\">k</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">≈</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8491em;\"></span><span class=\"mord mathnormal\">a</span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.03148em;\">k</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8491em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">b</span></span></span></span></span></span></span></span></span></span></span>","key":"qvzwJvZKl7"},{"type":"text","value":", or ","position":{"start":{"line":208,"column":1},"end":{"line":208,"column":1}},"key":"wJ1Ho7MSn8"},{"type":"inlineMath","value":"\\log \\epsilon_k \\approx b (\\log k) + \\log a","position":{"start":{"line":208,"column":1},"end":{"line":208,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>log</mi><mo>⁡</mo><msub><mi>ϵ</mi><mi>k</mi></msub><mo>≈</mo><mi>b</mi><mo stretchy=\"false\">(</mo><mi>log</mi><mo>⁡</mo><mi>k</mi><mo stretchy=\"false\">)</mo><mo>+</mo><mi>log</mi><mo>⁡</mo><mi>a</mi></mrow><annotation encoding=\"application/x-tex\">\\log \\epsilon_k \\approx b (\\log k) + \\log a</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8889em;vertical-align:-0.1944em;\"></span><span class=\"mop\">lo<span style=\"margin-right:0.01389em;\">g</span></span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">ϵ</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3361em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03148em;\">k</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">≈</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\">b</span><span class=\"mopen\">(</span><span class=\"mop\">lo<span style=\"margin-right:0.01389em;\">g</span></span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03148em;\">k</span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8889em;vertical-align:-0.1944em;\"></span><span class=\"mop\">lo<span style=\"margin-right:0.01389em;\">g</span></span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord mathnormal\">a</span></span></span></span>","key":"QSUiTtWYZp"},{"type":"text","value":".","position":{"start":{"line":208,"column":1},"end":{"line":208,"column":1}},"key":"XjNBbxf8Lo"}],"key":"bcVkqMDcs3"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"V = array([ [1, log(k+1)] for k in range(100) ])     # fitting matrix\nc = lstsq(V, log(ep), rcond=None)[0]           # coefficients of linear fit\nprint(c)","key":"hxtqZ5kyIe"},{"type":"output","id":"9iw_lQn7WQAn9SpUjzhtS","data":[{"output_type":"stream","name":"stdout","text":"[-0.18237525 -0.96741032]\n"}],"key":"HcDS4tdfnR"}],"data":{},"key":"KvG2art1AW"},{"type":"paragraph","position":{"start":{"line":216,"column":1},"end":{"line":216,"column":1}},"children":[{"type":"text","value":"In terms of the parameters ","position":{"start":{"line":216,"column":1},"end":{"line":216,"column":1}},"key":"PCwEQPJwbr"},{"type":"inlineMath","value":"a","position":{"start":{"line":216,"column":1},"end":{"line":216,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>a</mi></mrow><annotation encoding=\"application/x-tex\">a</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">a</span></span></span></span>","key":"BYZqAnGIJN"},{"type":"text","value":" and ","position":{"start":{"line":216,"column":1},"end":{"line":216,"column":1}},"key":"d4JBFNudzm"},{"type":"inlineMath","value":"b","position":{"start":{"line":216,"column":1},"end":{"line":216,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>b</mi></mrow><annotation encoding=\"application/x-tex\">b</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6944em;\"></span><span class=\"mord mathnormal\">b</span></span></span></span>","key":"sId6to6REp"},{"type":"text","value":" used above, we have","position":{"start":{"line":216,"column":1},"end":{"line":216,"column":1}},"key":"pKEp0qi5g4"}],"key":"wfk2M5sBa3"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"a, b = exp(c[0]), c[1]\nprint(f\"b: {b:.3f}\")","key":"KQl77Ts7uq"},{"type":"output","id":"QM-mKKflrOWQTU17VaZ8A","data":[{"output_type":"stream","name":"stdout","text":"b: -0.967\n"}],"key":"QQTz0VRE7U"}],"data":{},"key":"R0TrRf9zNV"},{"type":"paragraph","position":{"start":{"line":223,"column":1},"end":{"line":223,"column":1}},"children":[{"type":"text","value":"It’s tempting to conjecture that the slope ","position":{"start":{"line":223,"column":1},"end":{"line":223,"column":1}},"key":"YrfsJ4UBjS"},{"type":"inlineMath","value":"b\\to -1","position":{"start":{"line":223,"column":1},"end":{"line":223,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>b</mi><mo>→</mo><mo>−</mo><mn>1</mn></mrow><annotation encoding=\"application/x-tex\">b\\to -1</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6944em;\"></span><span class=\"mord mathnormal\">b</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">→</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.7278em;vertical-align:-0.0833em;\"></span><span class=\"mord\">−</span><span class=\"mord\">1</span></span></span></span>","key":"U4uWczKNAQ"},{"type":"text","value":" asymptotically. Here is how the numerical fit compares to the original convergence curve.","position":{"start":{"line":223,"column":1},"end":{"line":223,"column":1}},"key":"uWh4FqG7HD"}],"key":"YLi9iy0D7c"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"loglog(range(100), ep, \"o\", label=\"sequence\")\nk = arange(1,100)\nplot(k, a*k**b, \"--\", label=\"power fit\")\nxlabel(\"$k$\");  ylabel(\"error\"); \nlegend(); title(\"Sequence convergence\");","key":"A9ZDkG84bF"},{"type":"output","id":"BpgvWGI6NPC8rv0fgRO20","data":[{"output_type":"display_data","metadata":{},"data":{"text/plain":{"content":"<Figure size 700x400 with 1 Axes>","content_type":"text/plain"},"image/png":{"content_type":"image/png","hash":"cb2f073e2549511ace5816be4cbeda70","path":"/fnc/build/cb2f073e2549511ace5816be4cbeda70.png"}}}],"key":"hbVXoQ4c2w"}],"data":{},"key":"sYmDIjZ2C0"}],"label":"demo-fitting-pirate-python","identifier":"demo-fitting-pirate-python","html_id":"demo-fitting-pirate-python","key":"ZwCTkRAA2S"},{"type":"heading","depth":3,"position":{"start":{"line":234,"column":1},"end":{"line":234,"column":1}},"children":[{"type":"text","value":"Section 3.2","position":{"start":{"line":234,"column":1},"end":{"line":234,"column":1}},"key":"hwBVSTCaTt"}],"identifier":"section-3-2","label":"Section 3.2","html_id":"section-3-2","implicit":true,"key":"XMAvsiflmM"},{"type":"details","children":[{"type":"summary","children":[{"type":"text","value":"Instability in the normal equations","position":{"start":{"line":237,"column":1},"end":{"line":237,"column":1}},"key":"Pa4007M0tJ"}],"key":"T5CtmwU8cK"},{"type":"paragraph","position":{"start":{"line":239,"column":1},"end":{"line":239,"column":1}},"children":[{"type":"text","value":"Because the functions ","position":{"start":{"line":239,"column":1},"end":{"line":239,"column":1}},"key":"FApxuBu8f8"},{"type":"inlineMath","value":"\\sin^2(t)","position":{"start":{"line":239,"column":1},"end":{"line":239,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msup><mrow><mi>sin</mi><mo>⁡</mo></mrow><mn>2</mn></msup><mo stretchy=\"false\">(</mo><mi>t</mi><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">\\sin^2(t)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1.1219em;vertical-align:-0.25em;\"></span><span class=\"mop\"><span class=\"mop\">sin</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8719em;\"><span style=\"top:-3.1208em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span></span></span></span></span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">t</span><span class=\"mclose\">)</span></span></span></span>","key":"C7baieWlnq"},{"type":"text","value":", ","position":{"start":{"line":239,"column":1},"end":{"line":239,"column":1}},"key":"dQ6ADQFSLF"},{"type":"inlineMath","value":"\\cos^2(t)","position":{"start":{"line":239,"column":1},"end":{"line":239,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msup><mrow><mi>cos</mi><mo>⁡</mo></mrow><mn>2</mn></msup><mo stretchy=\"false\">(</mo><mi>t</mi><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">\\cos^2(t)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1.0641em;vertical-align:-0.25em;\"></span><span class=\"mop\"><span class=\"mop\">cos</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span></span></span></span></span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">t</span><span class=\"mclose\">)</span></span></span></span>","key":"Y0Lwac1J7P"},{"type":"text","value":", and ","position":{"start":{"line":239,"column":1},"end":{"line":239,"column":1}},"key":"BCWDb7Uv7y"},{"type":"text","value":"1","position":{"start":{"line":239,"column":1},"end":{"line":239,"column":1}},"key":"FU35QjkBF5"},{"type":"text","value":" are linearly dependent, we should find that the following matrix is somewhat ill-conditioned.","position":{"start":{"line":239,"column":1},"end":{"line":239,"column":1}},"key":"TLpfqZ8s2u"}],"key":"MUlKeF02UU"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"from numpy.linalg import cond\nt = linspace(0, 3, 400)\nA = array([ [sin(t)**2, cos((1+1e-7)*t)**2, 1] for t in t ])\nkappa = cond(A)\nprint(f\"cond(A) is {kappa:.3e}\")","key":"vLjpcgtZMD"},{"type":"output","id":"nguqybLZG0LrYFTyFcJSN","data":[{"output_type":"stream","name":"stdout","text":"cond(A) is 1.825e+07\n"}],"key":"uMGERecYu2"}],"data":{},"key":"mmOr0qDRED"},{"type":"paragraph","position":{"start":{"line":249,"column":1},"end":{"line":249,"column":1}},"children":[{"type":"text","value":"Now we set up an artificial linear least-squares problem with a known exact solution that actually makes the residual zero.","position":{"start":{"line":249,"column":1},"end":{"line":249,"column":1}},"key":"CmLokwB5BH"}],"key":"gfPi8gN3WI"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"x = array([1, 2, 1])\nb = A @ x","key":"H6Iwgu025Y"},{"type":"output","id":"5d-qb62GoLVbyEnw95bNC","data":[],"key":"fJwjyGpdA8"}],"data":{},"key":"PuKD4XnrM1"},{"type":"paragraph","position":{"start":{"line":256,"column":1},"end":{"line":256,"column":1}},"children":[{"type":"text","value":"Using backslash to find the least-squares solution, we get a relative error that is well below ","position":{"start":{"line":256,"column":1},"end":{"line":256,"column":1}},"key":"cp1NB3Uppr"},{"type":"text","value":"κ","position":{"start":{"line":256,"column":1},"end":{"line":256,"column":1}},"key":"jOS51ezZCA"},{"type":"text","value":" times machine epsilon.","position":{"start":{"line":256,"column":1},"end":{"line":256,"column":1}},"key":"RaPoQz47dI"}],"key":"flRaa5MS36"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"from numpy.linalg import lstsq\nx_BS = lstsq(A, b, rcond=None)[0]\nprint(f\"observed error: {norm(x_BS - x) / norm(x):.3e}\")\nprint(f\"conditioning bound: {kappa * finfo(float).eps:.3e}\")","key":"qfFzd2Zjbq"},{"type":"output","id":"ci880I-_wOajgY46EsAmx","data":[{"output_type":"stream","name":"stdout","text":"observed error: 1.490e-11\nconditioning bound: 4.053e-09\n"}],"key":"Sqb6W7hXYe"}],"data":{},"key":"DlnmLYI0Vp"},{"type":"paragraph","position":{"start":{"line":265,"column":1},"end":{"line":265,"column":1}},"children":[{"type":"text","value":"If we formulate and solve via the normal equations, we get a much larger relative error. With ","position":{"start":{"line":265,"column":1},"end":{"line":265,"column":1}},"key":"OzFvj8NNyp"},{"type":"inlineMath","value":"\\kappa^2\\approx 10^{14}","position":{"start":{"line":265,"column":1},"end":{"line":265,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msup><mi>κ</mi><mn>2</mn></msup><mo>≈</mo><mn>1</mn><msup><mn>0</mn><mn>14</mn></msup></mrow><annotation encoding=\"application/x-tex\">\\kappa^2\\approx 10^{14}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8141em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">κ</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">≈</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8141em;\"></span><span class=\"mord\">1</span><span class=\"mord\"><span class=\"mord\">0</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">14</span></span></span></span></span></span></span></span></span></span></span></span>","key":"ZgN86wV9K2"},{"type":"text","value":", we may not be left with more than about 2 accurate digits.","position":{"start":{"line":265,"column":1},"end":{"line":265,"column":1}},"key":"nMYm2PGK4p"}],"key":"l5TaiTNaS9"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"N = A.T @ A\nx_NE = solve(N, A.T @ b)\nrelative_err = norm(x_NE - x) / norm(x)\nprint(f\"observed error: {relative_err:.3e}\")\nprint(f\"accurate digits: {-log10(relative_err):.2f}\")","key":"eButidvgf2"},{"type":"output","id":"AACo2zeOjfEt1tyspmuU3","data":[{"output_type":"stream","name":"stdout","text":"observed error: 2.031e-02\naccurate digits: 1.69\n"}],"key":"HRC3Grl345"}],"data":{},"key":"MBEWQTQk74"}],"label":"demo-normaleqns-instab-python","identifier":"demo-normaleqns-instab-python","html_id":"demo-normaleqns-instab-python","key":"NFP9vr4xFn"},{"type":"heading","depth":3,"position":{"start":{"line":276,"column":1},"end":{"line":276,"column":1}},"children":[{"type":"text","value":"Section 3.3","position":{"start":{"line":276,"column":1},"end":{"line":276,"column":1}},"key":"fdutLsbmlr"}],"identifier":"section-3-3","label":"Section 3.3","html_id":"section-3-3","implicit":true,"key":"Ym0xs7XLb0"},{"type":"details","children":[{"type":"summary","children":[{"type":"abbreviation","title":"orthogonal times upper triangular","children":[{"type":"text","value":"QR","key":"edPTEsiTY6"}],"key":"b6vkrtyUTU"},{"type":"text","value":" factorization","key":"jD8FSgVBwe"}],"key":"lrQOtapjOi"},{"type":"paragraph","position":{"start":{"line":280,"column":1},"end":{"line":280,"column":1}},"children":[{"type":"text","value":"MATLAB provides access to both the thin and full forms of the ","key":"jeV5OajTl2"},{"type":"abbreviation","title":"orthogonal times upper triangular","children":[{"type":"text","value":"QR","key":"jNQ9tABA6r"}],"key":"AfBFLnnmwH"},{"type":"text","value":" factorization.","key":"z8cXWK45CY"}],"key":"IkyRr5UoV9"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"A = 1.0 + floor(9 * random.rand(6,4))\nA.shape","key":"YY4V9PK1A7"},{"type":"output","id":"asgG3Y3uLNs2lOIQCmQAI","data":[{"output_type":"execute_result","execution_count":20,"metadata":{},"data":{"text/plain":{"content":"(6, 4)","content_type":"text/plain"}}}],"key":"pujro9qAP7"}],"data":{},"key":"H5mbnYDAcS"},{"type":"paragraph","position":{"start":{"line":287,"column":1},"end":{"line":287,"column":1}},"children":[{"type":"text","value":"Here is the full form:","position":{"start":{"line":287,"column":1},"end":{"line":287,"column":1}},"key":"AYTh5dGcIO"}],"key":"No8h7kGE0b"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"from numpy.linalg import qr\nQ, R = qr(A, \"complete\")\nprint(f\"size of Q is {Q.shape}\")\nprint(\"R:\")\nprint(R)","key":"eT0eMWiyz9"},{"type":"output","id":"72H1yvz4xZJ7W9soONoNa","data":[{"output_type":"stream","name":"stdout","text":"size of Q is (6, 6)\nR:\n[[-11.18033989  -8.13928744  -8.31817288 -12.07476708]\n [  0.           8.04686274   8.61155487  -0.03479617]\n [  0.           0.          -4.08033366  -2.17130506]\n [  0.           0.           0.          -5.42993771]\n [  0.           0.           0.           0.        ]\n [  0.           0.           0.           0.        ]]\n"}],"key":"OXC1ApQgrc"}],"data":{},"key":"sO9pWFYc0K"},{"type":"paragraph","position":{"start":{"line":297,"column":1},"end":{"line":297,"column":1}},"children":[{"type":"text","value":"We can test that ","position":{"start":{"line":297,"column":1},"end":{"line":297,"column":1}},"key":"d4jxZVAk1f"},{"type":"inlineMath","value":"\\mathbf{Q}","position":{"start":{"line":297,"column":1},"end":{"line":297,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi mathvariant=\"bold\">Q</mi></mrow><annotation encoding=\"application/x-tex\">\\mathbf{Q}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8805em;vertical-align:-0.1944em;\"></span><span class=\"mord mathbf\">Q</span></span></span></span>","key":"rn7GMnv1V4"},{"type":"text","value":" is an orthogonal matrix:","position":{"start":{"line":297,"column":1},"end":{"line":297,"column":1}},"key":"saZHj5Mqeb"}],"key":"QrLWf6w81r"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"print(f\"norm of (Q^T Q - I) is {norm(Q.T @ Q - eye(6)):.3e}\")","key":"RtVScXTBO1"},{"type":"output","id":"zMyUvrT8hVOfxxP7dQZAh","data":[{"output_type":"stream","name":"stdout","text":"norm of (Q^T Q - I) is 4.804e-16\n"}],"key":"dZBUb2eqr5"}],"data":{},"key":"ZExII06WQG"},{"type":"paragraph","position":{"start":{"line":303,"column":1},"end":{"line":303,"column":1}},"children":[{"type":"text","value":"The default for ","position":{"start":{"line":303,"column":1},"end":{"line":303,"column":1}},"key":"Z3BtxJHcDR"},{"type":"inlineCode","value":"qr","position":{"start":{"line":303,"column":1},"end":{"line":303,"column":1}},"key":"Fcn0MqrIIm"},{"type":"text","value":", and the one you usually want, is the thin form.","position":{"start":{"line":303,"column":1},"end":{"line":303,"column":1}},"key":"VRAVUzaalq"}],"key":"qxqCCHNXuV"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"Q_hat, R_hat = qr(A)\nprint(f\"size of Q_hat is {Q_hat.shape}\")\nprint(\"R_hat:\")\nprint(R_hat)","key":"HpUniZMcf6"},{"type":"output","id":"dwv093a_RURkZfvyKRUIW","data":[{"output_type":"stream","name":"stdout","text":"size of Q_hat is (6, 4)\nR_hat:\n[[-11.18033989  -8.13928744  -8.31817288 -12.07476708]\n [  0.           8.04686274   8.61155487  -0.03479617]\n [  0.           0.          -4.08033366  -2.17130506]\n [  0.           0.           0.          -5.42993771]]\n"}],"key":"jpsJRyfhAX"}],"data":{},"key":"pGIdSyEqNX"},{"type":"paragraph","position":{"start":{"line":312,"column":1},"end":{"line":312,"column":1}},"children":[{"type":"text","value":"Now ","position":{"start":{"line":312,"column":1},"end":{"line":312,"column":1}},"key":"hodm3rNIR3"},{"type":"inlineMath","value":"\\hat{\\mathbf{Q}}","position":{"start":{"line":312,"column":1},"end":{"line":312,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mover accent=\"true\"><mi mathvariant=\"bold\">Q</mi><mo>^</mo></mover></mrow><annotation encoding=\"application/x-tex\">\\hat{\\mathbf{Q}}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1.144em;vertical-align:-0.1944em;\"></span><span class=\"mord accent\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.9495em;\"><span style=\"top:-3em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord mathbf\">Q</span></span><span style=\"top:-3.2551em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"accent-body\" style=\"left:-0.1667em;\"><span class=\"mord\">^</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.1944em;\"><span></span></span></span></span></span></span></span></span>","key":"WbQkK0xpWQ"},{"type":"text","value":" cannot be an orthogonal matrix, because it is not square, but it is still ONC. Mathematically, ","position":{"start":{"line":312,"column":1},"end":{"line":312,"column":1}},"key":"RjfkGOn2ql"},{"type":"inlineMath","value":"\\hat{\\mathbf{Q}}^T \\hat{\\mathbf{Q}}","position":{"start":{"line":312,"column":1},"end":{"line":312,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msup><mover accent=\"true\"><mi mathvariant=\"bold\">Q</mi><mo>^</mo></mover><mi>T</mi></msup><mover accent=\"true\"><mi mathvariant=\"bold\">Q</mi><mo>^</mo></mover></mrow><annotation encoding=\"application/x-tex\">\\hat{\\mathbf{Q}}^T \\hat{\\mathbf{Q}}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1.144em;vertical-align:-0.1944em;\"></span><span class=\"mord\"><span class=\"mord accent\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.9495em;\"><span style=\"top:-3em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord mathbf\">Q</span></span><span style=\"top:-3.2551em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"accent-body\" style=\"left:-0.1667em;\"><span class=\"mord\">^</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.1944em;\"><span></span></span></span></span></span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8413em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.13889em;\">T</span></span></span></span></span></span></span></span><span class=\"mord accent\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.9495em;\"><span style=\"top:-3em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord mathbf\">Q</span></span><span style=\"top:-3.2551em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"accent-body\" style=\"left:-0.1667em;\"><span class=\"mord\">^</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.1944em;\"><span></span></span></span></span></span></span></span></span>","key":"jY8aj9NVVF"},{"type":"text","value":" is a ","position":{"start":{"line":312,"column":1},"end":{"line":312,"column":1}},"key":"pjXcCkN34d"},{"type":"inlineMath","value":"4\\times 4","position":{"start":{"line":312,"column":1},"end":{"line":312,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>4</mn><mo>×</mo><mn>4</mn></mrow><annotation encoding=\"application/x-tex\">4\\times 4</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.7278em;vertical-align:-0.0833em;\"></span><span class=\"mord\">4</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">×</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">4</span></span></span></span>","key":"cR6gCeILdT"},{"type":"text","value":" identity matrix.","position":{"start":{"line":312,"column":1},"end":{"line":312,"column":1}},"key":"YO2z5acOAi"}],"key":"pMVhZllxd3"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"print(f\"norm of (Q_hat^T Q_hat - I) is {norm(Q_hat.T @ Q_hat - eye(4)):.3e}\")","key":"mB2y0AEGwU"},{"type":"output","id":"lodm8ZMjI4NNIJL2akLjP","data":[{"output_type":"stream","name":"stdout","text":"norm of (Q_hat^T Q_hat - I) is 4.328e-16\n"}],"key":"cfj0GgJJU8"}],"data":{},"key":"W6NeUp6iJv"}],"label":"demo-qr-qrfact-python","identifier":"demo-qr-qrfact-python","html_id":"demo-qr-qrfact-python","key":"kM6tYB1Tkv"},{"type":"details","children":[{"type":"summary","children":[{"type":"text","value":"Stability of least-squares via ","key":"iLAjh2s5Rl"},{"type":"abbreviation","title":"orthogonal times upper triangular","children":[{"type":"text","value":"QR","key":"V7vT91LeDL"}],"key":"yn1a5PqZ7f"}],"key":"xNwvskbnY8"},{"type":"paragraph","position":{"start":{"line":321,"column":1},"end":{"line":321,"column":1}},"children":[{"type":"text","value":"We’ll repeat the experiment of ","position":{"start":{"line":321,"column":1},"end":{"line":321,"column":1}},"key":"KcmWGVQTVK"},{"type":"crossReference","kind":"proof:example","identifier":"demo-normaleqns-instab","label":"demo-normaleqns-instab","children":[{"type":"text","value":"Demo ","key":"RJ5YwlugkL"},{"type":"text","value":"3.2.1","key":"iarntZQaCB"}],"template":"Example %s","enumerator":"3.2.1","resolved":true,"html_id":"demo-normaleqns-instab","remote":true,"url":"/normaleqns","dataUrl":"/normaleqns.json","key":"VhAKM9lVZE"},{"type":"text","value":", which exposed instability in the normal equations.","position":{"start":{"line":321,"column":1},"end":{"line":321,"column":1}},"key":"vGCoCQypr9"}],"key":"nOZzZ8gJhU"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"t = linspace(0, 3, 400)\nA = array([ [sin(t)**2, cos((1+1e-7)*t)**2, 1] for t in t ])\nx = array([1, 2, 1])\nb = A @ x","key":"QKOsgFwsFS"},{"type":"output","id":"Fgu6vTLEA7v9AkkFx3tOy","data":[],"key":"fAkdXLnFzA"}],"data":{},"key":"DkeSOMkYnB"},{"type":"paragraph","position":{"start":{"line":330,"column":1},"end":{"line":330,"column":1}},"children":[{"type":"text","value":"The error in the solution by ","position":{"start":{"line":330,"column":1},"end":{"line":330,"column":1}},"key":"Vh3TfHJty6"},{"type":"crossReference","kind":"proof:algorithm","identifier":"function-lsqrfact","label":"function-lsqrfact","children":[{"type":"text","value":"Function ","key":"CEMz3G83EU"},{"type":"text","value":"3.3.2","key":"xYOCYBbV66"}],"template":"Algorithm %s","enumerator":"3.3.2","resolved":true,"html_id":"function-lsqrfact","remote":true,"url":"/qr","dataUrl":"/qr.json","key":"uete3TG8Wj"},{"type":"text","value":" is similar to the bound predicted by the condition number.","position":{"start":{"line":330,"column":1},"end":{"line":330,"column":1}},"key":"ImqwrXn4en"}],"key":"rXKG7wjSnk"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"print(f\"observed error: {norm(FNC.lsqrfact(A, b) - x) / norm(x):.3e}\")\nprint(f\"conditioning bound: {cond(A) * finfo(float).eps:.3e}\")","key":"Bw6PaIOhEy"},{"type":"output","id":"itxV_tajxe6E2jzPMiplB","data":[{"output_type":"stream","name":"stdout","text":"observed error: 2.518e-09\nconditioning bound: 4.053e-09\n"}],"key":"NRA8o8LmZy"}],"data":{},"key":"ntCmxHr8xX"}],"label":"demo-qr-stable-python","identifier":"demo-qr-stable-python","html_id":"demo-qr-stable-python","key":"fvdq8mhuWf"},{"type":"heading","depth":3,"position":{"start":{"line":338,"column":1},"end":{"line":338,"column":1}},"children":[{"type":"text","value":"Section 3.4","position":{"start":{"line":338,"column":1},"end":{"line":338,"column":1}},"key":"JAaBdcUymb"}],"identifier":"section-3-4","label":"Section 3.4","html_id":"section-3-4","implicit":true,"key":"O7bmS7Kv3E"},{"type":"details","children":[{"type":"summary","children":[{"type":"text","value":"Householder ","key":"UNuiSf3VgN"},{"type":"abbreviation","title":"orthogonal times upper triangular","children":[{"type":"text","value":"QR","key":"AzAuSl6Wq1"}],"key":"Xg7JjA9sOi"},{"type":"text","value":" factorization","key":"nMqtiqWXc3"}],"key":"Yv3UtDvHRq"},{"type":"paragraph","position":{"start":{"line":342,"column":1},"end":{"line":342,"column":1}},"children":[{"type":"text","value":"We will use Householder reflections to produce a ","key":"uS3qmQJiiR"},{"type":"abbreviation","title":"orthogonal times upper triangular","children":[{"type":"text","value":"QR","key":"ONsQ8DjAwy"}],"key":"XdEmyA9P6r"},{"type":"text","value":" factorization of a matrix.","key":"yG2mcCmFIv"}],"key":"GcuuHahz93"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"A = 1.0 + floor(9 * random.rand(6,4))\nm, n = A.shape\nprint(A)","key":"o334pH1E5W"},{"type":"output","id":"to4LdPb4sjS7XEgN0oMPI","data":[{"output_type":"stream","name":"stdout","text":"[[5. 2. 9. 4.]\n [2. 2. 2. 8.]\n [4. 1. 7. 7.]\n [1. 4. 8. 9.]\n [2. 6. 7. 4.]\n [5. 8. 2. 4.]]\n"}],"key":"rZwslnoJjK"}],"data":{},"key":"ivIK60RPY1"},{"type":"paragraph","position":{"start":{"line":350,"column":1},"end":{"line":350,"column":1}},"children":[{"type":"text","value":"Our first step is to introduce zeros below the diagonal in column 1 by using ","position":{"start":{"line":350,"column":1},"end":{"line":350,"column":1}},"key":"i0o5PbH2Um"},{"type":"crossReference","kind":"equation","identifier":"hhvector","label":"hhvector","children":[{"type":"text","value":"(","key":"ADZZBbLivI"},{"type":"text","value":"3.4.4","key":"jhiuDHViCd"},{"type":"text","value":")","key":"tVwwVTYAQ3"}],"template":"(%s)","enumerator":"3.4.4","resolved":true,"html_id":"hhvector","remote":true,"url":"/house","dataUrl":"/house.json","key":"CGFUeeWUQY"},{"type":"text","value":" and ","position":{"start":{"line":350,"column":1},"end":{"line":350,"column":1}},"key":"HaF1ibXPHu"},{"type":"crossReference","kind":"equation","identifier":"hhreflect","label":"hhreflect","children":[{"type":"text","value":"(","key":"mLCYu4KnkY"},{"type":"text","value":"3.4.1","key":"xwkIGyODSC"},{"type":"text","value":")","key":"fgdutYtN1Q"}],"template":"(%s)","enumerator":"3.4.1","resolved":true,"html_id":"hhreflect","remote":true,"url":"/house","dataUrl":"/house.json","key":"HQWdrIARcr"},{"type":"text","value":".","position":{"start":{"line":350,"column":1},"end":{"line":350,"column":1}},"key":"wy3cW1bUeb"}],"key":"gOOsUK636h"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"z = A[:, 0]\nv = z - norm(z) * hstack([1, zeros(m-1)])\nP_1 = eye(m) - (2 / dot(v, v)) * outer(v, v)   # reflector","key":"bfoIdWPoH8"},{"type":"output","id":"stld0uG14_kcGWPgIUVQ5","data":[],"key":"ZFOrucUll1"}],"data":{},"key":"r4744wcMYt"},{"type":"paragraph","position":{"start":{"line":358,"column":1},"end":{"line":358,"column":1}},"children":[{"type":"text","value":"We check that this reflector introduces zeros as it should:","position":{"start":{"line":358,"column":1},"end":{"line":358,"column":1}},"key":"U7OjqwhROA"}],"key":"vG6Ofhn7gW"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"print(P_1 @ z)","key":"tE74aEpDf0"},{"type":"output","id":"hJr_64WRUds-H2cKsRktl","data":[{"output_type":"stream","name":"stdout","text":"[8.66025404e+00 2.22044605e-16 0.00000000e+00 1.11022302e-16\n 2.22044605e-16 1.33226763e-15]\n"}],"key":"RevB1jiK0W"}],"data":{},"key":"Rplq5Ak88L"},{"type":"paragraph","position":{"start":{"line":364,"column":1},"end":{"line":364,"column":1}},"children":[{"type":"text","value":"Now we replace ","position":{"start":{"line":364,"column":1},"end":{"line":364,"column":1}},"key":"wX6GiinUAn"},{"type":"inlineMath","value":"\\mathbf{A}","position":{"start":{"line":364,"column":1},"end":{"line":364,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi mathvariant=\"bold\">A</mi></mrow><annotation encoding=\"application/x-tex\">\\mathbf{A}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6861em;\"></span><span class=\"mord mathbf\">A</span></span></span></span>","key":"b00csCuwSJ"},{"type":"text","value":" by ","position":{"start":{"line":364,"column":1},"end":{"line":364,"column":1}},"key":"prjrWOuT3k"},{"type":"inlineMath","value":"\\mathbf{P}_1\\mathbf{A}","position":{"start":{"line":364,"column":1},"end":{"line":364,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi mathvariant=\"bold\">P</mi><mn>1</mn></msub><mi mathvariant=\"bold\">A</mi></mrow><annotation encoding=\"application/x-tex\">\\mathbf{P}_1\\mathbf{A}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8361em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathbf\">P</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3011em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">1</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mord mathbf\">A</span></span></span></span>","key":"NFyV6UYm8a"},{"type":"text","value":".","position":{"start":{"line":364,"column":1},"end":{"line":364,"column":1}},"key":"hRTgQ6qdvq"}],"key":"l2vcsBZjHH"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"A = P_1 @ A\nprint(A)","key":"D5wd3NabhN"},{"type":"output","id":"uL6QsagbDP73ZyB41JXQm","data":[{"output_type":"stream","name":"stdout","text":"[[ 8.66025404e+00  8.54478398e+00  1.25862359e+01  1.16624754e+01]\n [ 2.22044605e-16 -1.57613647e+00  4.04442800e-02  3.81314556e+00]\n [ 0.00000000e+00 -6.15227295e+00  3.08088856e+00 -1.37370888e+00]\n [ 1.11022302e-16  2.21193176e+00  7.02022214e+00  6.90657278e+00]\n [ 2.22044605e-16  2.42386353e+00  5.04044428e+00 -1.86854441e-01]\n [ 1.33226763e-15 -9.40341184e-01 -2.89888930e+00 -6.46713610e+00]]\n"}],"key":"gr3lD2c1fo"}],"data":{},"key":"VZoK5BhHnO"},{"type":"paragraph","position":{"start":{"line":371,"column":1},"end":{"line":371,"column":1}},"children":[{"type":"text","value":"We are set to put zeros into column 2. We must not use row 1 in any way, lest it destroy the zeros we just introduced. So we leave it out of the next reflector.","position":{"start":{"line":371,"column":1},"end":{"line":371,"column":1}},"key":"Dxo8fM0bqF"}],"key":"MTYCRaThRl"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"z = A[1:, 1]\nv = z - norm(z) * hstack([1, zeros(m-2)])\nP_2 = eye(m-1) - (2 / dot(v, v)) * outer(v, v)","key":"IvrHkJIjHJ"},{"type":"output","id":"TcjqVxQuXmuzDMk6BY9IW","data":[],"key":"mHAlHIwydH"}],"data":{},"key":"PYce1tg5nG"},{"type":"paragraph","position":{"start":{"line":379,"column":1},"end":{"line":379,"column":1}},"children":[{"type":"text","value":"We now apply this reflector to rows 2 and below only.","position":{"start":{"line":379,"column":1},"end":{"line":379,"column":1}},"key":"CONw2F13fB"}],"key":"YvGDA0xQ8A"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"A[1:, 1:] = P_2 @ A[1:, 1:]\nprint(A)","key":"NksaXXIgK3"},{"type":"output","id":"93_VK6VCVTzR2xdxysJtE","data":[{"output_type":"stream","name":"stdout","text":"[[ 8.66025404e+00  8.54478398e+00  1.25862359e+01  1.16624754e+01]\n [ 2.22044605e-16  7.21017799e+00  1.58849523e+00  3.23801530e+00]\n [ 0.00000000e+00 -7.10805078e-17  4.16485067e+00 -1.77642134e+00]\n [ 1.11022302e-16 -6.34365203e-17  6.63050435e+00  7.05136032e+00]\n [ 2.22044605e-16 -5.17187509e-16  4.61338647e+00 -2.81943734e-02]\n [ 1.33226763e-15  1.11022302e-16 -2.73321164e+00 -6.52868850e+00]]\n"}],"key":"k4oLKETknZ"}],"data":{},"key":"hcsfZIOFjm"},{"type":"paragraph","position":{"start":{"line":386,"column":1},"end":{"line":386,"column":1}},"children":[{"type":"text","value":"We need to iterate the process for the last two columns.","position":{"start":{"line":386,"column":1},"end":{"line":386,"column":1}},"key":"oNFIqN7Wcd"}],"key":"EI7FqeaAs7"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"for j in [2, 3]:\n    z = A[j:, j]\n    v = z - norm(z) * hstack([1, zeros(m-j-1)])\n    P = eye(m-j) - (2 / dot(v, v)) * outer(v, v)\n    A[j:, j:] = P @ A[j:, j:]","key":"h8OMZmFSz9"},{"type":"output","id":"FsB3ncA5ucz9u2G4VqY9x","data":[],"key":"fHYGxE1bPe"}],"data":{},"key":"M1zTskM76S"},{"type":"paragraph","position":{"start":{"line":396,"column":1},"end":{"line":396,"column":1}},"children":[{"type":"text","value":"We have now reduced the original to an upper triangular matrix using four orthogonal Householder reflections:","position":{"start":{"line":396,"column":1},"end":{"line":396,"column":1}},"key":"IyVynnrVwC"}],"key":"p6NVmSSjaI"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"R = triu(A)\nprint(R)","key":"MsNITxfJvt"},{"type":"output","id":"SeCC_bxpuSdLwzyoGqqIG","data":[{"output_type":"stream","name":"stdout","text":"[[ 8.66025404  8.54478398 12.58623587 11.66247544]\n [ 0.          7.21017799  1.58849523  3.2380153 ]\n [ 0.          0.          9.49017121  6.01356501]\n [ 0.          0.          0.          7.70317853]\n [ 0.          0.          0.          0.        ]\n [ 0.          0.          0.          0.        ]]\n"}],"key":"oGpS30dXnW"}],"data":{},"indexEntries":[{"entry":"Python","subEntry":{"value":"triu","kind":"entry"},"emphasis":false}],"label":"index-pSssiDAuMZ","identifier":"index-psssidaumz","html_id":"index-psssidaumz","key":"w8kwBmXFsB"}],"label":"demo-house-qr-python","identifier":"demo-house-qr-python","html_id":"demo-house-qr-python","key":"LpAoJvHME5"}],"key":"w015NHVXon"}],"key":"i3fT0zGZ0A"},"references":{"cite":{"order":[],"data":{}}},"footer":{"navigation":{"prev":{"title":"Chapter 2","url":"/chapter2-2","group":"Python codes"},"next":{"title":"Chapter 4","url":"/chapter4-2","group":"Python codes"}}},"domain":"http://localhost:3000"}