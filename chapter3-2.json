{"version":2,"kind":"Notebook","sha256":"c8b67a1163a9339638ceb857da7bcb4dcc5e90ba2258cb40ef956a67e9f8d3a1","slug":"chapter3-2","location":"/python/chapter3.md","dependencies":[],"frontmatter":{"title":"Chapter 3","numbering":{"heading_1":{"enabled":false},"heading_2":{"enabled":false},"heading_3":{"enabled":false},"heading_4":{"enabled":false},"heading_5":{"enabled":false},"heading_6":{"enabled":false},"title":{"offset":2}},"kernelspec":{"name":"python3","display_name":"Python 3","language":"python"},"content_includes_title":false,"authors":[{"nameParsed":{"literal":"Tobin A. Driscoll","given":"Tobin A.","family":"Driscoll"},"name":"Tobin A. Driscoll","email":"driscoll@udel.edu","id":"contributors-myst-generated-uid-0","corresponding":true},{"nameParsed":{"literal":"Richard J. Braun","given":"Richard J.","family":"Braun"},"name":"Richard J. Braun","id":"contributors-myst-generated-uid-1"}],"github":"https://github.com/fncbook/fnc","math":{"\\float":{"macro":"\\mathbb{F}"},"\\real":{"macro":"\\mathbb{R}"},"\\complex":{"macro":"\\mathbb{C}"},"\\nat":{"macro":"\\mathbb{N}"},"\\integer":{"macro":"\\mathbb{Z}"},"\\rmn":{"macro":"\\mathbb{R}^{#1 \\times #2}"},"\\dd":{"macro":"\\frac{d #1}{d #2}"},"\\ddd":{"macro":"\\frac{d^2 #1}{d #2^2}"},"\\pp":{"macro":"\\frac{\\partial #1}{\\partial #2}"},"\\ppp":{"macro":"\\frac{\\partial^2 #1}{\\partial #2^2}"},"\\ppdd":{"macro":"\\frac{\\partial^2 #1}{\\partial #2 \\partial #3}"},"\\abs":{"macro":"\\left\\lvert #1 \\right\\rvert"},"\\norm":{"macro":"\\left\\lVert #1 \\right\\rVert"},"\\twonorm":{"macro":"\\norm{#1}_2"},"\\onenorm":{"macro":"\\norm{#1}_1"},"\\infnorm":{"macro":"\\norm{#1}_\\infty"},"\\anynorm":{"macro":"\\norm{#1}_#2"},"\\innerprod":{"macro":"\\langle #1,#2 \\rangle"},"\\pr":{"macro":"^{(#1)}"},"\\kron":{"macro":"#1 \\otimes #2"},"\\eye":{"macro":"\\mathbf{e}_#1"},"\\meye":{"macro":"\\mathbf{I}"},"\\Qhat":{"macro":"\\hat{\\mathbf{Q}}"},"\\Rhat":{"macro":"\\hat{\\mathbf{R}}"},"\\bfalpha":{"macro":"\\mathbf{alpha}"},"\\bfdelta":{"macro":"\\mathbf{delta}"},"\\bfzero":{"macro":"\\boldsymbol{0}"},"\\macheps":{"macro":"\\epsilon_\\text{mach}"},"\\fl":{"macro":"\\operatorname{fl}"},"\\diag":{"macro":"\\operatorname{diag}"},"\\ign":{"macro":"\\operatorname{sign}"},"\\Re":{"macro":"\\operatorname{Re}"},"\\Im":{"macro":"\\operatorname{Im}"},"\\ee":{"macro":"\\times 10^"},"\\lnorm":{"macro":"\\|"},"\\rnorm":{"macro":"\\|"},"\\floor":{"macro":"\\lfloor#1\\rfloor"},"\\cI":{"macro":"\\mathcal{I}"},"\\mtx":{"macro":"\\operatorname{mtx}"},"\\myvec":{"macro":"\\operatorname{vec}"},"\\argmin":{"macro":"\\operatorname{argmin}"}},"abbreviations":{"IVP":"initial-value problem","BVP":"boundary-value problem","TPBVP":"two-point boundary-value problem","ONC":"matrix with orthonormal columns","SVD":"singular value decomposition","EVD":"eigenvalue decomposition","SPD":"symmetric positive definite","HPD":"hermitian positive definite","PDE":"partial differential equation","ODE":"ordinary differential equation"},"source_url":"https://github.com/fncbook/fnc/blob/master/python/chapter3.md","edit_url":"https://github.com/fncbook/fnc/edit/master/python/chapter3.md","exports":[{"format":"md","filename":"chapter3.md","url":"/build/chapter3-8238e771b656fbcb3f658c64342f6a20.md"}]},"mdast":{"type":"root","children":[{"type":"block","children":[{"type":"heading","depth":2,"position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"children":[{"type":"text","value":"Functions","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"key":"ZysZhPVQ4m"}],"identifier":"functions","label":"Functions","html_id":"functions","implicit":true,"key":"hARXAqNhHr"},{"type":"details","open":true,"children":[{"type":"summary","children":[{"type":"text","value":"Solution of least squares by the normal equations","position":{"start":{"line":14,"column":1},"end":{"line":14,"column":1}},"key":"pUXaVKSLxL"}],"key":"vsHlOLgeQr"},{"type":"include","file":"fncbook/fncbook/chapter03.py","literal":true,"filter":{"startAt":"def lsnormal(A, b)","endAt":"return"},"children":[{"type":"code","value":"def lsnormal(A, b):\n    \"\"\"\n    lsnormal(A, b)\n    \n    Solve a linear least squares problem by the normal equations. Returns the\n    minimizer of ||b-Ax||.\n    \"\"\"\n    N = A.T @ A\n    z = A.T @ b\n    R = scipy.linalg.cholesky(N)\n    w = forwardsub(R.T, z)                   # solve R'z=c\n    x = backsub(R, w)                        # solve Rx=z\n    return x","lang":"python","showLineNumbers":true,"filename":"lsnormal.py","key":"b2P3p4gQZs"}],"key":"RgIize4PGc"},{"type":"admonition","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"About the code","position":{"start":{"line":23,"column":1},"end":{"line":23,"column":1}},"key":"PSEWDPmNSR"}],"key":"oDW1VmS4qO"},{"type":"paragraph","position":{"start":{"line":25,"column":1},"end":{"line":25,"column":1}},"children":[{"type":"inlineCode","value":"cholesky","position":{"start":{"line":25,"column":1},"end":{"line":25,"column":1}},"key":"OJNzxLD1US"},{"type":"text","value":" is imported from ","position":{"start":{"line":25,"column":1},"end":{"line":25,"column":1}},"key":"OlqNuxrDl7"},{"type":"inlineCode","value":"scipy.linalg","position":{"start":{"line":25,"column":1},"end":{"line":25,"column":1}},"key":"w70AwLnKiX"},{"type":"text","value":".","position":{"start":{"line":25,"column":1},"end":{"line":25,"column":1}},"key":"uib6kkrRgT"}],"key":"kMCjP3aldS"}],"class":"dropdown","key":"PD2x9oKBx3"}],"label":"function-lsnormal-python","identifier":"function-lsnormal-python","html_id":"function-lsnormal-python","key":"Z1PP00v0u7"},{"type":"details","open":true,"children":[{"type":"summary","children":[{"type":"text","value":"Solution of least squares by QR factorization","position":{"start":{"line":30,"column":1},"end":{"line":30,"column":1}},"key":"Hinj4Syc5y"}],"key":"RKs4nx8IID"},{"type":"include","file":"fncbook/fncbook/chapter03.py","literal":true,"filter":{"startAt":"def lsqrfact","endAt":"return"},"children":[{"type":"code","value":"def lsqrfact(A, b):\n    \"\"\"\n    lsqrfact(A, b)\n    \n    Solve a linear least squares problem by QR factorization. Returns the\n    minimizer of ||b-Ax||.\n    \"\"\"\n    Q, R = np.linalg.qr(A)\n    c = Q.T @ b\n    x = backsub(R, c)\n    return x","lang":"python","showLineNumbers":true,"filename":"lsqrfact.py","key":"F11S38Tuaf"}],"key":"mV0l5CwVJu"}],"label":"function-lsqrfact-python","identifier":"function-lsqrfact-python","html_id":"function-lsqrfact-python","key":"pyu7kOOqiM"},{"type":"details","open":true,"children":[{"type":"summary","children":[{"type":"text","value":"QR factorization by Householder reflections","position":{"start":{"line":41,"column":1},"end":{"line":41,"column":1}},"key":"dYqlOd2Nz4"}],"key":"ide9xLob0Z"},{"type":"include","file":"fncbook/fncbook/chapter03.py","literal":true,"filter":{"startAt":"def qrfact","endAt":"return"},"children":[{"type":"code","value":"def qrfact(A):\n    \"\"\"\n        qrfact(A)\n\n    QR factorization by Householder reflections. Returns Q and R.\n    \"\"\"\n    m, n = A.shape\n    Qt = np.eye(m)\n    R = np.copy(A)\n    for k in range(n):\n        z = R[k:, k]\n        w = np.hstack((-np.sign(z[0]) * np.linalg.norm(z) - z[0], -z[1:]))\n        nrmw = np.linalg.norm(w)\n        if nrmw < np.finfo(float).eps: continue    # skip this iteration\n        v = w / nrmw\n        # Apply the reflection to each relevant column of R and Q\n        for j in range(k, n):\n            R[k:, j] -= 2 * np.dot(v, R[k:, j]) * v\n        for j in range(m):\n            Qt[k:, j] -= 2 * np.dot(v, Qt[k:, j]) * v \n    return Qt.T, np.triu(R)","lang":"python","showLineNumbers":true,"filename":"qrfact.py","key":"tpHgXHhDcM"}],"key":"UKA44CYYTd"}],"label":"function-qrfact-python","identifier":"function-qrfact-python","html_id":"function-qrfact-python","key":"RQNTuRXmoD"},{"type":"heading","depth":2,"position":{"start":{"line":51,"column":1},"end":{"line":51,"column":1}},"children":[{"type":"text","value":"Examples","position":{"start":{"line":51,"column":1},"end":{"line":51,"column":1}},"key":"GsOyYAkX98"}],"identifier":"examples","label":"Examples","html_id":"examples","implicit":true,"key":"erb9GvJnsc"}],"key":"gEUYIpsZVY"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"exec(open(\"FNC_init.py\").read())","visibility":"show","key":"HC1KubctBY"},{"type":"output","id":"AIod-aZ0itmtE7_AW5qnq","data":[],"visibility":"show","key":"e8sdDlrtrZ"}],"data":{"tags":[]},"visibility":"remove","key":"UsAvlGoS43"},{"type":"block","children":[{"type":"heading","depth":3,"position":{"start":{"line":58,"column":1},"end":{"line":58,"column":1}},"children":[{"type":"text","value":"3.1 ","position":{"start":{"line":58,"column":1},"end":{"line":58,"column":1}},"key":"hjJzw5fABZ"},{"type":"link","identifier":"section-leastsq-fitting","label":"section-leastsq-fitting","kind":"narrative","position":{"start":{"line":58,"column":5},"end":{"line":58,"column":29}},"url":"/fitting","internal":true,"dataUrl":"/fitting.json","children":[{"type":"text","value":"Fitting functions to data","key":"CCTnZcIUKk"}],"key":"GYFfknuOhm"}],"identifier":"id-3-1","label":"3.1 ","html_id":"id-3-1","implicit":true,"key":"vcWmAjGWlH"},{"type":"details","open":true,"children":[{"type":"summary","children":[{"type":"crossReference","identifier":"demo-fitting-tempinterp","label":"demo-fitting-tempinterp","kind":"proof:example","position":{"start":{"line":60,"column":1},"end":{"line":60,"column":25}},"children":[{"type":"text","value":"Example ","key":"cr1SeJqF9s"},{"type":"text","value":"3.1.1","key":"S4ExHunT4O"}],"template":"Example %s","enumerator":"3.1.1","resolved":true,"html_id":"demo-fitting-tempinterp","remote":true,"url":"/fitting","dataUrl":"/fitting.json","key":"rcS63YXx5i"}],"key":"FtJMssri9H"},{"type":"paragraph","position":{"start":{"line":62,"column":1},"end":{"line":62,"column":1}},"children":[{"type":"text","value":"Here are 5-year averages of the worldwide temperature anomaly as compared to the 1951–1980 average (source: NASA).","position":{"start":{"line":62,"column":1},"end":{"line":62,"column":1}},"key":"tla354dtM2"}],"key":"guOooDa9xq"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"year = arange(1955,2005,5)\ny = array([ -0.0480, -0.0180, -0.0360, -0.0120, -0.0040,\n    0.1180, 0.2100, 0.3320, 0.3340, 0.4560 ])\n\nfig, ax = subplots()\nax.scatter(year, y, color=\"k\", label=\"data\")\nxlabel(\"year\")\nylabel(\"anomaly (degrees C)\")\ntitle(\"World temperature anomaly\");","key":"x6DxxMT1bf"},{"type":"output","id":"UOra6DACOyj2jLMQUU2zM","data":[{"output_type":"display_data","metadata":{},"data":{"text/plain":{"content":"<Figure size 700x400 with 1 Axes>","content_type":"text/plain"},"image/png":{"content_type":"image/png","hash":"6a298e3993b6608335c493ec6238fb9d","path":"/build/6a298e3993b6608335c493ec6238fb9d.png"}}}],"key":"H9QhrqCImK"}],"key":"IoXDUvksXT"},{"type":"paragraph","position":{"start":{"line":76,"column":1},"end":{"line":76,"column":1}},"children":[{"type":"text","value":"A polynomial interpolant can be used to fit the data. Here we build one using a Vandermonde matrix. First, though, we express time as decades since 1950, as it improves the condition number of the matrix.","position":{"start":{"line":76,"column":1},"end":{"line":76,"column":1}},"key":"WfmGfpdGvi"}],"key":"i8XVSmIv66"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"from scipy import linalg\nt = (year - 1950) / 10\nV = vander(t)\nc = linalg.solve(V, y)\nprint(c)","key":"IuKwlQ4T4F"},{"type":"output","id":"9Yb7_F9_8aYnYQGxB3HcH","data":[{"output_type":"stream","name":"stdout","text":"[ 1.03111111e-02 -2.54666667e-01  2.69480635e+00 -1.59628889e+01\n  5.80155778e+01 -1.33273472e+02  1.91960567e+02 -1.65455972e+02\n  7.63617381e+01 -1.41140000e+01]\n"}],"key":"di48UAtFdJ"}],"key":"rxv5A626gK"},{"type":"paragraph","position":{"start":{"line":89,"column":1},"end":{"line":89,"column":1}},"children":[{"type":"text","value":"The coefficients in vector ","position":{"start":{"line":89,"column":1},"end":{"line":89,"column":1}},"key":"x9yEv0ICM8"},{"type":"inlineCode","value":"c","position":{"start":{"line":89,"column":1},"end":{"line":89,"column":1}},"key":"YzgwgIAmTj"},{"type":"text","value":" are used to create a polynomial. Then we create a function that evaluates the polynomial after changing the time variable as we did for the Vandermonde matrix.","position":{"start":{"line":89,"column":1},"end":{"line":89,"column":1}},"key":"DP3I202fat"}],"indexEntries":[{"entry":"Python","subEntry":{"value":"plotting functions","kind":"entry"},"emphasis":false}],"label":"index-U2nHgrFjmF","identifier":"index-u2nhgrfjmf","html_id":"index-u2nhgrfjmf","key":"PQ1z6mV4Fe"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"p = poly1d(c)    # convert to a polynomial\ntt = linspace(1955, 2000, 500)\nax.plot(tt, p((tt - 1950) / 10), label=\"interpolant\")\nax.legend();\nfig","key":"Ak1YiBu6xJ"},{"type":"output","id":"5p0k7XZUSE44Vp1WoKYR8","data":[{"output_type":"execute_result","execution_count":4,"metadata":{},"data":{"text/plain":{"content":"<Figure size 700x400 with 1 Axes>","content_type":"text/plain"},"image/png":{"content_type":"image/png","hash":"7c60816f908ba1e4a69b24717b0c0f2e","path":"/build/7c60816f908ba1e4a69b24717b0c0f2e.png"}}}],"key":"lZk6XAMnxx"}],"key":"Q54X536UyW"},{"type":"paragraph","position":{"start":{"line":99,"column":1},"end":{"line":99,"column":1}},"children":[{"type":"text","value":"As you can see, the interpolant does represent the data, in a sense. However it’s a crazy-looking curve for the application. Trying too hard to reproduce all the data exactly is known as ","position":{"start":{"line":99,"column":1},"end":{"line":99,"column":1}},"key":"e7MRTLE8Kq"},{"type":"emphasis","position":{"start":{"line":99,"column":1},"end":{"line":99,"column":1}},"children":[{"type":"text","value":"overfitting","position":{"start":{"line":99,"column":1},"end":{"line":99,"column":1}},"key":"gQyvXcJQlF"}],"key":"evpOesTsNJ"},{"type":"text","value":".","position":{"start":{"line":99,"column":1},"end":{"line":99,"column":1}},"key":"MuoRXMyxnp"}],"key":"vCwpCL8r7n"}],"label":"demo-fitting-tempinterp-python","identifier":"demo-fitting-tempinterp-python","html_id":"demo-fitting-tempinterp-python","key":"HfbDPzdmQI"},{"type":"details","open":true,"children":[{"type":"summary","children":[{"type":"crossReference","identifier":"demo-fitting-tempfit","label":"demo-fitting-tempfit","kind":"proof:example","position":{"start":{"line":104,"column":1},"end":{"line":104,"column":22}},"children":[{"type":"text","value":"Example ","key":"K3DdLZEBlf"},{"type":"text","value":"3.1.2","key":"uL6JcXdhMw"}],"template":"Example %s","enumerator":"3.1.2","resolved":true,"html_id":"demo-fitting-tempfit","remote":true,"url":"/fitting","dataUrl":"/fitting.json","key":"crt8qGzTlH"}],"key":"zs5dzpEy7q"},{"type":"paragraph","position":{"start":{"line":106,"column":1},"end":{"line":106,"column":1}},"children":[{"type":"text","value":"Here are the 5-year temperature averages again.","position":{"start":{"line":106,"column":1},"end":{"line":106,"column":1}},"key":"Lwvs94JmjP"}],"key":"glVzhDI22P"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"year = arange(1955, 2005, 5)\ny = array([-0.0480, -0.0180, -0.0360, -0.0120, -0.0040,\n    0.1180, 0.2100, 0.3320, 0.3340, 0.4560])\nt = (year - 1950) / 10","key":"Lib3vdZUhj"},{"type":"output","id":"tVzwmizrEJR9zjZZFdUbl","data":[],"key":"ffNDPaHKe2"}],"key":"y98u7uBOOl"},{"type":"paragraph","position":{"start":{"line":116,"column":1},"end":{"line":116,"column":1}},"children":[{"type":"text","value":"The standard best-fit line results from using a linear polynomial that meets the least-squares criterion.","position":{"start":{"line":116,"column":1},"end":{"line":116,"column":1}},"key":"fOcxGcofSF"}],"key":"UUoRV2lpJM"},{"type":"admonition","kind":"tip","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"Tip","key":"Tch6xMJVXW"}],"key":"VmclFcwOaA"},{"type":"paragraph","position":{"start":{"line":119,"column":1},"end":{"line":119,"column":1}},"children":[{"type":"text","value":"Backslash solves overdetermined linear systems in a least-squares sense.","position":{"start":{"line":119,"column":1},"end":{"line":119,"column":1}},"key":"SHzOVFO8dy"}],"key":"A3itEgnEmE"}],"class":"dropdown","key":"RYkdpLfAii"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"V = array([ [t[i], 1] for i in range(t.size) ])    # Vandermonde-ish matrix\nprint(V.shape)","key":"gukLH0SQHe"},{"type":"output","id":"gjclE-LTFb8zqX2qk7noV","data":[{"output_type":"stream","name":"stdout","text":"(10, 2)\n"}],"key":"JKqnJ9DJcq"}],"key":"i5PcjGGtO0"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"from scipy.linalg import lstsq\nc, res, rank, sv = lstsq(V, y)\np = poly1d(c)\nf = lambda year: p((year - 1950) / 10)","key":"DE5MFT7wgS"},{"type":"output","id":"vFW4ilbfGQObeAYWWszom","data":[],"key":"cX5XSHbxIN"}],"indexEntries":[{"entry":"Python","subEntry":{"value":"lstsq","kind":"entry"},"emphasis":true}],"label":"index-u2HxcOE1gF","identifier":"index-u2hxcoe1gf","html_id":"index-u2hxcoe1gf","key":"zxBbH5I555"},{"type":"code","lang":"","value":"\n```{code-cell}\nfig, ax = subplots()\nax.scatter(year, y, color=\"k\", label=\"data\")\nyr = linspace(1955, 2000, 500)\nax.plot(yr, f(yr), label=\"linear fit\")\n\nxlabel(\"year\")\nylabel(\"anomaly (degrees C)\")\ntitle(\"World temperature anomaly\");\nax.legend();","position":{"start":{"line":136,"column":1},"end":{"line":148,"column":1}},"key":"XEtdTsWpTx"},{"type":"paragraph","position":{"start":{"line":150,"column":1},"end":{"line":150,"column":1}},"children":[{"type":"text","value":"If we use a global cubic polynomial, the points are fit more closely.","position":{"start":{"line":150,"column":1},"end":{"line":150,"column":1}},"key":"mDyxx4OrY7"}],"key":"Nbmk1aEiyW"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"V = array([ [t[i]**3,t[i]**2,t[i],1] for i in range(t.size) ])    # Vandermonde-ish matrix\nprint(V.shape)","key":"RL68aZhLDK"},{"type":"output","id":"o2kdrvdwYeUsui5QyrIGG","data":[{"output_type":"stream","name":"stdout","text":"(10, 4)\n"}],"key":"BIXiRaSSct"}],"key":"nPmKLTZb9M"},{"type":"paragraph","position":{"start":{"line":157,"column":1},"end":{"line":157,"column":1}},"children":[{"type":"text","value":"Now we solve the new least-squares problem to redefine the fitting polynomial.","position":{"start":{"line":157,"column":1},"end":{"line":157,"column":1}},"key":"nrHIChzYKN"}],"key":"pGWLqFSwvv"},{"type":"admonition","kind":"tip","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"Tip","key":"rEKodZ5Uth"}],"key":"NssN4wIodX"},{"type":"paragraph","position":{"start":{"line":160,"column":1},"end":{"line":160,"column":1}},"children":[{"type":"text","value":"The definition of ","position":{"start":{"line":160,"column":1},"end":{"line":160,"column":1}},"key":"UjO4JEHv4s"},{"type":"inlineCode","value":"f","position":{"start":{"line":160,"column":1},"end":{"line":160,"column":1}},"key":"qIOj6KrpAU"},{"type":"text","value":" above is in terms of ","position":{"start":{"line":160,"column":1},"end":{"line":160,"column":1}},"key":"nWZDtwSP2Z"},{"type":"inlineCode","value":"c","position":{"start":{"line":160,"column":1},"end":{"line":160,"column":1}},"key":"OvxO4n1N8Q"},{"type":"text","value":". When ","position":{"start":{"line":160,"column":1},"end":{"line":160,"column":1}},"key":"B2vEGpPI1p"},{"type":"inlineCode","value":"c","position":{"start":{"line":160,"column":1},"end":{"line":160,"column":1}},"key":"iuJUeJIJWk"},{"type":"text","value":" is changed, ","position":{"start":{"line":160,"column":1},"end":{"line":160,"column":1}},"key":"XFjdrOa0GS"},{"type":"inlineCode","value":"f","position":{"start":{"line":160,"column":1},"end":{"line":160,"column":1}},"key":"TqioiiZtn6"},{"type":"text","value":" is updated with it.","position":{"start":{"line":160,"column":1},"end":{"line":160,"column":1}},"key":"Jb9nZpIWbw"}],"key":"y7GZrf1gdd"}],"class":"dropdown","key":"PiEvAz43wp"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"c, res, rank, sv = lstsq(V, y)\nyr = linspace(1955, 2000, 500)\nax.plot(yr, f(yr), label=\"cubic fit\")\nfig","key":"BpbqZdYrOj"},{"type":"output","id":"BeSfJBrkl96Vxv-SBIR7v","data":[{"output_type":"execute_result","execution_count":9,"metadata":{},"data":{"text/plain":{"content":"<Figure size 700x400 with 1 Axes>","content_type":"text/plain"},"image/png":{"content_type":"image/png","hash":"03b6417db32f1f1421a6c05e1ea553a2","path":"/build/03b6417db32f1f1421a6c05e1ea553a2.png"}}}],"key":"gI1QJXc87i"}],"key":"L2EsqmFOrh"},{"type":"paragraph","position":{"start":{"line":170,"column":1},"end":{"line":170,"column":1}},"children":[{"type":"text","value":"If we were to continue increasing the degree of the polynomial, the residual at the data points would get smaller, but overfitting would increase.","position":{"start":{"line":170,"column":1},"end":{"line":170,"column":1}},"key":"vj5sB63oDs"}],"key":"gCrfiCoK3l"}],"label":"demo-fitting-tempfit-python","identifier":"demo-fitting-tempfit-python","html_id":"demo-fitting-tempfit-python","key":"Cuel1tmNZS"},{"type":"details","open":true,"children":[{"type":"summary","children":[{"type":"crossReference","identifier":"demo-fitting-pirate","label":"demo-fitting-pirate","kind":"proof:example","position":{"start":{"line":174,"column":1},"end":{"line":174,"column":21}},"children":[{"type":"text","value":"Example ","key":"OzrZd5UscW"},{"type":"text","value":"3.1.3","key":"B6lI255KF9"}],"template":"Example %s","enumerator":"3.1.3","resolved":true,"html_id":"demo-fitting-pirate","remote":true,"url":"/fitting","dataUrl":"/fitting.json","key":"cjEYUCGRki"}],"key":"hxny3h9nFL"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"a = array([1 / (k+1)**2 for k in range(100)])\ns = cumsum(a)        # cumulative summation\np = sqrt(6*s)\n\nplot(range(100), p, \"o\")\nxlabel(\"$k$\") \nylabel(\"$p_k$\") \ntitle(\"Sequence convergence\");","key":"CdHtI9hyTN"},{"type":"output","id":"PqFtRuerK0QV7TatencvO","data":[{"output_type":"display_data","metadata":{},"data":{"text/plain":{"content":"<Figure size 700x400 with 1 Axes>","content_type":"text/plain"},"image/png":{"content_type":"image/png","hash":"62587dd62ae583045d95bc367c0cd9de","path":"/build/62587dd62ae583045d95bc367c0cd9de.png"}}}],"key":"Ycn4RIijl4"}],"key":"IqJE7DvEwc"},{"type":"paragraph","position":{"start":{"line":187,"column":1},"end":{"line":187,"column":1}},"children":[{"type":"text","value":"This graph suggests that maybe ","position":{"start":{"line":187,"column":1},"end":{"line":187,"column":1}},"key":"er3Vldz0ts"},{"type":"inlineMath","value":"p_k\\to \\pi","position":{"start":{"line":187,"column":1},"end":{"line":187,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>p</mi><mi>k</mi></msub><mo>→</mo><mi>π</mi></mrow><annotation encoding=\"application/x-tex\">p_k\\to \\pi</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.625em;vertical-align:-0.1944em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">p</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3361em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03148em;\">k</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">→</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">π</span></span></span></span>","key":"ZrtRUi11vb"},{"type":"text","value":", but it’s far from clear how close the sequence gets. It’s more informative to plot the sequence of errors, ","position":{"start":{"line":187,"column":1},"end":{"line":187,"column":1}},"key":"hNbTFIg5CG"},{"type":"inlineMath","value":"\\epsilon_k= |\\pi-p_k|","position":{"start":{"line":187,"column":1},"end":{"line":187,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>ϵ</mi><mi>k</mi></msub><mo>=</mo><mi mathvariant=\"normal\">∣</mi><mi>π</mi><mo>−</mo><msub><mi>p</mi><mi>k</mi></msub><mi mathvariant=\"normal\">∣</mi></mrow><annotation encoding=\"application/x-tex\">\\epsilon_k= |\\pi-p_k|</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.5806em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">ϵ</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3361em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03148em;\">k</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord\">∣</span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">π</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">p</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3361em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03148em;\">k</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mord\">∣</span></span></span></span>","key":"Yr4w9APZpK"},{"type":"text","value":". By plotting the error sequence on a log-log scale, we can see a nearly linear relationship.","position":{"start":{"line":187,"column":1},"end":{"line":187,"column":1}},"key":"kf7aGbLfyn"}],"key":"peDFY7KV8n"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"ep = abs(pi - p)    # error sequence\nloglog(range(100), ep, \"o\")\nxlabel(\"$k$\") \nylabel(\"error\") \ntitle(\"Sequence convergence\");","key":"AZctWdjLpw"},{"type":"output","id":"BixsUf-sv4vvPiibhCHCZ","data":[{"output_type":"display_data","metadata":{},"data":{"text/plain":{"content":"<Figure size 700x400 with 1 Axes>","content_type":"text/plain"},"image/png":{"content_type":"image/png","hash":"5d9e6a6d52e82bddeafa0c467b257574","path":"/build/5d9e6a6d52e82bddeafa0c467b257574.png"}}}],"key":"PP6hoACoat"}],"key":"GK16BVaMau"},{"type":"paragraph","position":{"start":{"line":197,"column":1},"end":{"line":197,"column":1}},"children":[{"type":"text","value":"The straight line on the log-log scale suggests a power-law relationship where ","position":{"start":{"line":197,"column":1},"end":{"line":197,"column":1}},"key":"qm0R1fk2AU"},{"type":"inlineMath","value":"\\epsilon_k\\approx a k^b","position":{"start":{"line":197,"column":1},"end":{"line":197,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>ϵ</mi><mi>k</mi></msub><mo>≈</mo><mi>a</mi><msup><mi>k</mi><mi>b</mi></msup></mrow><annotation encoding=\"application/x-tex\">\\epsilon_k\\approx a k^b</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6331em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">ϵ</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3361em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03148em;\">k</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">≈</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8491em;\"></span><span class=\"mord mathnormal\">a</span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.03148em;\">k</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8491em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">b</span></span></span></span></span></span></span></span></span></span></span>","key":"tQcgHNg9A3"},{"type":"text","value":", or ","position":{"start":{"line":197,"column":1},"end":{"line":197,"column":1}},"key":"SgwRaXNNeD"},{"type":"inlineMath","value":"\\log \\epsilon_k \\approx b (\\log k) + \\log a","position":{"start":{"line":197,"column":1},"end":{"line":197,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>log</mi><mo>⁡</mo><msub><mi>ϵ</mi><mi>k</mi></msub><mo>≈</mo><mi>b</mi><mo stretchy=\"false\">(</mo><mi>log</mi><mo>⁡</mo><mi>k</mi><mo stretchy=\"false\">)</mo><mo>+</mo><mi>log</mi><mo>⁡</mo><mi>a</mi></mrow><annotation encoding=\"application/x-tex\">\\log \\epsilon_k \\approx b (\\log k) + \\log a</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8889em;vertical-align:-0.1944em;\"></span><span class=\"mop\">lo<span style=\"margin-right:0.01389em;\">g</span></span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">ϵ</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3361em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03148em;\">k</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">≈</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\">b</span><span class=\"mopen\">(</span><span class=\"mop\">lo<span style=\"margin-right:0.01389em;\">g</span></span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03148em;\">k</span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8889em;vertical-align:-0.1944em;\"></span><span class=\"mop\">lo<span style=\"margin-right:0.01389em;\">g</span></span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord mathnormal\">a</span></span></span></span>","key":"JspaNSDDxz"},{"type":"text","value":".","position":{"start":{"line":197,"column":1},"end":{"line":197,"column":1}},"key":"TsElxtvt9O"}],"key":"UV6NgbFPfr"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"V = array([ [1, log(k+1)] for k in range(100) ])     # fitting matrix\nc = lstsq(V, log(ep))[0]           # coefficients of linear fit\nprint(c)","key":"YP1uDL7EmL"},{"type":"output","id":"j0FWz0yqwt024JMcQyY4V","data":[{"output_type":"stream","name":"stdout","text":"[-0.18237525 -0.96741032]\n"}],"key":"h6FHj8dSPx"}],"key":"as6PGrCui1"},{"type":"paragraph","position":{"start":{"line":205,"column":1},"end":{"line":205,"column":1}},"children":[{"type":"text","value":"In terms of the parameters ","position":{"start":{"line":205,"column":1},"end":{"line":205,"column":1}},"key":"wUi02k5vIB"},{"type":"inlineMath","value":"a","position":{"start":{"line":205,"column":1},"end":{"line":205,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>a</mi></mrow><annotation encoding=\"application/x-tex\">a</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">a</span></span></span></span>","key":"m6DfFO5ZR0"},{"type":"text","value":" and ","position":{"start":{"line":205,"column":1},"end":{"line":205,"column":1}},"key":"YDbgehZF9Q"},{"type":"inlineMath","value":"b","position":{"start":{"line":205,"column":1},"end":{"line":205,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>b</mi></mrow><annotation encoding=\"application/x-tex\">b</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6944em;\"></span><span class=\"mord mathnormal\">b</span></span></span></span>","key":"xJP3uVoLEW"},{"type":"text","value":" used above, we have","position":{"start":{"line":205,"column":1},"end":{"line":205,"column":1}},"key":"X8Iwt2e5yN"}],"key":"TejUzwxAyk"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"a, b = exp(c[0]), c[1]\nprint(f\"b: {b:.3f}\")","key":"jxmhrPpZOj"},{"type":"output","id":"GWUFMyfa7OSygGNgocR1Y","data":[{"output_type":"stream","name":"stdout","text":"b: -0.967\n"}],"key":"JcDMKyFmtu"}],"key":"Yc7fq1PrN4"},{"type":"paragraph","position":{"start":{"line":212,"column":1},"end":{"line":212,"column":1}},"children":[{"type":"text","value":"It’s tempting to conjecture that the slope ","position":{"start":{"line":212,"column":1},"end":{"line":212,"column":1}},"key":"gklWReHLos"},{"type":"inlineMath","value":"b\\to -1","position":{"start":{"line":212,"column":1},"end":{"line":212,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>b</mi><mo>→</mo><mo>−</mo><mn>1</mn></mrow><annotation encoding=\"application/x-tex\">b\\to -1</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6944em;\"></span><span class=\"mord mathnormal\">b</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">→</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.7278em;vertical-align:-0.0833em;\"></span><span class=\"mord\">−</span><span class=\"mord\">1</span></span></span></span>","key":"BNMUuF5Kud"},{"type":"text","value":" asymptotically. Here is how the numerical fit compares to the original convergence curve.","position":{"start":{"line":212,"column":1},"end":{"line":212,"column":1}},"key":"Bld3WDQUhF"}],"key":"tDj3j17Stx"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"loglog(range(100), ep, \"o\", label=\"sequence\")\nk = arange(1,100)\nplot(k, a*k**b, \"--\", label=\"power fit\")\nxlabel(\"$k$\");  ylabel(\"error\"); \nlegend(); title(\"Sequence convergence\");","key":"doMYhhvsY5"},{"type":"output","id":"-cSBw-q1hSxQEsc9N2-Ks","data":[{"output_type":"display_data","metadata":{},"data":{"text/plain":{"content":"<Figure size 700x400 with 1 Axes>","content_type":"text/plain"},"image/png":{"content_type":"image/png","hash":"b7240fc2b0eaaf60fc8bb59b60ac7dd9","path":"/build/b7240fc2b0eaaf60fc8bb59b60ac7dd9.png"}}}],"key":"jtMPRZILfE"}],"key":"o3NDPQ6bmS"}],"label":"demo-fitting-pirate-python","identifier":"demo-fitting-pirate-python","html_id":"demo-fitting-pirate-python","key":"u5R0quxZW8"},{"type":"heading","depth":3,"position":{"start":{"line":223,"column":1},"end":{"line":223,"column":1}},"children":[{"type":"text","value":"3.2 ","position":{"start":{"line":223,"column":1},"end":{"line":223,"column":1}},"key":"GoOlPApE2i"},{"type":"link","identifier":"section-leastsq-normaleqns","label":"section-leastsq-normaleqns","kind":"narrative","position":{"start":{"line":223,"column":5},"end":{"line":223,"column":32}},"url":"/normaleqns","internal":true,"dataUrl":"/normaleqns.json","children":[{"type":"text","value":"The normal equations","key":"QJ8QscwSDi"}],"key":"metmHjo4oD"}],"identifier":"id-3-2","label":"3.2 ","html_id":"id-3-2","implicit":true,"key":"lb1drvCJJQ"},{"type":"details","open":true,"children":[{"type":"summary","children":[{"type":"crossReference","identifier":"demo-normaleqns-instab","label":"demo-normaleqns-instab","kind":"proof:example","position":{"start":{"line":226,"column":1},"end":{"line":226,"column":24}},"children":[{"type":"text","value":"Example ","key":"bSwHsqBI3W"},{"type":"text","value":"3.2.1","key":"pP956nxpIu"}],"template":"Example %s","enumerator":"3.2.1","resolved":true,"html_id":"demo-normaleqns-instab","remote":true,"url":"/normaleqns","dataUrl":"/normaleqns.json","key":"paBSYvicr3"}],"key":"tJkHgLgmox"},{"type":"paragraph","position":{"start":{"line":229,"column":1},"end":{"line":229,"column":1}},"children":[{"type":"text","value":"Because the functions ","position":{"start":{"line":229,"column":1},"end":{"line":229,"column":1}},"key":"F2aqqSGZi6"},{"type":"inlineMath","value":"\\sin^2(t)","position":{"start":{"line":229,"column":1},"end":{"line":229,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msup><mrow><mi>sin</mi><mo>⁡</mo></mrow><mn>2</mn></msup><mo stretchy=\"false\">(</mo><mi>t</mi><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">\\sin^2(t)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1.1219em;vertical-align:-0.25em;\"></span><span class=\"mop\"><span class=\"mop\">sin</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8719em;\"><span style=\"top:-3.1208em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span></span></span></span></span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">t</span><span class=\"mclose\">)</span></span></span></span>","key":"SQ6iRjr0lL"},{"type":"text","value":", ","position":{"start":{"line":229,"column":1},"end":{"line":229,"column":1}},"key":"doKUpPMC6N"},{"type":"inlineMath","value":"\\cos^2(t)","position":{"start":{"line":229,"column":1},"end":{"line":229,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msup><mrow><mi>cos</mi><mo>⁡</mo></mrow><mn>2</mn></msup><mo stretchy=\"false\">(</mo><mi>t</mi><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">\\cos^2(t)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1.0641em;vertical-align:-0.25em;\"></span><span class=\"mop\"><span class=\"mop\">cos</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span></span></span></span></span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">t</span><span class=\"mclose\">)</span></span></span></span>","key":"HOk5HcqcCU"},{"type":"text","value":", and ","position":{"start":{"line":229,"column":1},"end":{"line":229,"column":1}},"key":"FwSPM8CEHs"},{"type":"text","value":"1","position":{"start":{"line":229,"column":1},"end":{"line":229,"column":1}},"key":"WabRBXe8nf"},{"type":"text","value":" are linearly dependent, we should find that the following matrix is somewhat ill-conditioned.","position":{"start":{"line":229,"column":1},"end":{"line":229,"column":1}},"key":"h1jF682JvF"}],"key":"JuBB3h8HtB"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"from numpy.linalg import cond\nt = linspace(0, 3, 400)\nA = array([ [sin(t)**2, cos((1+1e-7)*t)**2, 1] for t in t ])\nkappa = cond(A)\nprint(f\"cond(A) is {kappa:.3e}\")","key":"R8dBL8dDT0"},{"type":"output","id":"Z5DyrP1ufjiZaNSE_Roxx","data":[{"output_type":"stream","name":"stdout","text":"cond(A) is 1.825e+07\n"}],"key":"ViV6BFl8hg"}],"key":"dBDs5PWWyt"},{"type":"paragraph","position":{"start":{"line":239,"column":1},"end":{"line":239,"column":1}},"children":[{"type":"text","value":"Now we set up an artificial linear least-squares problem with a known exact solution that actually makes the residual zero.","position":{"start":{"line":239,"column":1},"end":{"line":239,"column":1}},"key":"ufL5yyoP3B"}],"key":"R56xQLr4hQ"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"x = array([1, 2, 1])\nb = A @ x","key":"BlFTSNbFGG"},{"type":"output","id":"XlzNn0HDC9SIj0KwGOIvl","data":[],"key":"MHBpPOHzCC"}],"key":"SnlIdICuEI"},{"type":"paragraph","position":{"start":{"line":246,"column":1},"end":{"line":246,"column":1}},"children":[{"type":"text","value":"Using backslash to find the least-squares solution, we get a relative error that is well below ","position":{"start":{"line":246,"column":1},"end":{"line":246,"column":1}},"key":"MY4tnuIccC"},{"type":"inlineMath","value":"\\kappa","position":{"start":{"line":246,"column":1},"end":{"line":246,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>κ</mi></mrow><annotation encoding=\"application/x-tex\">\\kappa</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">κ</span></span></span></span>","key":"gnmgGChZNQ"},{"type":"text","value":" times machine epsilon.","position":{"start":{"line":246,"column":1},"end":{"line":246,"column":1}},"key":"yHrIf4Al2s"}],"key":"BnU4L81L24"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"from scipy.linalg import lstsq\nx_BS = lstsq(A, b)[0]\nprint(f\"observed error: {norm(x_BS - x) / norm(x):.3e}\")\nprint(f\"conditioning bound: {kappa * finfo(float).eps:.3e}\")","key":"aPUdRs1QA1"},{"type":"output","id":"_IFkhiFZeGj7xxbrBv_9N","data":[{"output_type":"stream","name":"stdout","text":"observed error: 2.019e-10\nconditioning bound: 4.053e-09\n"}],"key":"LKsSyDSJLL"}],"key":"G5IYhjrd4P"},{"type":"paragraph","position":{"start":{"line":255,"column":1},"end":{"line":255,"column":1}},"children":[{"type":"text","value":"If we formulate and solve via the normal equations, we get a much larger relative error. With ","position":{"start":{"line":255,"column":1},"end":{"line":255,"column":1}},"key":"BXQtFmUSqj"},{"type":"inlineMath","value":"\\kappa^2\\approx 10^{14}","position":{"start":{"line":255,"column":1},"end":{"line":255,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msup><mi>κ</mi><mn>2</mn></msup><mo>≈</mo><mn>1</mn><msup><mn>0</mn><mn>14</mn></msup></mrow><annotation encoding=\"application/x-tex\">\\kappa^2\\approx 10^{14}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8141em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">κ</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">≈</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8141em;\"></span><span class=\"mord\">1</span><span class=\"mord\"><span class=\"mord\">0</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">14</span></span></span></span></span></span></span></span></span></span></span></span>","key":"bwZBeA2WBm"},{"type":"text","value":", we may not be left with more than about 2 accurate digits.","position":{"start":{"line":255,"column":1},"end":{"line":255,"column":1}},"key":"HV0r8BZecj"}],"key":"WR5IPFZM4F"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"from scipy import linalg\nN = A.T @ A\nx_NE = linalg.solve(N, A.T @ b)\nrelative_err = norm(x_NE - x) / norm(x)\nprint(f\"observed error: {relative_err:.3e}\")\nprint(f\"accurate digits: {-log10(relative_err):.2f}\")","key":"WwlO3gxmQg"},{"type":"output","id":"mF0TuFoe9DjCz6U1QMmMc","data":[{"output_type":"stream","name":"stdout","text":"observed error: 5.991e-02\naccurate digits: 1.22\n"}],"key":"sN3nr8kzcK"}],"key":"bjVzyGIofZ"}],"label":"demo-normaleqns-instab-python","identifier":"demo-normaleqns-instab-python","html_id":"demo-normaleqns-instab-python","key":"QJZev2RfEt"},{"type":"heading","depth":3,"position":{"start":{"line":267,"column":1},"end":{"line":267,"column":1}},"children":[{"type":"text","value":"3.3 ","position":{"start":{"line":267,"column":1},"end":{"line":267,"column":1}},"key":"wPic1KXFAJ"},{"type":"link","identifier":"section-leastsq-qr","label":"section-leastsq-qr","kind":"narrative","position":{"start":{"line":267,"column":5},"end":{"line":267,"column":24}},"url":"/qr","internal":true,"dataUrl":"/qr.json","children":[{"type":"text","value":"The QR factorization","key":"kdfnjPkPWh"}],"key":"n5TnE0zBL8"}],"identifier":"id-3-3","label":"3.3 ","html_id":"id-3-3","implicit":true,"key":"cr5JFJFqLe"},{"type":"details","open":true,"children":[{"type":"summary","children":[{"type":"crossReference","identifier":"demo-qr-qrfact","label":"demo-qr-qrfact","kind":"proof:example","position":{"start":{"line":269,"column":1},"end":{"line":269,"column":16}},"children":[{"type":"text","value":"Example ","key":"HNbb7nFEDN"},{"type":"text","value":"3.3.1","key":"HAAD1BHTmI"}],"template":"Example %s","enumerator":"3.3.1","resolved":true,"html_id":"demo-qr-qrfact","remote":true,"url":"/qr","dataUrl":"/qr.json","key":"ptPmJngj1C"}],"key":"LnhPIc9Qqy"},{"type":"paragraph","position":{"start":{"line":272,"column":1},"end":{"line":272,"column":1}},"children":[{"type":"text","value":"NumPy provides access to both the thin and full forms of the QR factorization.","position":{"start":{"line":272,"column":1},"end":{"line":272,"column":1}},"key":"qnp5dHYvPV"}],"key":"AJXhxTzjuJ"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"A = 1.0 + floor(9 * random.rand(6,4))\nA.shape","key":"K9e7Zr6c2O"},{"type":"output","id":"9RSb05eJBObK5D0G8nNlF","data":[{"output_type":"execute_result","execution_count":19,"metadata":{},"data":{"text/plain":{"content":"(6, 4)","content_type":"text/plain"}}}],"key":"ANZpVz8Fa4"}],"key":"fUSbwYQEx8"},{"type":"paragraph","position":{"start":{"line":279,"column":1},"end":{"line":279,"column":1}},"children":[{"type":"text","value":"Here is the full form:","position":{"start":{"line":279,"column":1},"end":{"line":279,"column":1}},"key":"lImiR1YB8c"}],"key":"JVz7ZAGKMu"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"from numpy.linalg import qr\nQ, R = qr(A, \"complete\")\nprint(f\"size of Q is {Q.shape}\")\nprint(\"R:\")\nprint(R)","key":"E3paXFDl7g"},{"type":"output","id":"L-zoVXDSctvYNlkeoTbNM","data":[{"output_type":"stream","name":"stdout","text":"size of Q is (6, 6)\nR:\n[[-13.7113092   -5.61580217 -10.72107688  -8.02257453]\n [  0.          -8.27422298  -6.25950658 -10.26643936]\n [  0.           0.          -5.3737406   -6.4622615 ]\n [  0.           0.           0.           3.387875  ]\n [  0.           0.           0.           0.        ]\n [  0.           0.           0.           0.        ]]\n"}],"key":"EXtMQXIkiN"}],"key":"gAWcSXt5ye"},{"type":"paragraph","position":{"start":{"line":289,"column":1},"end":{"line":289,"column":1}},"children":[{"type":"text","value":"We can test that ","position":{"start":{"line":289,"column":1},"end":{"line":289,"column":1}},"key":"fpxKtBlp3G"},{"type":"inlineMath","value":"\\mathbf{Q}","position":{"start":{"line":289,"column":1},"end":{"line":289,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi mathvariant=\"bold\">Q</mi></mrow><annotation encoding=\"application/x-tex\">\\mathbf{Q}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8805em;vertical-align:-0.1944em;\"></span><span class=\"mord mathbf\">Q</span></span></span></span>","key":"FggRYq7BFK"},{"type":"text","value":" is an orthogonal matrix:","position":{"start":{"line":289,"column":1},"end":{"line":289,"column":1}},"key":"mTKvdieiUZ"}],"key":"K7sa69QlCv"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"print(f\"norm of (Q^T Q - I) is {norm(Q.T @ Q - eye(6)):.3e}\")","key":"AccqxstPTZ"},{"type":"output","id":"czy0i_107wpu3MHrkjYvO","data":[{"output_type":"stream","name":"stdout","text":"norm of (Q^T Q - I) is 6.171e-16\n"}],"key":"N5Wza55F1E"}],"key":"TceA8mkX2Z"},{"type":"paragraph","position":{"start":{"line":295,"column":1},"end":{"line":295,"column":1}},"children":[{"type":"text","value":"The default for ","position":{"start":{"line":295,"column":1},"end":{"line":295,"column":1}},"key":"CFTVVn25ns"},{"type":"inlineCode","value":"qr","position":{"start":{"line":295,"column":1},"end":{"line":295,"column":1}},"key":"rZTX9NPzc7"},{"type":"text","value":", and the one you usually want, is the thin form.","position":{"start":{"line":295,"column":1},"end":{"line":295,"column":1}},"key":"GMaHdLmXgt"}],"key":"v4skWeWl5A"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"Q_hat, R_hat = qr(A)\nprint(f\"size of Q_hat is {Q_hat.shape}\")\nprint(\"R_hat:\")\nprint(R_hat)","key":"xrpTcKRGS1"},{"type":"output","id":"FK2Hys6GjJZ132aFhU4lq","data":[{"output_type":"stream","name":"stdout","text":"size of Q_hat is (6, 4)\nR_hat:\n[[-13.7113092   -5.61580217 -10.72107688  -8.02257453]\n [  0.          -8.27422298  -6.25950658 -10.26643936]\n [  0.           0.          -5.3737406   -6.4622615 ]\n [  0.           0.           0.           3.387875  ]]\n"}],"key":"MnCvEaxEgQ"}],"key":"NUFnVUOYqU"},{"type":"paragraph","position":{"start":{"line":304,"column":1},"end":{"line":304,"column":1}},"children":[{"type":"text","value":"Now ","position":{"start":{"line":304,"column":1},"end":{"line":304,"column":1}},"key":"bHGnApbYLA"},{"type":"inlineMath","value":"\\hat{\\mathbf{Q}}","position":{"start":{"line":304,"column":1},"end":{"line":304,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mover accent=\"true\"><mi mathvariant=\"bold\">Q</mi><mo>^</mo></mover></mrow><annotation encoding=\"application/x-tex\">\\hat{\\mathbf{Q}}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1.144em;vertical-align:-0.1944em;\"></span><span class=\"mord accent\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.9495em;\"><span style=\"top:-3em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord mathbf\">Q</span></span><span style=\"top:-3.2551em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"accent-body\" style=\"left:-0.1667em;\"><span class=\"mord\">^</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.1944em;\"><span></span></span></span></span></span></span></span></span>","key":"h3VlE66lCR"},{"type":"text","value":" cannot be an orthogonal matrix, because it is not square, but it is still ","key":"StvmI8gEkd"},{"type":"abbreviation","title":"matrix with orthonormal columns","children":[{"type":"text","value":"ONC","key":"lyAXKuW8lR"}],"key":"y35iXKQg02"},{"type":"text","value":". Mathematically, ","key":"yhIyaCtyMr"},{"type":"inlineMath","value":"\\hat{\\mathbf{Q}}^T \\hat{\\mathbf{Q}}","position":{"start":{"line":304,"column":1},"end":{"line":304,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msup><mover accent=\"true\"><mi mathvariant=\"bold\">Q</mi><mo>^</mo></mover><mi>T</mi></msup><mover accent=\"true\"><mi mathvariant=\"bold\">Q</mi><mo>^</mo></mover></mrow><annotation encoding=\"application/x-tex\">\\hat{\\mathbf{Q}}^T \\hat{\\mathbf{Q}}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1.144em;vertical-align:-0.1944em;\"></span><span class=\"mord\"><span class=\"mord accent\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.9495em;\"><span style=\"top:-3em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord mathbf\">Q</span></span><span style=\"top:-3.2551em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"accent-body\" style=\"left:-0.1667em;\"><span class=\"mord\">^</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.1944em;\"><span></span></span></span></span></span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8413em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.13889em;\">T</span></span></span></span></span></span></span></span><span class=\"mord accent\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.9495em;\"><span style=\"top:-3em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord mathbf\">Q</span></span><span style=\"top:-3.2551em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"accent-body\" style=\"left:-0.1667em;\"><span class=\"mord\">^</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.1944em;\"><span></span></span></span></span></span></span></span></span>","key":"yzoKD53ShR"},{"type":"text","value":" is a ","position":{"start":{"line":304,"column":1},"end":{"line":304,"column":1}},"key":"QxJSBrofmI"},{"type":"inlineMath","value":"4\\times 4","position":{"start":{"line":304,"column":1},"end":{"line":304,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>4</mn><mo>×</mo><mn>4</mn></mrow><annotation encoding=\"application/x-tex\">4\\times 4</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.7278em;vertical-align:-0.0833em;\"></span><span class=\"mord\">4</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">×</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">4</span></span></span></span>","key":"sQbAOXOBIR"},{"type":"text","value":" identity matrix.","position":{"start":{"line":304,"column":1},"end":{"line":304,"column":1}},"key":"AWicBMnxlU"}],"key":"L5d7FbO0TQ"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"print(f\"norm of (Q_hat^T Q_hat - I) is {norm(Q_hat.T @ Q_hat - eye(4)):.3e}\")","key":"fDsSfCwkOk"},{"type":"output","id":"X2Md-jM1E1DNf2yD-AJLX","data":[{"output_type":"stream","name":"stdout","text":"norm of (Q_hat^T Q_hat - I) is 3.387e-16\n"}],"key":"fQtR71gB3C"}],"key":"goWFjNcOn7"}],"label":"demo-qr-qrfact-python","identifier":"demo-qr-qrfact-python","html_id":"demo-qr-qrfact-python","key":"ozAPdNdl0Z"},{"type":"details","open":true,"children":[{"type":"summary","children":[{"type":"crossReference","identifier":"demo-qr-stable","label":"demo-qr-stable","kind":"proof:example","position":{"start":{"line":312,"column":1},"end":{"line":312,"column":16}},"children":[{"type":"text","value":"Example ","key":"ha5F6DHEJh"},{"type":"text","value":"3.3.2","key":"THrHf3YzUb"}],"template":"Example %s","enumerator":"3.3.2","resolved":true,"html_id":"demo-qr-stable","remote":true,"url":"/qr","dataUrl":"/qr.json","key":"xNqsIeqjeA"}],"key":"siwEVaqRUL"},{"type":"paragraph","position":{"start":{"line":314,"column":1},"end":{"line":314,"column":1}},"children":[{"type":"text","value":"We’ll repeat the experiment of ","position":{"start":{"line":314,"column":1},"end":{"line":314,"column":1}},"key":"QwZyIUoU5Z"},{"type":"crossReference","identifier":"demo-normaleqns-instab","label":"demo-normaleqns-instab","kind":"proof:example","position":{"start":{"line":314,"column":32},"end":{"line":314,"column":55}},"children":[{"type":"text","value":"Example ","key":"i3cia7kqSg"},{"type":"text","value":"3.2.1","key":"Sa7Wjzejh7"}],"template":"Example %s","enumerator":"3.2.1","resolved":true,"html_id":"demo-normaleqns-instab","remote":true,"url":"/normaleqns","dataUrl":"/normaleqns.json","key":"kq5A8DRDGV"},{"type":"text","value":", which exposed instability in the normal equations.","position":{"start":{"line":314,"column":1},"end":{"line":314,"column":1}},"key":"BFV0VQxF0s"}],"key":"d6cXgqnecP"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"t = linspace(0, 3, 400)\nA = array([ [sin(t)**2, cos((1+1e-7)*t)**2, 1] for t in t ])\nx = array([1, 2, 1])\nb = A @ x","key":"Ks5rUr8uYi"},{"type":"output","id":"Mjgi-iXdJuoB4PyOX1x3Q","data":[],"key":"G241mQiydt"}],"key":"XDP3uy6WNb"},{"type":"paragraph","position":{"start":{"line":323,"column":1},"end":{"line":323,"column":1}},"children":[{"type":"text","value":"The error in the solution by ","position":{"start":{"line":323,"column":1},"end":{"line":323,"column":1}},"key":"n1mNPBgoS9"},{"type":"crossReference","kind":"proof:algorithm","identifier":"function-lsqrfact","label":"function-lsqrfact","children":[{"type":"text","value":"Function ","key":"yaYYmA8QdE"},{"type":"text","value":"3.3.2","key":"thT3gOkHwA"}],"template":"Algorithm %s","enumerator":"3.3.2","resolved":true,"html_id":"function-lsqrfact","remote":true,"url":"/qr","dataUrl":"/qr.json","key":"elJ9xL0NXc"},{"type":"text","value":" is similar to the bound predicted by the condition number.","position":{"start":{"line":323,"column":1},"end":{"line":323,"column":1}},"key":"nppu644DVy"}],"key":"xNLRHe02An"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"print(f\"observed error: {norm(FNC.lsqrfact(A, b) - x) / norm(x):.3e}\")\nprint(f\"conditioning bound: {cond(A) * finfo(float).eps:.3e}\")","key":"PuuEE3014y"},{"type":"output","id":"TeQwddE47T5HqT9kLqJO6","data":[{"output_type":"stream","name":"stdout","text":"observed error: 5.186e-09\nconditioning bound: 4.053e-09\n"}],"key":"mSyPYkyjRP"}],"key":"xCOSrmpzBB"}],"label":"demo-qr-stable-python","identifier":"demo-qr-stable-python","html_id":"demo-qr-stable-python","key":"yriRTY2fIl"},{"type":"heading","depth":3,"position":{"start":{"line":331,"column":1},"end":{"line":331,"column":1}},"children":[{"type":"text","value":"3.4 ","position":{"start":{"line":331,"column":1},"end":{"line":331,"column":1}},"key":"Mplyz3xYaX"},{"type":"link","identifier":"section-leastsq-house","label":"section-leastsq-house","kind":"narrative","position":{"start":{"line":331,"column":5},"end":{"line":331,"column":27}},"url":"/house","internal":true,"dataUrl":"/house.json","children":[{"type":"text","value":"Computing QR factorizations","key":"AqXAX97iOq"}],"key":"FJeENdLbqi"}],"identifier":"id-3-4","label":"3.4 ","html_id":"id-3-4","implicit":true,"key":"y4UE8kA2et"},{"type":"details","open":true,"children":[{"type":"summary","children":[{"type":"crossReference","identifier":"demo-house-qr","label":"demo-house-qr","kind":"proof:example","position":{"start":{"line":333,"column":1},"end":{"line":333,"column":15}},"children":[{"type":"text","value":"Example ","key":"Nhn5G4Tezy"},{"type":"text","value":"3.4.1","key":"UuTzNLFOpL"}],"template":"Example %s","enumerator":"3.4.1","resolved":true,"html_id":"demo-house-qr","remote":true,"url":"/house","dataUrl":"/house.json","key":"LCHqO4ND7f"}],"key":"l4O2VdJAmd"},{"type":"paragraph","position":{"start":{"line":336,"column":1},"end":{"line":336,"column":1}},"children":[{"type":"text","value":"We will use Householder reflections to produce a QR factorization of a matrix.","position":{"start":{"line":336,"column":1},"end":{"line":336,"column":1}},"key":"o1fNuDLit3"}],"key":"MowjWCowhU"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"A = 1.0 + floor(9 * random.rand(6,4))\nm, n = A.shape\nprint(A)","key":"kx66MKEIpn"},{"type":"output","id":"FZ0nBcjAKHR-ue8JkTm8r","data":[{"output_type":"stream","name":"stdout","text":"[[6. 4. 4. 6.]\n [5. 9. 3. 4.]\n [2. 1. 3. 5.]\n [8. 3. 3. 5.]\n [3. 7. 6. 4.]\n [4. 1. 8. 4.]]\n"}],"key":"qG6aQKPiSo"}],"key":"Ztnd15FDdG"},{"type":"paragraph","position":{"start":{"line":344,"column":1},"end":{"line":344,"column":1}},"children":[{"type":"text","value":"Our first step is to introduce zeros below the diagonal in column 1 by using ","position":{"start":{"line":344,"column":1},"end":{"line":344,"column":1}},"key":"Y0Iu0lZOkv"},{"type":"crossReference","kind":"equation","identifier":"hhvector","label":"hhvector","children":[{"type":"text","value":"(","key":"bsmEZFyINz"},{"type":"text","value":"3.4.4","key":"ZyLngXm8RP"},{"type":"text","value":")","key":"FizEBbSXaS"}],"template":"(%s)","enumerator":"3.4.4","resolved":true,"html_id":"hhvector","remote":true,"url":"/house","dataUrl":"/house.json","key":"dOEe8fZOZp"},{"type":"text","value":" and ","position":{"start":{"line":344,"column":1},"end":{"line":344,"column":1}},"key":"zbIG5wsS6P"},{"type":"crossReference","kind":"equation","identifier":"hhreflect","label":"hhreflect","children":[{"type":"text","value":"(","key":"QjA4iIpEyb"},{"type":"text","value":"3.4.1","key":"lduvzGL1Xx"},{"type":"text","value":")","key":"blwfTPmZ3n"}],"template":"(%s)","enumerator":"3.4.1","resolved":true,"html_id":"hhreflect","remote":true,"url":"/house","dataUrl":"/house.json","key":"eL0e2YDChP"},{"type":"text","value":".","position":{"start":{"line":344,"column":1},"end":{"line":344,"column":1}},"key":"MPExiK9iQR"}],"key":"M1QuR3Q0P7"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"z = A[:, 0]\nv = z - norm(z) * hstack([1, zeros(m-1)])\nP_1 = eye(m) - (2 / dot(v, v)) * outer(v, v)   # reflector","key":"S1wlnduG1L"},{"type":"output","id":"krBiblNxKiFbocKqLRmO4","data":[],"key":"zM2nmZlLge"}],"key":"sU5Wn30j4h"},{"type":"paragraph","position":{"start":{"line":352,"column":1},"end":{"line":352,"column":1}},"children":[{"type":"text","value":"We check that this reflector introduces zeros as it should:","position":{"start":{"line":352,"column":1},"end":{"line":352,"column":1}},"key":"zNlfE9ronh"}],"key":"o5qGteqoJ3"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"print(P_1 @ z)","key":"qkvdbsN4QS"},{"type":"output","id":"L8EmoQvarwJr126SDz70p","data":[{"output_type":"stream","name":"stdout","text":"[ 1.24096736e+01 -4.44089210e-16 -3.33066907e-16 -4.44089210e-16\n -1.11022302e-16  0.00000000e+00]\n"}],"key":"eeywotLmYg"}],"key":"UbsbR6nwCk"},{"type":"paragraph","position":{"start":{"line":358,"column":1},"end":{"line":358,"column":1}},"children":[{"type":"text","value":"Now we replace ","position":{"start":{"line":358,"column":1},"end":{"line":358,"column":1}},"key":"WSzrnhoi4b"},{"type":"inlineMath","value":"\\mathbf{A}","position":{"start":{"line":358,"column":1},"end":{"line":358,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi mathvariant=\"bold\">A</mi></mrow><annotation encoding=\"application/x-tex\">\\mathbf{A}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6861em;\"></span><span class=\"mord mathbf\">A</span></span></span></span>","key":"A42PyY5ASj"},{"type":"text","value":" by ","position":{"start":{"line":358,"column":1},"end":{"line":358,"column":1}},"key":"ggNfPnn7TK"},{"type":"inlineMath","value":"\\mathbf{P}_1\\mathbf{A}","position":{"start":{"line":358,"column":1},"end":{"line":358,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi mathvariant=\"bold\">P</mi><mn>1</mn></msub><mi mathvariant=\"bold\">A</mi></mrow><annotation encoding=\"application/x-tex\">\\mathbf{P}_1\\mathbf{A}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8361em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathbf\">P</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3011em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">1</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mord mathbf\">A</span></span></span></span>","key":"UjCj3UtLeJ"},{"type":"text","value":".","position":{"start":{"line":358,"column":1},"end":{"line":358,"column":1}},"key":"ikD0q72yoC"}],"key":"sWbm1RY4cg"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"A = P_1 @ A\nprint(A)","key":"kUsXGtaAsL"},{"type":"output","id":"0fAEFPP1Kje_bWWxCNhoD","data":[{"output_type":"stream","name":"stdout","text":"[[ 1.24096736e+01  9.66987557e+00  9.58929327e+00  1.07980277e+01]\n [-4.44089210e-16  4.57709497e+00 -1.36004513e+00  2.57198117e-01]\n [-3.33066907e-16 -7.69162014e-01  1.25598195e+00  3.50287925e+00]\n [-4.44089210e-16 -4.07664806e+00 -3.97607221e+00 -9.88483012e-01]\n [-1.11022302e-16  4.34625698e+00  3.38397292e+00  1.75431887e+00]\n [ 0.00000000e+00 -2.53832403e+00  4.51196390e+00  1.00575849e+00]]\n"}],"key":"vfxuBiHKnO"}],"key":"iyMkRR94WO"},{"type":"paragraph","position":{"start":{"line":365,"column":1},"end":{"line":365,"column":1}},"children":[{"type":"text","value":"We are set to put zeros into column 2. We must not use row 1 in any way, lest it destroy the zeros we just introduced. So we leave it out of the next reflector.","position":{"start":{"line":365,"column":1},"end":{"line":365,"column":1}},"key":"zQHkh119A3"}],"key":"OPa4wBRi6P"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"z = A[1:, 1]\nv = z - norm(z) * hstack([1, zeros(m-2)])\nP_2 = eye(m-1) - (2 / dot(v, v)) * outer(v, v)","key":"jMm82aoUgh"},{"type":"output","id":"rxlPs4IwiX52m-O799OHB","data":[],"key":"TZrF2xa627"}],"key":"rrgHc1Q4n0"},{"type":"paragraph","position":{"start":{"line":373,"column":1},"end":{"line":373,"column":1}},"children":[{"type":"text","value":"We now apply this reflector to rows 2 and below only.","position":{"start":{"line":373,"column":1},"end":{"line":373,"column":1}},"key":"DIUJL6yEea"}],"key":"QpMLhL7R4q"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"A[1:, 1:] = P_2 @ A[1:, 1:]\nprint(A)","key":"svGLjMuDPw"},{"type":"output","id":"vGBUmx7L8XhcxM--nfoX3","data":[{"output_type":"stream","name":"stdout","text":"[[ 1.24096736e+01  9.66987557e+00  9.58929327e+00  1.07980277e+01]\n [-4.44089210e-16  7.96828128e+00  1.54019755e+00  9.51825785e-01]\n [-3.33066907e-16  3.07198988e-16  1.91379202e+00  3.66042919e+00]\n [-4.44089210e-16  1.23380363e-15 -4.89602405e-01 -1.53449996e-01]\n [-1.11022302e-16 -9.48115471e-16 -3.33074392e-01  8.64060986e-01]\n [ 0.00000000e+00  7.56056118e-16  6.68281356e+00  1.52569162e+00]]\n"}],"key":"MRHv3xgIZ8"}],"key":"H6qqzGeY7W"},{"type":"paragraph","position":{"start":{"line":380,"column":1},"end":{"line":380,"column":1}},"children":[{"type":"text","value":"We need to iterate the process for the last two columns.","position":{"start":{"line":380,"column":1},"end":{"line":380,"column":1}},"key":"Rqgbzgxulh"}],"key":"OB6fs1Uxqc"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"for j in [2, 3]:\n    z = A[j:, j]\n    v = z - norm(z) * hstack([1, zeros(m-j-1)])\n    P = eye(m-j) - (2 / dot(v, v)) * outer(v, v)\n    A[j:, j:] = P @ A[j:, j:]","key":"XIpE4QPNNp"},{"type":"output","id":"d-CNLDcDuvTET52h__fvO","data":[],"key":"uPl7836p3C"}],"key":"MW8WNlgeft"},{"type":"paragraph","position":{"start":{"line":390,"column":1},"end":{"line":390,"column":1}},"children":[{"type":"text","value":"We have now reduced the original to an upper triangular matrix using four orthogonal Householder reflections:","position":{"start":{"line":390,"column":1},"end":{"line":390,"column":1}},"key":"IbbncCNwj2"}],"key":"yDNOOZR5mB"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"R = triu(A)\nprint(R)","key":"TkYkmGXRFC"},{"type":"output","id":"ZhSbH-wfhJePLk8Nx-tNJ","data":[{"output_type":"stream","name":"stdout","text":"[[12.40967365  9.66987557  9.58929327 10.79802772]\n [ 0.          7.96828128  1.54019755  0.95182579]\n [ 0.          0.          6.97662139  2.43506774]\n [ 0.          0.          0.          3.25070303]\n [ 0.          0.          0.          0.        ]\n [ 0.          0.          0.          0.        ]]\n"}],"key":"GDaM3f4n1E"}],"indexEntries":[{"entry":"Python","subEntry":{"value":"triu","kind":"entry"},"emphasis":false}],"label":"index-FdhZ1ceceR","identifier":"index-fdhz1cecer","html_id":"index-fdhz1cecer","key":"Pc31C7R9Oo"}],"label":"demo-house-qr-python","identifier":"demo-house-qr-python","html_id":"demo-house-qr-python","key":"DJmffyEATr"}],"key":"KARpOThhJj"}],"key":"j3ORQDh4tQ"},"references":{"cite":{"order":[],"data":{}}},"footer":{"navigation":{"prev":{"title":"Chapter 2","url":"/chapter2-2","group":"Python codes"},"next":{"title":"Chapter 4","url":"/chapter4-2","group":"Python codes"}}},"domain":"http://localhost:3000"}