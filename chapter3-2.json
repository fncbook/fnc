{"version":2,"kind":"Notebook","sha256":"c8b67a1163a9339638ceb857da7bcb4dcc5e90ba2258cb40ef956a67e9f8d3a1","slug":"chapter3-2","location":"/python/chapter3.md","dependencies":[],"frontmatter":{"title":"Chapter 3","numbering":{"heading_1":{"enabled":false},"heading_2":{"enabled":false},"heading_3":{"enabled":false},"heading_4":{"enabled":false},"heading_5":{"enabled":false},"heading_6":{"enabled":false},"title":{"offset":2}},"kernelspec":{"name":"python3","display_name":"Python 3","language":"python"},"content_includes_title":false,"authors":[{"nameParsed":{"literal":"Tobin A. Driscoll","given":"Tobin A.","family":"Driscoll"},"name":"Tobin A. Driscoll","email":"driscoll@udel.edu","id":"contributors-myst-generated-uid-0","corresponding":true},{"nameParsed":{"literal":"Richard J. Braun","given":"Richard J.","family":"Braun"},"name":"Richard J. Braun","id":"contributors-myst-generated-uid-1"}],"github":"https://github.com/fncbook/fnc","math":{"\\float":{"macro":"\\mathbb{F}"},"\\real":{"macro":"\\mathbb{R}"},"\\complex":{"macro":"\\mathbb{C}"},"\\nat":{"macro":"\\mathbb{N}"},"\\integer":{"macro":"\\mathbb{Z}"},"\\rmn":{"macro":"\\mathbb{R}^{#1 \\times #2}"},"\\dd":{"macro":"\\frac{d #1}{d #2}"},"\\ddd":{"macro":"\\frac{d^2 #1}{d #2^2}"},"\\pp":{"macro":"\\frac{\\partial #1}{\\partial #2}"},"\\ppp":{"macro":"\\frac{\\partial^2 #1}{\\partial #2^2}"},"\\ppdd":{"macro":"\\frac{\\partial^2 #1}{\\partial #2 \\partial #3}"},"\\abs":{"macro":"\\left\\lvert #1 \\right\\rvert"},"\\norm":{"macro":"\\left\\lVert #1 \\right\\rVert"},"\\twonorm":{"macro":"\\norm{#1}_2"},"\\onenorm":{"macro":"\\norm{#1}_1"},"\\infnorm":{"macro":"\\norm{#1}_\\infty"},"\\anynorm":{"macro":"\\norm{#1}_#2"},"\\innerprod":{"macro":"\\langle #1,#2 \\rangle"},"\\pr":{"macro":"^{(#1)}"},"\\kron":{"macro":"#1 \\otimes #2"},"\\eye":{"macro":"\\mathbf{e}_#1"},"\\meye":{"macro":"\\mathbf{I}"},"\\Qhat":{"macro":"\\hat{\\mathbf{Q}}"},"\\Rhat":{"macro":"\\hat{\\mathbf{R}}"},"\\bfalpha":{"macro":"\\mathbf{alpha}"},"\\bfdelta":{"macro":"\\mathbf{delta}"},"\\bfzero":{"macro":"\\boldsymbol{0}"},"\\macheps":{"macro":"\\epsilon_\\text{mach}"},"\\fl":{"macro":"\\operatorname{fl}"},"\\diag":{"macro":"\\operatorname{diag}"},"\\ign":{"macro":"\\operatorname{sign}"},"\\Re":{"macro":"\\operatorname{Re}"},"\\Im":{"macro":"\\operatorname{Im}"},"\\ee":{"macro":"\\times 10^"},"\\lnorm":{"macro":"\\|"},"\\rnorm":{"macro":"\\|"},"\\floor":{"macro":"\\lfloor#1\\rfloor"},"\\cI":{"macro":"\\mathcal{I}"},"\\mtx":{"macro":"\\operatorname{mtx}"},"\\myvec":{"macro":"\\operatorname{vec}"},"\\argmin":{"macro":"\\operatorname{argmin}"}},"abbreviations":{"IVP":"initial-value problem","BVP":"boundary-value problem","TPBVP":"two-point boundary-value problem","ONC":"matrix with orthonormal columns","SVD":"singular value decomposition","EVD":"eigenvalue decomposition","SPD":"symmetric positive definite","HPD":"hermitian positive definite","PDE":"partial differential equation","ODE":"ordinary differential equation"},"edit_url":"https://github.com/fncbook/fnc/blob/master/python/chapter3.md","exports":[{"format":"md","filename":"chapter3.md","url":"/build/chapter3-8238e771b656fbcb3f658c64342f6a20.md"}]},"mdast":{"type":"root","children":[{"type":"block","children":[{"type":"heading","depth":2,"position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"children":[{"type":"text","value":"Functions","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"key":"T3ye07QzPM"}],"identifier":"functions","label":"Functions","html_id":"functions","implicit":true,"key":"TJqgXHG69e"},{"type":"details","open":true,"children":[{"type":"summary","children":[{"type":"text","value":"Solution of least squares by the normal equations","position":{"start":{"line":14,"column":1},"end":{"line":14,"column":1}},"key":"lT2HgW6x7J"}],"key":"rUqQXuxGVX"},{"type":"include","file":"fncbook/fncbook/chapter03.py","literal":true,"filter":{"startAt":"def lsnormal(A, b)","endAt":"return"},"children":[{"type":"code","value":"def lsnormal(A, b):\n    \"\"\"\n    lsnormal(A, b)\n    \n    Solve a linear least squares problem by the normal equations. Returns the\n    minimizer of ||b-Ax||.\n    \"\"\"\n    N = A.T @ A\n    z = A.T @ b\n    R = scipy.linalg.cholesky(N)\n    w = forwardsub(R.T, z)                   # solve R'z=c\n    x = backsub(R, w)                        # solve Rx=z\n    return x","lang":"python","showLineNumbers":true,"filename":"lsnormal.py","key":"nD4ySvx9uI"}],"key":"vkJeHFrtKK"},{"type":"admonition","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"About the code","position":{"start":{"line":23,"column":1},"end":{"line":23,"column":1}},"key":"eIgQ4IfUi6"}],"key":"EhGrrEvLBS"},{"type":"paragraph","position":{"start":{"line":25,"column":1},"end":{"line":25,"column":1}},"children":[{"type":"inlineCode","value":"cholesky","position":{"start":{"line":25,"column":1},"end":{"line":25,"column":1}},"key":"nxpb0YuCLW"},{"type":"text","value":" is imported from ","position":{"start":{"line":25,"column":1},"end":{"line":25,"column":1}},"key":"hV5Bm7tQK5"},{"type":"inlineCode","value":"scipy.linalg","position":{"start":{"line":25,"column":1},"end":{"line":25,"column":1}},"key":"W4a9vGnKrr"},{"type":"text","value":".","position":{"start":{"line":25,"column":1},"end":{"line":25,"column":1}},"key":"oSKq6p3qYS"}],"key":"wwj2XhzSYT"}],"class":"dropdown","key":"PmJI5MEpjq"}],"label":"function-lsnormal-python","identifier":"function-lsnormal-python","html_id":"function-lsnormal-python","key":"yBA8KzzOqN"},{"type":"details","open":true,"children":[{"type":"summary","children":[{"type":"text","value":"Solution of least squares by QR factorization","position":{"start":{"line":30,"column":1},"end":{"line":30,"column":1}},"key":"jkhWHcWSiK"}],"key":"uzIlbcRVJX"},{"type":"include","file":"fncbook/fncbook/chapter03.py","literal":true,"filter":{"startAt":"def lsqrfact","endAt":"return"},"children":[{"type":"code","value":"def lsqrfact(A, b):\n    \"\"\"\n    lsqrfact(A, b)\n    \n    Solve a linear least squares problem by QR factorization. Returns the\n    minimizer of ||b-Ax||.\n    \"\"\"\n    Q, R = np.linalg.qr(A)\n    c = Q.T @ b\n    x = backsub(R, c)\n    return x","lang":"python","showLineNumbers":true,"filename":"lsqrfact.py","key":"zYP6COzIGO"}],"key":"JN6ETBvYUJ"}],"label":"function-lsqrfact-python","identifier":"function-lsqrfact-python","html_id":"function-lsqrfact-python","key":"E9qxOYKab2"},{"type":"details","open":true,"children":[{"type":"summary","children":[{"type":"text","value":"QR factorization by Householder reflections","position":{"start":{"line":41,"column":1},"end":{"line":41,"column":1}},"key":"UlmdD2s67h"}],"key":"LsdWvxnai1"},{"type":"include","file":"fncbook/fncbook/chapter03.py","literal":true,"filter":{"startAt":"def qrfact","endAt":"return"},"children":[{"type":"code","value":"def qrfact(A):\n    \"\"\"\n        qrfact(A)\n\n    QR factorization by Householder reflections. Returns Q and R.\n    \"\"\"\n    m, n = A.shape\n    Qt = np.eye(m)\n    R = np.copy(A)\n    for k in range(n):\n        z = R[k:, k]\n        w = np.hstack((-np.sign(z[0]) * np.linalg.norm(z) - z[0], -z[1:]))\n        nrmw = np.linalg.norm(w)\n        if nrmw < np.finfo(float).eps: continue    # skip this iteration\n        v = w / nrmw\n        # Apply the reflection to each relevant column of R and Q\n        for j in range(k, n):\n            R[k:, j] -= 2 * np.dot(v, R[k:, j]) * v\n        for j in range(m):\n            Qt[k:, j] -= 2 * np.dot(v, Qt[k:, j]) * v \n    return Qt.T, np.triu(R)","lang":"python","showLineNumbers":true,"filename":"qrfact.py","key":"XDrymuolCu"}],"key":"Gw9cZ3W8ER"}],"label":"function-qrfact-python","identifier":"function-qrfact-python","html_id":"function-qrfact-python","key":"EIOG6DjHbQ"},{"type":"heading","depth":2,"position":{"start":{"line":51,"column":1},"end":{"line":51,"column":1}},"children":[{"type":"text","value":"Examples","position":{"start":{"line":51,"column":1},"end":{"line":51,"column":1}},"key":"Ocm597fL9z"}],"identifier":"examples","label":"Examples","html_id":"examples","implicit":true,"key":"xISRoQhMwx"}],"key":"xUfzXPQ2i4"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"exec(open(\"FNC_init.py\").read())","visibility":"show","key":"Wr8qt7JBPZ"},{"type":"output","id":"_hAxVgtYZiyVBw7qFCXX2","data":[],"visibility":"show","key":"ZOwuaeS3Tu"}],"data":{"tags":[]},"visibility":"remove","key":"nhwo3rSJwz"},{"type":"block","children":[{"type":"heading","depth":3,"position":{"start":{"line":58,"column":1},"end":{"line":58,"column":1}},"children":[{"type":"text","value":"3.1 ","position":{"start":{"line":58,"column":1},"end":{"line":58,"column":1}},"key":"zBXAXIYdNR"},{"type":"link","identifier":"section-leastsq-fitting","label":"section-leastsq-fitting","kind":"narrative","position":{"start":{"line":58,"column":5},"end":{"line":58,"column":29}},"url":"/fitting","internal":true,"dataUrl":"/fitting.json","children":[{"type":"text","value":"Fitting functions to data","key":"QiHqCPXOZe"}],"key":"sgWzQoLXMI"}],"identifier":"id-3-1","label":"3.1 ","html_id":"id-3-1","implicit":true,"key":"abLtMw4iTP"},{"type":"details","open":true,"children":[{"type":"summary","children":[{"type":"crossReference","identifier":"demo-fitting-tempinterp","label":"demo-fitting-tempinterp","kind":"proof:example","position":{"start":{"line":60,"column":1},"end":{"line":60,"column":25}},"children":[{"type":"text","value":"Example ","key":"K7OmBdVv25"},{"type":"text","value":"3.1.1","key":"OFmmtnMKWf"}],"template":"Example %s","enumerator":"3.1.1","resolved":true,"html_id":"demo-fitting-tempinterp","remote":true,"url":"/fitting","dataUrl":"/fitting.json","key":"TlNvwgEoN4"}],"key":"Uv5DzuTcWI"},{"type":"paragraph","position":{"start":{"line":62,"column":1},"end":{"line":62,"column":1}},"children":[{"type":"text","value":"Here are 5-year averages of the worldwide temperature anomaly as compared to the 1951–1980 average (source: NASA).","position":{"start":{"line":62,"column":1},"end":{"line":62,"column":1}},"key":"sFCWncasdg"}],"key":"g0K3i3TR2G"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"year = arange(1955,2005,5)\ny = array([ -0.0480, -0.0180, -0.0360, -0.0120, -0.0040,\n    0.1180, 0.2100, 0.3320, 0.3340, 0.4560 ])\n\nfig, ax = subplots()\nax.scatter(year, y, color=\"k\", label=\"data\")\nxlabel(\"year\")\nylabel(\"anomaly (degrees C)\")\ntitle(\"World temperature anomaly\");","key":"bm1h6DCmSW"},{"type":"output","id":"c6mqHsLCsrZdjr1nsLO_h","data":[{"output_type":"display_data","metadata":{},"data":{"text/plain":{"content":"<Figure size 700x400 with 1 Axes>","content_type":"text/plain"},"image/png":{"content_type":"image/png","hash":"6a298e3993b6608335c493ec6238fb9d","path":"/build/6a298e3993b6608335c493ec6238fb9d.png"}}}],"key":"qODKf0GPQW"}],"key":"Dl9MB7gkcY"},{"type":"paragraph","position":{"start":{"line":76,"column":1},"end":{"line":76,"column":1}},"children":[{"type":"text","value":"A polynomial interpolant can be used to fit the data. Here we build one using a Vandermonde matrix. First, though, we express time as decades since 1950, as it improves the condition number of the matrix.","position":{"start":{"line":76,"column":1},"end":{"line":76,"column":1}},"key":"Rt1H0IgPRq"}],"key":"RYcDLWQo59"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"from scipy import linalg\nt = (year - 1950) / 10\nV = vander(t)\nc = linalg.solve(V, y)\nprint(c)","key":"DoTznSCIGc"},{"type":"output","id":"DVZteKFKwPVhSWTEqhJC0","data":[{"output_type":"stream","name":"stdout","text":"[ 1.03111111e-02 -2.54666667e-01  2.69480635e+00 -1.59628889e+01\n  5.80155778e+01 -1.33273472e+02  1.91960567e+02 -1.65455972e+02\n  7.63617381e+01 -1.41140000e+01]\n"}],"key":"ccyLXCwxaR"}],"key":"tbHBb9IKOQ"},{"type":"paragraph","position":{"start":{"line":89,"column":1},"end":{"line":89,"column":1}},"children":[{"type":"text","value":"The coefficients in vector ","position":{"start":{"line":89,"column":1},"end":{"line":89,"column":1}},"key":"r86cxZxG0Y"},{"type":"inlineCode","value":"c","position":{"start":{"line":89,"column":1},"end":{"line":89,"column":1}},"key":"fMWg7RzhGS"},{"type":"text","value":" are used to create a polynomial. Then we create a function that evaluates the polynomial after changing the time variable as we did for the Vandermonde matrix.","position":{"start":{"line":89,"column":1},"end":{"line":89,"column":1}},"key":"ziijnWXE8u"}],"indexEntries":[{"entry":"Python","subEntry":{"value":"plotting functions","kind":"entry"},"emphasis":false}],"label":"index-uUaKMeszvU","identifier":"index-uuakmeszvu","html_id":"index-uuakmeszvu","key":"b5WsrlEqTt"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"p = poly1d(c)    # convert to a polynomial\ntt = linspace(1955, 2000, 500)\nax.plot(tt, p((tt - 1950) / 10), label=\"interpolant\")\nax.legend();\nfig","key":"eg7tcSnKhI"},{"type":"output","id":"99CdgLulEMDLdJjr3c3t2","data":[{"output_type":"execute_result","execution_count":4,"metadata":{},"data":{"text/plain":{"content":"<Figure size 700x400 with 1 Axes>","content_type":"text/plain"},"image/png":{"content_type":"image/png","hash":"7c60816f908ba1e4a69b24717b0c0f2e","path":"/build/7c60816f908ba1e4a69b24717b0c0f2e.png"}}}],"key":"RGN4R4wLLF"}],"key":"IkwML3MUfz"},{"type":"paragraph","position":{"start":{"line":99,"column":1},"end":{"line":99,"column":1}},"children":[{"type":"text","value":"As you can see, the interpolant does represent the data, in a sense. However it’s a crazy-looking curve for the application. Trying too hard to reproduce all the data exactly is known as ","position":{"start":{"line":99,"column":1},"end":{"line":99,"column":1}},"key":"wB2nmO82W7"},{"type":"emphasis","position":{"start":{"line":99,"column":1},"end":{"line":99,"column":1}},"children":[{"type":"text","value":"overfitting","position":{"start":{"line":99,"column":1},"end":{"line":99,"column":1}},"key":"QyBw61SJyL"}],"key":"zKfmlCHEmM"},{"type":"text","value":".","position":{"start":{"line":99,"column":1},"end":{"line":99,"column":1}},"key":"gHyhooPzUk"}],"key":"xs8dji915i"}],"label":"demo-fitting-tempinterp-python","identifier":"demo-fitting-tempinterp-python","html_id":"demo-fitting-tempinterp-python","key":"r2NuIgWu6u"},{"type":"details","open":true,"children":[{"type":"summary","children":[{"type":"crossReference","identifier":"demo-fitting-tempfit","label":"demo-fitting-tempfit","kind":"proof:example","position":{"start":{"line":104,"column":1},"end":{"line":104,"column":22}},"children":[{"type":"text","value":"Example ","key":"logKvT6C33"},{"type":"text","value":"3.1.2","key":"F4GC4Z1PDZ"}],"template":"Example %s","enumerator":"3.1.2","resolved":true,"html_id":"demo-fitting-tempfit","remote":true,"url":"/fitting","dataUrl":"/fitting.json","key":"P54dmHIMB7"}],"key":"DjJNIx6M1C"},{"type":"paragraph","position":{"start":{"line":106,"column":1},"end":{"line":106,"column":1}},"children":[{"type":"text","value":"Here are the 5-year temperature averages again.","position":{"start":{"line":106,"column":1},"end":{"line":106,"column":1}},"key":"nhh60oYSrx"}],"key":"kYiyjV0d8V"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"year = arange(1955, 2005, 5)\ny = array([-0.0480, -0.0180, -0.0360, -0.0120, -0.0040,\n    0.1180, 0.2100, 0.3320, 0.3340, 0.4560])\nt = (year - 1950) / 10","key":"lInAxxJJg2"},{"type":"output","id":"hwpwB1-Dvgpgf1_P9QiJI","data":[],"key":"yqCb7lv51h"}],"key":"Tn6f8uliMa"},{"type":"paragraph","position":{"start":{"line":116,"column":1},"end":{"line":116,"column":1}},"children":[{"type":"text","value":"The standard best-fit line results from using a linear polynomial that meets the least-squares criterion.","position":{"start":{"line":116,"column":1},"end":{"line":116,"column":1}},"key":"x7i6Gdx9RF"}],"key":"UKMkpCrWdq"},{"type":"admonition","kind":"tip","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"Tip","key":"Dxk2lVVO2N"}],"key":"p8j4elAr7U"},{"type":"paragraph","position":{"start":{"line":119,"column":1},"end":{"line":119,"column":1}},"children":[{"type":"text","value":"Backslash solves overdetermined linear systems in a least-squares sense.","position":{"start":{"line":119,"column":1},"end":{"line":119,"column":1}},"key":"kijOKm4NtV"}],"key":"SCnQF0RP6c"}],"class":"dropdown","key":"t0b4dhGXVk"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"V = array([ [t[i], 1] for i in range(t.size) ])    # Vandermonde-ish matrix\nprint(V.shape)","key":"D3tgoycvDy"},{"type":"output","id":"_W6JVRYDQmGSZ8ODzeTuG","data":[{"output_type":"stream","name":"stdout","text":"(10, 2)\n"}],"key":"VsBitpobGF"}],"key":"fuMl3TXXZi"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"from scipy.linalg import lstsq\nc, res, rank, sv = lstsq(V, y)\np = poly1d(c)\nf = lambda year: p((year - 1950) / 10)","key":"bYfuZkS36i"},{"type":"output","id":"71_4WuVhKcca2BheGMiSK","data":[],"key":"R8eT0mUjcM"}],"indexEntries":[{"entry":"Python","subEntry":{"value":"lstsq","kind":"entry"},"emphasis":true}],"label":"index-MyKvK2PzIx","identifier":"index-mykvk2pzix","html_id":"index-mykvk2pzix","key":"tgwRrPG4RM"},{"type":"code","lang":"","value":"\n```{code-cell}\nfig, ax = subplots()\nax.scatter(year, y, color=\"k\", label=\"data\")\nyr = linspace(1955, 2000, 500)\nax.plot(yr, f(yr), label=\"linear fit\")\n\nxlabel(\"year\")\nylabel(\"anomaly (degrees C)\")\ntitle(\"World temperature anomaly\");\nax.legend();","position":{"start":{"line":136,"column":1},"end":{"line":148,"column":1}},"key":"I7W2aexZQH"},{"type":"paragraph","position":{"start":{"line":150,"column":1},"end":{"line":150,"column":1}},"children":[{"type":"text","value":"If we use a global cubic polynomial, the points are fit more closely.","position":{"start":{"line":150,"column":1},"end":{"line":150,"column":1}},"key":"w5AdAu5aFi"}],"key":"WWxXhyJkEr"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"V = array([ [t[i]**3,t[i]**2,t[i],1] for i in range(t.size) ])    # Vandermonde-ish matrix\nprint(V.shape)","key":"i4ScqRPCvu"},{"type":"output","id":"eUkyR8DjUK8weNJXQiBnV","data":[{"output_type":"stream","name":"stdout","text":"(10, 4)\n"}],"key":"Q11wdi32tF"}],"key":"Hjfrg75XZf"},{"type":"paragraph","position":{"start":{"line":157,"column":1},"end":{"line":157,"column":1}},"children":[{"type":"text","value":"Now we solve the new least-squares problem to redefine the fitting polynomial.","position":{"start":{"line":157,"column":1},"end":{"line":157,"column":1}},"key":"FZEZqA8JcC"}],"key":"l21p7F9tkX"},{"type":"admonition","kind":"tip","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"Tip","key":"NBXiSMSC9Y"}],"key":"v7xkoDymhx"},{"type":"paragraph","position":{"start":{"line":160,"column":1},"end":{"line":160,"column":1}},"children":[{"type":"text","value":"The definition of ","position":{"start":{"line":160,"column":1},"end":{"line":160,"column":1}},"key":"bV3HhWJBtf"},{"type":"inlineCode","value":"f","position":{"start":{"line":160,"column":1},"end":{"line":160,"column":1}},"key":"ywZbK3QmBL"},{"type":"text","value":" above is in terms of ","position":{"start":{"line":160,"column":1},"end":{"line":160,"column":1}},"key":"ioiVU5NKTe"},{"type":"inlineCode","value":"c","position":{"start":{"line":160,"column":1},"end":{"line":160,"column":1}},"key":"UMzWxtQ47Q"},{"type":"text","value":". When ","position":{"start":{"line":160,"column":1},"end":{"line":160,"column":1}},"key":"s19uU2PWgT"},{"type":"inlineCode","value":"c","position":{"start":{"line":160,"column":1},"end":{"line":160,"column":1}},"key":"Z7fY9mvMkY"},{"type":"text","value":" is changed, ","position":{"start":{"line":160,"column":1},"end":{"line":160,"column":1}},"key":"mNNmahWpzR"},{"type":"inlineCode","value":"f","position":{"start":{"line":160,"column":1},"end":{"line":160,"column":1}},"key":"rsBgtW9lFu"},{"type":"text","value":" is updated with it.","position":{"start":{"line":160,"column":1},"end":{"line":160,"column":1}},"key":"tAxebgKWxP"}],"key":"C4K1LnUJhr"}],"class":"dropdown","key":"nOq9736LZP"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"c, res, rank, sv = lstsq(V, y)\nyr = linspace(1955, 2000, 500)\nax.plot(yr, f(yr), label=\"cubic fit\")\nfig","key":"eINZdpnJca"},{"type":"output","id":"dBo2RoIikKn0RiuhnVavb","data":[{"output_type":"execute_result","execution_count":9,"metadata":{},"data":{"text/plain":{"content":"<Figure size 700x400 with 1 Axes>","content_type":"text/plain"},"image/png":{"content_type":"image/png","hash":"03b6417db32f1f1421a6c05e1ea553a2","path":"/build/03b6417db32f1f1421a6c05e1ea553a2.png"}}}],"key":"yhTUYs9VrY"}],"key":"JiqomVjjXR"},{"type":"paragraph","position":{"start":{"line":170,"column":1},"end":{"line":170,"column":1}},"children":[{"type":"text","value":"If we were to continue increasing the degree of the polynomial, the residual at the data points would get smaller, but overfitting would increase.","position":{"start":{"line":170,"column":1},"end":{"line":170,"column":1}},"key":"PRN7ZJLtr6"}],"key":"sju01PinkN"}],"label":"demo-fitting-tempfit-python","identifier":"demo-fitting-tempfit-python","html_id":"demo-fitting-tempfit-python","key":"M3laVVF0ED"},{"type":"details","open":true,"children":[{"type":"summary","children":[{"type":"crossReference","identifier":"demo-fitting-pirate","label":"demo-fitting-pirate","kind":"proof:example","position":{"start":{"line":174,"column":1},"end":{"line":174,"column":21}},"children":[{"type":"text","value":"Example ","key":"J2ZqSmYKHS"},{"type":"text","value":"3.1.3","key":"a1doylQC9y"}],"template":"Example %s","enumerator":"3.1.3","resolved":true,"html_id":"demo-fitting-pirate","remote":true,"url":"/fitting","dataUrl":"/fitting.json","key":"YomF1mbwBG"}],"key":"RTsEkcF02u"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"a = array([1 / (k+1)**2 for k in range(100)])\ns = cumsum(a)        # cumulative summation\np = sqrt(6*s)\n\nplot(range(100), p, \"o\")\nxlabel(\"$k$\") \nylabel(\"$p_k$\") \ntitle(\"Sequence convergence\");","key":"cXesyuIzEw"},{"type":"output","id":"St7ut6VPEpQhr3mkm5tnx","data":[{"output_type":"display_data","metadata":{},"data":{"text/plain":{"content":"<Figure size 700x400 with 1 Axes>","content_type":"text/plain"},"image/png":{"content_type":"image/png","hash":"62587dd62ae583045d95bc367c0cd9de","path":"/build/62587dd62ae583045d95bc367c0cd9de.png"}}}],"key":"QhiGmKlvDf"}],"key":"feJZYTDY8T"},{"type":"paragraph","position":{"start":{"line":187,"column":1},"end":{"line":187,"column":1}},"children":[{"type":"text","value":"This graph suggests that maybe ","position":{"start":{"line":187,"column":1},"end":{"line":187,"column":1}},"key":"nRPgSK1z6H"},{"type":"inlineMath","value":"p_k\\to \\pi","position":{"start":{"line":187,"column":1},"end":{"line":187,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>p</mi><mi>k</mi></msub><mo>→</mo><mi>π</mi></mrow><annotation encoding=\"application/x-tex\">p_k\\to \\pi</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.625em;vertical-align:-0.1944em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">p</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3361em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03148em;\">k</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">→</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">π</span></span></span></span>","key":"Tin4luZ2A8"},{"type":"text","value":", but it’s far from clear how close the sequence gets. It’s more informative to plot the sequence of errors, ","position":{"start":{"line":187,"column":1},"end":{"line":187,"column":1}},"key":"YEPZe1uKat"},{"type":"inlineMath","value":"\\epsilon_k= |\\pi-p_k|","position":{"start":{"line":187,"column":1},"end":{"line":187,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>ϵ</mi><mi>k</mi></msub><mo>=</mo><mi mathvariant=\"normal\">∣</mi><mi>π</mi><mo>−</mo><msub><mi>p</mi><mi>k</mi></msub><mi mathvariant=\"normal\">∣</mi></mrow><annotation encoding=\"application/x-tex\">\\epsilon_k= |\\pi-p_k|</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.5806em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">ϵ</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3361em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03148em;\">k</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord\">∣</span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">π</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">p</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3361em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03148em;\">k</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mord\">∣</span></span></span></span>","key":"HNbw9R7S9g"},{"type":"text","value":". By plotting the error sequence on a log-log scale, we can see a nearly linear relationship.","position":{"start":{"line":187,"column":1},"end":{"line":187,"column":1}},"key":"cgDwG6d9zb"}],"key":"OjWNS15ikL"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"ep = abs(pi - p)    # error sequence\nloglog(range(100), ep, \"o\")\nxlabel(\"$k$\") \nylabel(\"error\") \ntitle(\"Sequence convergence\");","key":"FlQex0REKR"},{"type":"output","id":"7qAT_qWPEHrTy1zNeQN90","data":[{"output_type":"display_data","metadata":{},"data":{"text/plain":{"content":"<Figure size 700x400 with 1 Axes>","content_type":"text/plain"},"image/png":{"content_type":"image/png","hash":"5d9e6a6d52e82bddeafa0c467b257574","path":"/build/5d9e6a6d52e82bddeafa0c467b257574.png"}}}],"key":"lPXGm6a1vH"}],"key":"qckcH7uTl1"},{"type":"paragraph","position":{"start":{"line":197,"column":1},"end":{"line":197,"column":1}},"children":[{"type":"text","value":"The straight line on the log-log scale suggests a power-law relationship where ","position":{"start":{"line":197,"column":1},"end":{"line":197,"column":1}},"key":"FbSMTxEvQm"},{"type":"inlineMath","value":"\\epsilon_k\\approx a k^b","position":{"start":{"line":197,"column":1},"end":{"line":197,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>ϵ</mi><mi>k</mi></msub><mo>≈</mo><mi>a</mi><msup><mi>k</mi><mi>b</mi></msup></mrow><annotation encoding=\"application/x-tex\">\\epsilon_k\\approx a k^b</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6331em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">ϵ</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3361em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03148em;\">k</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">≈</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8491em;\"></span><span class=\"mord mathnormal\">a</span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.03148em;\">k</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8491em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">b</span></span></span></span></span></span></span></span></span></span></span>","key":"yyyACcZU1h"},{"type":"text","value":", or ","position":{"start":{"line":197,"column":1},"end":{"line":197,"column":1}},"key":"WIfM07fUf3"},{"type":"inlineMath","value":"\\log \\epsilon_k \\approx b (\\log k) + \\log a","position":{"start":{"line":197,"column":1},"end":{"line":197,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>log</mi><mo>⁡</mo><msub><mi>ϵ</mi><mi>k</mi></msub><mo>≈</mo><mi>b</mi><mo stretchy=\"false\">(</mo><mi>log</mi><mo>⁡</mo><mi>k</mi><mo stretchy=\"false\">)</mo><mo>+</mo><mi>log</mi><mo>⁡</mo><mi>a</mi></mrow><annotation encoding=\"application/x-tex\">\\log \\epsilon_k \\approx b (\\log k) + \\log a</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8889em;vertical-align:-0.1944em;\"></span><span class=\"mop\">lo<span style=\"margin-right:0.01389em;\">g</span></span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">ϵ</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3361em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03148em;\">k</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">≈</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\">b</span><span class=\"mopen\">(</span><span class=\"mop\">lo<span style=\"margin-right:0.01389em;\">g</span></span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03148em;\">k</span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8889em;vertical-align:-0.1944em;\"></span><span class=\"mop\">lo<span style=\"margin-right:0.01389em;\">g</span></span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord mathnormal\">a</span></span></span></span>","key":"lu1luKXJnT"},{"type":"text","value":".","position":{"start":{"line":197,"column":1},"end":{"line":197,"column":1}},"key":"pqNulVK9QS"}],"key":"jLCzUnMMlB"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"V = array([ [1, log(k+1)] for k in range(100) ])     # fitting matrix\nc = lstsq(V, log(ep))[0]           # coefficients of linear fit\nprint(c)","key":"WDmTyFRmCI"},{"type":"output","id":"_SF6r6MpYqzA9SF2DHAet","data":[{"output_type":"stream","name":"stdout","text":"[-0.18237525 -0.96741032]\n"}],"key":"S1wCygnQpH"}],"key":"dlY3Ziky7u"},{"type":"paragraph","position":{"start":{"line":205,"column":1},"end":{"line":205,"column":1}},"children":[{"type":"text","value":"In terms of the parameters ","position":{"start":{"line":205,"column":1},"end":{"line":205,"column":1}},"key":"zJsvgPPqdt"},{"type":"inlineMath","value":"a","position":{"start":{"line":205,"column":1},"end":{"line":205,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>a</mi></mrow><annotation encoding=\"application/x-tex\">a</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">a</span></span></span></span>","key":"KkegULwNbn"},{"type":"text","value":" and ","position":{"start":{"line":205,"column":1},"end":{"line":205,"column":1}},"key":"HPWYvrUzt1"},{"type":"inlineMath","value":"b","position":{"start":{"line":205,"column":1},"end":{"line":205,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>b</mi></mrow><annotation encoding=\"application/x-tex\">b</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6944em;\"></span><span class=\"mord mathnormal\">b</span></span></span></span>","key":"n2BnWgH1or"},{"type":"text","value":" used above, we have","position":{"start":{"line":205,"column":1},"end":{"line":205,"column":1}},"key":"J4X9E5wec1"}],"key":"Rlofm2YwQR"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"a, b = exp(c[0]), c[1]\nprint(f\"b: {b:.3f}\")","key":"FY8AWe7KcP"},{"type":"output","id":"XAcfAVuF2SgBHTbY-QhSa","data":[{"output_type":"stream","name":"stdout","text":"b: -0.967\n"}],"key":"Z86F7FuvNk"}],"key":"bXAtC4kxBG"},{"type":"paragraph","position":{"start":{"line":212,"column":1},"end":{"line":212,"column":1}},"children":[{"type":"text","value":"It’s tempting to conjecture that the slope ","position":{"start":{"line":212,"column":1},"end":{"line":212,"column":1}},"key":"xug5mx4SDC"},{"type":"inlineMath","value":"b\\to -1","position":{"start":{"line":212,"column":1},"end":{"line":212,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>b</mi><mo>→</mo><mo>−</mo><mn>1</mn></mrow><annotation encoding=\"application/x-tex\">b\\to -1</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6944em;\"></span><span class=\"mord mathnormal\">b</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">→</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.7278em;vertical-align:-0.0833em;\"></span><span class=\"mord\">−</span><span class=\"mord\">1</span></span></span></span>","key":"iMBugWzLdA"},{"type":"text","value":" asymptotically. Here is how the numerical fit compares to the original convergence curve.","position":{"start":{"line":212,"column":1},"end":{"line":212,"column":1}},"key":"XqA942U8Se"}],"key":"wYevHCK39N"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"loglog(range(100), ep, \"o\", label=\"sequence\")\nk = arange(1,100)\nplot(k, a*k**b, \"--\", label=\"power fit\")\nxlabel(\"$k$\");  ylabel(\"error\"); \nlegend(); title(\"Sequence convergence\");","key":"ZJSMZnAvlC"},{"type":"output","id":"dEn6EhEe27jlWKLOuf3QT","data":[{"output_type":"display_data","metadata":{},"data":{"text/plain":{"content":"<Figure size 700x400 with 1 Axes>","content_type":"text/plain"},"image/png":{"content_type":"image/png","hash":"b7240fc2b0eaaf60fc8bb59b60ac7dd9","path":"/build/b7240fc2b0eaaf60fc8bb59b60ac7dd9.png"}}}],"key":"CzzklODqF2"}],"key":"HN4wzqiR0a"}],"label":"demo-fitting-pirate-python","identifier":"demo-fitting-pirate-python","html_id":"demo-fitting-pirate-python","key":"xhutVOO8mM"},{"type":"heading","depth":3,"position":{"start":{"line":223,"column":1},"end":{"line":223,"column":1}},"children":[{"type":"text","value":"3.2 ","position":{"start":{"line":223,"column":1},"end":{"line":223,"column":1}},"key":"BYmQe5l7WU"},{"type":"link","identifier":"section-leastsq-normaleqns","label":"section-leastsq-normaleqns","kind":"narrative","position":{"start":{"line":223,"column":5},"end":{"line":223,"column":32}},"url":"/normaleqns","internal":true,"dataUrl":"/normaleqns.json","children":[{"type":"text","value":"The normal equations","key":"gTJAxVaFk1"}],"key":"ghUY6UJcSZ"}],"identifier":"id-3-2","label":"3.2 ","html_id":"id-3-2","implicit":true,"key":"t0uR4Tnw0I"},{"type":"details","open":true,"children":[{"type":"summary","children":[{"type":"crossReference","identifier":"demo-normaleqns-instab","label":"demo-normaleqns-instab","kind":"proof:example","position":{"start":{"line":226,"column":1},"end":{"line":226,"column":24}},"children":[{"type":"text","value":"Example ","key":"Ol5kXwYtyL"},{"type":"text","value":"3.2.1","key":"HmZP6QDaYz"}],"template":"Example %s","enumerator":"3.2.1","resolved":true,"html_id":"demo-normaleqns-instab","remote":true,"url":"/normaleqns","dataUrl":"/normaleqns.json","key":"eYvnxLWMG9"}],"key":"lmciRCQDEc"},{"type":"paragraph","position":{"start":{"line":229,"column":1},"end":{"line":229,"column":1}},"children":[{"type":"text","value":"Because the functions ","position":{"start":{"line":229,"column":1},"end":{"line":229,"column":1}},"key":"KqaNjaGrsH"},{"type":"inlineMath","value":"\\sin^2(t)","position":{"start":{"line":229,"column":1},"end":{"line":229,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msup><mrow><mi>sin</mi><mo>⁡</mo></mrow><mn>2</mn></msup><mo stretchy=\"false\">(</mo><mi>t</mi><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">\\sin^2(t)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1.1219em;vertical-align:-0.25em;\"></span><span class=\"mop\"><span class=\"mop\">sin</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8719em;\"><span style=\"top:-3.1208em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span></span></span></span></span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">t</span><span class=\"mclose\">)</span></span></span></span>","key":"ymffGY1FRF"},{"type":"text","value":", ","position":{"start":{"line":229,"column":1},"end":{"line":229,"column":1}},"key":"qPw9pHRlKy"},{"type":"inlineMath","value":"\\cos^2(t)","position":{"start":{"line":229,"column":1},"end":{"line":229,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msup><mrow><mi>cos</mi><mo>⁡</mo></mrow><mn>2</mn></msup><mo stretchy=\"false\">(</mo><mi>t</mi><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">\\cos^2(t)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1.0641em;vertical-align:-0.25em;\"></span><span class=\"mop\"><span class=\"mop\">cos</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span></span></span></span></span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">t</span><span class=\"mclose\">)</span></span></span></span>","key":"O6qwhgYyIb"},{"type":"text","value":", and ","position":{"start":{"line":229,"column":1},"end":{"line":229,"column":1}},"key":"BosgGIPstl"},{"type":"text","value":"1","position":{"start":{"line":229,"column":1},"end":{"line":229,"column":1}},"key":"EnSJTuKdVG"},{"type":"text","value":" are linearly dependent, we should find that the following matrix is somewhat ill-conditioned.","position":{"start":{"line":229,"column":1},"end":{"line":229,"column":1}},"key":"sOb8uEEl9G"}],"key":"lAlvTOKsV4"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"from numpy.linalg import cond\nt = linspace(0, 3, 400)\nA = array([ [sin(t)**2, cos((1+1e-7)*t)**2, 1] for t in t ])\nkappa = cond(A)\nprint(f\"cond(A) is {kappa:.3e}\")","key":"ZnyP0Fewo4"},{"type":"output","id":"aVFTSxcLmjuHvHys2NQme","data":[{"output_type":"stream","name":"stdout","text":"cond(A) is 1.825e+07\n"}],"key":"cJJIRSkUR0"}],"key":"K84PXkI2nr"},{"type":"paragraph","position":{"start":{"line":239,"column":1},"end":{"line":239,"column":1}},"children":[{"type":"text","value":"Now we set up an artificial linear least-squares problem with a known exact solution that actually makes the residual zero.","position":{"start":{"line":239,"column":1},"end":{"line":239,"column":1}},"key":"AxJ1Hrqc8Z"}],"key":"RrwMGam3wZ"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"x = array([1, 2, 1])\nb = A @ x","key":"OJAeP5r2Sx"},{"type":"output","id":"RMMO9A_GyYqp_75gauuou","data":[],"key":"J1aXyVMrD4"}],"key":"J7cJC4RpuH"},{"type":"paragraph","position":{"start":{"line":246,"column":1},"end":{"line":246,"column":1}},"children":[{"type":"text","value":"Using backslash to find the least-squares solution, we get a relative error that is well below ","position":{"start":{"line":246,"column":1},"end":{"line":246,"column":1}},"key":"ZxeHh9klbe"},{"type":"inlineMath","value":"\\kappa","position":{"start":{"line":246,"column":1},"end":{"line":246,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>κ</mi></mrow><annotation encoding=\"application/x-tex\">\\kappa</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">κ</span></span></span></span>","key":"I7C8FFB1Nz"},{"type":"text","value":" times machine epsilon.","position":{"start":{"line":246,"column":1},"end":{"line":246,"column":1}},"key":"TQdTkJL4HK"}],"key":"vWxsgeyzSI"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"from scipy.linalg import lstsq\nx_BS = lstsq(A, b)[0]\nprint(f\"observed error: {norm(x_BS - x) / norm(x):.3e}\")\nprint(f\"conditioning bound: {kappa * finfo(float).eps:.3e}\")","key":"ygEyYsJvkL"},{"type":"output","id":"mBFYoy9_VGjNpKfQ8Xz0S","data":[{"output_type":"stream","name":"stdout","text":"observed error: 2.019e-10\nconditioning bound: 4.053e-09\n"}],"key":"N0RyTqDHEU"}],"key":"bYgxfADmkG"},{"type":"paragraph","position":{"start":{"line":255,"column":1},"end":{"line":255,"column":1}},"children":[{"type":"text","value":"If we formulate and solve via the normal equations, we get a much larger relative error. With ","position":{"start":{"line":255,"column":1},"end":{"line":255,"column":1}},"key":"PrqUaRb2RT"},{"type":"inlineMath","value":"\\kappa^2\\approx 10^{14}","position":{"start":{"line":255,"column":1},"end":{"line":255,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msup><mi>κ</mi><mn>2</mn></msup><mo>≈</mo><mn>1</mn><msup><mn>0</mn><mn>14</mn></msup></mrow><annotation encoding=\"application/x-tex\">\\kappa^2\\approx 10^{14}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8141em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">κ</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">≈</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8141em;\"></span><span class=\"mord\">1</span><span class=\"mord\"><span class=\"mord\">0</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">14</span></span></span></span></span></span></span></span></span></span></span></span>","key":"dItxy0sjdW"},{"type":"text","value":", we may not be left with more than about 2 accurate digits.","position":{"start":{"line":255,"column":1},"end":{"line":255,"column":1}},"key":"C2v0Gc9bYL"}],"key":"HL78gdrqA1"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"from scipy import linalg\nN = A.T @ A\nx_NE = linalg.solve(N, A.T @ b)\nrelative_err = norm(x_NE - x) / norm(x)\nprint(f\"observed error: {relative_err:.3e}\")\nprint(f\"accurate digits: {-log10(relative_err):.2f}\")","key":"LKMNckg0vM"},{"type":"output","id":"p9oVXbmGBqwqjXkAxn13w","data":[{"output_type":"stream","name":"stdout","text":"observed error: 5.991e-02\naccurate digits: 1.22\n"}],"key":"ruMRFWEy3M"}],"key":"povVQKzbmQ"}],"label":"demo-normaleqns-instab-python","identifier":"demo-normaleqns-instab-python","html_id":"demo-normaleqns-instab-python","key":"Qw7AdLyw1m"},{"type":"heading","depth":3,"position":{"start":{"line":267,"column":1},"end":{"line":267,"column":1}},"children":[{"type":"text","value":"3.3 ","position":{"start":{"line":267,"column":1},"end":{"line":267,"column":1}},"key":"iLWnfBSGDy"},{"type":"link","identifier":"section-leastsq-qr","label":"section-leastsq-qr","kind":"narrative","position":{"start":{"line":267,"column":5},"end":{"line":267,"column":24}},"url":"/qr","internal":true,"dataUrl":"/qr.json","children":[{"type":"text","value":"The QR factorization","key":"xyzJERw3VF"}],"key":"scTk7Z2joy"}],"identifier":"id-3-3","label":"3.3 ","html_id":"id-3-3","implicit":true,"key":"ZywHiQLBg1"},{"type":"details","open":true,"children":[{"type":"summary","children":[{"type":"crossReference","identifier":"demo-qr-qrfact","label":"demo-qr-qrfact","kind":"proof:example","position":{"start":{"line":269,"column":1},"end":{"line":269,"column":16}},"children":[{"type":"text","value":"Example ","key":"ffi9ygfTKV"},{"type":"text","value":"3.3.1","key":"wEYBBz4Y64"}],"template":"Example %s","enumerator":"3.3.1","resolved":true,"html_id":"demo-qr-qrfact","remote":true,"url":"/qr","dataUrl":"/qr.json","key":"vC1ffiwv44"}],"key":"NQYogXtOuy"},{"type":"paragraph","position":{"start":{"line":272,"column":1},"end":{"line":272,"column":1}},"children":[{"type":"text","value":"NumPy provides access to both the thin and full forms of the QR factorization.","position":{"start":{"line":272,"column":1},"end":{"line":272,"column":1}},"key":"xeFjqlS2KG"}],"key":"fDwFoYPBVy"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"A = 1.0 + floor(9 * random.rand(6,4))\nA.shape","key":"FkFppnjDRx"},{"type":"output","id":"0nIgDyROgOfkQmLskImyn","data":[{"output_type":"execute_result","execution_count":19,"metadata":{},"data":{"text/plain":{"content":"(6, 4)","content_type":"text/plain"}}}],"key":"k5a2vhMKvX"}],"key":"PvblRnBTcX"},{"type":"paragraph","position":{"start":{"line":279,"column":1},"end":{"line":279,"column":1}},"children":[{"type":"text","value":"Here is the full form:","position":{"start":{"line":279,"column":1},"end":{"line":279,"column":1}},"key":"mUjy5sU53w"}],"key":"E5Penb75M9"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"from numpy.linalg import qr\nQ, R = qr(A, \"complete\")\nprint(f\"size of Q is {Q.shape}\")\nprint(\"R:\")\nprint(R)","key":"BMTmiZ3gRt"},{"type":"output","id":"1rBy5cwj4UHjsVK_gEOFu","data":[{"output_type":"stream","name":"stdout","text":"size of Q is (6, 6)\nR:\n[[-15.49193338 -11.42530087 -11.36075115  -5.68037557]\n [  0.          -9.71918206  -5.78237959  -7.62409836]\n [  0.           0.           7.5827053   -0.08160202]\n [  0.           0.           0.          -5.62136982]\n [  0.           0.           0.           0.        ]\n [  0.           0.           0.           0.        ]]\n"}],"key":"aZ1Yu9WgjF"}],"key":"FO9rhz9qHd"},{"type":"paragraph","position":{"start":{"line":289,"column":1},"end":{"line":289,"column":1}},"children":[{"type":"text","value":"We can test that ","position":{"start":{"line":289,"column":1},"end":{"line":289,"column":1}},"key":"gGiVvFCObu"},{"type":"inlineMath","value":"\\mathbf{Q}","position":{"start":{"line":289,"column":1},"end":{"line":289,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi mathvariant=\"bold\">Q</mi></mrow><annotation encoding=\"application/x-tex\">\\mathbf{Q}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8805em;vertical-align:-0.1944em;\"></span><span class=\"mord mathbf\">Q</span></span></span></span>","key":"rmwiuPkMWp"},{"type":"text","value":" is an orthogonal matrix:","position":{"start":{"line":289,"column":1},"end":{"line":289,"column":1}},"key":"bhhW7wLq0O"}],"key":"jIaqOBltV2"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"print(f\"norm of (Q^T Q - I) is {norm(Q.T @ Q - eye(6)):.3e}\")","key":"erTERigZdb"},{"type":"output","id":"hEGKa9D-bmmxnHB_X0wrd","data":[{"output_type":"stream","name":"stdout","text":"norm of (Q^T Q - I) is 3.823e-16\n"}],"key":"yvxVQQnoSv"}],"key":"PupgH2V62z"},{"type":"paragraph","position":{"start":{"line":295,"column":1},"end":{"line":295,"column":1}},"children":[{"type":"text","value":"The default for ","position":{"start":{"line":295,"column":1},"end":{"line":295,"column":1}},"key":"R2EOFq37DY"},{"type":"inlineCode","value":"qr","position":{"start":{"line":295,"column":1},"end":{"line":295,"column":1}},"key":"EIEibKdIKA"},{"type":"text","value":", and the one you usually want, is the thin form.","position":{"start":{"line":295,"column":1},"end":{"line":295,"column":1}},"key":"yumFZvrenU"}],"key":"BYXGhktJBI"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"Q_hat, R_hat = qr(A)\nprint(f\"size of Q_hat is {Q_hat.shape}\")\nprint(\"R_hat:\")\nprint(R_hat)","key":"KnOi4wcu0x"},{"type":"output","id":"Z2mR2rdJPvi_0HpWuCCeQ","data":[{"output_type":"stream","name":"stdout","text":"size of Q_hat is (6, 4)\nR_hat:\n[[-15.49193338 -11.42530087 -11.36075115  -5.68037557]\n [  0.          -9.71918206  -5.78237959  -7.62409836]\n [  0.           0.           7.5827053   -0.08160202]\n [  0.           0.           0.          -5.62136982]]\n"}],"key":"SsEyegd4ii"}],"key":"hA0TjSfQBh"},{"type":"paragraph","position":{"start":{"line":304,"column":1},"end":{"line":304,"column":1}},"children":[{"type":"text","value":"Now ","position":{"start":{"line":304,"column":1},"end":{"line":304,"column":1}},"key":"mFgaNUOmkD"},{"type":"inlineMath","value":"\\hat{\\mathbf{Q}}","position":{"start":{"line":304,"column":1},"end":{"line":304,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mover accent=\"true\"><mi mathvariant=\"bold\">Q</mi><mo>^</mo></mover></mrow><annotation encoding=\"application/x-tex\">\\hat{\\mathbf{Q}}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1.144em;vertical-align:-0.1944em;\"></span><span class=\"mord accent\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.9495em;\"><span style=\"top:-3em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord mathbf\">Q</span></span><span style=\"top:-3.2551em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"accent-body\" style=\"left:-0.1667em;\"><span class=\"mord\">^</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.1944em;\"><span></span></span></span></span></span></span></span></span>","key":"bcHNcJfwB4"},{"type":"text","value":" cannot be an orthogonal matrix, because it is not square, but it is still ","key":"Va5gweI1ZI"},{"type":"abbreviation","title":"matrix with orthonormal columns","children":[{"type":"text","value":"ONC","key":"F3hRUUfYMy"}],"key":"L22JIkaKRa"},{"type":"text","value":". Mathematically, ","key":"bgnZvtrXvI"},{"type":"inlineMath","value":"\\hat{\\mathbf{Q}}^T \\hat{\\mathbf{Q}}","position":{"start":{"line":304,"column":1},"end":{"line":304,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msup><mover accent=\"true\"><mi mathvariant=\"bold\">Q</mi><mo>^</mo></mover><mi>T</mi></msup><mover accent=\"true\"><mi mathvariant=\"bold\">Q</mi><mo>^</mo></mover></mrow><annotation encoding=\"application/x-tex\">\\hat{\\mathbf{Q}}^T \\hat{\\mathbf{Q}}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1.144em;vertical-align:-0.1944em;\"></span><span class=\"mord\"><span class=\"mord accent\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.9495em;\"><span style=\"top:-3em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord mathbf\">Q</span></span><span style=\"top:-3.2551em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"accent-body\" style=\"left:-0.1667em;\"><span class=\"mord\">^</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.1944em;\"><span></span></span></span></span></span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8413em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.13889em;\">T</span></span></span></span></span></span></span></span><span class=\"mord accent\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.9495em;\"><span style=\"top:-3em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord mathbf\">Q</span></span><span style=\"top:-3.2551em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"accent-body\" style=\"left:-0.1667em;\"><span class=\"mord\">^</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.1944em;\"><span></span></span></span></span></span></span></span></span>","key":"ttWuAt5BsF"},{"type":"text","value":" is a ","position":{"start":{"line":304,"column":1},"end":{"line":304,"column":1}},"key":"EMqDFLllVq"},{"type":"inlineMath","value":"4\\times 4","position":{"start":{"line":304,"column":1},"end":{"line":304,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>4</mn><mo>×</mo><mn>4</mn></mrow><annotation encoding=\"application/x-tex\">4\\times 4</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.7278em;vertical-align:-0.0833em;\"></span><span class=\"mord\">4</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">×</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">4</span></span></span></span>","key":"ugbtwtnS2O"},{"type":"text","value":" identity matrix.","position":{"start":{"line":304,"column":1},"end":{"line":304,"column":1}},"key":"qbScujar2E"}],"key":"VkYBj7xXEO"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"print(f\"norm of (Q_hat^T Q_hat - I) is {norm(Q_hat.T @ Q_hat - eye(4)):.3e}\")","key":"SsJ7ShRSO0"},{"type":"output","id":"mfvcAOFflFn0TpfAOrzZq","data":[{"output_type":"stream","name":"stdout","text":"norm of (Q_hat^T Q_hat - I) is 3.073e-16\n"}],"key":"hy9VsCjYpV"}],"key":"rrPpnjln1l"}],"label":"demo-qr-qrfact-python","identifier":"demo-qr-qrfact-python","html_id":"demo-qr-qrfact-python","key":"tffTHJTuFM"},{"type":"details","open":true,"children":[{"type":"summary","children":[{"type":"crossReference","identifier":"demo-qr-stable","label":"demo-qr-stable","kind":"proof:example","position":{"start":{"line":312,"column":1},"end":{"line":312,"column":16}},"children":[{"type":"text","value":"Example ","key":"vBJn9m1Gws"},{"type":"text","value":"3.3.2","key":"jvfeT3LnUx"}],"template":"Example %s","enumerator":"3.3.2","resolved":true,"html_id":"demo-qr-stable","remote":true,"url":"/qr","dataUrl":"/qr.json","key":"NzUWYYG62i"}],"key":"S8OqojGr87"},{"type":"paragraph","position":{"start":{"line":314,"column":1},"end":{"line":314,"column":1}},"children":[{"type":"text","value":"We’ll repeat the experiment of ","position":{"start":{"line":314,"column":1},"end":{"line":314,"column":1}},"key":"Y9rnRmDFqe"},{"type":"crossReference","identifier":"demo-normaleqns-instab","label":"demo-normaleqns-instab","kind":"proof:example","position":{"start":{"line":314,"column":32},"end":{"line":314,"column":55}},"children":[{"type":"text","value":"Example ","key":"eakuVVVTNk"},{"type":"text","value":"3.2.1","key":"rnWH5FoJNd"}],"template":"Example %s","enumerator":"3.2.1","resolved":true,"html_id":"demo-normaleqns-instab","remote":true,"url":"/normaleqns","dataUrl":"/normaleqns.json","key":"Ssl3MPa9t0"},{"type":"text","value":", which exposed instability in the normal equations.","position":{"start":{"line":314,"column":1},"end":{"line":314,"column":1}},"key":"qvXsdQcDbo"}],"key":"MNnMRwMMHc"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"t = linspace(0, 3, 400)\nA = array([ [sin(t)**2, cos((1+1e-7)*t)**2, 1] for t in t ])\nx = array([1, 2, 1])\nb = A @ x","key":"E18GDcO3iY"},{"type":"output","id":"9RG74zQZSOac76HpPN5Dg","data":[],"key":"Duvy8HJHtY"}],"key":"JsFu6EEYaX"},{"type":"paragraph","position":{"start":{"line":323,"column":1},"end":{"line":323,"column":1}},"children":[{"type":"text","value":"The error in the solution by ","position":{"start":{"line":323,"column":1},"end":{"line":323,"column":1}},"key":"Uko6GYeQ4i"},{"type":"crossReference","kind":"proof:algorithm","identifier":"function-lsqrfact","label":"function-lsqrfact","children":[{"type":"text","value":"Function ","key":"mQPQVyx6WA"},{"type":"text","value":"3.3.2","key":"pTCteKcfhI"}],"template":"Algorithm %s","enumerator":"3.3.2","resolved":true,"html_id":"function-lsqrfact","remote":true,"url":"/qr","dataUrl":"/qr.json","key":"lo7xRSvVXF"},{"type":"text","value":" is similar to the bound predicted by the condition number.","position":{"start":{"line":323,"column":1},"end":{"line":323,"column":1}},"key":"HSEbRuABs7"}],"key":"gcPBZhrhid"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"print(f\"observed error: {norm(FNC.lsqrfact(A, b) - x) / norm(x):.3e}\")\nprint(f\"conditioning bound: {cond(A) * finfo(float).eps:.3e}\")","key":"deJSp7EDSC"},{"type":"output","id":"waoSlwK_SGotEE1n3Xv4d","data":[{"output_type":"stream","name":"stdout","text":"observed error: 5.186e-09\nconditioning bound: 4.053e-09\n"}],"key":"DmyVIqvNgF"}],"key":"kHiHeYOUEx"}],"label":"demo-qr-stable-python","identifier":"demo-qr-stable-python","html_id":"demo-qr-stable-python","key":"YOTDgZd8EE"},{"type":"heading","depth":3,"position":{"start":{"line":331,"column":1},"end":{"line":331,"column":1}},"children":[{"type":"text","value":"3.4 ","position":{"start":{"line":331,"column":1},"end":{"line":331,"column":1}},"key":"SAh5Fs94lj"},{"type":"link","identifier":"section-leastsq-house","label":"section-leastsq-house","kind":"narrative","position":{"start":{"line":331,"column":5},"end":{"line":331,"column":27}},"url":"/house","internal":true,"dataUrl":"/house.json","children":[{"type":"text","value":"Computing QR factorizations","key":"IckgKEko91"}],"key":"zitc3A5J38"}],"identifier":"id-3-4","label":"3.4 ","html_id":"id-3-4","implicit":true,"key":"N8eMd6K4OH"},{"type":"details","open":true,"children":[{"type":"summary","children":[{"type":"crossReference","identifier":"demo-house-qr","label":"demo-house-qr","kind":"proof:example","position":{"start":{"line":333,"column":1},"end":{"line":333,"column":15}},"children":[{"type":"text","value":"Example ","key":"Jkvar15BRu"},{"type":"text","value":"3.4.1","key":"EYPAgZxJ19"}],"template":"Example %s","enumerator":"3.4.1","resolved":true,"html_id":"demo-house-qr","remote":true,"url":"/house","dataUrl":"/house.json","key":"ShkGuaGmxR"}],"key":"TS9Sq2jYA4"},{"type":"paragraph","position":{"start":{"line":336,"column":1},"end":{"line":336,"column":1}},"children":[{"type":"text","value":"We will use Householder reflections to produce a QR factorization of a matrix.","position":{"start":{"line":336,"column":1},"end":{"line":336,"column":1}},"key":"jOA4cHM7MN"}],"key":"cIcwSkRFFd"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"A = 1.0 + floor(9 * random.rand(6,4))\nm, n = A.shape\nprint(A)","key":"cOwEXW0gwX"},{"type":"output","id":"Ju70MzjEQje5-ZRBeDQ3v","data":[{"output_type":"stream","name":"stdout","text":"[[4. 7. 6. 6.]\n [9. 6. 8. 6.]\n [1. 7. 4. 1.]\n [7. 1. 8. 6.]\n [5. 1. 9. 4.]\n [7. 3. 6. 6.]]\n"}],"key":"DHKDtf8wca"}],"key":"gy6HETP1Tf"},{"type":"paragraph","position":{"start":{"line":344,"column":1},"end":{"line":344,"column":1}},"children":[{"type":"text","value":"Our first step is to introduce zeros below the diagonal in column 1 by using ","position":{"start":{"line":344,"column":1},"end":{"line":344,"column":1}},"key":"TgqZS9Ja0N"},{"type":"crossReference","kind":"equation","identifier":"hhvector","label":"hhvector","children":[{"type":"text","value":"(","key":"YaQjnXS29b"},{"type":"text","value":"3.4.4","key":"LdPDgvHPkF"},{"type":"text","value":")","key":"kKOOuxT6Jr"}],"template":"(%s)","enumerator":"3.4.4","resolved":true,"html_id":"hhvector","remote":true,"url":"/house","dataUrl":"/house.json","key":"VaqV6qzMn4"},{"type":"text","value":" and ","position":{"start":{"line":344,"column":1},"end":{"line":344,"column":1}},"key":"oPPvpXBGLT"},{"type":"crossReference","kind":"equation","identifier":"hhreflect","label":"hhreflect","children":[{"type":"text","value":"(","key":"OSCUaK9dg8"},{"type":"text","value":"3.4.1","key":"Me2yoFTReC"},{"type":"text","value":")","key":"XPmIRpuY7V"}],"template":"(%s)","enumerator":"3.4.1","resolved":true,"html_id":"hhreflect","remote":true,"url":"/house","dataUrl":"/house.json","key":"hje3lyxWoJ"},{"type":"text","value":".","position":{"start":{"line":344,"column":1},"end":{"line":344,"column":1}},"key":"uG84u1PRwV"}],"key":"fkBcCVu43B"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"z = A[:, 0]\nv = z - norm(z) * hstack([1, zeros(m-1)])\nP_1 = eye(m) - (2 / dot(v, v)) * outer(v, v)   # reflector","key":"BYikZSauk2"},{"type":"output","id":"XtTn1o-pVVh8ktHhpaDdd","data":[],"key":"cekrSyIPAf"}],"key":"rcyPtOcRJg"},{"type":"paragraph","position":{"start":{"line":352,"column":1},"end":{"line":352,"column":1}},"children":[{"type":"text","value":"We check that this reflector introduces zeros as it should:","position":{"start":{"line":352,"column":1},"end":{"line":352,"column":1}},"key":"KJH0qd0YUn"}],"key":"XS58vJz7sP"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"print(P_1 @ z)","key":"APJIfeg3Pz"},{"type":"output","id":"oqcHydi4PI6hKNfG6Ysg4","data":[{"output_type":"stream","name":"stdout","text":"[ 1.48660687e+01  4.99600361e-16  1.38777878e-17 -1.11022302e-15\n -4.71844785e-16 -6.66133815e-16]\n"}],"key":"Bcf9aKNZQn"}],"key":"r4BVK1tktp"},{"type":"paragraph","position":{"start":{"line":358,"column":1},"end":{"line":358,"column":1}},"children":[{"type":"text","value":"Now we replace ","position":{"start":{"line":358,"column":1},"end":{"line":358,"column":1}},"key":"iNeAah8KDi"},{"type":"inlineMath","value":"\\mathbf{A}","position":{"start":{"line":358,"column":1},"end":{"line":358,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi mathvariant=\"bold\">A</mi></mrow><annotation encoding=\"application/x-tex\">\\mathbf{A}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6861em;\"></span><span class=\"mord mathbf\">A</span></span></span></span>","key":"eFLSPA7j7B"},{"type":"text","value":" by ","position":{"start":{"line":358,"column":1},"end":{"line":358,"column":1}},"key":"DvexHOPLN2"},{"type":"inlineMath","value":"\\mathbf{P}_1\\mathbf{A}","position":{"start":{"line":358,"column":1},"end":{"line":358,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi mathvariant=\"bold\">P</mi><mn>1</mn></msub><mi mathvariant=\"bold\">A</mi></mrow><annotation encoding=\"application/x-tex\">\\mathbf{P}_1\\mathbf{A}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8361em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathbf\">P</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3011em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">1</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mord mathbf\">A</span></span></span></span>","key":"Mto8586uiV"},{"type":"text","value":".","position":{"start":{"line":358,"column":1},"end":{"line":358,"column":1}},"key":"WA12I0EeOn"}],"key":"og3UTD9QTz"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"A = P_1 @ A\nprint(A)","key":"IfVV70AzVI"},{"type":"output","id":"8DchUDkXCE9nLlqq0TQ53","data":[{"output_type":"stream","name":"stdout","text":"[[ 1.48660687e+01  8.20660809e+00  1.63459489e+01  1.23099121e+01]\n [ 4.99600361e-16  5.00060702e+00 -5.69202185e-01  7.73711589e-01]\n [ 1.38777878e-17  6.88895634e+00  3.04786642e+00  4.19301288e-01]\n [-1.11022302e-15  2.22694352e-01  1.33506497e+00  1.93510901e+00]\n [-4.71844785e-16  4.44781680e-01  4.23933212e+00  1.09650644e+00]\n [-6.66133815e-16  2.22269435e+00 -6.64935032e-01  1.93510901e+00]]\n"}],"key":"PTU0wemfx8"}],"key":"SO2NXoXhKI"},{"type":"paragraph","position":{"start":{"line":365,"column":1},"end":{"line":365,"column":1}},"children":[{"type":"text","value":"We are set to put zeros into column 2. We must not use row 1 in any way, lest it destroy the zeros we just introduced. So we leave it out of the next reflector.","position":{"start":{"line":365,"column":1},"end":{"line":365,"column":1}},"key":"M8RCVp1IsH"}],"key":"GnCK5Q5k0E"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"z = A[1:, 1]\nv = z - norm(z) * hstack([1, zeros(m-2)])\nP_2 = eye(m-1) - (2 / dot(v, v)) * outer(v, v)","key":"lKo9zzy1Pr"},{"type":"output","id":"7FgInRaoCwQi4klNtwvAn","data":[],"key":"arIjeBtIZg"}],"key":"rDR7zmrfil"},{"type":"paragraph","position":{"start":{"line":373,"column":1},"end":{"line":373,"column":1}},"children":[{"type":"text","value":"We now apply this reflector to rows 2 and below only.","position":{"start":{"line":373,"column":1},"end":{"line":373,"column":1}},"key":"bRxY9NJnqy"}],"key":"ITzUGKgyxR"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"A[1:, 1:] = P_2 @ A[1:, 1:]\nprint(A)","key":"UnA9VDbGn0"},{"type":"output","id":"jxXFCONCWqXt9zWWzBom3","data":[{"output_type":"stream","name":"stdout","text":"[[ 1.48660687e+01  8.20660809e+00  1.63459489e+01  1.23099121e+01]\n [ 4.99600361e-16  8.81201360e+00  2.13971567e+00  1.35920984e+00]\n [ 1.38777878e-17  4.10311034e-16 -1.84838814e+00 -6.38962055e-01]\n [-1.11022302e-15  3.90935888e-17  1.17678726e+00  1.90089929e+00]\n [-4.71844785e-16  5.62420092e-17  3.92320813e+00  1.02818025e+00]\n [-6.66133815e-16  8.78282593e-17 -2.24469209e+00  1.59366456e+00]]\n"}],"key":"NH8EmqSrGk"}],"key":"U1Vt6vmJQq"},{"type":"paragraph","position":{"start":{"line":380,"column":1},"end":{"line":380,"column":1}},"children":[{"type":"text","value":"We need to iterate the process for the last two columns.","position":{"start":{"line":380,"column":1},"end":{"line":380,"column":1}},"key":"IMge01gDBS"}],"key":"LNA2ZlQwON"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"for j in [2, 3]:\n    z = A[j:, j]\n    v = z - norm(z) * hstack([1, zeros(m-j-1)])\n    P = eye(m-j) - (2 / dot(v, v)) * outer(v, v)\n    A[j:, j:] = P @ A[j:, j:]","key":"aMK97YLOSA"},{"type":"output","id":"7SLr7OjQaLKHoGh7ei8y3","data":[],"key":"Nc1Q0uXmvu"}],"key":"dgLP4o3bXW"},{"type":"paragraph","position":{"start":{"line":390,"column":1},"end":{"line":390,"column":1}},"children":[{"type":"text","value":"We have now reduced the original to an upper triangular matrix using four orthogonal Householder reflections:","position":{"start":{"line":390,"column":1},"end":{"line":390,"column":1}},"key":"LuA9aYV2q1"}],"key":"OfckCcCs0c"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"R = triu(A)\nprint(R)","key":"SsOA0ns1Do"},{"type":"output","id":"77hwc7fhOgKu1nFT4AruX","data":[{"output_type":"stream","name":"stdout","text":"[[14.86606875  8.20660809 16.34594889 12.30991213]\n [ 0.          8.8120136   2.13971567  1.35920984]\n [ 0.          0.          5.02310378  0.77133243]\n [ 0.          0.          0.          2.65021853]\n [ 0.          0.          0.          0.        ]\n [ 0.          0.          0.          0.        ]]\n"}],"key":"FZqj1hpzmS"}],"indexEntries":[{"entry":"Python","subEntry":{"value":"triu","kind":"entry"},"emphasis":false}],"label":"index-s5sPqVTSXa","identifier":"index-s5spqvtsxa","html_id":"index-s5spqvtsxa","key":"zK4qG1DOt0"}],"label":"demo-house-qr-python","identifier":"demo-house-qr-python","html_id":"demo-house-qr-python","key":"DAE4M8Kv59"}],"key":"QmJCFoXAby"}],"key":"oYsHh5IF9G"},"references":{"cite":{"order":[],"data":{}}},"footer":{"navigation":{"prev":{"title":"Chapter 2","url":"/chapter2-2","group":"Python codes"},"next":{"title":"Chapter 4","url":"/chapter4-2","group":"Python codes"}}},"domain":"http://localhost:3000"}