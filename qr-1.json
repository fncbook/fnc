{"kind":"Notebook","sha256":"167ca7b0556a5ed138c7138da30fe8a44c6b6c43125ddc8072247ff028001c57","slug":"qr-1","location":"/chapter3/section4/julia/qr.ipynb","dependencies":[],"frontmatter":{"numbering":{"heading_1":{"enabled":false},"heading_2":{"enabled":false},"heading_3":{"enabled":false},"heading_4":{"enabled":false},"heading_5":{"enabled":false},"heading_6":{"enabled":false}},"kernelspec":{"name":"julia-1.11","display_name":"Julia 1","language":"julia"},"authors":[{"nameParsed":{"literal":"Tobin A. Driscoll","given":"Tobin A.","family":"Driscoll"},"name":"Tobin A. Driscoll","email":"driscoll@udel.edu","id":"contributors-myst-generated-uid-0","corresponding":true},{"nameParsed":{"literal":"Richard J. Braun","given":"Richard J.","family":"Braun"},"name":"Richard J. Braun","id":"contributors-myst-generated-uid-1"}],"github":"https://github.com/fncbook/fnc","math":{"\\float":{"macro":"\\mathbb{F}"},"\\real":{"macro":"\\mathbb{R}"},"\\complex":{"macro":"\\mathbb{C}"},"\\nat":{"macro":"\\mathbb{N}"},"\\integer":{"macro":"\\mathbb{Z}"},"\\rmn":{"macro":"\\mathbb{R}^{#1 \\times #2}"},"\\dd":{"macro":"\\frac{d #1}{d #2}"},"\\ddd":{"macro":"\\frac{d^2 #1}{d #2^2}"},"\\pp":{"macro":"\\frac{\\partial #1}{\\partial #2}"},"\\ppp":{"macro":"\\frac{\\partial^2 #1}{\\partial #2^2}"},"\\ppdd":{"macro":"\\frac{\\partial^2 #1}{\\partial #2 \\partial #3}"},"\\abs":{"macro":"\\left\\lvert #1 \\right\\rvert"},"\\norm":{"macro":"\\left\\lVert #1 \\right\\rVert"},"\\twonorm":{"macro":"\\norm{#1}_2"},"\\onenorm":{"macro":"\\norm{#1}_1"},"\\infnorm":{"macro":"\\norm{#1}_\\infty"},"\\anynorm":{"macro":"\\norm{#1}_#2"},"\\innerprod":{"macro":"\\langle #1,#2 \\rangle"},"\\pr":{"macro":"^{(#1)}"},"\\kron":{"macro":"#1 \\otimes #2"},"\\eye":{"macro":"\\mathbf{e}_#1"},"\\meye":{"macro":"\\mathbf{I}"},"\\Qhat":{"macro":"\\hat{\\mathbf{Q}}"},"\\Rhat":{"macro":"\\hat{\\mathbf{R}}"},"\\bfalpha":{"macro":"\\mathbf{alpha}"},"\\bfdelta":{"macro":"\\mathbf{delta}"},"\\bfzero":{"macro":"\\boldsymbol{0}"},"\\macheps":{"macro":"\\epsilon_\\text{mach}"},"\\fl":{"macro":"\\operatorname{fl}"},"\\diag":{"macro":"\\operatorname{diag}"},"\\ign":{"macro":"\\operatorname{sign}"},"\\Re":{"macro":"\\operatorname{Re}"},"\\Im":{"macro":"\\operatorname{Im}"},"\\ee":{"macro":"\\times 10^"},"\\lnorm":{"macro":"\\|"},"\\rnorm":{"macro":"\\|"},"\\floor":{"macro":"\\lfloor#1\\rfloor"},"\\cI":{"macro":"\\mathcal{I}"},"\\mtx":{"macro":"\\operatorname{mtx}"},"\\myvec":{"macro":"\\operatorname{vec}"},"\\argmin":{"macro":"\\operatorname{argmin}"}},"abbreviations":{"IVP":"initial-value problem","BVP":"boundary-value problem","ONC":"matrix with orthonormal columns","SVD":"singular value decomposition","EVD":"eigenvalue decomposition","SPD":"symmetric positive definite","HPD":"hermitian positive definite","PDE":"partial differential equation","ODE":"ordinary differential equation"},"exports":[{"format":"ipynb","filename":"qr.ipynb","url":"/fnc/build/qr-b85efc8115997c520d5e990561897d3b.ipynb"}]},"widgets":{},"mdast":{"type":"root","children":[{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"crossReference","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"strong","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Demo ","key":"DMQsQdZVMt"},{"type":"text","value":"3.4.1","key":"T6RQxzMzPU"}],"key":"f59xRLmiGG"}],"identifier":"demo-house-qr","label":"demo-house-qr","kind":"proof:example","template":"Example %s","enumerator":"3.4.1","resolved":true,"html_id":"demo-house-qr","remote":true,"url":"/house","dataUrl":"/house.json","key":"jUqTGzgBi2"}],"key":"FxUP8nHjNr"},{"type":"paragraph","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"text","value":"We will use Householder reflections to produce a QR factorization of a random matrix.","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"QrURL4NtmI"}],"key":"PuGXQvWrgd"},{"type":"admonition","kind":"tip","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"Tip","key":"rF4PFyZqT1"}],"key":"vSxN8IF8aj"},{"type":"paragraph","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"text","value":"The ","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"a3xJUi4Mbf"},{"type":"inlineCode","value":"rand","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"YenrWDDtjD"},{"type":"text","value":" function can select randomly from within the interval ","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"gTRWquIuvu"},{"type":"inlineMath","value":"[0,1]","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mo stretchy=\"false\">[</mo><mn>0</mn><mo separator=\"true\">,</mo><mn>1</mn><mo stretchy=\"false\">]</mo></mrow><annotation encoding=\"application/x-tex\">[0,1]</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mopen\">[</span><span class=\"mord\">0</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord\">1</span><span class=\"mclose\">]</span></span></span></span>","key":"MjH9Wq5JK2"},{"type":"text","value":", or from a vector or range that you specify.","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"PrlJzhNV0N"}],"key":"gQsSQ2BpZ1"}],"class":"dropdown","key":"Z2ETbNFRub"}],"key":"xw9VWr04Cn"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.status.idle":"2025-01-14T15:19:38.218000Z","iopub.status.busy":"2025-01-14T15:19:35.421000Z","iopub.execute_input":"2025-01-14T15:19:36.772000Z","shell.execute_reply":"2025-01-14T15:19:38.198000Z"}},"children":[{"type":"code","lang":"julia","executable":true,"value":"A = rand(float(1:9), 6, 4)\nm,n = size(A)","key":"MmUhZNy80R"},{"type":"output","id":"7ypVBpwsov4kba3qEg0W8","data":[{"output_type":"execute_result","execution_count":2,"metadata":{},"data":{"text/plain":{"content":"(6, 4)","content_type":"text/plain"}}}],"key":"Rv6a2706qo"}],"key":"wexsujKjBa"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"paragraph","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"text","value":"Our first step is to introduce zeros below the diagonal in column 1 by using ","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"i1EFoNNNZ9"},{"type":"crossReference","kind":"equation","identifier":"hhvector","label":"hhvector","children":[{"type":"text","value":"(","key":"zrWIOqSc2I"},{"type":"text","value":"3.4.4","key":"XhApehfuUG"},{"type":"text","value":")","key":"uN5DOngYWk"}],"template":"(%s)","enumerator":"3.4.4","resolved":true,"html_id":"hhvector","remote":true,"url":"/house","dataUrl":"/house.json","key":"E7UNSwJz9q"},{"type":"text","value":" and ","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"lVdm16Bhi7"},{"type":"crossReference","kind":"equation","identifier":"hhreflect","label":"hhreflect","children":[{"type":"text","value":"(","key":"H9Fs8jVJ2H"},{"type":"text","value":"3.4.1","key":"p1gQ7QqHFJ"},{"type":"text","value":")","key":"tDMaWQrcn9"}],"template":"(%s)","enumerator":"3.4.1","resolved":true,"html_id":"hhreflect","remote":true,"url":"/house","dataUrl":"/house.json","key":"Xo041yzLhN"},{"type":"text","value":".","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"LNJo0WyO5i"}],"indexEntries":[{"entry":"Julia","subEntry":{"value":"normalize","kind":"entry"},"emphasis":false},{"entry":"Julia","subEntry":{"value":"I","kind":"entry"},"emphasis":true}],"label":"index-wIpnqZIGUH","identifier":"index-wipnqziguh","html_id":"index-wipnqziguh","key":"XaOxSVzFfu"},{"type":"code","lang":"","value":"```{tip}\n:class: dropdown\n`I` can stand for an identity matrix of any size, inferred from the context when needed.\n```","position":{"start":{"line":5,"column":1},"end":{"line":9,"column":1}},"key":"EwoPHa2W0I"}],"key":"x3OOvHNZJ3"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.status.idle":"2025-01-14T15:19:42.402000Z","iopub.status.busy":"2025-01-14T15:19:38.221000Z","iopub.execute_input":"2025-01-14T15:19:38.221000Z","shell.execute_reply":"2025-01-14T15:19:42.401000Z"}},"children":[{"type":"code","lang":"julia","executable":true,"value":"z = A[:, 1];\nv = normalize(z - norm(z) * [1; zeros(m-1)])\nP₁ = I - 2v * v'   # reflector","key":"c3tIvzklq6"},{"type":"output","id":"bKTdQEbQrv0KT6w4sBxZ_","data":[{"output_type":"execute_result","execution_count":3,"metadata":{},"data":{"text/plain":{"content":"6×6 Matrix{Float64}:\n 0.40179    0.53572     0.066965    0.334825   0.602685    0.26786\n 0.53572    0.520243   -0.0599696  -0.299848  -0.539727   -0.239878\n 0.066965  -0.0599696   0.992504   -0.037481  -0.0674658  -0.0299848\n 0.334825  -0.299848   -0.037481    0.812595  -0.337329   -0.149924\n 0.602685  -0.539727   -0.0674658  -0.337329   0.392808   -0.269863\n 0.26786   -0.239878   -0.0299848  -0.149924  -0.269863    0.880061","content_type":"text/plain"}}}],"key":"K2AAY2G2QR"}],"key":"lrv6DkDG4l"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"We check that this reflector introduces zeros as it should:","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"QjpAPODQ89"}],"key":"Ht7voDMtHy"}],"key":"GPwRXsxp6H"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.status.idle":"2025-01-14T15:19:43.252000Z","iopub.status.busy":"2025-01-14T15:19:42.411000Z","iopub.execute_input":"2025-01-14T15:19:42.412000Z","shell.execute_reply":"2025-01-14T15:19:43.252000Z"}},"children":[{"type":"code","lang":"julia","executable":true,"value":"P₁ * z","key":"hyIphhYgaS"},{"type":"output","id":"ZJ6N_2MNUSlvqno8STI5S","data":[{"output_type":"execute_result","execution_count":4,"metadata":{},"data":{"text/plain":{"content":"6-element Vector{Float64}:\n 14.933184523068077\n  1.5543122344752192e-15\n  1.942890293094024e-16\n  1.3322676295501878e-15\n  1.1102230246251565e-15\n  8.881784197001252e-16","content_type":"text/plain"}}}],"key":"JGxxTIu06l"}],"key":"NoZkY5Dvh7"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Now we replace ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"jl10eIUq2i"},{"type":"inlineMath","value":"\\mathbf{A}","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi mathvariant=\"bold\">A</mi></mrow><annotation encoding=\"application/x-tex\">\\mathbf{A}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6861em;\"></span><span class=\"mord mathbf\">A</span></span></span></span>","key":"Diz9DUmQho"},{"type":"text","value":" by ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"aiHrF0DmhY"},{"type":"inlineMath","value":"\\mathbf{P}\\mathbf{A}","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi mathvariant=\"bold\">P</mi><mi mathvariant=\"bold\">A</mi></mrow><annotation encoding=\"application/x-tex\">\\mathbf{P}\\mathbf{A}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6861em;\"></span><span class=\"mord mathbf\">PA</span></span></span></span>","key":"pZ5t8MPBjL"},{"type":"text","value":".","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"ZRkP1gAnEz"}],"key":"sNqrDljKjX"}],"key":"T0fFWmEZMO"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.status.idle":"2025-01-14T15:19:43.287000Z","iopub.status.busy":"2025-01-14T15:19:43.274000Z","iopub.execute_input":"2025-01-14T15:19:43.274000Z","shell.execute_reply":"2025-01-14T15:19:43.286000Z"}},"children":[{"type":"code","lang":"julia","executable":true,"value":"A = P₁ * A","key":"qryBdy4t2s"},{"type":"output","id":"nDC6q6ZYmyGB7Ike_rfVV","data":[{"output_type":"execute_result","execution_count":5,"metadata":{},"data":{"text/plain":{"content":"6×4 Matrix{Float64}:\n 14.9332        9.70992    9.30813    14.4644\n  1.55431e-15  -0.217907   0.455298   -3.16236\n  1.94289e-16   3.47276    5.18191     4.6047\n  1.33227e-15   4.36381   -0.0904386  -1.97648\n  1.11022e-15  -0.745146  -6.36279    -3.55766\n  8.88178e-16  -0.108954   5.72765     1.41882","content_type":"text/plain"}}}],"key":"YmjNTdL4mv"}],"key":"EuWwBKcgzz"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"We are set to put zeros into column 2. We must not use row 1 in any way, lest it destroy the zeros we just introduced. So we leave it out of the next reflector.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"TtJgq7zU3Y"}],"key":"W4SOX8p0VE"}],"key":"MKj0NCcjn0"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.status.idle":"2025-01-14T15:19:43.339000Z","iopub.status.busy":"2025-01-14T15:19:43.290000Z","iopub.execute_input":"2025-01-14T15:19:43.290000Z","shell.execute_reply":"2025-01-14T15:19:43.339000Z"}},"children":[{"type":"code","lang":"julia","executable":true,"value":"z = A[2:m, 2]\nv = normalize(z - norm(z) * [1; zeros(m-2)])\nP₂ = I - 2v * v'","key":"KEvEKsnDUW"},{"type":"output","id":"17jhJWIBDK2_aFevbVc_t","data":[{"output_type":"execute_result","execution_count":6,"metadata":{},"data":{"text/plain":{"content":"5×5 Matrix{Float64}:\n -0.0386921   0.616631    0.774847   -0.13231     -0.0193461\n  0.616631    0.63393    -0.459997    0.0785472    0.011485\n  0.774847   -0.459997    0.421976    0.0987009    0.0144319\n -0.13231     0.0785472   0.0987009   0.983146    -0.00246432\n -0.0193461   0.011485    0.0144319  -0.00246432   0.99964","content_type":"text/plain"}}}],"key":"uYu1okqDXG"}],"key":"lyqwvv92Nm"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"We now apply this reflector to rows 2 and below only.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"tYqHSuaV83"}],"key":"ih6rLSfsem"}],"key":"oytZCUvAA1"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.status.idle":"2025-01-14T15:19:43.389000Z","iopub.status.busy":"2025-01-14T15:19:43.342000Z","iopub.execute_input":"2025-01-14T15:19:43.342000Z","shell.execute_reply":"2025-01-14T15:19:43.384000Z"}},"children":[{"type":"code","lang":"julia","executable":true,"value":"A[2:m, :] = P₂ * A[2:m, :]\nA","key":"PM97QGqXMJ"},{"type":"output","id":"1XOzb08iPT8_59KrAEsR9","data":[{"output_type":"execute_result","execution_count":7,"metadata":{},"data":{"text/plain":{"content":"6×4 Matrix{Float64}:\n 14.9332        9.70992       9.30813  14.4644\n  9.27893e-16   5.63183       3.83869   1.87356\n  5.6617e-16   -1.00692e-15   3.17332   1.61507\n  1.79957e-15  -6.74785e-16  -2.61439  -5.73319\n  1.03043e-15   1.99563e-16  -5.93181  -2.91618\n  8.76511e-16   2.02104e-17   5.79067   1.51262","content_type":"text/plain"}}}],"key":"v6wA2mFw97"}],"key":"SaCKlCp0aj"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"We need to iterate the process for the last two columns.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"vCupmK7ieb"}],"key":"RpTD5q7wgm"}],"key":"kw3oRdChy6"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.status.idle":"2025-01-14T15:19:43.473000Z","iopub.status.busy":"2025-01-14T15:19:43.390000Z","iopub.execute_input":"2025-01-14T15:19:43.391000Z","shell.execute_reply":"2025-01-14T15:19:43.472000Z"}},"children":[{"type":"code","lang":"julia","executable":true,"value":"for j in 3:n\n    z = A[j:m, j]\n    v = normalize(z - norm(z) * [1; zeros(m-j)])\n    P = I - 2v * v'\n    A[j:m, :] = P * A[j:m, :]\nend","key":"iWpRajJCNV"},{"type":"output","id":"qXjp8QGb1EPhcsk470Bb6","data":[],"key":"dX9k5GZrVx"}],"key":"t2tpdCIcZD"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"We have now reduced the original to an upper triangular matrix using four orthogonal Householder reflections:","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"l5bcHEQjg6"}],"key":"UMqFz47XWc"}],"key":"uQtY5JdpJH"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.status.idle":"2025-01-14T15:19:43.481000Z","iopub.status.busy":"2025-01-14T15:19:43.475000Z","iopub.execute_input":"2025-01-14T15:19:43.475000Z","shell.execute_reply":"2025-01-14T15:19:43.480000Z"}},"children":[{"type":"code","lang":"julia","executable":true,"value":"R = triu(A)","key":"IccfmtPmvc"},{"type":"output","id":"fOM5CGFCxpK98sbVEazCs","data":[{"output_type":"execute_result","execution_count":9,"metadata":{},"data":{"text/plain":{"content":"6×4 Matrix{Float64}:\n 14.9332  9.70992  9.30813  14.4644\n  0.0     5.63183  3.83869   1.87356\n  0.0     0.0      9.25328   4.98971\n  0.0     0.0      0.0       4.62307\n  0.0     0.0      0.0       0.0\n  0.0     0.0      0.0       0.0","content_type":"text/plain"}}}],"key":"hDMMQ3ueHy"}],"key":"gegDYpQLYP"}],"key":"F32kGg8CWt"},"references":{"cite":{"order":[],"data":{}}},"footer":{"navigation":{"prev":{"title":"Stable","url":"/stable-1","group":"Chapter 3"},"next":{"title":"Bessel","url":"/bessel","group":"Chapter 4"}}},"domain":"http://localhost:3000"}