{"kind":"Notebook","sha256":"444a550ee037eaa81d9127411f92512459fef82ed9396b95be59964415da3f43","slug":"chapter6-2","location":"/python/chapter6.md","dependencies":[],"frontmatter":{"title":"Chapter 6","numbering":{"heading_1":{"enabled":false},"heading_2":{"enabled":false},"heading_3":{"enabled":false},"heading_4":{"enabled":false},"heading_5":{"enabled":false},"heading_6":{"enabled":false}},"kernelspec":{"name":"python3","display_name":"Python 3","language":"python"},"content_includes_title":false,"authors":[{"nameParsed":{"literal":"Tobin A. Driscoll","given":"Tobin A.","family":"Driscoll"},"name":"Tobin A. Driscoll","email":"driscoll@udel.edu","id":"contributors-myst-generated-uid-0","corresponding":true},{"nameParsed":{"literal":"Richard J. Braun","given":"Richard J.","family":"Braun"},"name":"Richard J. Braun","id":"contributors-myst-generated-uid-1"}],"github":"https://github.com/fncbook/fnc","math":{"\\float":{"macro":"\\mathbb{F}"},"\\real":{"macro":"\\mathbb{R}"},"\\complex":{"macro":"\\mathbb{C}"},"\\nat":{"macro":"\\mathbb{N}"},"\\integer":{"macro":"\\mathbb{Z}"},"\\rmn":{"macro":"\\mathbb{R}^{#1 \\times #2}"},"\\dd":{"macro":"\\frac{d #1}{d #2}"},"\\ddd":{"macro":"\\frac{d^2 #1}{d #2^2}"},"\\pp":{"macro":"\\frac{\\partial #1}{\\partial #2}"},"\\ppp":{"macro":"\\frac{\\partial^2 #1}{\\partial #2^2}"},"\\ppdd":{"macro":"\\frac{\\partial^2 #1}{\\partial #2 \\partial #3}"},"\\abs":{"macro":"\\left\\lvert #1 \\right\\rvert"},"\\norm":{"macro":"\\left\\lVert #1 \\right\\rVert"},"\\twonorm":{"macro":"\\norm{#1}_2"},"\\onenorm":{"macro":"\\norm{#1}_1"},"\\infnorm":{"macro":"\\norm{#1}_\\infty"},"\\anynorm":{"macro":"\\norm{#1}_#2"},"\\innerprod":{"macro":"\\langle #1,#2 \\rangle"},"\\pr":{"macro":"^{(#1)}"},"\\kron":{"macro":"#1 \\otimes #2"},"\\eye":{"macro":"\\mathbf{e}_#1"},"\\meye":{"macro":"\\mathbf{I}"},"\\Qhat":{"macro":"\\hat{\\mathbf{Q}}"},"\\Rhat":{"macro":"\\hat{\\mathbf{R}}"},"\\bfalpha":{"macro":"\\mathbf{alpha}"},"\\bfdelta":{"macro":"\\mathbf{delta}"},"\\bfzero":{"macro":"\\boldsymbol{0}"},"\\macheps":{"macro":"\\epsilon_\\text{mach}"},"\\fl":{"macro":"\\operatorname{fl}"},"\\diag":{"macro":"\\operatorname{diag}"},"\\ign":{"macro":"\\operatorname{sign}"},"\\Re":{"macro":"\\operatorname{Re}"},"\\Im":{"macro":"\\operatorname{Im}"},"\\ee":{"macro":"\\times 10^"},"\\lnorm":{"macro":"\\|"},"\\rnorm":{"macro":"\\|"},"\\floor":{"macro":"\\lfloor#1\\rfloor"},"\\cI":{"macro":"\\mathcal{I}"},"\\mtx":{"macro":"\\operatorname{mtx}"},"\\myvec":{"macro":"\\operatorname{vec}"},"\\argmin":{"macro":"\\operatorname{argmin}"}},"abbreviations":{"LU":"lower triangular times upper triangular","QR":"orthogonal times upper triangular"},"exports":[{"format":"md","filename":"chapter6.md","url":"/fnc/build/chapter6-61a48ab90d0a59f97ca23d97a0e6fd50.md"}]},"mdast":{"type":"root","children":[{"type":"block","children":[{"type":"heading","depth":2,"position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"children":[{"type":"text","value":"Functions","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"key":"awSrZB8d9g"}],"identifier":"functions","label":"Functions","html_id":"functions","implicit":true,"key":"ODkt8arvIf"},{"type":"details","children":[{"type":"summary","children":[{"type":"text","value":"Euler’s method for an initial-value problem","position":{"start":{"line":14,"column":1},"end":{"line":14,"column":1}},"key":"beLzweKPoI"}],"key":"RenFbAzE8c"},{"type":"include","file":"../python/pkg/FNC/FNC06.py","literal":true,"filter":{"startAt":"def euler","endAt":"return t"},"children":[{"type":"code","value":"def euler(dudt, tspan, u0, n):\n    \"\"\"\n    euler(dudt,tspan,u0,n)\n\n    Apply Euler's method to solve the IVP u'=`dudt`(u,t) over the interval `tspan` with\n    u(`tspan[1]`)=`u0`, using `n` subintervals/steps. Return vectors of times and solution\n    values.\n    \"\"\"\n    a, b = tspan\n    h = (b - a) / n\n    t = np.linspace(a, b, n+1)\n    u = np.tile(np.array(u0), (n+1, 1))\n    for i in range(n):\n        u[i+1] = u[i] + h * dudt(t[i], u[i])\n\n    return t, u.T","lang":"python","showLineNumbers":true,"filename":"euler.py","key":"cYxI2vOHaT"}],"key":"pN4oM4G1ZT"}],"label":"function-euler-python","identifier":"function-euler-python","html_id":"function-euler-python","key":"lqfocsYtEf"},{"type":"details","children":[{"type":"summary","children":[{"type":"text","value":"Improved Euler method for an IVP","position":{"start":{"line":25,"column":1},"end":{"line":25,"column":1}},"key":"rrnmAAcXcJ"}],"key":"Q4l3QU7dXn"},{"type":"include","file":"../python/pkg/FNC/FNC06.py","literal":true,"filter":{"startAt":"def ie2","endAt":"return t"},"children":[{"type":"code","value":"def ie2(dudt, tspan, u0, n):\n    \"\"\"\n    ie2(dudt,tspan,u0,n)\n\n    Apply the Improved Euler method to solve the vector-valued IVP u'=`dudt`(u,p,t) over the\n    interval `tspan` with u(`tspan[1]`)=`u0`, using `n` subintervals/steps. Returns a vector\n    of times and a vector of solution values/vectors.\n    \"\"\"\n    # Time discretization.\n    a, b = tspan\n    h = (b - a) / n\n    t = np.linspace(a, b, n + 1)\n\n    # Initialize output.\n    u = np.tile(np.array(u0), (n+1, 1))\n\n    # Time stepping.\n    for i in range(n):\n        uhalf = u[i] + h / 2 * dudt(t[i], u[i])\n        u[i+1] = u[i] + h * dudt(t[i] + h / 2, uhalf)\n\n    return t, u.T","lang":"python","showLineNumbers":true,"filename":"ie2.py","key":"QwqC541sKA"}],"key":"QaNFfatm4M"}],"label":"function-ie2-python","identifier":"function-ie2-python","html_id":"function-ie2-python","key":"u5e9hsebuR"},{"type":"details","children":[{"type":"summary","children":[{"type":"text","value":"Fourth-order Runge-Kutta for an IVP","position":{"start":{"line":36,"column":1},"end":{"line":36,"column":1}},"key":"f1kiKUAv5F"}],"key":"xWtw2ByCU6"},{"type":"include","file":"../python/pkg/FNC/FNC06.py","literal":true,"filter":{"startAt":"def rk4","endAt":"return t"},"children":[{"type":"code","value":"def rk4(dudt, tspan, u0, n):\n    \"\"\"\n    rk4(dudt,tspan,u0,n)\n\n    Apply \"the\" Runge-Kutta 4th order method to solve the vector-valued IVP u'=`dudt`(u,p,t)\n    over the interval `tspan` with u(`tspan[1]`)=`u0`, using `n` subintervals/steps.\n    Return a vector of times and a vector of solution values/vectors.\n    \"\"\"\n    # Time discretization.\n    a, b = tspan\n    h = (b - a) / n\n    t = np.linspace(a, b, n + 1)\n\n    # Initialize output.\n    u = np.tile(np.array(u0), (n+1, 1))\n\n    # Time stepping.\n    for i in range(n):\n        k1 = h * dudt(t[i], u[i])\n        k2 = h * dudt(t[i] + h / 2, u[i] + k1 / 2)\n        k3 = h * dudt(t[i] + h / 2, u[i] + k2 / 2)\n        k4 = h * dudt(t[i] + h, u[i] + k3)\n        u[i+1] = u[i] + (k1 + 2 * (k2 + k3) + k4) / 6\n\n    return t, u.T","lang":"python","showLineNumbers":true,"filename":"rk4.py","key":"jT4tJqgUdq"}],"key":"l9kYYcSfez"}],"label":"function-rk4-python","identifier":"function-rk4-python","html_id":"function-rk4-python","key":"gs12K7ZZBt"},{"type":"details","children":[{"type":"summary","children":[{"type":"text","value":"Adaptive IVP solver based on embedded RK formulas","position":{"start":{"line":47,"column":1},"end":{"line":47,"column":1}},"key":"uKpYtePACP"}],"key":"gaKgURU2PJ"},{"type":"include","file":"../python/pkg/FNC/FNC06.py","literal":true,"filter":{"startAt":"def euler","endAt":"return"},"children":[{"type":"code","value":"def euler(dudt, tspan, u0, n):\n    \"\"\"\n    euler(dudt,tspan,u0,n)\n\n    Apply Euler's method to solve the IVP u'=`dudt`(u,t) over the interval `tspan` with\n    u(`tspan[1]`)=`u0`, using `n` subintervals/steps. Return vectors of times and solution\n    values.\n    \"\"\"\n    a, b = tspan\n    h = (b - a) / n\n    t = np.linspace(a, b, n+1)\n    u = np.tile(np.array(u0), (n+1, 1))\n    for i in range(n):\n        u[i+1] = u[i] + h * dudt(t[i], u[i])\n\n    return t, u.T","lang":"python","showLineNumbers":true,"filename":"rk23.py","key":"oa2W2LVrtr"}],"key":"Px7spoNexE"},{"type":"admonition","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"About the code","position":{"start":{"line":55,"column":1},"end":{"line":55,"column":1}},"key":"DFM20uIZbd"}],"key":"dWCUbr9TGW"},{"type":"paragraph","position":{"start":{"line":57,"column":1},"end":{"line":57,"column":1}},"children":[{"type":"text","value":"The check ","position":{"start":{"line":57,"column":1},"end":{"line":57,"column":1}},"key":"YAZ6UXC4oR"},{"type":"inlineCode","value":"t[i]+h==t[i]","position":{"start":{"line":57,"column":1},"end":{"line":57,"column":1}},"key":"aYnIsitvrs"},{"type":"text","value":"on line 19 is to detect when ","position":{"start":{"line":57,"column":1},"end":{"line":57,"column":1}},"key":"ZGDv5PdxYq"},{"type":"inlineMath","value":"h","position":{"start":{"line":57,"column":1},"end":{"line":57,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>h</mi></mrow><annotation encoding=\"application/x-tex\">h</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6944em;\"></span><span class=\"mord mathnormal\">h</span></span></span></span>","key":"cOWJMVKj9M"},{"type":"text","value":" has become so small that it no longer changes the floating-point value of ","position":{"start":{"line":57,"column":1},"end":{"line":57,"column":1}},"key":"SYnBe46NqK"},{"type":"inlineMath","value":"t_i","position":{"start":{"line":57,"column":1},"end":{"line":57,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>t</mi><mi>i</mi></msub></mrow><annotation encoding=\"application/x-tex\">t_i</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.7651em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">t</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3117em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span>","key":"EKI8hpOgh2"},{"type":"text","value":". This may be a sign that the underlying exact solution has a singularity near ","position":{"start":{"line":57,"column":1},"end":{"line":57,"column":1}},"key":"ZMFTn8bwAP"},{"type":"inlineMath","value":"t=t_i","position":{"start":{"line":57,"column":1},"end":{"line":57,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>t</mi><mo>=</mo><msub><mi>t</mi><mi>i</mi></msub></mrow><annotation encoding=\"application/x-tex\">t=t_i</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6151em;\"></span><span class=\"mord mathnormal\">t</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.7651em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">t</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3117em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span>","key":"uNpn3paLwP"},{"type":"text","value":", but in any case, the solver must halt by using a ","position":{"start":{"line":57,"column":1},"end":{"line":57,"column":1}},"key":"ZEe0sI0ZiX"},{"type":"inlineCode","value":"break","position":{"start":{"line":57,"column":1},"end":{"line":57,"column":1}},"key":"LJy45cQS1R"},{"type":"text","value":" statement to exit the loop.","position":{"start":{"line":57,"column":1},"end":{"line":57,"column":1}},"key":"h97NyKFAmN"}],"key":"I4WE7EZrR8"},{"type":"paragraph","position":{"start":{"line":59,"column":1},"end":{"line":59,"column":1}},"children":[{"type":"text","value":"On line 30, we use a combination of absolute and relative tolerances to judge the acceptability of a solution value, as in ","position":{"start":{"line":59,"column":1},"end":{"line":59,"column":1}},"key":"hPc9rIpq9L"},{"type":"crossReference","kind":"equation","identifier":"absreltolerance","label":"absreltolerance","children":[{"type":"text","value":"(","key":"pplcNdMT4o"},{"type":"text","value":"5.7.6","key":"QvfeJKooNQ"},{"type":"text","value":")","key":"d12aOMrDBp"}],"template":"(%s)","enumerator":"5.7.6","resolved":true,"html_id":"absreltolerance","remote":true,"url":"/adaptive","dataUrl":"/adaptive.json","key":"lf6HJwl1kC"},{"type":"text","value":". In lines 41--43 we underestimate the step factor ","position":{"start":{"line":59,"column":1},"end":{"line":59,"column":1}},"key":"wuHtGY85JH"},{"type":"inlineMath","value":"q","position":{"start":{"line":59,"column":1},"end":{"line":59,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>q</mi></mrow><annotation encoding=\"application/x-tex\">q</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.625em;vertical-align:-0.1944em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">q</span></span></span></span>","key":"HiQeEXUyOR"},{"type":"text","value":" a bit and prevent a huge increase in the step size, since a rejected step is expensive, and then we make sure that our final step doesn’t take us past the end of the domain.","position":{"start":{"line":59,"column":1},"end":{"line":59,"column":1}},"key":"dHwM6HS2KJ"}],"key":"dtUDUqx8lQ"},{"type":"paragraph","position":{"start":{"line":61,"column":1},"end":{"line":62,"column":1}},"children":[{"type":"text","value":"Finally, line 37 exploits a subtle property of the BS23 formula called ","position":{"start":{"line":61,"column":1},"end":{"line":61,"column":1}},"key":"PR7koEDf0B"},{"type":"emphasis","position":{"start":{"line":61,"column":1},"end":{"line":61,"column":1}},"children":[{"type":"text","value":"first same as last","position":{"start":{"line":61,"column":1},"end":{"line":61,"column":1}},"key":"qlz4oxxSR1"}],"key":"y2ZgNV3Zdc"},{"type":"text","value":" (FSAL).\nWhile ","position":{"start":{"line":61,"column":1},"end":{"line":61,"column":1}},"key":"TV3OKgjLVm"},{"type":"crossReference","kind":"equation","identifier":"bs23","label":"bs23","children":[{"type":"text","value":"(","key":"jAQgKBO7rf"},{"type":"text","value":"6.5.5","key":"MPOGMv55rj"},{"type":"text","value":")","key":"g3iqKKbdLz"}],"template":"(%s)","enumerator":"6.5.5","resolved":true,"html_id":"bs23","remote":true,"url":"/adaptive-rk","dataUrl":"/adaptive-rk.json","key":"Ip4d6PLTuk"},{"type":"text","value":" calls for four stages to find the paired second- and third-order estimates, the final stage computed in stepping from ","position":{"start":{"line":61,"column":1},"end":{"line":61,"column":1}},"key":"LD9rhx8Jhq"},{"type":"inlineMath","value":"t_i","position":{"start":{"line":61,"column":1},"end":{"line":61,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>t</mi><mi>i</mi></msub></mrow><annotation encoding=\"application/x-tex\">t_i</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.7651em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">t</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3117em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span>","key":"fpzMJK8AIB"},{"type":"text","value":" to ","position":{"start":{"line":61,"column":1},"end":{"line":61,"column":1}},"key":"Vpc6OfonrE"},{"type":"inlineMath","value":"t_{i+1}","position":{"start":{"line":61,"column":1},"end":{"line":61,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>t</mi><mrow><mi>i</mi><mo>+</mo><mn>1</mn></mrow></msub></mrow><annotation encoding=\"application/x-tex\">t_{i+1}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8234em;vertical-align:-0.2083em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">t</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3117em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">i</span><span class=\"mbin mtight\">+</span><span class=\"mord mtight\">1</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.2083em;\"><span></span></span></span></span></span></span></span></span></span>","key":"ISNPsoeKsn"},{"type":"text","value":" is identical to the first stage needed to step from ","position":{"start":{"line":61,"column":1},"end":{"line":61,"column":1}},"key":"C5jGAlLj9n"},{"type":"inlineMath","value":"t_{i+1}","position":{"start":{"line":61,"column":1},"end":{"line":61,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>t</mi><mrow><mi>i</mi><mo>+</mo><mn>1</mn></mrow></msub></mrow><annotation encoding=\"application/x-tex\">t_{i+1}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8234em;vertical-align:-0.2083em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">t</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3117em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">i</span><span class=\"mbin mtight\">+</span><span class=\"mord mtight\">1</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.2083em;\"><span></span></span></span></span></span></span></span></span></span>","key":"pZlmq4OP7b"},{"type":"text","value":" to ","position":{"start":{"line":61,"column":1},"end":{"line":61,"column":1}},"key":"SxnXSOiURr"},{"type":"inlineMath","value":"t_{i+2}","position":{"start":{"line":61,"column":1},"end":{"line":61,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>t</mi><mrow><mi>i</mi><mo>+</mo><mn>2</mn></mrow></msub></mrow><annotation encoding=\"application/x-tex\">t_{i+2}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8234em;vertical-align:-0.2083em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">t</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3117em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">i</span><span class=\"mbin mtight\">+</span><span class=\"mord mtight\">2</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.2083em;\"><span></span></span></span></span></span></span></span></span></span>","key":"KOA74894lv"},{"type":"text","value":". By repurposing ","position":{"start":{"line":61,"column":1},"end":{"line":61,"column":1}},"key":"bldbMdVJVV"},{"type":"inlineCode","value":"s₄","position":{"start":{"line":61,"column":1},"end":{"line":61,"column":1}},"key":"Mttl78wrtP"},{"type":"text","value":" as ","position":{"start":{"line":61,"column":1},"end":{"line":61,"column":1}},"key":"MM4D4oawEZ"},{"type":"inlineCode","value":"s₁","position":{"start":{"line":61,"column":1},"end":{"line":61,"column":1}},"key":"QNFHHgc5uO"},{"type":"text","value":" for the next pass, one of the stage evaluations comes for free, and only three evaluations of ","position":{"start":{"line":61,"column":1},"end":{"line":61,"column":1}},"key":"WvdpUcCEsG"},{"type":"inlineMath","value":"f","position":{"start":{"line":61,"column":1},"end":{"line":61,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>f</mi></mrow><annotation encoding=\"application/x-tex\">f</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8889em;vertical-align:-0.1944em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.10764em;\">f</span></span></span></span>","key":"D6tcKxWUAU"},{"type":"text","value":" are needed per successful step.","position":{"start":{"line":61,"column":1},"end":{"line":61,"column":1}},"key":"QWRXjCj6PH"}],"key":"Xlk3LhFCpt"}],"class":"dropdown","key":"KB1OkLnSBU"}],"label":"function-rk23-python","identifier":"function-rk23-python","html_id":"function-rk23-python","key":"xl5MlBpfL7"},{"type":"details","children":[{"type":"summary","children":[{"type":"text","value":"4th-order Adams–Bashforth formula for an IVP","position":{"start":{"line":68,"column":1},"end":{"line":68,"column":1}},"key":"hEKmt5sk4z"}],"key":"wmx4F2YxnP"},{"type":"include","file":"../python/pkg/FNC/FNC06.py","literal":true,"filter":{"startAt":"def ab4","endAt":"return t"},"children":[{"type":"code","value":"def ab4(dudt, tspan, u0, n):\n    \"\"\"\n    ab4(dudt,tspan,u0,n)\n\n    Apply the Adams-Bashforth 4th order method to solve the vector-valued IVP u'=`dudt`(u,p,t)\n    over the interval `tspan` with u(`tspan[1]`)=`u0`, using `n` subintervals/steps.\n    \"\"\"\n    # Time discretization.\n    a, b = tspan\n    h = (b - a) / n\n    t = np.linspace(a, b, n + 1)\n\n    # Constants in the AB4 method.\n    k = 4\n    sigma = np.array([55, -59, 37, -9]) / 24\n\n    # Find starting values by RK4.\n    ts, us = rk4(dudt, [a, a + (k - 1) * h], u0, k - 1)\n    u = np.tile(np.array(u0), (n+1, 1))\n    u[:k] = us[:k].T\n\n    # Compute history of u' values, from newest to oldest.\n    f = np.array([dudt(t[k-j-2], u[k-j-2]) for j in range(k)])\n\n    # Time stepping.\n    for i in range(k-1, n):\n        f = np.vstack([dudt(t[i], u[i]), f[:-1]])  # new value of du/dt\n        u[i+1] = u[i] + h * np.dot(sigma, f)  # advance one step\n\n    return t, u.T","lang":"python","showLineNumbers":true,"filename":"ab4.py","key":"Zf37sfHybn"}],"key":"T1PnziHlqO"},{"type":"admonition","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"About the code","position":{"start":{"line":76,"column":1},"end":{"line":76,"column":1}},"key":"rooDEp0VuE"}],"key":"un8gDxRAmP"},{"type":"paragraph","position":{"start":{"line":78,"column":1},"end":{"line":78,"column":1}},"children":[{"type":"text","value":"Line 15 sets ","position":{"start":{"line":78,"column":1},"end":{"line":78,"column":1}},"key":"O4n7j4RuIx"},{"type":"inlineCode","value":"σ","position":{"start":{"line":78,"column":1},"end":{"line":78,"column":1}},"key":"P5ZfBeKV1a"},{"type":"text","value":" to be the coefficients of the generating polynomial ","position":{"start":{"line":78,"column":1},"end":{"line":78,"column":1}},"key":"uGsS4dQl4y"},{"type":"inlineMath","value":"\\sigma(z)","position":{"start":{"line":78,"column":1},"end":{"line":78,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>σ</mi><mo stretchy=\"false\">(</mo><mi>z</mi><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">\\sigma(z)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">σ</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\" style=\"margin-right:0.04398em;\">z</span><span class=\"mclose\">)</span></span></span></span>","key":"WQOFvqlnmG"},{"type":"text","value":" of AB4. Lines 19--21 set up the IVP over the time interval ","position":{"start":{"line":78,"column":1},"end":{"line":78,"column":1}},"key":"nZ3KdYULKK"},{"type":"inlineMath","value":"a \\le t \\le a+3 h","position":{"start":{"line":78,"column":1},"end":{"line":78,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>a</mi><mo>≤</mo><mi>t</mi><mo>≤</mo><mi>a</mi><mo>+</mo><mn>3</mn><mi>h</mi></mrow><annotation encoding=\"application/x-tex\">a \\le t \\le a+3 h</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.7719em;vertical-align:-0.136em;\"></span><span class=\"mord mathnormal\">a</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.7719em;vertical-align:-0.136em;\"></span><span class=\"mord mathnormal\">t</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6667em;vertical-align:-0.0833em;\"></span><span class=\"mord mathnormal\">a</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6944em;\"></span><span class=\"mord\">3</span><span class=\"mord mathnormal\">h</span></span></span></span>","key":"OpGLQFSvTp"},{"type":"text","value":", call ","position":{"start":{"line":78,"column":1},"end":{"line":78,"column":1}},"key":"szpFT7VD87"},{"type":"inlineCode","value":"rk4","position":{"start":{"line":78,"column":1},"end":{"line":78,"column":1}},"key":"pS270Aa73s"},{"type":"text","value":" to solve it using the step size ","position":{"start":{"line":78,"column":1},"end":{"line":78,"column":1}},"key":"Pr9lb3ptBf"},{"type":"inlineMath","value":"h","position":{"start":{"line":78,"column":1},"end":{"line":78,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>h</mi></mrow><annotation encoding=\"application/x-tex\">h</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6944em;\"></span><span class=\"mord mathnormal\">h</span></span></span></span>","key":"DUVPjDpTyG"},{"type":"text","value":", and use the result to fill the first four values of the solution. Then line 24 computes the vector ","position":{"start":{"line":78,"column":1},"end":{"line":78,"column":1}},"key":"HZevzOe9Y4"},{"type":"inlineMath","value":"[f_2,f_1,f_0]","position":{"start":{"line":78,"column":1},"end":{"line":78,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mo stretchy=\"false\">[</mo><msub><mi>f</mi><mn>2</mn></msub><mo separator=\"true\">,</mo><msub><mi>f</mi><mn>1</mn></msub><mo separator=\"true\">,</mo><msub><mi>f</mi><mn>0</mn></msub><mo stretchy=\"false\">]</mo></mrow><annotation encoding=\"application/x-tex\">[f_2,f_1,f_0]</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mopen\">[</span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.10764em;\">f</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3011em;\"><span style=\"top:-2.55em;margin-left:-0.1076em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.10764em;\">f</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3011em;\"><span style=\"top:-2.55em;margin-left:-0.1076em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">1</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.10764em;\">f</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3011em;\"><span style=\"top:-2.55em;margin-left:-0.1076em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">0</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mclose\">]</span></span></span></span>","key":"YTs1aHXvnV"},{"type":"text","value":".","position":{"start":{"line":78,"column":1},"end":{"line":78,"column":1}},"key":"oh96ZiI7Qk"}],"key":"YqAB6izgMz"},{"type":"paragraph","position":{"start":{"line":80,"column":1},"end":{"line":80,"column":1}},"children":[{"type":"text","value":"Line 28 computes ","position":{"start":{"line":80,"column":1},"end":{"line":80,"column":1}},"key":"coHNSjCT0B"},{"type":"inlineMath","value":"f_i","position":{"start":{"line":80,"column":1},"end":{"line":80,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>f</mi><mi>i</mi></msub></mrow><annotation encoding=\"application/x-tex\">f_i</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8889em;vertical-align:-0.1944em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.10764em;\">f</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3117em;\"><span style=\"top:-2.55em;margin-left:-0.1076em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span>","key":"FVzg1cBIL1"},{"type":"text","value":", based on the most recent solution value and time. That goes into the first spot of ","position":{"start":{"line":80,"column":1},"end":{"line":80,"column":1}},"key":"yk7u0n5fOO"},{"type":"inlineCode","value":"f","position":{"start":{"line":80,"column":1},"end":{"line":80,"column":1}},"key":"Chzr8lsH4b"},{"type":"text","value":", followed by the three values that were previously most recent. These are the four values that appear in ","position":{"start":{"line":80,"column":1},"end":{"line":80,"column":1}},"key":"CFwGTCa6mS"},{"type":"crossReference","kind":"equation","identifier":"ab4","label":"ab4","children":[{"type":"text","value":"(","key":"zWyBwHEAHi"},{"type":"text","value":"6.7.1","key":"tDnr32c97j"},{"type":"text","value":")","key":"j0w8GDp4xo"}],"template":"(%s)","enumerator":"6.7.1","resolved":true,"html_id":"ab4","remote":true,"url":"/implicit","dataUrl":"/implicit.json","key":"vofT6SRHvN"},{"type":"text","value":". Each particular ","position":{"start":{"line":80,"column":1},"end":{"line":80,"column":1}},"key":"PtKJoRM3HH"},{"type":"inlineMath","value":"f_i","position":{"start":{"line":80,"column":1},"end":{"line":80,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>f</mi><mi>i</mi></msub></mrow><annotation encoding=\"application/x-tex\">f_i</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8889em;vertical-align:-0.1944em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.10764em;\">f</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3117em;\"><span style=\"top:-2.55em;margin-left:-0.1076em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span>","key":"mRXO6gLmkz"},{"type":"text","value":" value starts at the front of ","position":{"start":{"line":80,"column":1},"end":{"line":80,"column":1}},"key":"hYk7EyFnwi"},{"type":"inlineCode","value":"f","position":{"start":{"line":80,"column":1},"end":{"line":80,"column":1}},"key":"nVsXxgBDOr"},{"type":"text","value":", moves through each position in the vector over three iterations, and then is forgotten.","position":{"start":{"line":80,"column":1},"end":{"line":80,"column":1}},"key":"ZH1o0Ncz35"}],"key":"jjosyKRhK8"}],"class":"dropdown","key":"TQMZMbcidd"}],"label":"function-ab4-python","identifier":"function-ab4-python","html_id":"function-ab4-python","key":"X34WheKsGt"},{"type":"details","children":[{"type":"summary","children":[{"type":"text","value":"2nd-order Adams–Moulton (trapezoid) formula for an IVP","position":{"start":{"line":85,"column":1},"end":{"line":85,"column":1}},"key":"vnGPyLdXF8"}],"key":"JbLFW436zz"},{"type":"include","file":"../python/pkg/FNC/FNC06.py","literal":true,"filter":{"startAt":"def am2","endAt":"return t"},"children":[{"type":"code","value":"def am2(dudt, tspan, u0, n):\n    \"\"\"\n    am2(dudt,tspan,u0,n)\n\n    Apply the Adams-Moulton 2nd order method to solve the vector-valued IVP u'=`dudt`(u,p,t)\n    over the interval `tspan` with u(`tspan[1]`)=`u0`, using `n` subintervals/steps.\n    \"\"\"\n    # Time discretization.\n    a, b = tspan\n    h = (b - a) / n\n    t = np.linspace(a, b, n + 1)\n\n    # Initialize output.\n    u = np.tile(np.array(u0), (n+1, 1))\n\n    # Time stepping.\n    for i in range(n):\n        # Data that does not depend on the new value.\n        known = u[i] + h / 2 * dudt(t[i], u[i])\n        # Find a root for the new value.\n        F = lambda z: z - h / 2 * dudt(t[i+1], z) - known\n        unew = levenberg(F, known)\n        u[i+1] = unew[:, -1]\n\n    return t, u.T","lang":"python","showLineNumbers":true,"filename":"am2.py","key":"RWBUPyMFyi"}],"key":"X0RHmqGTHE"},{"type":"admonition","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"About the code","position":{"start":{"line":93,"column":1},"end":{"line":93,"column":1}},"key":"XSjtaX988b"}],"key":"Ay03EiCiOb"},{"type":"paragraph","position":{"start":{"line":95,"column":1},"end":{"line":95,"column":1}},"children":[{"type":"text","value":"Lines 22-23 define the function ","position":{"start":{"line":95,"column":1},"end":{"line":95,"column":1}},"key":"FUUWbdngyV"},{"type":"inlineMath","value":"\\mathbf{g}","position":{"start":{"line":95,"column":1},"end":{"line":95,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi mathvariant=\"bold\">g</mi></mrow><annotation encoding=\"application/x-tex\">\\mathbf{g}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6389em;vertical-align:-0.1944em;\"></span><span class=\"mord mathbf\" style=\"margin-right:0.01597em;\">g</span></span></span></span>","key":"h2habZROFO"},{"type":"text","value":" and call ","position":{"start":{"line":95,"column":1},"end":{"line":95,"column":1}},"key":"AikF5VZgki"},{"type":"inlineCode","value":"levenberg","position":{"start":{"line":95,"column":1},"end":{"line":95,"column":1}},"key":"M16eLeem57"},{"type":"text","value":" to find the new solution value, using an Euler half-step as its starting value. A robust code would have to intercept the case where ","position":{"start":{"line":95,"column":1},"end":{"line":95,"column":1}},"key":"zmQFaZucqa"},{"type":"inlineCode","value":"levenberg","position":{"start":{"line":95,"column":1},"end":{"line":95,"column":1}},"key":"gwJ6evPpAF"},{"type":"text","value":" fails to converge, but we have ignored this issue for the sake of brevity.","position":{"start":{"line":95,"column":1},"end":{"line":95,"column":1}},"key":"nkh6I9WXKJ"}],"key":"ZJPNplzyk5"}],"class":"dropdown","key":"TXSkA4BRgp"}],"label":"function-am2-python","identifier":"function-am2-python","html_id":"function-am2-python","key":"VSMxdfuUIj"},{"type":"heading","depth":2,"position":{"start":{"line":99,"column":1},"end":{"line":99,"column":1}},"children":[{"type":"text","value":"Examples","position":{"start":{"line":99,"column":1},"end":{"line":99,"column":1}},"key":"AvUmlCvK4e"}],"identifier":"examples","label":"Examples","html_id":"examples","implicit":true,"key":"NK1zwkKG8T"}],"key":"aFuD1NoNxn"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"from numpy import *\nfrom numpy.linalg import norm\nfrom matplotlib.pyplot import *\nfrom prettytable import PrettyTable\nimport sys\nsys.path.append('pkg/')\nimport FNC\nimport importlib\nimportlib.reload(FNC)","key":"vjHUc5wP2k"},{"type":"output","id":"B77ZA-t_ut-_cSOXB13V4","data":[],"key":"uZZbEmXFpt"}],"data":{},"key":"uP81s1Pte5"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# This (optional) block is for improving the display of plots.\nrcParams[\"figure.figsize\"] = [7, 4]\nrcParams[\"lines.linewidth\"] = 2\nrcParams[\"lines.markersize\"] = 4\nrcParams['animation.html'] = \"jshtml\"  # or try \"html5\"","visibility":"show","key":"ERFpz132CS"},{"type":"output","id":"N74DXWE9smWVEq7KbZ6kn","data":[],"visibility":"show","key":"X6P8oX6Nuu"}],"data":{"tags":[]},"visibility":"remove","key":"CqY5BewQ4p"},{"type":"block","children":[{"type":"heading","depth":3,"position":{"start":{"line":122,"column":1},"end":{"line":122,"column":1}},"children":[{"type":"text","value":"Section 6.1","position":{"start":{"line":122,"column":1},"end":{"line":122,"column":1}},"key":"yhyzSZu5PQ"}],"identifier":"section-6-1","label":"Section 6.1","html_id":"section-6-1","implicit":true,"key":"Ja4atF9gcY"},{"type":"details","children":[{"type":"summary","children":[{"type":"text","value":"Solving an IVP","position":{"start":{"line":125,"column":1},"end":{"line":125,"column":1}},"key":"HQkwp1qNls"}],"key":"TKIWbY5RFg"},{"type":"paragraph","position":{"start":{"line":126,"column":1},"end":{"line":126,"column":1}},"children":[{"type":"text","value":"Let’s use ","position":{"start":{"line":126,"column":1},"end":{"line":126,"column":1}},"key":"AaMUxhOQcf"},{"type":"inlineCode","value":"solve_ivp","position":{"start":{"line":126,"column":1},"end":{"line":126,"column":1}},"key":"tqG9Ycjxrv"},{"type":"text","value":" from ","position":{"start":{"line":126,"column":1},"end":{"line":126,"column":1}},"key":"zphfOlfhKY"},{"type":"inlineCode","value":"scipy.integrate","position":{"start":{"line":126,"column":1},"end":{"line":126,"column":1}},"key":"L5U3pqyFWf"},{"type":"text","value":" to define and solve an initial-value problem for ","position":{"start":{"line":126,"column":1},"end":{"line":126,"column":1}},"key":"cTNKV49L6N"},{"type":"inlineMath","value":"u'=\\sin[(u+t)^2]","position":{"start":{"line":126,"column":1},"end":{"line":126,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msup><mi>u</mi><mo mathvariant=\"normal\" lspace=\"0em\" rspace=\"0em\">′</mo></msup><mo>=</mo><mi>sin</mi><mo>⁡</mo><mo stretchy=\"false\">[</mo><mo stretchy=\"false\">(</mo><mi>u</mi><mo>+</mo><mi>t</mi><msup><mo stretchy=\"false\">)</mo><mn>2</mn></msup><mo stretchy=\"false\">]</mo></mrow><annotation encoding=\"application/x-tex\">u&#x27;=\\sin[(u+t)^2]</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.7519em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">u</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.7519em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">′</span></span></span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mop\">sin</span><span class=\"mopen\">[(</span><span class=\"mord mathnormal\">u</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1.0641em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\">t</span><span class=\"mclose\"><span class=\"mclose\">)</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span></span></span></span></span><span class=\"mclose\">]</span></span></span></span>","key":"Nb1Ps9SnHa"},{"type":"text","value":" over ","position":{"start":{"line":126,"column":1},"end":{"line":126,"column":1}},"key":"JhNsNQ26q7"},{"type":"inlineMath","value":"t \\in [0,4]","position":{"start":{"line":126,"column":1},"end":{"line":126,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>t</mi><mo>∈</mo><mo stretchy=\"false\">[</mo><mn>0</mn><mo separator=\"true\">,</mo><mn>4</mn><mo stretchy=\"false\">]</mo></mrow><annotation encoding=\"application/x-tex\">t \\in [0,4]</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6542em;vertical-align:-0.0391em;\"></span><span class=\"mord mathnormal\">t</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">∈</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mopen\">[</span><span class=\"mord\">0</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord\">4</span><span class=\"mclose\">]</span></span></span></span>","key":"WMrgVksVvw"},{"type":"text","value":", such that ","position":{"start":{"line":126,"column":1},"end":{"line":126,"column":1}},"key":"BhO7DQ7vbF"},{"type":"inlineMath","value":"u(0)=-1","position":{"start":{"line":126,"column":1},"end":{"line":126,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>u</mi><mo stretchy=\"false\">(</mo><mn>0</mn><mo stretchy=\"false\">)</mo><mo>=</mo><mo>−</mo><mn>1</mn></mrow><annotation encoding=\"application/x-tex\">u(0)=-1</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\">u</span><span class=\"mopen\">(</span><span class=\"mord\">0</span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.7278em;vertical-align:-0.0833em;\"></span><span class=\"mord\">−</span><span class=\"mord\">1</span></span></span></span>","key":"i3vIW8vqfv"},{"type":"text","value":".","position":{"start":{"line":126,"column":1},"end":{"line":126,"column":1}},"key":"BUl7vDi1E0"}],"key":"yB7HE2NDdg"},{"type":"paragraph","position":{"start":{"line":128,"column":1},"end":{"line":128,"column":1}},"children":[{"type":"text","value":"To create an initial-value problem for ","position":{"start":{"line":128,"column":1},"end":{"line":128,"column":1}},"key":"hrl9eD9sJK"},{"type":"inlineMath","value":"u(t)","position":{"start":{"line":128,"column":1},"end":{"line":128,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>u</mi><mo stretchy=\"false\">(</mo><mi>t</mi><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">u(t)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\">u</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">t</span><span class=\"mclose\">)</span></span></span></span>","key":"f7zRezyvyH"},{"type":"text","value":", you must supply a function that computes ","position":{"start":{"line":128,"column":1},"end":{"line":128,"column":1}},"key":"jFFaeJN0XJ"},{"type":"inlineMath","value":"u'","position":{"start":{"line":128,"column":1},"end":{"line":128,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msup><mi>u</mi><mo mathvariant=\"normal\" lspace=\"0em\" rspace=\"0em\">′</mo></msup></mrow><annotation encoding=\"application/x-tex\">u&#x27;</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.7519em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">u</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.7519em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">′</span></span></span></span></span></span></span></span></span></span></span></span>","key":"VwAdb1r3lx"},{"type":"text","value":", an initial value for ","position":{"start":{"line":128,"column":1},"end":{"line":128,"column":1}},"key":"W1vuKvbSRZ"},{"type":"inlineMath","value":"u","position":{"start":{"line":128,"column":1},"end":{"line":128,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>u</mi></mrow><annotation encoding=\"application/x-tex\">u</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">u</span></span></span></span>","key":"y97BseFcv5"},{"type":"text","value":", and the endpoints of the interval for ","position":{"start":{"line":128,"column":1},"end":{"line":128,"column":1}},"key":"DQV3b30B8e"},{"type":"inlineMath","value":"t","position":{"start":{"line":128,"column":1},"end":{"line":128,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>t</mi></mrow><annotation encoding=\"application/x-tex\">t</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6151em;\"></span><span class=\"mord mathnormal\">t</span></span></span></span>","key":"ig0cH3t4jp"},{"type":"text","value":". The ","position":{"start":{"line":128,"column":1},"end":{"line":128,"column":1}},"key":"spxemmASDW"},{"type":"inlineMath","value":"t","position":{"start":{"line":128,"column":1},"end":{"line":128,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>t</mi></mrow><annotation encoding=\"application/x-tex\">t</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6151em;\"></span><span class=\"mord mathnormal\">t</span></span></span></span>","key":"kMAneijVi3"},{"type":"text","value":" interval should be defined as ","position":{"start":{"line":128,"column":1},"end":{"line":128,"column":1}},"key":"Uv1UIsmJh7"},{"type":"inlineCode","value":"(a,b)","position":{"start":{"line":128,"column":1},"end":{"line":128,"column":1}},"key":"bY4ZNw6b0K"},{"type":"text","value":", where at least one of the values is a float.","position":{"start":{"line":128,"column":1},"end":{"line":128,"column":1}},"key":"BvquV0SaXE"}],"key":"pQJOexFi2s"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"f = lambda t, u: sin((t + u) ** 2)\ntspan = [0.0, 4.0]\nu0 = [-1.0]","key":"jmwlYzqPSL"},{"type":"output","id":"vkt19x_rOpcBMBYWwZSXQ","data":[],"key":"kbHmWEnhna"}],"data":{},"indexEntries":[{"entry":"Julia","subEntry":{"value":"ODEProblem","kind":"entry"},"emphasis":true},{"entry":"Julia","subEntry":{"value":"solve","kind":"entry"},"emphasis":true}],"label":"index-FM0ot2CeTz","identifier":"index-fm0ot2cetz","html_id":"index-fm0ot2cetz","key":"VYf5JJ2wPQ"},{"type":"paragraph","position":{"start":{"line":139,"column":1},"end":{"line":139,"column":1}},"children":[{"type":"text","value":"Note above that even though this is a problem for a scalar function ","position":{"start":{"line":139,"column":1},"end":{"line":139,"column":1}},"key":"xXqdmcVJzS"},{"type":"inlineMath","value":"u(t)","position":{"start":{"line":139,"column":1},"end":{"line":139,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>u</mi><mo stretchy=\"false\">(</mo><mi>t</mi><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">u(t)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\">u</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">t</span><span class=\"mclose\">)</span></span></span></span>","key":"vCrFIgQoTG"},{"type":"text","value":", we had to set the initial condition as a “one-dimensional vector.”","position":{"start":{"line":139,"column":1},"end":{"line":139,"column":1}},"key":"AxUKKlGFjU"}],"key":"xbbpE0tojc"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"from scipy.integrate import solve_ivp\nsol = solve_ivp(f, tspan, u0)","key":"dClF2b9IGk"},{"type":"output","id":"wsbR9WlPPfLJPDx4hnCS-","data":[],"key":"Umm9lPECxa"}],"data":{},"key":"Hz2svJg15u"},{"type":"paragraph","position":{"start":{"line":146,"column":1},"end":{"line":146,"column":1}},"children":[{"type":"text","value":"The resulting solution object has fields ","position":{"start":{"line":146,"column":1},"end":{"line":146,"column":1}},"key":"Bnj7BYyYng"},{"type":"inlineCode","value":"t","position":{"start":{"line":146,"column":1},"end":{"line":146,"column":1}},"key":"MMoXKWleGP"},{"type":"text","value":" and ","position":{"start":{"line":146,"column":1},"end":{"line":146,"column":1}},"key":"XpjsFcmapA"},{"type":"inlineCode","value":"y","position":{"start":{"line":146,"column":1},"end":{"line":146,"column":1}},"key":"wL7ra0Owon"},{"type":"text","value":" that contain the values of the independent and dependent variables, respectively; those field names are the same regardless of what we use in our own codes.","position":{"start":{"line":146,"column":1},"end":{"line":146,"column":1}},"key":"Dix21qYsbG"}],"key":"TBLJNfZDIa"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"print(\"t shape:\", sol.t.shape)\nprint(\"u shape:\", sol.y.shape)\nplot(sol.t, sol.y[0, :], \"-o\")\nxlabel(\"$t$\"), ylabel(\"$u(t)$\")\ntitle(\"Solution of $u' = sin((t+u)^2)$\")","key":"Gq6aBpZvpe"},{"type":"output","id":"FiBN0MDvXlIElvJ08GuJm","data":[{"output_type":"stream","name":"stdout","text":"t shape: (10,)\nu shape: (1, 10)\n"},{"output_type":"display_data","metadata":{},"data":{"text/plain":{"content":"<Figure size 700x400 with 1 Axes>","content_type":"text/plain"},"image/png":{"content_type":"image/png","hash":"6c41081c8136eb0d4d934f46f8fc6179","path":"/fnc/build/6c41081c8136eb0d4d934f46f8fc6179.png"}}}],"key":"AVBMELvDjn"}],"data":{},"key":"dpCmoPzv7u"},{"type":"paragraph","position":{"start":{"line":156,"column":1},"end":{"line":156,"column":1}},"children":[{"type":"text","value":"You can see above that the solution was not computed at enough points to make a smooth graph. There is a way to request output at times of your choosing.","position":{"start":{"line":156,"column":1},"end":{"line":156,"column":1}},"key":"dxpW2W9NDx"}],"key":"TEeU5kEE7L"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"sol = solve_ivp(f, tspan, u0, t_eval=linspace(0, 4, 200))\nplot(sol.t, sol.y[0, :], \"-\")\nxlabel(\"$t$\"), ylabel(\"$u(t)$\")\ntitle(\"Solution of $u' = sin((t+u)^2)$\")","key":"jtAKSQBR7O"},{"type":"output","id":"5m8kSbh1gwxgJXbZfrMDl","data":[{"output_type":"display_data","metadata":{},"data":{"text/plain":{"content":"<Figure size 700x400 with 1 Axes>","content_type":"text/plain"},"image/png":{"content_type":"image/png","hash":"df39779b9ee385bae7fc7d2e93ce43f5","path":"/fnc/build/df39779b9ee385bae7fc7d2e93ce43f5.png"}}}],"key":"d335OZM0H6"}],"data":{},"key":"XD6kYjKDAf"},{"type":"paragraph","position":{"start":{"line":165,"column":1},"end":{"line":165,"column":1}},"children":[{"type":"text","value":"Another option is to enable interpolation to evaluate the solution anywhere after the fact:","position":{"start":{"line":165,"column":1},"end":{"line":165,"column":1}},"key":"U7o6c8bQjB"}],"key":"tmWHyq8c1G"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"sol = solve_ivp(f, tspan, u0, dense_output=True)\nfor t in linspace(0, 4, 6):\n    print(f\"u({t:.2f}) = {sol.sol(t)[0]:.4f}\")","key":"LdXEOGdGcz"},{"type":"output","id":"qIqQ-PuWJchtbPzzG6NKm","data":[{"output_type":"stream","name":"stdout","text":"u(0.00) = -1.0000\nu(0.80) = -0.8122\nu(1.60) = -0.6204\nu(2.40) = -0.4320\nu(3.20) = -1.1139\nu(4.00) = -1.8822\n"}],"key":"HoaAfPBITE"}],"data":{},"key":"BqMTJsAdUp"}],"label":"demo-basics-first-python","identifier":"demo-basics-first-python","html_id":"demo-basics-first-python","key":"nqrbJQBWRI"},{"type":"details","children":[{"type":"summary","children":[{"type":"text","value":"Finite-time singularity","position":{"start":{"line":175,"column":1},"end":{"line":175,"column":1}},"key":"RISbvnyVjL"}],"key":"basGA46Dyb"},{"type":"grid","columns":[1,1,2,2],"children":[{"type":"paragraph","position":{"start":{"line":178,"column":1},"end":{"line":178,"column":1}},"children":[{"type":"text","value":"The equation ","position":{"start":{"line":178,"column":1},"end":{"line":178,"column":1}},"key":"lV5xvDHdAA"},{"type":"inlineMath","value":"u'=(u+t)^2","position":{"start":{"line":178,"column":1},"end":{"line":178,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msup><mi>u</mi><mo mathvariant=\"normal\" lspace=\"0em\" rspace=\"0em\">′</mo></msup><mo>=</mo><mo stretchy=\"false\">(</mo><mi>u</mi><mo>+</mo><mi>t</mi><msup><mo stretchy=\"false\">)</mo><mn>2</mn></msup></mrow><annotation encoding=\"application/x-tex\">u&#x27;=(u+t)^2</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.7519em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">u</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.7519em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">′</span></span></span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">u</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1.0641em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\">t</span><span class=\"mclose\"><span class=\"mclose\">)</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span></span></span></span></span></span></span></span>","key":"UudPh0TehW"},{"type":"text","value":" gives us some trouble.","position":{"start":{"line":178,"column":1},"end":{"line":178,"column":1}},"key":"mUidNarqEJ"}],"key":"RwlHbfUAOe"},{"type":"card","children":[{"type":"paragraph","position":{"start":{"line":180,"column":1},"end":{"line":180,"column":1}},"children":[{"type":"text","value":"It’s a good idea to check ","position":{"start":{"line":180,"column":1},"end":{"line":180,"column":1}},"key":"ii03MQJC88"},{"type":"inlineCode","value":"sol.success","position":{"start":{"line":180,"column":1},"end":{"line":180,"column":1}},"key":"eO03j2ZTOW"},{"type":"text","value":" after calling ","position":{"start":{"line":180,"column":1},"end":{"line":180,"column":1}},"key":"Dr9t9cgXKu"},{"type":"inlineCode","value":"solve_ivp","position":{"start":{"line":180,"column":1},"end":{"line":180,"column":1}},"key":"Q9hzniJPcq"},{"type":"text","value":". If it’s ","position":{"start":{"line":180,"column":1},"end":{"line":180,"column":1}},"key":"EXwfy3yUBQ"},{"type":"inlineCode","value":"False","position":{"start":{"line":180,"column":1},"end":{"line":180,"column":1}},"key":"SXB1hRpvVp"},{"type":"text","value":", the solution may not be reliable.","position":{"start":{"line":180,"column":1},"end":{"line":180,"column":1}},"key":"PdVVg06mpM"}],"key":"Pg4IZqWwjA"}],"key":"m4Wsj5Fbor"}],"key":"kg3jgMVuB7"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"f = lambda t, u: (t + u) ** 2\nsol = solve_ivp(f, [0.0, 1.0], [1.0])\nif not sol.success:\n    print(sol.message)","key":"ZQuEKCxeGR"},{"type":"output","id":"L4yNJ6vu8xvFv35Pym9bf","data":[{"output_type":"stream","name":"stdout","text":"Required step size is less than spacing between numbers.\n"}],"key":"AwtdXLBGZ4"}],"data":{},"key":"jxYoubxADJ"},{"type":"paragraph","position":{"start":{"line":191,"column":1},"end":{"line":191,"column":1}},"children":[{"type":"text","value":"The warning message we received can mean that there is a bug in the formulation of the problem. But if everything has been done correctly, it suggests that the solution may not exist past the indicated time. This is a possibility in nonlinear ODEs.","position":{"start":{"line":191,"column":1},"end":{"line":191,"column":1}},"key":"CnhI5c31j0"}],"key":"g7Gk66JHkM"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"semilogy(sol.t, sol.y[0, :])\nxlabel(\"$t$\")\nylabel(\"$u(t)$\")\ntitle(\"Blowup in finite time\")","key":"oxh5BhoVX4"},{"type":"output","id":"YD56z8Rj7Qu3SHJyuminy","data":[{"output_type":"display_data","metadata":{},"data":{"text/plain":{"content":"<Figure size 700x400 with 1 Axes>","content_type":"text/plain"},"image/png":{"content_type":"image/png","hash":"46577e661388afc825f2dd08f1301895","path":"/fnc/build/46577e661388afc825f2dd08f1301895.png"}}}],"key":"VzPCkKpojV"}],"data":{},"key":"L1PFMrCcNG"}],"label":"demo-basics-sing-python","identifier":"demo-basics-sing-python","html_id":"demo-basics-sing-python","key":"ebmwcRcS9o"},{"type":"details","children":[{"type":"summary","children":[{"type":"text","value":"Conditioning of an IVP","position":{"start":{"line":202,"column":1},"end":{"line":202,"column":1}},"key":"PPZa9AraAT"}],"key":"vb9Y1phcGg"},{"type":"paragraph","position":{"start":{"line":203,"column":1},"end":{"line":203,"column":1}},"children":[{"type":"text","value":"Consider the ODEs ","position":{"start":{"line":203,"column":1},"end":{"line":203,"column":1}},"key":"BsNSV2z7sH"},{"type":"inlineMath","value":"u'=u","position":{"start":{"line":203,"column":1},"end":{"line":203,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msup><mi>u</mi><mo mathvariant=\"normal\" lspace=\"0em\" rspace=\"0em\">′</mo></msup><mo>=</mo><mi>u</mi></mrow><annotation encoding=\"application/x-tex\">u&#x27;=u</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.7519em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">u</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.7519em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">′</span></span></span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">u</span></span></span></span>","key":"f9fWYZ5Fop"},{"type":"text","value":" and ","position":{"start":{"line":203,"column":1},"end":{"line":203,"column":1}},"key":"re68SpW8T0"},{"type":"inlineMath","value":"u'=-u","position":{"start":{"line":203,"column":1},"end":{"line":203,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msup><mi>u</mi><mo mathvariant=\"normal\" lspace=\"0em\" rspace=\"0em\">′</mo></msup><mo>=</mo><mo>−</mo><mi>u</mi></mrow><annotation encoding=\"application/x-tex\">u&#x27;=-u</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.7519em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">u</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.7519em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">′</span></span></span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6667em;vertical-align:-0.0833em;\"></span><span class=\"mord\">−</span><span class=\"mord mathnormal\">u</span></span></span></span>","key":"EtXwZhiPVo"},{"type":"text","value":". In each case we compute ","position":{"start":{"line":203,"column":1},"end":{"line":203,"column":1}},"key":"IsdZSTHPID"},{"type":"inlineMath","value":"\\partial f/\\partial u = \\pm 1","position":{"start":{"line":203,"column":1},"end":{"line":203,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi mathvariant=\"normal\">∂</mi><mi>f</mi><mi mathvariant=\"normal\">/</mi><mi mathvariant=\"normal\">∂</mi><mi>u</mi><mo>=</mo><mo>±</mo><mn>1</mn></mrow><annotation encoding=\"application/x-tex\">\\partial f/\\partial u = \\pm 1</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord\" style=\"margin-right:0.05556em;\">∂</span><span class=\"mord mathnormal\" style=\"margin-right:0.10764em;\">f</span><span class=\"mord\">/</span><span class=\"mord\" style=\"margin-right:0.05556em;\">∂</span><span class=\"mord mathnormal\">u</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.7278em;vertical-align:-0.0833em;\"></span><span class=\"mord\">±</span><span class=\"mord\">1</span></span></span></span>","key":"yV6H8Zk3Cu"},{"type":"text","value":", so the condition number bound from ","position":{"start":{"line":203,"column":1},"end":{"line":203,"column":1}},"key":"OWTO3tIBpF"},{"type":"crossReference","kind":"proof:theorem","identifier":"theorem-depic","label":"theorem-depIC","children":[{"type":"text","value":"Theorem ","key":"yct7HjzUG0"},{"type":"text","value":"6.1.2","key":"YDe7cvKPrg"}],"template":"Theorem %s","enumerator":"6.1.2","resolved":true,"html_id":"theorem-depic","remote":true,"url":"/basics","dataUrl":"/basics.json","key":"nVSdd8x6bn"},{"type":"text","value":" is ","position":{"start":{"line":203,"column":1},"end":{"line":203,"column":1}},"key":"pzYpmCfXPn"},{"type":"inlineMath","value":"e^{b-a}","position":{"start":{"line":203,"column":1},"end":{"line":203,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msup><mi>e</mi><mrow><mi>b</mi><mo>−</mo><mi>a</mi></mrow></msup></mrow><annotation encoding=\"application/x-tex\">e^{b-a}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8491em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">e</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8491em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">b</span><span class=\"mbin mtight\">−</span><span class=\"mord mathnormal mtight\">a</span></span></span></span></span></span></span></span></span></span></span></span>","key":"SuPhvFYxxq"},{"type":"text","value":" in both problems. However, they behave quite differently. In the case of exponential growth, ","position":{"start":{"line":203,"column":1},"end":{"line":203,"column":1}},"key":"WKKpyhYpuj"},{"type":"inlineMath","value":"u'=u","position":{"start":{"line":203,"column":1},"end":{"line":203,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msup><mi>u</mi><mo mathvariant=\"normal\" lspace=\"0em\" rspace=\"0em\">′</mo></msup><mo>=</mo><mi>u</mi></mrow><annotation encoding=\"application/x-tex\">u&#x27;=u</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.7519em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">u</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.7519em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">′</span></span></span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">u</span></span></span></span>","key":"aGhRm5mgh4"},{"type":"text","value":", the bound is the actual condition number.","position":{"start":{"line":203,"column":1},"end":{"line":203,"column":1}},"key":"sRrk6ufvtc"}],"key":"AcJxHKVxhw"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"t = linspace(0, 3, 200)\nu = array([exp(t) * u0 for u0 in [0.7, 1, 1.3]])\nplot(t, u.T)\nxlabel(\"$t$\")\nylabel(\"$u(t)$\")\ntitle(\"Exponential divergence of solutions\")","key":"W0ThVAwDle"},{"type":"output","id":"vOOYPSuyDpTni1dA4Gnbm","data":[{"output_type":"display_data","metadata":{},"data":{"text/plain":{"content":"<Figure size 700x400 with 1 Axes>","content_type":"text/plain"},"image/png":{"content_type":"image/png","hash":"199757bf48b2523338e175a528c784bc","path":"/fnc/build/199757bf48b2523338e175a528c784bc.png"}}}],"key":"NX3BySzFuC"}],"data":{},"key":"vYPN3GQqTu"},{"type":"paragraph","position":{"start":{"line":214,"column":1},"end":{"line":214,"column":1}},"children":[{"type":"text","value":"But with ","position":{"start":{"line":214,"column":1},"end":{"line":214,"column":1}},"key":"Vl1kX3Dve5"},{"type":"inlineMath","value":"u'=-u","position":{"start":{"line":214,"column":1},"end":{"line":214,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msup><mi>u</mi><mo mathvariant=\"normal\" lspace=\"0em\" rspace=\"0em\">′</mo></msup><mo>=</mo><mo>−</mo><mi>u</mi></mrow><annotation encoding=\"application/x-tex\">u&#x27;=-u</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.7519em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">u</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.7519em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">′</span></span></span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6667em;vertical-align:-0.0833em;\"></span><span class=\"mord\">−</span><span class=\"mord mathnormal\">u</span></span></span></span>","key":"ER5Y9NZXyQ"},{"type":"text","value":", solutions actually get closer together with time.","position":{"start":{"line":214,"column":1},"end":{"line":214,"column":1}},"key":"To2oCXEDwe"}],"key":"uw2dLbQLPS"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"t = linspace(0, 3, 200)\nu = array([exp(-t) * u0 for u0 in [0.7, 1, 1.3]])\nplot(t, u.T)\nxlabel(\"$t$\")\nylabel(\"$u(t)$\")\ntitle(\"Exponential convergence of solutions\")","key":"n5XTOAdJU6"},{"type":"output","id":"YEddA54EmjKEl5fTDn1hM","data":[{"output_type":"display_data","metadata":{},"data":{"text/plain":{"content":"<Figure size 700x400 with 1 Axes>","content_type":"text/plain"},"image/png":{"content_type":"image/png","hash":"14b7f05f18c75cc7f94ffd37a11c500e","path":"/fnc/build/14b7f05f18c75cc7f94ffd37a11c500e.png"}}}],"key":"BYL9A41qGp"}],"data":{},"key":"F5dQ1VdTfq"},{"type":"paragraph","position":{"start":{"line":225,"column":1},"end":{"line":225,"column":1}},"children":[{"type":"text","value":"In this case the actual condition number is one, because the initial difference between solutions is the largest over all time. Hence, the exponentially growing upper bound ","position":{"start":{"line":225,"column":1},"end":{"line":225,"column":1}},"key":"yFuYQBSJnx"},{"type":"inlineMath","value":"e^{b-a}","position":{"start":{"line":225,"column":1},"end":{"line":225,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msup><mi>e</mi><mrow><mi>b</mi><mo>−</mo><mi>a</mi></mrow></msup></mrow><annotation encoding=\"application/x-tex\">e^{b-a}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8491em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">e</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8491em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">b</span><span class=\"mbin mtight\">−</span><span class=\"mord mathnormal mtight\">a</span></span></span></span></span></span></span></span></span></span></span></span>","key":"KD68TPBq2n"},{"type":"text","value":" is a gross overestimate.","position":{"start":{"line":225,"column":1},"end":{"line":225,"column":1}},"key":"PIQmnJzyUi"}],"key":"kMRy1MmAvK"}],"label":"demo-basics-cond-python","identifier":"demo-basics-cond-python","html_id":"demo-basics-cond-python","key":"TQkdhXYyu7"},{"type":"heading","depth":3,"position":{"start":{"line":228,"column":1},"end":{"line":228,"column":1}},"children":[{"type":"text","value":"Section 6.2","position":{"start":{"line":228,"column":1},"end":{"line":228,"column":1}},"key":"wGdBDfmdUR"}],"identifier":"section-6-2","label":"Section 6.2","html_id":"section-6-2","implicit":true,"key":"sSR2lOcxcN"},{"type":"details","children":[{"type":"summary","children":[{"type":"text","value":"Convergence of Euler’s method","position":{"start":{"line":230,"column":1},"end":{"line":230,"column":1}},"key":"pZDcMVrIuT"}],"key":"rijHpE4pbI"},{"type":"paragraph","position":{"start":{"line":231,"column":1},"end":{"line":231,"column":1}},"children":[{"type":"text","value":"We consider the IVP ","position":{"start":{"line":231,"column":1},"end":{"line":231,"column":1}},"key":"ocm6f6WkNO"},{"type":"inlineMath","value":"u'=\\sin[(u+t)^2]","position":{"start":{"line":231,"column":1},"end":{"line":231,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msup><mi>u</mi><mo mathvariant=\"normal\" lspace=\"0em\" rspace=\"0em\">′</mo></msup><mo>=</mo><mi>sin</mi><mo>⁡</mo><mo stretchy=\"false\">[</mo><mo stretchy=\"false\">(</mo><mi>u</mi><mo>+</mo><mi>t</mi><msup><mo stretchy=\"false\">)</mo><mn>2</mn></msup><mo stretchy=\"false\">]</mo></mrow><annotation encoding=\"application/x-tex\">u&#x27;=\\sin[(u+t)^2]</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.7519em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">u</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.7519em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">′</span></span></span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mop\">sin</span><span class=\"mopen\">[(</span><span class=\"mord mathnormal\">u</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1.0641em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\">t</span><span class=\"mclose\"><span class=\"mclose\">)</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span></span></span></span></span><span class=\"mclose\">]</span></span></span></span>","key":"p1h8UQwGgJ"},{"type":"text","value":" over ","position":{"start":{"line":231,"column":1},"end":{"line":231,"column":1}},"key":"Wyo5tK47D2"},{"type":"inlineMath","value":"0\\le t \\le 4","position":{"start":{"line":231,"column":1},"end":{"line":231,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>0</mn><mo>≤</mo><mi>t</mi><mo>≤</mo><mn>4</mn></mrow><annotation encoding=\"application/x-tex\">0\\le t \\le 4</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.7804em;vertical-align:-0.136em;\"></span><span class=\"mord\">0</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.7719em;vertical-align:-0.136em;\"></span><span class=\"mord mathnormal\">t</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">4</span></span></span></span>","key":"Y6TeaufBBj"},{"type":"text","value":", with ","position":{"start":{"line":231,"column":1},"end":{"line":231,"column":1}},"key":"ceKToJ0ASK"},{"type":"inlineMath","value":"u(0)=-1","position":{"start":{"line":231,"column":1},"end":{"line":231,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>u</mi><mo stretchy=\"false\">(</mo><mn>0</mn><mo stretchy=\"false\">)</mo><mo>=</mo><mo>−</mo><mn>1</mn></mrow><annotation encoding=\"application/x-tex\">u(0)=-1</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\">u</span><span class=\"mopen\">(</span><span class=\"mord\">0</span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.7278em;vertical-align:-0.0833em;\"></span><span class=\"mord\">−</span><span class=\"mord\">1</span></span></span></span>","key":"CyPt8GBJs6"},{"type":"text","value":".","position":{"start":{"line":231,"column":1},"end":{"line":231,"column":1}},"key":"N4sGmmx3nu"}],"key":"eFbZ5MjxKT"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"f = lambda t, u: sin((t + u) ** 2)\ntspan = [0.0, 4.0]\nu0 = -1.0\nt, u = FNC.euler(f, tspan, u0, 20)\n\nfig, ax = subplots()\nax.plot(t, u[0, :], \"-o\", label=\"$n=20$\")\nxlabel(\"$t$\"), ylabel(\"$u(t)$\")\ntitle(\"Solution by Euler's method\")\nlegend()","key":"SNCqZuZmVu"},{"type":"output","id":"KIJmQeinR3H7ImxWYvUXH","data":[{"output_type":"display_data","metadata":{},"data":{"text/plain":{"content":"<Figure size 700x400 with 1 Axes>","content_type":"text/plain"},"image/png":{"content_type":"image/png","hash":"f4ce9325477a4204bd1214b310208d32","path":"/fnc/build/f4ce9325477a4204bd1214b310208d32.png"}}}],"key":"PpkpBy0Xgh"}],"data":{},"key":"Al07BrIOHq"},{"type":"paragraph","position":{"start":{"line":246,"column":1},"end":{"line":246,"column":1}},"children":[{"type":"text","value":"We could define a different interpolant to get a smoother picture above, but the derivation of Euler’s method assumed a piecewise linear interpolant. We can instead request more steps to make the interpolant look smoother.","position":{"start":{"line":246,"column":1},"end":{"line":246,"column":1}},"key":"SNyhj7FzXY"}],"key":"r8Q8pUjQk1"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"t, u = FNC.euler(f, tspan, u0, 200)\nax.plot(t, u[0, :], label=\"$n=200$\")\nax.legend()\nfig","key":"dJ82zfwix8"},{"type":"output","id":"430zsfwxq4IJ37QHgbdBy","data":[{"output_type":"execute_result","execution_count":13,"metadata":{},"data":{"text/plain":{"content":"<Figure size 700x400 with 1 Axes>","content_type":"text/plain"},"image/png":{"content_type":"image/png","hash":"cca23f690bac659e7c1731db0a7163fe","path":"/fnc/build/cca23f690bac659e7c1731db0a7163fe.png"}}}],"key":"U84aroUZd8"}],"data":{},"key":"BpJmJNPanH"},{"type":"paragraph","position":{"start":{"line":255,"column":1},"end":{"line":255,"column":1}},"children":[{"type":"text","value":"Increasing ","position":{"start":{"line":255,"column":1},"end":{"line":255,"column":1}},"key":"vok08O51Pt"},{"type":"inlineMath","value":"n","position":{"start":{"line":255,"column":1},"end":{"line":255,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>n</mi></mrow><annotation encoding=\"application/x-tex\">n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">n</span></span></span></span>","key":"o5WYZ921aA"},{"type":"text","value":" changed the solution noticeably. Since we know that interpolants and finite differences become more accurate as ","position":{"start":{"line":255,"column":1},"end":{"line":255,"column":1}},"key":"VmIWqmWPH4"},{"type":"inlineMath","value":"h\\to 0","position":{"start":{"line":255,"column":1},"end":{"line":255,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>h</mi><mo>→</mo><mn>0</mn></mrow><annotation encoding=\"application/x-tex\">h\\to 0</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6944em;\"></span><span class=\"mord mathnormal\">h</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">→</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">0</span></span></span></span>","key":"myMFcm6sx8"},{"type":"text","value":", we should anticipate the same behavior from Euler’s method. We don’t have an exact solution to compare to, so we will use ","position":{"start":{"line":255,"column":1},"end":{"line":255,"column":1}},"key":"HiAmIbUsHi"},{"type":"inlineCode","value":"solve_ivp","position":{"start":{"line":255,"column":1},"end":{"line":255,"column":1}},"key":"dZav05nPa0"},{"type":"text","value":" to construct an accurate reference solution.","position":{"start":{"line":255,"column":1},"end":{"line":255,"column":1}},"key":"FnJiwBTlRk"}],"key":"g9OEhzAY8o"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"from scipy.integrate import solve_ivp\nsol = solve_ivp(f, tspan, [u0], dense_output=True, atol=1e-8, rtol=1e-8)\nax.plot(t, sol.sol(t)[0, :], \"--\", label=\"accurate\")\nax.legend()\nfig","key":"M6q16tHidJ"},{"type":"output","id":"K5o0e3MVj1tv2rIxCyKTb","data":[{"output_type":"execute_result","execution_count":14,"metadata":{},"data":{"text/plain":{"content":"<Figure size 700x400 with 1 Axes>","content_type":"text/plain"},"image/png":{"content_type":"image/png","hash":"ededf807f034ce039a57795456ee3b78","path":"/fnc/build/ededf807f034ce039a57795456ee3b78.png"}}}],"key":"vf5j6nWEnY"}],"data":{},"key":"rCch1uJkf1"},{"type":"paragraph","position":{"start":{"line":265,"column":1},"end":{"line":265,"column":1}},"children":[{"type":"text","value":"Now we can perform a convergence study.","position":{"start":{"line":265,"column":1},"end":{"line":265,"column":1}},"key":"ElIrcGKPYd"}],"key":"IOwR4nhUOm"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"n_ = array([int(5 * 10**k) for k in arange(0, 3, 0.5)])\nerr_ = zeros(6)\nresults = PrettyTable([\"n\", \"error\"])\nfor j, n in enumerate(n_):\n    t, u = FNC.euler(f, tspan, u0, n)\n    err_[j] = norm(sol.sol(t)[0, :] - u[0, :], inf)\n    results.add_row((n, err_[j]))\nprint(results)","key":"hwMf7W4H4o"},{"type":"output","id":"MqilL60TKSQMpQ1U6gQEn","data":[{"output_type":"stream","name":"stdout","text":"+------+-----------------------+\n|  n   |         error         |\n+------+-----------------------+\n|  5   |   2.734204988403654   |\n|  15  |  0.15019897709240698  |\n|  50  |  0.02999619702005879  |\n| 158  |  0.008850284724318591 |\n| 500  | 0.0027366205261468157 |\n| 1581 | 0.0008596857693601301 |\n+------+-----------------------+\n"}],"key":"BypU5hqVfq"}],"data":{},"key":"MtNgh5iBL3"},{"type":"paragraph","position":{"start":{"line":278,"column":1},"end":{"line":278,"column":1}},"children":[{"type":"text","value":"The error is approximately cut by a factor of 10 for each increase in ","position":{"start":{"line":278,"column":1},"end":{"line":278,"column":1}},"key":"NbOSZ53V5B"},{"type":"inlineMath","value":"n","position":{"start":{"line":278,"column":1},"end":{"line":278,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>n</mi></mrow><annotation encoding=\"application/x-tex\">n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">n</span></span></span></span>","key":"A3peyoTztl"},{"type":"text","value":" by the same factor. A log-log plot also confirms first-order convergence. Keep in mind that since ","position":{"start":{"line":278,"column":1},"end":{"line":278,"column":1}},"key":"Ny523uiEce"},{"type":"inlineMath","value":"h=(b-a)/n","position":{"start":{"line":278,"column":1},"end":{"line":278,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>h</mi><mo>=</mo><mo stretchy=\"false\">(</mo><mi>b</mi><mo>−</mo><mi>a</mi><mo stretchy=\"false\">)</mo><mi mathvariant=\"normal\">/</mi><mi>n</mi></mrow><annotation encoding=\"application/x-tex\">h=(b-a)/n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6944em;\"></span><span class=\"mord mathnormal\">h</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">b</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\">a</span><span class=\"mclose\">)</span><span class=\"mord\">/</span><span class=\"mord mathnormal\">n</span></span></span></span>","key":"SI0TCNj9X8"},{"type":"text","value":", it follows that ","position":{"start":{"line":278,"column":1},"end":{"line":278,"column":1}},"key":"VAWXciqERA"},{"type":"inlineMath","value":"O(h)=O(n^{-1})","position":{"start":{"line":278,"column":1},"end":{"line":278,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>O</mi><mo stretchy=\"false\">(</mo><mi>h</mi><mo stretchy=\"false\">)</mo><mo>=</mo><mi>O</mi><mo stretchy=\"false\">(</mo><msup><mi>n</mi><mrow><mo>−</mo><mn>1</mn></mrow></msup><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">O(h)=O(n^{-1})</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">O</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">h</span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1.0641em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">O</span><span class=\"mopen\">(</span><span class=\"mord\"><span class=\"mord mathnormal\">n</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">−</span><span class=\"mord mtight\">1</span></span></span></span></span></span></span></span></span><span class=\"mclose\">)</span></span></span></span>","key":"fKLXAbKszP"},{"type":"text","value":".","position":{"start":{"line":278,"column":1},"end":{"line":278,"column":1}},"key":"p5wYe8JYfL"}],"key":"TOvtj4b3v3"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"loglog(n_, err_, \"-o\", label=\"results\")\nplot(n_, 0.5 * (n_ / n_[0])**(-1), \"--\", label=\"1st order\")\nxlabel(\"$n$\"), ylabel(\"inf-norm error\")\ntitle(\"Convergence of Euler's method\")\nlegend()","key":"ASv5ndx30C"},{"type":"output","id":"Js-kFy-dJcaZKYr_AL-qx","data":[{"output_type":"display_data","metadata":{},"data":{"text/plain":{"content":"<Figure size 700x400 with 1 Axes>","content_type":"text/plain"},"image/png":{"content_type":"image/png","hash":"8d4a01a6f7cfe9be0ed4c5048dbbe29c","path":"/fnc/build/8d4a01a6f7cfe9be0ed4c5048dbbe29c.png"}}}],"key":"w3QA5QIw8K"}],"data":{},"key":"c4L17LED7z"}],"label":"demo-euler-converge-python","identifier":"demo-euler-converge-python","html_id":"demo-euler-converge-python","key":"DPlvqf70aD"},{"type":"heading","depth":3,"position":{"start":{"line":289,"column":1},"end":{"line":289,"column":1}},"children":[{"type":"text","value":"Section 6.3","position":{"start":{"line":289,"column":1},"end":{"line":289,"column":1}},"key":"Bh7zoc1vik"}],"identifier":"section-6-3","label":"Section 6.3","html_id":"section-6-3","implicit":true,"key":"VOJ8eImWK2"},{"type":"details","children":[{"type":"summary","children":[{"type":"text","value":"Predator-prey model","position":{"start":{"line":291,"column":1},"end":{"line":291,"column":1}},"key":"YUfGPK5mcF"}],"key":"mpIBhn6dX5"},{"type":"paragraph","position":{"start":{"line":292,"column":1},"end":{"line":292,"column":1}},"children":[{"type":"text","value":"We encode the predator–prey equations via a function.","position":{"start":{"line":292,"column":1},"end":{"line":292,"column":1}},"key":"XTvrfJb9DA"}],"key":"rhccUZLTiG"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"def predprey(t, u):\n    y, z = u                        # rename for convenience\n    s = (y * z) / (1 + beta * y)    # appears in both equations\n    return array([y * (1 - alpha * y) - s, -z + s])","key":"dSskePIUN6"},{"type":"output","id":"vLVEzXWyXwS9R1RSprBpc","data":[],"key":"uhrCa5ipdX"}],"data":{},"key":"Pj4c4BiTSJ"},{"type":"paragraph","position":{"start":{"line":301,"column":1},"end":{"line":301,"column":1}},"children":[{"type":"text","value":"As before, the ODE function must accept three inputs, ","position":{"start":{"line":301,"column":1},"end":{"line":301,"column":1}},"key":"dEb8W9zmDX"},{"type":"inlineCode","value":"u","position":{"start":{"line":301,"column":1},"end":{"line":301,"column":1}},"key":"JuFnumihAQ"},{"type":"text","value":", ","position":{"start":{"line":301,"column":1},"end":{"line":301,"column":1}},"key":"uahGxvBl95"},{"type":"inlineCode","value":"p","position":{"start":{"line":301,"column":1},"end":{"line":301,"column":1}},"key":"oq6leZz6rB"},{"type":"text","value":", and ","position":{"start":{"line":301,"column":1},"end":{"line":301,"column":1}},"key":"rGu5ccEMi3"},{"type":"inlineCode","value":"t","position":{"start":{"line":301,"column":1},"end":{"line":301,"column":1}},"key":"h3rFBvNcj4"},{"type":"text","value":", even though in this case there is no explicit dependence on ","position":{"start":{"line":301,"column":1},"end":{"line":301,"column":1}},"key":"Qio3Qm0lx5"},{"type":"inlineCode","value":"t","position":{"start":{"line":301,"column":1},"end":{"line":301,"column":1}},"key":"PP0O496KQb"},{"type":"text","value":". The second input is used to pass parameters that don’t change throughout a single instance of the problem.","position":{"start":{"line":301,"column":1},"end":{"line":301,"column":1}},"key":"fkhrXig0Nz"}],"key":"AkBtb2TI1y"},{"type":"paragraph","position":{"start":{"line":303,"column":1},"end":{"line":303,"column":1}},"children":[{"type":"text","value":"To specify the IVP we must also provide the initial condition, which is a 2-vector here, and the interval for the independent variable. These are given in the call to ","position":{"start":{"line":303,"column":1},"end":{"line":303,"column":1}},"key":"YDdgd6kN8f"},{"type":"inlineCode","value":"solve_ivp","position":{"start":{"line":303,"column":1},"end":{"line":303,"column":1}},"key":"A0FyAxJTYa"},{"type":"text","value":".","position":{"start":{"line":303,"column":1},"end":{"line":303,"column":1}},"key":"Bdfs8qS9jR"}],"key":"g8Rd41Dn7l"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"from scipy.integrate import solve_ivp\nu0 = array([1, 0.01])\ntspan = [0.0, 80.0]\nalpha, beta = 0.1, 0.25\nsol = solve_ivp(predprey, tspan, u0, dense_output=True)\nprint(f\"solved with {sol.y.shape[1]} time steps\")","key":"ALAnwIcxBf"},{"type":"output","id":"2L2n1uIduxfFTWbiGONsh","data":[{"output_type":"stream","name":"stdout","text":"solved with 102 time steps\n"}],"key":"P8If8L7Hn2"}],"data":{},"key":"Go6tWvadk4"},{"type":"paragraph","position":{"start":{"line":314,"column":1},"end":{"line":314,"column":1}},"children":[{"type":"text","value":"As in scalar problems, the solution object has fields ","position":{"start":{"line":314,"column":1},"end":{"line":314,"column":1}},"key":"msl6CwYlTa"},{"type":"inlineCode","value":"t","position":{"start":{"line":314,"column":1},"end":{"line":314,"column":1}},"key":"yZrjcN9ZeM"},{"type":"text","value":" and ","position":{"start":{"line":314,"column":1},"end":{"line":314,"column":1}},"key":"WRFwzId92f"},{"type":"inlineCode","value":"y","position":{"start":{"line":314,"column":1},"end":{"line":314,"column":1}},"key":"E2PDp7NihL"},{"type":"text","value":" that contain the values of the independent and dependent variables, respectively. Each row of ","position":{"start":{"line":314,"column":1},"end":{"line":314,"column":1}},"key":"AYdkmTwRVl"},{"type":"inlineCode","value":"y","position":{"start":{"line":314,"column":1},"end":{"line":314,"column":1}},"key":"G6mDmkaPyS"},{"type":"text","value":" represents one component of the solution at every time step, and each column of ","position":{"start":{"line":314,"column":1},"end":{"line":314,"column":1}},"key":"XhcWkq040n"},{"type":"inlineCode","value":"y","position":{"start":{"line":314,"column":1},"end":{"line":314,"column":1}},"key":"B84bWsRjVK"},{"type":"text","value":" is the entire solution vector at one time step. Since we used ","position":{"start":{"line":314,"column":1},"end":{"line":314,"column":1}},"key":"sBORWm5IqR"},{"type":"inlineCode","value":"dense_output=True","position":{"start":{"line":314,"column":1},"end":{"line":314,"column":1}},"key":"jWxkbBQ9PK"},{"type":"text","value":", there is also a method ","position":{"start":{"line":314,"column":1},"end":{"line":314,"column":1}},"key":"lKnOt7Kte3"},{"type":"inlineCode","value":"sol","position":{"start":{"line":314,"column":1},"end":{"line":314,"column":1}},"key":"i4TIDDfpyE"},{"type":"text","value":" that can be used to evaluate the solution at any time.","position":{"start":{"line":314,"column":1},"end":{"line":314,"column":1}},"key":"fTTcTMy4SU"}],"key":"aucr487Aa3"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"t = linspace(0, 80, 1200)\nu = vstack([sol.sol(t[i]) for i in range(t.size)]).T    # same shape as sol.y\nfig, ax = subplots()\nax.plot(t, u[0, :], label=\"prey\")\nax.plot(t, u[1, :], label=\"predator\")\nxlabel(\"$t$\"), ylabel(\"population\")\ntitle(\"Predator-prey solution\")","key":"JXmbxZPhYc"},{"type":"output","id":"elxsP6cKyvqLe80Ekf4MI","data":[{"output_type":"display_data","metadata":{},"data":{"text/plain":{"content":"<Figure size 700x400 with 1 Axes>","content_type":"text/plain"},"image/png":{"content_type":"image/png","hash":"60a5771fb055569f8d08479bbf6f0ab3","path":"/fnc/build/60a5771fb055569f8d08479bbf6f0ab3.png"}}}],"key":"Nts0GGIHVW"}],"data":{},"key":"tjkDSC6PY8"},{"type":"paragraph","position":{"start":{"line":326,"column":1},"end":{"line":326,"column":1}},"children":[{"type":"text","value":"We can also use ","position":{"start":{"line":326,"column":1},"end":{"line":326,"column":1}},"key":"bQz6eniHgF"},{"type":"crossReference","kind":"proof:algorithm","identifier":"function-euler","label":"function-euler","children":[{"type":"text","value":"Function ","key":"O11xZpI0EA"},{"type":"text","value":"6.2.2","key":"WsGaXcloT6"}],"template":"Algorithm %s","enumerator":"6.2.2","resolved":true,"html_id":"function-euler","remote":true,"url":"/euler","dataUrl":"/euler.json","key":"PA1EEbeG57"},{"type":"text","value":" to find the solution.","position":{"start":{"line":326,"column":1},"end":{"line":326,"column":1}},"key":"jHtoalsRmb"}],"key":"i4UW7VHJsP"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"t_E, u_E = FNC.euler(predprey, tspan, u0, 800)\nax.scatter(t_E, u_E[0, :], label=\"prey (Euler)\", s=1)\nax.scatter(t_E, u_E[1, :], label=\"predator (Euler)\", s=2)\nax.legend()\nfig","key":"hN1C3l4C2F"},{"type":"output","id":"6pVQDtEMyP0xfrD0z4T83","data":[{"output_type":"execute_result","execution_count":20,"metadata":{},"data":{"text/plain":{"content":"<Figure size 700x400 with 1 Axes>","content_type":"text/plain"},"image/png":{"content_type":"image/png","hash":"e3b3db7a0626a9be16839989a9856b39","path":"/fnc/build/e3b3db7a0626a9be16839989a9856b39.png"}}}],"key":"JVt7eBwXhD"}],"data":{},"key":"wMH55A95yY"},{"type":"paragraph","position":{"start":{"line":336,"column":1},"end":{"line":336,"column":1}},"children":[{"type":"text","value":"You can see above that the Euler solution is not very accurate. When the solution has two components, it’s common to plot the it in the ","position":{"start":{"line":336,"column":1},"end":{"line":336,"column":1}},"key":"RAr8FIZzu1"},{"type":"emphasis","position":{"start":{"line":336,"column":1},"end":{"line":336,"column":1}},"children":[{"type":"text","value":"phase plane","position":{"start":{"line":336,"column":1},"end":{"line":336,"column":1}},"key":"pRnFZ6RbT9"}],"key":"jmkvITW6S1"},{"type":"text","value":", i.e., with ","position":{"start":{"line":336,"column":1},"end":{"line":336,"column":1}},"key":"i9ySJSyrIk"},{"type":"inlineMath","value":"u_1","position":{"start":{"line":336,"column":1},"end":{"line":336,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>u</mi><mn>1</mn></msub></mrow><annotation encoding=\"application/x-tex\">u_1</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.5806em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">u</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3011em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">1</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span>","key":"KGo8P69gEm"},{"type":"text","value":" and ","position":{"start":{"line":336,"column":1},"end":{"line":336,"column":1}},"key":"aW69E7n9UD"},{"type":"inlineMath","value":"u_2","position":{"start":{"line":336,"column":1},"end":{"line":336,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>u</mi><mn>2</mn></msub></mrow><annotation encoding=\"application/x-tex\">u_2</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.5806em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">u</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3011em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span>","key":"PluuIhHPnx"},{"type":"text","value":" along the axes and time as a parameterization of the curve.","position":{"start":{"line":336,"column":1},"end":{"line":336,"column":1}},"key":"CvESj6dPjk"}],"key":"pKbzV71l6K"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"plot(u[0, :], u[1, :])\nxlabel(\"prey\"), ylabel(\"predator\")\ntitle(\"Predator-prey phase plane\")","key":"gNlzdmStrJ"},{"type":"output","id":"AoOIda7sCUvaT98q5SBQo","data":[{"output_type":"display_data","metadata":{},"data":{"text/plain":{"content":"<Figure size 700x400 with 1 Axes>","content_type":"text/plain"},"image/png":{"content_type":"image/png","hash":"f79266244356436450b85dcc5ac3755d","path":"/fnc/build/f79266244356436450b85dcc5ac3755d.png"}}}],"key":"EYS9WZ0HKz"}],"data":{},"key":"Mk2uneSbs5"},{"type":"paragraph","position":{"start":{"line":343,"column":1},"end":{"line":343,"column":1}},"children":[{"type":"text","value":"From this plot we can see that the solution approaches a periodic one, which in the phase plane is represented by a closed path.","position":{"start":{"line":343,"column":1},"end":{"line":343,"column":1}},"key":"T44yluqj8P"}],"key":"SKrnnGCURo"}],"label":"demo-systems-predator-python","identifier":"demo-systems-predator-python","html_id":"demo-systems-predator-python","key":"lxk0j1v1vS"},{"type":"details","children":[{"type":"summary","children":[{"type":"text","value":"Coupled pendulums","position":{"start":{"line":347,"column":1},"end":{"line":347,"column":1}},"key":"fugh2yK187"}],"key":"C2HCa5ny64"},{"type":"paragraph","position":{"start":{"line":348,"column":1},"end":{"line":348,"column":1}},"children":[{"type":"text","value":"Let’s implement the coupled pendulums from ","position":{"start":{"line":348,"column":1},"end":{"line":348,"column":1}},"key":"x6zX0qtUCY"},{"type":"crossReference","kind":"proof:example","identifier":"example-systems-coupledpendula","label":"example-systems-coupledpendula","children":[{"type":"text","value":"Example ","key":"Ws75fF1fWC"},{"type":"text","value":"6.3.4","key":"f7sci9YATU"}],"template":"Example %s","enumerator":"6.3.4","resolved":true,"html_id":"example-systems-coupledpendula","remote":true,"url":"/systems","dataUrl":"/systems.json","key":"xlZjXnq24P"},{"type":"text","value":". The pendulums will be pulled in opposite directions and then released together from rest.","position":{"start":{"line":348,"column":1},"end":{"line":348,"column":1}},"key":"iCudZGE0q1"}],"key":"M9zfS0vqCr"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"def couple(t, u, params):\n    gamma, L, k = params\n    g = 9.8\n    udot = copy(u)\n    udot[:2] = u[2:4]\n    udot[2] = -gamma * u[2] - (g / L) * sin(u[0]) + k * (u[1] - u[0])\n    udot[3] = -gamma * u[3] - (g / L) * sin(u[1]) + k * (u[0] - u[1])\n    return udot\n\nu0 = array([1.25, -0.5, 0, 0])\ntspan = [0.0, 50.0]","key":"PNMRk0Gvsr"},{"type":"output","id":"IMEicYwjOnj7Fm2srEx0o","data":[],"key":"d24ZBKf4Nw"}],"data":{},"key":"PoloJqdwia"},{"type":"grid","columns":[1,1,2,2],"children":[{"type":"paragraph","position":{"start":{"line":365,"column":1},"end":{"line":365,"column":1}},"children":[{"type":"text","value":"First we check the behavior of the system when the pendulums are uncoupled, i.e., when ","position":{"start":{"line":365,"column":1},"end":{"line":365,"column":1}},"key":"JFaGmzHtde"},{"type":"inlineMath","value":"k=0","position":{"start":{"line":365,"column":1},"end":{"line":365,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>k</mi><mo>=</mo><mn>0</mn></mrow><annotation encoding=\"application/x-tex\">k=0</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6944em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03148em;\">k</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">0</span></span></span></span>","key":"L2UEc1ymCc"},{"type":"text","value":".","position":{"start":{"line":365,"column":1},"end":{"line":365,"column":1}},"key":"m69VxmT3VN"}],"key":"ckhiZGDqdd"},{"type":"card","children":[{"type":"paragraph","position":{"start":{"line":367,"column":1},"end":{"line":367,"column":1}},"children":[{"type":"text","value":"We use a closure here to pass the fixed parameter values into ","position":{"start":{"line":367,"column":1},"end":{"line":367,"column":1}},"key":"SbcXfXE6Vh"},{"type":"inlineCode","value":"couple","position":{"start":{"line":367,"column":1},"end":{"line":367,"column":1}},"key":"Fh0xMmM4ws"},{"type":"text","value":".","position":{"start":{"line":367,"column":1},"end":{"line":367,"column":1}},"key":"LTNlDB6Ntv"}],"key":"d0WdUrPRMR"}],"key":"iy1gdF1mnc"}],"key":"HC2a8226rp"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"gamma, L, k = 0.01, 0.5, 0.0\ndu_dt = lambda t, u: couple(t, u, (gamma, L, k))\nsol = solve_ivp(du_dt, tspan, u0, t_eval=linspace(0, 50, 1000))\nplot(sol.t, sol.y[:2, :].T)    # first two components of solution\nxlabel(\"t\"), ylabel(\"angle\")\ntitle(\"Uncoupled pendulums\");","key":"C66gku4aGW"},{"type":"output","id":"YQxaocsnL_2zIC_9pOAgo","data":[{"output_type":"display_data","metadata":{},"data":{"text/plain":{"content":"<Figure size 700x400 with 1 Axes>","content_type":"text/plain"},"image/png":{"content_type":"image/png","hash":"25f23eeccdbebf72f89d5dce5c2a7b96","path":"/fnc/build/25f23eeccdbebf72f89d5dce5c2a7b96.png"}}}],"key":"byVeHzlZ7K"}],"data":{},"key":"NPlLprILFK"},{"type":"paragraph","position":{"start":{"line":380,"column":1},"end":{"line":380,"column":1}},"children":[{"type":"text","value":"You can see that the pendulums swing independently. Because the model is nonlinear and the initial angles are not small, they have slightly different periods of oscillation, and they go in and out of phase.","position":{"start":{"line":380,"column":1},"end":{"line":380,"column":1}},"key":"quhwOMknTD"}],"key":"KW9w22WD5h"},{"type":"paragraph","position":{"start":{"line":382,"column":1},"end":{"line":382,"column":1}},"children":[{"type":"text","value":"With coupling activated, a different behavior is seen.","position":{"start":{"line":382,"column":1},"end":{"line":382,"column":1}},"key":"Ad7skeFl5U"}],"key":"BB9nGkjwe3"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"k = 0.75    # changes the value in the du_dt closure\nsol = solve_ivp(du_dt, tspan, u0, t_eval=linspace(0, 50, 1000))\nplot(sol.t, sol.y[:2, :].T)\nxlabel(\"t\"), ylabel(\"angle\")\ntitle(\"Coupled pendulums\");","key":"SHiybVNp8d"},{"type":"output","id":"kF6dQ4-qfOU0KW0IXd-HP","data":[{"output_type":"display_data","metadata":{},"data":{"text/plain":{"content":"<Figure size 700x400 with 1 Axes>","content_type":"text/plain"},"image/png":{"content_type":"image/png","hash":"ec445e39a7dd507b8a9483634d85fd51","path":"/fnc/build/ec445e39a7dd507b8a9483634d85fd51.png"}}}],"key":"JTkYF9JgUj"}],"data":{},"key":"YJQQr605Cc"},{"type":"paragraph","position":{"start":{"line":392,"column":1},"end":{"line":392,"column":1}},"children":[{"type":"text","value":"The coupling makes the pendulums swap energy back and forth.","position":{"start":{"line":392,"column":1},"end":{"line":392,"column":1}},"key":"sif9STvv0L"}],"key":"pn1t5u246C"}],"label":"demo-systems-coupledpendula-python","identifier":"demo-systems-coupledpendula-python","html_id":"demo-systems-coupledpendula-python","key":"hMxZ2hunpf"},{"type":"heading","depth":3,"position":{"start":{"line":395,"column":1},"end":{"line":395,"column":1}},"children":[{"type":"text","value":"Section 6.4","position":{"start":{"line":395,"column":1},"end":{"line":395,"column":1}},"key":"UddFS2ZYBt"}],"identifier":"section-6-4","label":"Section 6.4","html_id":"section-6-4","implicit":true,"key":"dKeviqCcpS"},{"type":"details","children":[{"type":"summary","children":[{"type":"text","value":"Convergence of Runge–Kutta methods","position":{"start":{"line":397,"column":1},"end":{"line":397,"column":1}},"key":"Cd3ooi5dkF"}],"key":"w1IWKR1cXK"},{"type":"paragraph","position":{"start":{"line":398,"column":1},"end":{"line":398,"column":1}},"children":[{"type":"text","value":"We solve the IVP ","position":{"start":{"line":398,"column":1},"end":{"line":398,"column":1}},"key":"o9LyXrxhle"},{"type":"inlineMath","value":"u'=\\sin[(u+t)^2]","position":{"start":{"line":398,"column":1},"end":{"line":398,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msup><mi>u</mi><mo mathvariant=\"normal\" lspace=\"0em\" rspace=\"0em\">′</mo></msup><mo>=</mo><mi>sin</mi><mo>⁡</mo><mo stretchy=\"false\">[</mo><mo stretchy=\"false\">(</mo><mi>u</mi><mo>+</mo><mi>t</mi><msup><mo stretchy=\"false\">)</mo><mn>2</mn></msup><mo stretchy=\"false\">]</mo></mrow><annotation encoding=\"application/x-tex\">u&#x27;=\\sin[(u+t)^2]</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.7519em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">u</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.7519em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">′</span></span></span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mop\">sin</span><span class=\"mopen\">[(</span><span class=\"mord mathnormal\">u</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1.0641em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\">t</span><span class=\"mclose\"><span class=\"mclose\">)</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span></span></span></span></span><span class=\"mclose\">]</span></span></span></span>","key":"BgnFQxxvdb"},{"type":"text","value":" over ","position":{"start":{"line":398,"column":1},"end":{"line":398,"column":1}},"key":"N6U3srdgTG"},{"type":"inlineMath","value":"0\\le t \\le 4","position":{"start":{"line":398,"column":1},"end":{"line":398,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>0</mn><mo>≤</mo><mi>t</mi><mo>≤</mo><mn>4</mn></mrow><annotation encoding=\"application/x-tex\">0\\le t \\le 4</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.7804em;vertical-align:-0.136em;\"></span><span class=\"mord\">0</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.7719em;vertical-align:-0.136em;\"></span><span class=\"mord mathnormal\">t</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">4</span></span></span></span>","key":"sFHpcCCtFg"},{"type":"text","value":", with ","position":{"start":{"line":398,"column":1},"end":{"line":398,"column":1}},"key":"zrq2JSBzkW"},{"type":"inlineMath","value":"u(0)=-1","position":{"start":{"line":398,"column":1},"end":{"line":398,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>u</mi><mo stretchy=\"false\">(</mo><mn>0</mn><mo stretchy=\"false\">)</mo><mo>=</mo><mo>−</mo><mn>1</mn></mrow><annotation encoding=\"application/x-tex\">u(0)=-1</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\">u</span><span class=\"mopen\">(</span><span class=\"mord\">0</span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.7278em;vertical-align:-0.0833em;\"></span><span class=\"mord\">−</span><span class=\"mord\">1</span></span></span></span>","key":"RUi8d7ZdPJ"},{"type":"text","value":". We start by getting a reference solution to validate against.","position":{"start":{"line":398,"column":1},"end":{"line":398,"column":1}},"key":"S96MaI8hVk"}],"key":"rVnS5rzZ6m"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"from scipy.integrate import solve_ivp\ndu_dt = lambda t, u: sin((t + u)**2)\ntspan = (0.0, 4.0)\nu0 = -1.0\nsol = solve_ivp(du_dt, tspan, [u0], dense_output=True, atol=1e-13, rtol=1e-13)\nu_ref = sol.sol","key":"JHNRGAOK3L"},{"type":"output","id":"SYsfE2lfZV8OLqmf0naGZ","data":[],"key":"kEGr21tL0X"}],"data":{},"key":"BZDbbojIBZ"},{"type":"paragraph","position":{"start":{"line":409,"column":1},"end":{"line":409,"column":1}},"children":[{"type":"text","value":"Now we perform a convergence study of our two Runge–Kutta implementations.","position":{"start":{"line":409,"column":1},"end":{"line":409,"column":1}},"key":"WQox5lHwIL"}],"key":"a6eIuZf2vf"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"n = array([int(2 * 10**k) for k in linspace(0, 3, 7)])\nerr = {\"IE2\" : [], \"RK4\" : []}\nresults = PrettyTable([\"n\", \"IE2 error\", \"RK4 error\"])\nfor i in range(len(n)):\n    t, u = FNC.ie2(du_dt, tspan, u0, n[i])\n    err[\"IE2\"].append( abs(u_ref(4)[0] - u[0][-1]) )\n    t, u = FNC.rk4(du_dt, tspan, u0, n[i])\n    err[\"RK4\"].append( abs(u_ref(4)[0] - u[0][-1]) )\n    results.add_row([n[i], err[\"IE2\"][-1], err[\"RK4\"][-1]])\n\nprint(results)","key":"LYrNMGl6uK"},{"type":"output","id":"7F27XLqxk5QvjhwQWhDcD","data":[{"output_type":"stream","name":"stdout","text":"+------+------------------------+------------------------+\n|  n   |       IE2 error        |       RK4 error        |\n+------+------------------------+------------------------+\n|  2   |   1.7690264118810441   |   0.8206513302232612   |\n|  6   |   0.5126838225133257   |   0.7919245473433536   |\n|  20  |  0.002966971266360252  | 4.0177650143746746e-05 |\n|  63  | 0.00021416270501584123 | 3.581705267929891e-07  |\n| 200  | 1.951309601522233e-05  | 3.326041442264227e-09  |\n| 632  | 1.9058382192405077e-06 | 3.2657876403163755e-11 |\n| 2000 | 1.8883901087285437e-07 | 2.6711965972481266e-13 |\n+------+------------------------+------------------------+\n"}],"key":"WX8jAKciDT"}],"data":{},"key":"YmU9DDpNjx"},{"type":"paragraph","position":{"start":{"line":425,"column":1},"end":{"line":425,"column":1}},"children":[{"type":"text","value":"The amount of computational work at each time step is assumed to be proportional to the number of stages. Let’s compare on an apples-to-apples basis by using the number of ","position":{"start":{"line":425,"column":1},"end":{"line":425,"column":1}},"key":"YxrMAUlZWy"},{"type":"inlineMath","value":"f","position":{"start":{"line":425,"column":1},"end":{"line":425,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>f</mi></mrow><annotation encoding=\"application/x-tex\">f</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8889em;vertical-align:-0.1944em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.10764em;\">f</span></span></span></span>","key":"wd5slgqSG6"},{"type":"text","value":"-evaluations on the horizontal axis.","position":{"start":{"line":425,"column":1},"end":{"line":425,"column":1}},"key":"hs1PMW80FL"}],"key":"S9rMHjqAnv"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"loglog(2 * n, err[\"IE2\"], \"-o\", label=\"IE2\")\nloglog(4 * n, err[\"RK4\"], \"-o\", label=\"RK4\")\nplot(2 * n, 0.5 * err[\"IE2\"][-1] * (n / n[-1])**(-2), \"--\", label=\"2nd order\")\nplot(4 * n, 0.5 * err[\"RK4\"][-1] * (n / n[-1])**(-4), \"--\", label=\"4th order\")\n\nxlabel(\"f-evaluations\"),  ylabel(\"inf-norm error\")\nlegend()\ntitle(\"Convergence of RK methods\");","key":"uXjDVQHW0z"},{"type":"output","id":"0AJ6lvIQiBkjKvzrNXyYn","data":[{"output_type":"display_data","metadata":{},"data":{"text/plain":{"content":"<Figure size 700x400 with 1 Axes>","content_type":"text/plain"},"image/png":{"content_type":"image/png","hash":"cd6cb29a14523b483894d43b7161d2d8","path":"/fnc/build/cd6cb29a14523b483894d43b7161d2d8.png"}}}],"key":"OYDnBYW1bJ"}],"data":{},"key":"GpRiXBDlvM"},{"type":"paragraph","position":{"start":{"line":438,"column":1},"end":{"line":438,"column":1}},"children":[{"type":"text","value":"The fourth-order variant is more efficient in this problem over a wide range of accuracy.","position":{"start":{"line":438,"column":1},"end":{"line":438,"column":1}},"key":"NzlTHnUpeC"}],"key":"Nwigo8gyzP"}],"label":"demo-rk-converge-python","identifier":"demo-rk-converge-python","html_id":"demo-rk-converge-python","key":"AItpYTLzLZ"},{"type":"heading","depth":3,"position":{"start":{"line":441,"column":1},"end":{"line":441,"column":1}},"children":[{"type":"text","value":"Section 6.5","position":{"start":{"line":441,"column":1},"end":{"line":441,"column":1}},"key":"W5fzSwTnO3"}],"identifier":"section-6-5","label":"Section 6.5","html_id":"section-6-5","implicit":true,"key":"Q2gXK4eHBb"},{"type":"details","children":[{"type":"summary","children":[{"type":"text","value":"Adaptive step size","position":{"start":{"line":443,"column":1},"end":{"line":443,"column":1}},"key":"QeJEAaj5SH"}],"key":"qw4Hixc9pl"},{"type":"paragraph","position":{"start":{"line":444,"column":1},"end":{"line":444,"column":1}},"children":[{"type":"text","value":"Let’s run adaptive RK on  ","position":{"start":{"line":444,"column":1},"end":{"line":444,"column":1}},"key":"v2b4GltHcR"},{"type":"inlineMath","value":"u'=e^{t-u\\sin u}","position":{"start":{"line":444,"column":1},"end":{"line":444,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msup><mi>u</mi><mo mathvariant=\"normal\" lspace=\"0em\" rspace=\"0em\">′</mo></msup><mo>=</mo><msup><mi>e</mi><mrow><mi>t</mi><mo>−</mo><mi>u</mi><mi>sin</mi><mo>⁡</mo><mi>u</mi></mrow></msup></mrow><annotation encoding=\"application/x-tex\">u&#x27;=e^{t-u\\sin u}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.7519em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">u</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.7519em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">′</span></span></span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8305em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">e</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8305em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">t</span><span class=\"mbin mtight\">−</span><span class=\"mord mathnormal mtight\">u</span><span class=\"mspace mtight\" style=\"margin-right:0.1952em;\"></span><span class=\"mop mtight\"><span class=\"mtight\">s</span><span class=\"mtight\">i</span><span class=\"mtight\">n</span></span><span class=\"mspace mtight\" style=\"margin-right:0.1952em;\"></span><span class=\"mord mathnormal mtight\">u</span></span></span></span></span></span></span></span></span></span></span></span>","key":"ONtav9b4df"},{"type":"text","value":".","position":{"start":{"line":444,"column":1},"end":{"line":444,"column":1}},"key":"hOUMcXPQwL"}],"key":"U6Gth6lc6p"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"f = lambda t, u: exp(t - u * sin(u))\nt, u = FNC.rk23(f, [0.0, 5.0], [0.0], 1e-5)\nscatter(t, u[0, :])\nxlabel(\"$t$\"), ylabel(\"$u(t)$\")\ntitle(\"Adaptive IVP solution\")","key":"ih7XiR77VP"},{"type":"output","id":"P0J-DYEn0AZEDn5wnwGcK","data":[{"output_type":"display_data","metadata":{},"data":{"text/plain":{"content":"<Figure size 700x400 with 1 Axes>","content_type":"text/plain"},"image/png":{"content_type":"image/png","hash":"2c0ef544586d85369ca444b7e24692df","path":"/fnc/build/2c0ef544586d85369ca444b7e24692df.png"}}}],"key":"BAeHJS96ay"}],"data":{},"key":"bhwpJwtTIF"},{"type":"paragraph","position":{"start":{"line":454,"column":1},"end":{"line":454,"column":1}},"children":[{"type":"text","value":"The solution makes a very abrupt change near ","position":{"start":{"line":454,"column":1},"end":{"line":454,"column":1}},"key":"yH2YHVoylq"},{"type":"inlineMath","value":"t=2.4","position":{"start":{"line":454,"column":1},"end":{"line":454,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>t</mi><mo>=</mo><mn>2.4</mn></mrow><annotation encoding=\"application/x-tex\">t=2.4</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6151em;\"></span><span class=\"mord mathnormal\">t</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">2.4</span></span></span></span>","key":"V9UuirnUgO"},{"type":"text","value":". The resulting time steps vary over three orders of magnitude.","position":{"start":{"line":454,"column":1},"end":{"line":454,"column":1}},"key":"jegiCYAtLn"}],"key":"mwqdjY1jZP"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"dt = [t[i + 1] - t[i] for i in range(t.size - 1)]\nsemilogy(t[:-1], dt)\nxlabel(\"$t$\"), ylabel(\"time step\")\ntitle(\"Adaptive step sizes\")","key":"Kh9QlhL95Z"},{"type":"output","id":"6kVV_zHtKV_XiOCwOL-go","data":[{"output_type":"display_data","metadata":{},"data":{"text/plain":{"content":"<Figure size 700x400 with 1 Axes>","content_type":"text/plain"},"image/png":{"content_type":"image/png","hash":"6f5f1476588f27b429711a2efee7a657","path":"/fnc/build/6f5f1476588f27b429711a2efee7a657.png"}}}],"key":"ruM7BNZUUy"}],"data":{},"key":"e7tA28IiAV"},{"type":"paragraph","position":{"start":{"line":463,"column":1},"end":{"line":463,"column":1}},"children":[{"type":"text","value":"If we had to run with a uniform step size to get this accuracy, it would be","position":{"start":{"line":463,"column":1},"end":{"line":463,"column":1}},"key":"EF1CqwQGj1"}],"key":"nLmeBNS2pd"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"print(f\"min step size was {min(dt):.2e}\")","key":"yXC6Jxxqz3"},{"type":"output","id":"L7HRsRAqiNsVlwCz60xsL","data":[{"output_type":"stream","name":"stdout","text":"min step size was 4.61e-05\n"}],"key":"DxhvgQK1UR"}],"data":{},"key":"Emx4n5AakC"},{"type":"paragraph","position":{"start":{"line":469,"column":1},"end":{"line":469,"column":1}},"children":[{"type":"text","value":"On the other hand, the average step size that was actually taken was","position":{"start":{"line":469,"column":1},"end":{"line":469,"column":1}},"key":"LGJzeeUMvT"}],"key":"lvD8OXFSBv"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"print(f\"mean step size was {mean(dt):.2e}\")","key":"AbmGnmIMEi"},{"type":"output","id":"tK6dTawZJOyM67NrR-4hc","data":[{"output_type":"stream","name":"stdout","text":"mean step size was 3.21e-02\n"}],"key":"QL6EhC8rTc"}],"data":{},"key":"vLlMxX8eG5"},{"type":"paragraph","position":{"start":{"line":475,"column":1},"end":{"line":475,"column":1}},"children":[{"type":"text","value":"We took fewer steps by a factor of 1000! Even accounting for the extra stage per step and the occasional rejected step, the savings are clear.","position":{"start":{"line":475,"column":1},"end":{"line":475,"column":1}},"key":"j3Pq3qryjF"}],"key":"FbsxL3HhUR"}],"label":"demo-adapt-basic-python","identifier":"demo-adapt-basic-python","html_id":"demo-adapt-basic-python","key":"zHOouU9g2O"},{"type":"details","children":[{"type":"summary","children":[{"type":"text","value":"Adaptive step size near a singularity","position":{"start":{"line":480,"column":1},"end":{"line":480,"column":1}},"key":"wkiMAUpYE9"}],"key":"ySYSvURrHT"},{"type":"paragraph","position":{"start":{"line":481,"column":1},"end":{"line":481,"column":1}},"children":[{"type":"text","value":"In ","position":{"start":{"line":481,"column":1},"end":{"line":481,"column":1}},"key":"kTnBmYQC7l"},{"type":"crossReference","kind":"proof:example","identifier":"demo-basics-sing","label":"demo-basics-sing","children":[{"type":"text","value":"Demo ","key":"JTTdhv6ecQ"},{"type":"text","value":"6.1.3","key":"VoFL0yjuHh"}],"template":"Example %s","enumerator":"6.1.3","resolved":true,"html_id":"demo-basics-sing","remote":true,"url":"/basics","dataUrl":"/basics.json","key":"lbEvOvAax8"},{"type":"text","value":" we saw an IVP that appears to blow up in a finite amount of time. Because the solution increases so rapidly as it approaches the blowup, adaptive stepping is required even to get close.","position":{"start":{"line":481,"column":1},"end":{"line":481,"column":1}},"key":"Xbgm23nCOY"}],"key":"Z41daPkGnq"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"du_dt = lambda t, u: (t + u)**2\ntspan = (0.0, 2.0)\nu0 = [1.0]\nt, u = FNC.rk23(du_dt, tspan, u0, 1e-5)","key":"GTs7oz5fg1"},{"type":"output","id":"-LRKcUmvFRbhEF_av-UGX","data":[{"output_type":"stream","name":"stderr","text":"/Users/driscoll/Dropbox/Mac/Documents/GitHub/fnc/python/pkg/FNC/FNC06.py:90: UserWarning: Stepsize too small near t=0.785408720407281\n  warnings.warn(f\"Stepsize too small near t={t[i]}\")\n"}],"key":"xq6vw4zPCN"}],"data":{},"key":"ZIIGyhSA7U"},{"type":"paragraph","position":{"start":{"line":490,"column":1},"end":{"line":490,"column":1}},"children":[{"type":"text","value":"In fact, the failure of the adaptivity gives a decent idea of when the singularity occurs.","position":{"start":{"line":490,"column":1},"end":{"line":490,"column":1}},"key":"rVVYxWkvA3"}],"key":"rC03UZLWmC"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"semilogy(t, u[0, :])\nxlabel(\"$t$\"),  ylabel(\"$u(t)$\")\ntitle(\"Finite-time blowup\")\n\ntf = t[-1]\naxvline(x=tf, color='k', linestyle='--', label=f\"t = {tf:.6f}\")\nlegend();","key":"wpuzZXqaOP"},{"type":"output","id":"hrm_vYFsN-QZ_VZn1uLBU","data":[{"output_type":"display_data","metadata":{},"data":{"text/plain":{"content":"<Figure size 700x400 with 1 Axes>","content_type":"text/plain"},"image/png":{"content_type":"image/png","hash":"9f9078bced9942279526825f3bba9ade","path":"/fnc/build/9f9078bced9942279526825f3bba9ade.png"}}}],"key":"qyToYTYbeg"}],"data":{},"key":"yF1f5OUZEz"}],"label":"demo-adpat-sing-python","identifier":"demo-adpat-sing-python","html_id":"demo-adpat-sing-python","key":"MAxwFy8EjK"},{"type":"heading","depth":3,"position":{"start":{"line":503,"column":1},"end":{"line":503,"column":1}},"children":[{"type":"text","value":"Section 6.6","position":{"start":{"line":503,"column":1},"end":{"line":503,"column":1}},"key":"YnOui9a1Jz"}],"identifier":"section-6-6","label":"Section 6.6","html_id":"section-6-6","implicit":true,"key":"dgAaYhqQC7"},{"type":"details","children":[{"type":"summary","children":[{"type":"text","value":"Convergence of Adams–Bashforth","position":{"start":{"line":505,"column":1},"end":{"line":505,"column":1}},"key":"NEGCJakQLw"}],"key":"xH4R4BCbbG"},{"type":"paragraph","position":{"start":{"line":506,"column":1},"end":{"line":506,"column":1}},"children":[{"type":"text","value":"We study the convergence of AB4 using the IVP ","position":{"start":{"line":506,"column":1},"end":{"line":506,"column":1}},"key":"XAJ2h2M3M8"},{"type":"inlineMath","value":"u'=\\sin[(u+t)^2]","position":{"start":{"line":506,"column":1},"end":{"line":506,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msup><mi>u</mi><mo mathvariant=\"normal\" lspace=\"0em\" rspace=\"0em\">′</mo></msup><mo>=</mo><mi>sin</mi><mo>⁡</mo><mo stretchy=\"false\">[</mo><mo stretchy=\"false\">(</mo><mi>u</mi><mo>+</mo><mi>t</mi><msup><mo stretchy=\"false\">)</mo><mn>2</mn></msup><mo stretchy=\"false\">]</mo></mrow><annotation encoding=\"application/x-tex\">u&#x27;=\\sin[(u+t)^2]</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.7519em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">u</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.7519em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">′</span></span></span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mop\">sin</span><span class=\"mopen\">[(</span><span class=\"mord mathnormal\">u</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1.0641em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\">t</span><span class=\"mclose\"><span class=\"mclose\">)</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span></span></span></span></span><span class=\"mclose\">]</span></span></span></span>","key":"UXygZbEuTh"},{"type":"text","value":" over ","position":{"start":{"line":506,"column":1},"end":{"line":506,"column":1}},"key":"JbUHdwHedF"},{"type":"inlineMath","value":"0\\le t \\le 4","position":{"start":{"line":506,"column":1},"end":{"line":506,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>0</mn><mo>≤</mo><mi>t</mi><mo>≤</mo><mn>4</mn></mrow><annotation encoding=\"application/x-tex\">0\\le t \\le 4</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.7804em;vertical-align:-0.136em;\"></span><span class=\"mord\">0</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.7719em;vertical-align:-0.136em;\"></span><span class=\"mord mathnormal\">t</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">4</span></span></span></span>","key":"T0VxImzqrA"},{"type":"text","value":", with ","position":{"start":{"line":506,"column":1},"end":{"line":506,"column":1}},"key":"hdgTjDlj96"},{"type":"inlineMath","value":"u(0)=-1","position":{"start":{"line":506,"column":1},"end":{"line":506,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>u</mi><mo stretchy=\"false\">(</mo><mn>0</mn><mo stretchy=\"false\">)</mo><mo>=</mo><mo>−</mo><mn>1</mn></mrow><annotation encoding=\"application/x-tex\">u(0)=-1</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\">u</span><span class=\"mopen\">(</span><span class=\"mord\">0</span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.7278em;vertical-align:-0.0833em;\"></span><span class=\"mord\">−</span><span class=\"mord\">1</span></span></span></span>","key":"Y5Y9jVZ7O8"},{"type":"text","value":". As usual, ","position":{"start":{"line":506,"column":1},"end":{"line":506,"column":1}},"key":"viBxvdPKnQ"},{"type":"inlineCode","value":"solve_ivp","position":{"start":{"line":506,"column":1},"end":{"line":506,"column":1}},"key":"nUri3anH86"},{"type":"text","value":" is called to give an accurate reference solution.","position":{"start":{"line":506,"column":1},"end":{"line":506,"column":1}},"key":"NlPnnUxDR6"}],"key":"CQcB3jcVXY"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"from scipy.integrate import solve_ivp\ndu_dt = lambda t, u: sin((t + u)**2)\ntspan = (0.0, 4.0)\nu0 = [-1.0]\nu_ref = solve_ivp(du_dt, tspan, u0, dense_output=True, rtol=1e-13, atol=1e-13).sol","key":"fXQkqCIBmk"},{"type":"output","id":"kfgllnzk7a9JUj_7mtVK2","data":[],"key":"EOJjjx8G8H"}],"data":{},"key":"T9mcZXZ0oR"},{"type":"paragraph","position":{"start":{"line":516,"column":1},"end":{"line":516,"column":1}},"children":[{"type":"text","value":"Now we perform a convergence study of the AB4 code.","position":{"start":{"line":516,"column":1},"end":{"line":516,"column":1}},"key":"JUWZnb5oOm"}],"key":"K6dIygYFow"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"n = array([int(4 * 10**k) for k in linspace(0, 3, 7)])\nerr = []\nresults = PrettyTable([\"n\", \"AB4 error\"])\nfor i in range(len(n)):\n    t, u = FNC.ab4(du_dt, tspan, u0, n[i])\n    err.append( abs(u_ref(4)[0] - u[0][-1]) )\n    results.add_row([n[i], err[-1]])\n\nprint(results)","key":"eVNa7qW3D7"},{"type":"output","id":"OaExkKHrmV8ygHHtBWGg-","data":[{"output_type":"stream","name":"stdout","text":"+------+------------------------+\n|  n   |       AB4 error        |\n+------+------------------------+\n|  4   |   0.5004401704518087   |\n|  12  |   0.9739144270683646   |\n|  40  | 2.2180676292116175e-05 |\n| 126  | 3.9306304588926366e-07 |\n| 400  | 4.561844235695389e-09  |\n| 1264 | 4.791389507374788e-11  |\n| 4000 | 5.426770144367765e-13  |\n+------+------------------------+\n"}],"key":"Y7J5i7NoIi"}],"data":{},"key":"aSk1UXUXYh"},{"type":"paragraph","position":{"start":{"line":530,"column":1},"end":{"line":530,"column":1}},"children":[{"type":"text","value":"The method should converge as ","position":{"start":{"line":530,"column":1},"end":{"line":530,"column":1}},"key":"j2LViWYYAI"},{"type":"inlineMath","value":"O(h^4)","position":{"start":{"line":530,"column":1},"end":{"line":530,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>O</mi><mo stretchy=\"false\">(</mo><msup><mi>h</mi><mn>4</mn></msup><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">O(h^4)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1.0641em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">O</span><span class=\"mopen\">(</span><span class=\"mord\"><span class=\"mord mathnormal\">h</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">4</span></span></span></span></span></span></span></span><span class=\"mclose\">)</span></span></span></span>","key":"QuIE0BBJZg"},{"type":"text","value":", so a log-log scale is appropriate for the errors.","position":{"start":{"line":530,"column":1},"end":{"line":530,"column":1}},"key":"bUauHP5HpJ"}],"key":"LCjc54oVEk"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"loglog(n, err, \"-o\", label=\"AB4\")\nloglog(n, 0.5 * err[-1] * (n / n[-1])**(-4), \"--\", label=\"4th order\")\n\nxlabel(\"$n$\"),  ylabel(\"final error\")\nlegend(), title(\"Convergence of AB4\");","key":"rR7zentBRA"},{"type":"output","id":"oBAqfXD0JQBRX0RJ9CKzD","data":[{"output_type":"display_data","metadata":{},"data":{"text/plain":{"content":"<Figure size 700x400 with 1 Axes>","content_type":"text/plain"},"image/png":{"content_type":"image/png","hash":"f142fff98e73ebc37e763732e0e86987","path":"/fnc/build/f142fff98e73ebc37e763732e0e86987.png"}}}],"key":"G36mDJ3J4M"}],"data":{},"key":"bdeRDCUzUO"}],"label":"demo-implicit-ab4-python","identifier":"demo-implicit-ab4-python","html_id":"demo-implicit-ab4-python","key":"Rq6Nu8B1mA"},{"type":"details","children":[{"type":"summary","children":[{"type":"text","value":"Stiffness","position":{"start":{"line":542,"column":1},"end":{"line":542,"column":1}},"key":"EgcnnOPNPo"}],"key":"SQ13ghrIDk"},{"type":"paragraph","position":{"start":{"line":543,"column":1},"end":{"line":543,"column":1}},"children":[{"type":"text","value":"The following simple ODE uncovers a surprise.","position":{"start":{"line":543,"column":1},"end":{"line":543,"column":1}},"key":"AzU15bliK5"}],"key":"P8pa0lXupW"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"f = lambda t, u: u**2 - u**3\nu0 = array([0.005])\ntspan = [0, 400]","key":"Svw6orGy7I"},{"type":"output","id":"0hsplRmSz4JIfRGjsf4XZ","data":[],"key":"Qxc2lPtHis"}],"data":{},"key":"u89YRDm2H1"},{"type":"paragraph","position":{"start":{"line":551,"column":1},"end":{"line":551,"column":1}},"children":[{"type":"text","value":"We will solve the problem first with the implicit AM2 method using ","position":{"start":{"line":551,"column":1},"end":{"line":551,"column":1}},"key":"sWmIUpKUOr"},{"type":"inlineMath","value":"n=200","position":{"start":{"line":551,"column":1},"end":{"line":551,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>n</mi><mo>=</mo><mn>200</mn></mrow><annotation encoding=\"application/x-tex\">n=200</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">n</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">200</span></span></span></span>","key":"u38PQKzMgg"},{"type":"text","value":" steps.","position":{"start":{"line":551,"column":1},"end":{"line":551,"column":1}},"key":"cPiAqgmwYG"}],"key":"uTV8Z99KEZ"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"tI, uI = FNC.am2(f, [0.0, 400.0], u0, 200)\nfig, ax = subplots()\nax.plot(tI, uI[0], label=\"AM2\")\nxlabel(\"$t$\"), ylabel(\"$y(t)$\");","key":"blUHl0796R"},{"type":"output","id":"oEGiuNQArx8Qxfe_37A7G","data":[{"output_type":"display_data","metadata":{},"data":{"text/plain":{"content":"<Figure size 700x400 with 1 Axes>","content_type":"text/plain"},"image/png":{"content_type":"image/png","hash":"fef8135e4aa29a89d4e5d72437989558","path":"/fnc/build/fef8135e4aa29a89d4e5d72437989558.png"}}}],"key":"ZWZgpQa7HY"}],"data":{},"key":"jh545NNNQM"},{"type":"paragraph","position":{"start":{"line":560,"column":1},"end":{"line":560,"column":1}},"children":[{"type":"text","value":"So far, so good. Now we repeat the process using the explicit AB4 method.","position":{"start":{"line":560,"column":1},"end":{"line":560,"column":1}},"key":"dS3EvX9gps"}],"key":"nE8BQLsJxE"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"tE, uE = FNC.ab4(f, [0.0, 400.0], u0, 200)\nax.scatter(tE, uE[0], label=\"AB4\")\nax.set_ylim([-4, 2]), ax.legend()\nfig","key":"IryfBBVKSv"},{"type":"output","id":"KVSSOlX98R6-HR1jzSFJH","data":[{"output_type":"stream","name":"stderr","text":"/var/folders/gc/0752xrm56pnf0r0dsrn5370c0000gr/T/ipykernel_21993/862619530.py:1: RuntimeWarning: overflow encountered in square\n  f = lambda t, u: u**2 - u**3\n/var/folders/gc/0752xrm56pnf0r0dsrn5370c0000gr/T/ipykernel_21993/862619530.py:1: RuntimeWarning: overflow encountered in power\n  f = lambda t, u: u**2 - u**3\n/var/folders/gc/0752xrm56pnf0r0dsrn5370c0000gr/T/ipykernel_21993/862619530.py:1: RuntimeWarning: invalid value encountered in subtract\n  f = lambda t, u: u**2 - u**3\n"},{"output_type":"execute_result","execution_count":39,"metadata":{},"data":{"text/plain":{"content":"<Figure size 700x400 with 1 Axes>","content_type":"text/plain"},"image/png":{"content_type":"image/png","hash":"c6c197110e00077b6daacac32ca51f40","path":"/fnc/build/c6c197110e00077b6daacac32ca51f40.png"}}}],"key":"JF2tKPI94Z"}],"data":{},"key":"xaIs4pmM4S"},{"type":"paragraph","position":{"start":{"line":569,"column":1},"end":{"line":569,"column":1}},"children":[{"type":"text","value":"Once the solution starts to take off, the AB4 result goes catastrophically wrong.","position":{"start":{"line":569,"column":1},"end":{"line":569,"column":1}},"key":"SZ5QgIbHWW"}],"key":"VX0AF5ujN5"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"uE[0, 104:111]","key":"pq1MH70Eom"},{"type":"output","id":"wAkcrDlt6lRIPx9UUdnSr","data":[{"output_type":"execute_result","execution_count":40,"metadata":{},"data":{"text/plain":{"content":"array([ 7.55385780e-01,  1.43729703e+00, -3.28897685e+00,  2.14179113e+02,\n       -4.48208915e+07,  4.12689029e+23, -3.22144124e+71])","content_type":"text/plain"}}}],"key":"bwxSu4ajjR"}],"data":{},"key":"KKXBpZ5bGt"},{"type":"paragraph","position":{"start":{"line":575,"column":1},"end":{"line":575,"column":1}},"children":[{"type":"text","value":"We hope that AB4 will converge in the limit ","position":{"start":{"line":575,"column":1},"end":{"line":575,"column":1}},"key":"AnH2Gca8Id"},{"type":"inlineMath","value":"h\\to 0","position":{"start":{"line":575,"column":1},"end":{"line":575,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>h</mi><mo>→</mo><mn>0</mn></mrow><annotation encoding=\"application/x-tex\">h\\to 0</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6944em;\"></span><span class=\"mord mathnormal\">h</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">→</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">0</span></span></span></span>","key":"ihvRYTEQ0F"},{"type":"text","value":", so let’s try using more steps.","position":{"start":{"line":575,"column":1},"end":{"line":575,"column":1}},"key":"F6GFAdn7cD"}],"key":"NgCaDFoaJk"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"plot(tI, uI[0], color=\"k\", label=\"AM2\")\ntE, uE = FNC.ab4(f, [0, 400], u0, 1000)\nplot(tE, uE[0], \".-\", label=\"AM4, n=1000\")\ntE, uE = FNC.ab4(f, [0, 400], u0, 1600)\nplot(tE, uE[0], \".-\", label=\"AM4, n=1600\")\nxlabel(\"$t$\"),  ylabel(\"$u(t)$\")\nlegend()","key":"MrPu3I2zfB"},{"type":"output","id":"fWhEIkTyHLgxnICZltpW0","data":[{"output_type":"display_data","metadata":{},"data":{"text/plain":{"content":"<Figure size 700x400 with 1 Axes>","content_type":"text/plain"},"image/png":{"content_type":"image/png","hash":"e2487bd3b5b88bea9b7573ef7ff0634b","path":"/fnc/build/e2487bd3b5b88bea9b7573ef7ff0634b.png"}}}],"key":"nplvStLV0Q"}],"data":{},"key":"cP34s6QSqU"},{"type":"paragraph","position":{"start":{"line":587,"column":1},"end":{"line":587,"column":1}},"children":[{"type":"text","value":"So AB4, which is supposed to be ","position":{"start":{"line":587,"column":1},"end":{"line":587,"column":1}},"key":"w1LQ9WXacv"},{"type":"emphasis","position":{"start":{"line":587,"column":1},"end":{"line":587,"column":1}},"children":[{"type":"text","value":"more","position":{"start":{"line":587,"column":1},"end":{"line":587,"column":1}},"key":"XeTqE5MjMj"}],"key":"E53nZUfR4E"},{"type":"text","value":" accurate than AM2, actually needs something like 8 times as many steps to get a reasonable-looking answer!","position":{"start":{"line":587,"column":1},"end":{"line":587,"column":1}},"key":"tESHyq9Lxf"}],"key":"uwLLmRpd3S"}],"label":"demo-implicit-stiff-python","identifier":"demo-implicit-stiff-python","html_id":"demo-implicit-stiff-python","key":"tUONeil0G6"},{"type":"heading","depth":3,"position":{"start":{"line":590,"column":1},"end":{"line":590,"column":1}},"children":[{"type":"text","value":"Section 6.7","position":{"start":{"line":590,"column":1},"end":{"line":590,"column":1}},"key":"lDXZiXTuA3"}],"identifier":"section-6-7","label":"Section 6.7","html_id":"section-6-7","implicit":true,"key":"wKNe3gayDg"},{"type":"details","children":[{"type":"summary","children":[{"type":"text","value":"Instability","position":{"start":{"line":592,"column":1},"end":{"line":592,"column":1}},"key":"wiXNzddFf3"}],"key":"iI6ANi1lil"},{"type":"paragraph","position":{"start":{"line":593,"column":1},"end":{"line":593,"column":1}},"children":[{"type":"text","value":"We’ll measure the error at the time ","position":{"start":{"line":593,"column":1},"end":{"line":593,"column":1}},"key":"v2yPYGUlX2"},{"type":"inlineMath","value":"t=1","position":{"start":{"line":593,"column":1},"end":{"line":593,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>t</mi><mo>=</mo><mn>1</mn></mrow><annotation encoding=\"application/x-tex\">t=1</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6151em;\"></span><span class=\"mord mathnormal\">t</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">1</span></span></span></span>","key":"nA9SOyzjRV"},{"type":"text","value":".","position":{"start":{"line":593,"column":1},"end":{"line":593,"column":1}},"key":"PPcDW74bkj"}],"key":"OlvT9xNcsr"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"du_dt = lambda t, u: u\nu_exact = exp\na, b = (0.0, 1.0)\n\ndef LIAF(du_dt, tspan, u0, n):\n    a, b = tspan\n    h = (b - a) / n\n    t = linspace(a, b, n+1)\n    u = np.tile(np.array(u0), (n+1, 1))\n    u[1] = u_exact(t[1])    # use an exact starting value\n    f = copy(u)\n    f[0] = du_dt(t[0], u[0])\n    for i in range(n):\n        f[i] = du_dt(t[i], u[i])\n        u[i + 1] = -4 * u[i] + 5 * u[i-1] + h * (4 * f[i] + 2 * f[i-1])\n\n    return t, u.T\n\nn = [5, 10, 20, 40, 60]\nresults = PrettyTable([\"n\", \"error\"])\nfor j in range(5):\n    t, u = LIAF(du_dt, [a, b], [1.0], n[j])\n    err = abs(u_exact(b) - u[0, -1])\n    results.add_row([n[j], err])\nprint(results)","key":"N1UQIUJgqk"},{"type":"output","id":"h1K5Rz8NCl-yblp_e07_5","data":[{"output_type":"stream","name":"stdout","text":"+----+------------------------+\n| n  |         error          |\n+----+------------------------+\n| 5  |    293.502838171541    |\n| 10 |   452905.58324991807   |\n| 20 |   2196838145485.221    |\n| 40 | 1.0437865522698013e+26 |\n| 60 | 6.628042953187168e+39  |\n+----+------------------------+\n"}],"key":"PT19oVQ1UF"}],"data":{},"key":"CTMOW7ppCn"},{"type":"paragraph","position":{"start":{"line":623,"column":1},"end":{"line":623,"column":1}},"children":[{"type":"text","value":"There is no convergence in sight! A graph of the last numerical attempt yields a clue:","position":{"start":{"line":623,"column":1},"end":{"line":623,"column":1}},"key":"Y4KBgmNDAK"}],"key":"kTfNfZwO0Y"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"semilogy(t, abs(u[0]), \"-o\")\nxlabel(\"$t$\"), ylabel(\"$|u|$\")\ntitle(\"LIAF solution\")","key":"VkHxEgW0C6"},{"type":"output","id":"5ySoOgZaxuhx2gvokmUaI","data":[{"output_type":"display_data","metadata":{},"data":{"text/plain":{"content":"<Figure size 700x400 with 1 Axes>","content_type":"text/plain"},"image/png":{"content_type":"image/png","hash":"e9969c91ae7ff197ce0f895bd461dd6b","path":"/fnc/build/e9969c91ae7ff197ce0f895bd461dd6b.png"}}}],"key":"SYd5Px2BTm"}],"data":{},"key":"bJXYVQpXSX"},{"type":"paragraph","position":{"start":{"line":631,"column":1},"end":{"line":631,"column":1}},"children":[{"type":"text","value":"It’s clear that the solution is growing exponentially in time.","position":{"start":{"line":631,"column":1},"end":{"line":631,"column":1}},"key":"tysJe2GJuy"}],"key":"svaCLCKUJG"}],"label":"demo-zs-LIAF-python","identifier":"demo-zs-liaf-python","html_id":"demo-zs-liaf-python","key":"AxVJqoSySK"}],"key":"MvLA3UyedO"}],"key":"CW6b4oVtMn"},"references":{"cite":{"order":[],"data":{}}},"footer":{"navigation":{"prev":{"title":"Chapter 5","url":"/chapter5-2","group":"Python codes"},"next":{"title":"Index","url":"/genindex","group":"Python codes"}}},"domain":"http://localhost:3000"}