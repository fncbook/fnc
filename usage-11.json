{"kind":"Notebook","sha256":"d1e8e8f0b139bf6585a4fada38f3e729a113001a943df02aad8ebb73d7c89077","slug":"usage-11","location":"/chapter5/section7/python/usage.ipynb","dependencies":[],"frontmatter":{"numbering":{"heading_1":{"enabled":false},"heading_2":{"enabled":false},"heading_3":{"enabled":false},"heading_4":{"enabled":false},"heading_5":{"enabled":false},"heading_6":{"enabled":false}},"kernelspec":{"name":"python3","display_name":"myst","language":"python"},"authors":[{"nameParsed":{"literal":"Tobin A. Driscoll","given":"Tobin A.","family":"Driscoll"},"name":"Tobin A. Driscoll","email":"driscoll@udel.edu","id":"contributors-myst-generated-uid-0","corresponding":true},{"nameParsed":{"literal":"Richard J. Braun","given":"Richard J.","family":"Braun"},"name":"Richard J. Braun","id":"contributors-myst-generated-uid-1"}],"github":"https://github.com/fncbook/fnc","math":{"\\float":{"macro":"\\mathbb{F}"},"\\real":{"macro":"\\mathbb{R}"},"\\complex":{"macro":"\\mathbb{C}"},"\\nat":{"macro":"\\mathbb{N}"},"\\integer":{"macro":"\\mathbb{Z}"},"\\rmn":{"macro":"\\mathbb{R}^{#1 \\times #2}"},"\\dd":{"macro":"\\frac{d #1}{d #2}"},"\\ddd":{"macro":"\\frac{d^2 #1}{d #2^2}"},"\\pp":{"macro":"\\frac{\\partial #1}{\\partial #2}"},"\\ppp":{"macro":"\\frac{\\partial^2 #1}{\\partial #2^2}"},"\\ppdd":{"macro":"\\frac{\\partial^2 #1}{\\partial #2 \\partial #3}"},"\\abs":{"macro":"\\left\\lvert #1 \\right\\rvert"},"\\norm":{"macro":"\\left\\lVert #1 \\right\\rVert"},"\\twonorm":{"macro":"\\norm{#1}_2"},"\\onenorm":{"macro":"\\norm{#1}_1"},"\\infnorm":{"macro":"\\norm{#1}_\\infty"},"\\anynorm":{"macro":"\\norm{#1}_#2"},"\\innerprod":{"macro":"\\langle #1,#2 \\rangle"},"\\pr":{"macro":"^{(#1)}"},"\\kron":{"macro":"#1 \\otimes #2"},"\\eye":{"macro":"\\mathbf{e}_#1"},"\\meye":{"macro":"\\mathbf{I}"},"\\Qhat":{"macro":"\\hat{\\mathbf{Q}}"},"\\Rhat":{"macro":"\\hat{\\mathbf{R}}"},"\\bfalpha":{"macro":"\\mathbf{alpha}"},"\\bfdelta":{"macro":"\\mathbf{delta}"},"\\bfzero":{"macro":"\\boldsymbol{0}"},"\\macheps":{"macro":"\\epsilon_\\text{mach}"},"\\fl":{"macro":"\\operatorname{fl}"},"\\diag":{"macro":"\\operatorname{diag}"},"\\ign":{"macro":"\\operatorname{sign}"},"\\Re":{"macro":"\\operatorname{Re}"},"\\Im":{"macro":"\\operatorname{Im}"},"\\ee":{"macro":"\\times 10^"},"\\lnorm":{"macro":"\\|"},"\\rnorm":{"macro":"\\|"},"\\floor":{"macro":"\\lfloor#1\\rfloor"},"\\cI":{"macro":"\\mathcal{I}"},"\\mtx":{"macro":"\\operatorname{mtx}"},"\\myvec":{"macro":"\\operatorname{vec}"},"\\argmin":{"macro":"\\operatorname{argmin}"}},"abbreviations":{"IVP":"initial-value problem","BVP":"boundary-value problem","ONC":"matrix with orthonormal columns","SVD":"singular value decomposition","EVD":"eigenvalue decomposition","SPD":"symmetric positive definite","HPD":"hermitian positive definite","PDE":"partial differential equation","ODE":"ordinary differential equation"},"exports":[{"format":"ipynb","filename":"usage.ipynb","url":"/build/usage-e5dd1fabc53ec22c93bf12646b8f1f47.ipynb"}]},"widgets":{},"mdast":{"type":"root","children":[{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2025-01-11T16:48:33.187842Z","iopub.status.busy":"2025-01-11T16:48:33.187121Z","iopub.status.idle":"2025-01-11T16:48:33.506987Z","shell.execute_reply":"2025-01-11T16:48:33.506670Z"},"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"exec(open(\"../../../python/FNC_init.py\").read())","visibility":"show","key":"vXRKeSA2PB"},{"type":"output","id":"xqrtGF9UEDNMi5gsLDkR1","data":[],"visibility":"show","key":"KfmPTUBtBm"}],"visibility":"remove","key":"k54yBIqDFm"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"crossReference","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"strong","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Demo ","key":"dhUwSswYdG"},{"type":"text","value":"5.7.2","key":"bZcPSVsk2K"}],"key":"t9iJewpNlC"}],"identifier":"demo-adapt-usage","label":"demo-adapt-usage","kind":"proof:example","template":"Example %s","enumerator":"5.7.2","resolved":true,"html_id":"demo-adapt-usage","remote":true,"url":"/adaptive","dataUrl":"/adaptive.json","key":"aR84w9Xu8S"}],"key":"WnZFr9lOrq"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"We’ll integrate the function from ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"LjqSywzECK"},{"type":"crossReference","kind":"proof:example","identifier":"demo-adapt-motive","label":"demo-adapt-motive","children":[{"type":"text","value":"Demo ","key":"NnrqF0e8jv"},{"type":"text","value":"5.7.1","key":"By8wfKTOUU"}],"template":"Example %s","enumerator":"5.7.1","resolved":true,"html_id":"demo-adapt-motive","remote":true,"url":"/adaptive","dataUrl":"/adaptive.json","key":"Z1WYJBgxaW"},{"type":"text","value":".","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"VKL2QQ5bJQ"}],"key":"n0tYy78Ur2"}],"key":"zw5m2H9AYr"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2025-01-11T16:48:33.508691Z","iopub.status.busy":"2025-01-11T16:48:33.508570Z","iopub.status.idle":"2025-01-11T16:48:33.510924Z","shell.execute_reply":"2025-01-11T16:48:33.510703Z"}},"children":[{"type":"code","lang":"python","executable":true,"value":"from scipy.integrate import quad\nf = lambda x: (x + 1) ** 2 * cos((2 * x + 1) / (x - 4.3))\nI, errest = quad(f, 0, 4, epsabs=1e-12, epsrel=1e-12)\nprint(\"integral:\", I)    # 'exact' value","key":"UbrkdAgh8P"},{"type":"output","id":"yUrN37oEsu5s7eBYhXCcw","data":[{"name":"stdout","output_type":"stream","text":"integral: -2.8255333734374504\n"}],"key":"BF4AgMrDGy"}],"key":"ZXHchAx0I7"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"We perform the integration and show the nodes selected underneath the curve.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"CqRyG8PJxX"}],"key":"lW1p9LNC2y"}],"key":"h3n3wvMKKj"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2025-01-11T16:48:33.512203Z","iopub.status.busy":"2025-01-11T16:48:33.512124Z","iopub.status.idle":"2025-01-11T16:48:33.624050Z","shell.execute_reply":"2025-01-11T16:48:33.623764Z"}},"children":[{"type":"code","lang":"python","executable":true,"value":"Q, t = FNC.intadapt(f, 0, 4, 0.001)\nprint(\"number of nodes:\", t.size)\n\nx = linspace(0, 4, 600)\nplot(x, f(x), \"k\")\nstem(t, f(t))\nxlabel(\"$x$\"); ylabel(\"$f(x)$\");","key":"s16pYnlYle"},{"type":"output","id":"gnKip0aGTg9IEZckjrugO","data":[{"name":"stdout","output_type":"stream","text":"number of nodes: 69\n"},{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"549096332e90554ad3e51dd26cfb3730","path":"/build/549096332e90554ad3e51dd26cfb3730.png"},"text/plain":{"content":"<Figure size 700x400 with 1 Axes>","content_type":"text/plain"}}}],"key":"mIp12vydgl"}],"key":"oUnfE774EC"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"The error turns out to be a bit more than we requested. It’s only an estimate, not a guarantee.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"wVGOaQL2DH"}],"key":"iNkKu5fUtJ"}],"key":"kUoRKepV23"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2025-01-11T16:48:33.627199Z","iopub.status.busy":"2025-01-11T16:48:33.627088Z","iopub.status.idle":"2025-01-11T16:48:33.628907Z","shell.execute_reply":"2025-01-11T16:48:33.628640Z"}},"children":[{"type":"code","lang":"python","executable":true,"value":"print(\"error:\", I - Q)","key":"S7YQZg1k1X"},{"type":"output","id":"F0xls6NKiYqjUcSYt_HUP","data":[{"name":"stdout","output_type":"stream","text":"error: -0.02200281303763152\n"}],"key":"rDo7ZlsW6l"}],"key":"p70Ke2cQHu"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Let’s see how the number of integrand evaluations and the error vary with the requested tolerance.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"xI5SZAXpb5"}],"key":"Nk38hefRG6"}],"key":"ic0vEOgGzC"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2025-01-11T16:48:33.630025Z","iopub.status.busy":"2025-01-11T16:48:33.629947Z","iopub.status.idle":"2025-01-11T16:48:33.656795Z","shell.execute_reply":"2025-01-11T16:48:33.656471Z"}},"children":[{"type":"code","lang":"python","executable":true,"value":"tol = 10.0 ** arange(-4, -11, -1)\nerr = zeros(len(tol))\nnum = zeros(len(tol), dtype=int)\nresults = PrettyTable([\"tolerance\", \"error\", \"number of f-evals\"])\nfor k in range(len(tol)):\n    Q, t = FNC.intadapt(f, 0, 4, tol[k])\n    err[k] = abs(I - Q)\n    num[k] = len(t)\n    results.add_row([tol[k], err[k], num[k]])\nprint(results)","key":"FYQXZFQunB"},{"type":"output","id":"WgwpLXEZYIlZ54V9ViJTV","data":[{"name":"stdout","output_type":"stream","text":"+-----------+------------------------+-------------------+\n| tolerance |         error          | number of f-evals |\n+-----------+------------------------+-------------------+\n|   0.0001  | 0.00041946881777921163 |        113        |\n|   1e-05   | 4.789766253399108e-05  |        181        |\n|   1e-06   | 6.314383844685523e-06  |        297        |\n|   1e-07   | 6.639249816586812e-07  |        489        |\n|   1e-08   |  7.18080657158282e-08  |        757        |\n|   1e-09   | 1.265238136483049e-08  |        1193       |\n|   1e-10   | 8.441305432427271e-10  |        2009       |\n+-----------+------------------------+-------------------+\n"}],"key":"AgFZvs1RaV"}],"key":"eZsRSjSa8K"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"As you can see, even though the errors are not smaller than the estimates, the two columns decrease in tandem. If we consider now the convergence not in ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"zGJNZ4INEI"},{"type":"inlineMath","value":"h","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>h</mi></mrow><annotation encoding=\"application/x-tex\">h</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6944em;\"></span><span class=\"mord mathnormal\">h</span></span></span></span>","key":"R9rScAoxh5"},{"type":"text","value":", which is poorly defined now, but in the number of nodes actually chosen, we come close to the fourth-order accuracy of the underlying Simpson scheme.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"Kf4sshaolA"}],"key":"ADd9ASUq6U"}],"key":"OpLgwSbMnu"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2025-01-11T16:48:33.658051Z","iopub.status.busy":"2025-01-11T16:48:33.657969Z","iopub.status.idle":"2025-01-11T16:48:33.789873Z","shell.execute_reply":"2025-01-11T16:48:33.789555Z"}},"children":[{"type":"code","lang":"python","executable":true,"value":"loglog(num, abs(err), \"-o\", label=\"results\")\norder4 = 0.5 * err[-1] * (num / num[-1]) ** (-4)\nloglog(num, order4, \"k--\", label=\"$O(n^{-4})$\")\nxlabel(\"number of nodes\"), ylabel(\"error\")\nlegend()\ntitle(\"Convergence of adaptive quadrature\");","key":"xJeVXWExMG"},{"type":"output","id":"f41PoSgQZyXo4rAi2VvEI","data":[{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"6b79cf50fd8444a6982cd2bd5b14af97","path":"/build/6b79cf50fd8444a6982cd2bd5b14af97.png"},"text/plain":{"content":"<Figure size 700x400 with 1 Axes>","content_type":"text/plain"}}}],"key":"QaZDRs4zBY"}],"key":"fgy7P15wUZ"}],"key":"IygOtcTfOC"},"references":{"cite":{"order":[],"data":{}}},"footer":{"navigation":{"prev":{"title":"Motive","url":"/motive-2","group":"Chapter 5"},"next":{"title":"First","url":"/first-2","group":"Chapter 6"}}},"domain":"http://localhost:3000"}