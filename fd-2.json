{"kind":"Notebook","sha256":"30d31d03be47370708c90e398da0e7f261c4cf539103b241ade665dc27b54da0","slug":"fd-2","location":"/chapter13/section3/python/fd.ipynb","dependencies":[],"frontmatter":{"numbering":{"heading_1":{"enabled":false},"heading_2":{"enabled":false},"heading_3":{"enabled":false},"heading_4":{"enabled":false},"heading_5":{"enabled":false},"heading_6":{"enabled":false}},"kernelspec":{"name":"python3","display_name":"Python 3","language":"python"},"authors":[{"nameParsed":{"literal":"Tobin A. Driscoll","given":"Tobin A.","family":"Driscoll"},"name":"Tobin A. Driscoll","email":"driscoll@udel.edu","id":"contributors-myst-generated-uid-0","corresponding":true},{"nameParsed":{"literal":"Richard J. Braun","given":"Richard J.","family":"Braun"},"name":"Richard J. Braun","id":"contributors-myst-generated-uid-1"}],"github":"https://github.com/fncbook/fnc","math":{"\\float":{"macro":"\\mathbb{F}"},"\\real":{"macro":"\\mathbb{R}"},"\\complex":{"macro":"\\mathbb{C}"},"\\nat":{"macro":"\\mathbb{N}"},"\\integer":{"macro":"\\mathbb{Z}"},"\\rmn":{"macro":"\\mathbb{R}^{#1 \\times #2}"},"\\dd":{"macro":"\\frac{d #1}{d #2}"},"\\ddd":{"macro":"\\frac{d^2 #1}{d #2^2}"},"\\pp":{"macro":"\\frac{\\partial #1}{\\partial #2}"},"\\ppp":{"macro":"\\frac{\\partial^2 #1}{\\partial #2^2}"},"\\ppdd":{"macro":"\\frac{\\partial^2 #1}{\\partial #2 \\partial #3}"},"\\abs":{"macro":"\\left\\lvert #1 \\right\\rvert"},"\\norm":{"macro":"\\left\\lVert #1 \\right\\rVert"},"\\twonorm":{"macro":"\\norm{#1}_2"},"\\onenorm":{"macro":"\\norm{#1}_1"},"\\infnorm":{"macro":"\\norm{#1}_\\infty"},"\\anynorm":{"macro":"\\norm{#1}_#2"},"\\innerprod":{"macro":"\\langle #1,#2 \\rangle"},"\\pr":{"macro":"^{(#1)}"},"\\kron":{"macro":"#1 \\otimes #2"},"\\eye":{"macro":"\\mathbf{e}_#1"},"\\meye":{"macro":"\\mathbf{I}"},"\\Qhat":{"macro":"\\hat{\\mathbf{Q}}"},"\\Rhat":{"macro":"\\hat{\\mathbf{R}}"},"\\bfalpha":{"macro":"\\mathbf{alpha}"},"\\bfdelta":{"macro":"\\mathbf{delta}"},"\\bfzero":{"macro":"\\boldsymbol{0}"},"\\macheps":{"macro":"\\epsilon_\\text{mach}"},"\\fl":{"macro":"\\operatorname{fl}"},"\\diag":{"macro":"\\operatorname{diag}"},"\\ign":{"macro":"\\operatorname{sign}"},"\\Re":{"macro":"\\operatorname{Re}"},"\\Im":{"macro":"\\operatorname{Im}"},"\\ee":{"macro":"\\times 10^"},"\\lnorm":{"macro":"\\|"},"\\rnorm":{"macro":"\\|"},"\\floor":{"macro":"\\lfloor#1\\rfloor"},"\\cI":{"macro":"\\mathcal{I}"},"\\mtx":{"macro":"\\operatorname{mtx}"},"\\myvec":{"macro":"\\operatorname{vec}"},"\\argmin":{"macro":"\\operatorname{argmin}"}},"abbreviations":{"IVP":"initial-value problem","BVP":"boundary-value problem","ONC":"matrix with orthonormal columns","SVD":"singular value decomposition","EVD":"eigenvalue decomposition","SPD":"symmetric positive definite","HPD":"hermitian positive definite","PDE":"partial differential equation","ODE":"ordinary differential equation"},"exports":[{"format":"ipynb","filename":"fd.ipynb","url":"/build/fd-4dd978001ed38c047f0095a3c1dd2ed9.ipynb"}]},"widgets":{},"mdast":{"type":"root","children":[{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2025-01-09T20:35:10.719876Z","iopub.status.busy":"2025-01-09T20:35:10.719759Z","iopub.status.idle":"2025-01-09T20:35:11.293786Z","shell.execute_reply":"2025-01-09T20:35:11.293445Z"},"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"exec(open(\"../../../python/FNC_init.py\").read())","visibility":"show","key":"JhKPKt7RV0"},{"type":"output","id":"Wn6EBesb6nIhJ22NE4oHV","data":[],"visibility":"show","key":"dWnOIdoeWY"}],"visibility":"remove","key":"pakXQh4tbZ"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"crossReference","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"strong","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Demo ","key":"R9E4vYT4Wq"},{"type":"text","value":"13.3.2","key":"qFn63mft7u"}],"key":"r36RavQtNX"}],"identifier":"demo-laplace-fd","label":"demo-laplace-fd","kind":"proof:example","template":"Example %s","enumerator":"13.3.2","resolved":true,"html_id":"demo-laplace-fd","remote":true,"url":"/laplace","dataUrl":"/laplace.json","key":"m2xaJLXvXB"}],"key":"BMRNz5nXww"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"We make a crude discretization for illustrative purposes.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"WyPn9lbSkt"}],"key":"jooxWlsr9B"}],"key":"hzFmqVwsZB"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2025-01-09T20:35:11.295771Z","iopub.status.busy":"2025-01-09T20:35:11.295567Z","iopub.status.idle":"2025-01-09T20:35:11.298214Z","shell.execute_reply":"2025-01-09T20:35:11.297897Z"}},"children":[{"type":"code","lang":"python","executable":true,"value":"m, n = 5, 6\nx, Dx, Dxx = FNC.diffmat2(m, [0, 3])\ny, Dy, Dyy = FNC.diffmat2(n, [-1, 1])\nmtx, X, Y, vec, unvec, is_boundary = FNC.tensorgrid(x, y)","key":"aqRWCgYd3Q"},{"type":"output","id":"ToIbRT9EIqNxOC94K9BAT","data":[],"key":"fZzrUjAOwp"}],"key":"gBqyuUs1Bw"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Next, we define ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"VlnB4p0l6E"},{"type":"text","value":"ϕ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"KomDu3m97c"},{"type":"text","value":" and evaluate it on the grid to get the forcing vector of the linear system.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"sCpOtR2plP"}],"key":"fBzYRMm9nb"}],"key":"JcNSwxjP5Y"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2025-01-09T20:35:11.299681Z","iopub.status.busy":"2025-01-09T20:35:11.299553Z","iopub.status.idle":"2025-01-09T20:35:11.301527Z","shell.execute_reply":"2025-01-09T20:35:11.301230Z"}},"children":[{"type":"code","lang":"python","executable":true,"value":"f = lambda x, y: x**2 - y + 2\nb = vec(mtx(f))","key":"sw2YJbJ0N5"},{"type":"output","id":"9jMdaevYhMNGYFNZ_6ajL","data":[],"key":"csG1Darc72"}],"key":"BZUo2idsZM"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Here are the coefficients for the ","key":"yc89L2oj5R"},{"type":"abbreviation","title":"partial differential equation","children":[{"type":"text","value":"PDE","key":"RvZWUHz1Xe"}],"key":"m8ZzQSE49J"},{"type":"text","value":" collocation, before any modifications are made for the boundary conditions. The combination of Kronecker products and finite differences produces a characteristic sparsity pattern.","key":"lsSStFuxrk"}],"key":"O8gmxEiqj2"}],"key":"tJXadaQERI"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2025-01-09T20:35:11.303030Z","iopub.status.busy":"2025-01-09T20:35:11.302900Z","iopub.status.idle":"2025-01-09T20:35:11.450791Z","shell.execute_reply":"2025-01-09T20:35:11.450374Z"}},"children":[{"type":"code","lang":"python","executable":true,"value":"import scipy.sparse as sp\nDxx = sp.lil_matrix(Dxx)\nDyy = sp.lil_matrix(Dyy)\nIx = sp.eye(m+1)\nIy = sp.eye(n+1)\nA = sp.kron(Iy, Dxx) + sp.kron(Dyy, Ix)\n\nspy(A)\ntitle(\"Matrix before imposing BC\");","key":"x18z0G2Zcs"},{"type":"output","id":"DgDa48FjqjtyVVY-EqC6O","data":[{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"47adca8dcf498c190431a9536da0e187","path":"/build/47adca8dcf498c190431a9536da0e187.png"},"text/plain":{"content":"<Figure size 700x400 with 1 Axes>","content_type":"text/plain"}}}],"key":"P8gICKEDK0"}],"key":"CfSqF92mvb"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"The number of equations is equal to ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"jB4rL71MmD"},{"type":"inlineMath","value":"(m+1)(n+1)","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mo stretchy=\"false\">(</mo><mi>m</mi><mo>+</mo><mn>1</mn><mo stretchy=\"false\">)</mo><mo stretchy=\"false\">(</mo><mi>n</mi><mo>+</mo><mn>1</mn><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">(m+1)(n+1)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">m</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord\">1</span><span class=\"mclose\">)</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">n</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord\">1</span><span class=\"mclose\">)</span></span></span></span>","key":"yUWHjpiasx"},{"type":"text","value":", which is the total number of points on the grid.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"njXcqCwIXH"}],"key":"lI35qDrqWz"}],"key":"REX2XEIAjV"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2025-01-09T20:35:11.452747Z","iopub.status.busy":"2025-01-09T20:35:11.452586Z","iopub.status.idle":"2025-01-09T20:35:11.454716Z","shell.execute_reply":"2025-01-09T20:35:11.454356Z"}},"children":[{"type":"code","lang":"python","executable":true,"value":"N = len(b)","key":"nDixEKoTnO"},{"type":"output","id":"0Q6pY-pFpDm7bePZ88W5M","data":[],"key":"EeDz5GTXRT"}],"key":"aye2dqVnTn"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"We now use the Boolean array that indicates where the boundary points lie in the grid.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"QdLTigATqe"}],"key":"k39N9MHuyD"}],"key":"ECcHxZBaHK"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2025-01-09T20:35:11.456356Z","iopub.status.busy":"2025-01-09T20:35:11.456201Z","iopub.status.idle":"2025-01-09T20:35:11.565649Z","shell.execute_reply":"2025-01-09T20:35:11.565272Z"}},"children":[{"type":"code","lang":"python","executable":true,"value":"spy(is_boundary)\ntitle(\"Boundary points\");","key":"N38ZPhf6UR"},{"type":"output","id":"9NbYs3GDrXUY_2H7kfONT","data":[{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"a576cc06c3517a98779ee5481905113d","path":"/build/a576cc06c3517a98779ee5481905113d.png"},"text/plain":{"content":"<Figure size 700x400 with 1 Axes>","content_type":"text/plain"}}}],"key":"cQAhXdGoxD"}],"key":"oOCyUaxWwb"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"In order to impose Dirichlet boundary conditions, we replace the boundary rows of the system by rows of the identity.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"EVEaIKMQcu"}],"key":"WT5d1XN1tk"},{"type":"admonition","kind":"tip","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"Tip","key":"oedqFFsfLW"}],"key":"h9tOXIWW7L"},{"type":"paragraph","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"text","value":"Changing rows of a sparse array requires that the operands be in a particular sparse representation called ","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"yYeDxa1cNI"},{"type":"inlineCode","value":"lil","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"AKQCeZHZL9"},{"type":"text","value":". The conversion isn’t done automatically because it can be slow and you are encouraged to avoid it when possible. We’re just trying to keep things conceptually simple here.","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"goOMtfY2GO"}],"key":"z2fj4Hvh1G"}],"class":"dropdown","key":"qrK8U6a4ZI"}],"key":"l1mBAWk4nz"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2025-01-09T20:35:11.567915Z","iopub.status.busy":"2025-01-09T20:35:11.567525Z","iopub.status.idle":"2025-01-09T20:35:11.685409Z","shell.execute_reply":"2025-01-09T20:35:11.684974Z"}},"children":[{"type":"code","lang":"python","executable":true,"value":"I = sp.eye(N, format=\"lil\")\nidx = vec(is_boundary)\nA = A.tolil()\nA[idx, :] = I[idx, :];    # Dirichlet conditions\n\nspy(A)\ntitle(\"Matrix with Dirichlet BC imposed\");","key":"PHAIRnzsD7"},{"type":"output","id":"shl3YN0OQeg0sK0gc8G6N","data":[{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"4c6fc1c49c820f4b1a4d114aa5933ec8","path":"/build/4c6fc1c49c820f4b1a4d114aa5933ec8.png"},"text/plain":{"content":"<Figure size 700x400 with 1 Axes>","content_type":"text/plain"}}}],"key":"UKAu6oBuI7"}],"key":"BScGqAUC2y"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Finally, we must replace the rows in the vector ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"LJQxIHPxt3"},{"type":"inlineMath","value":"\\mathbf{b}","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi mathvariant=\"bold\">b</mi></mrow><annotation encoding=\"application/x-tex\">\\mathbf{b}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6944em;\"></span><span class=\"mord mathbf\">b</span></span></span></span>","key":"ZZaOFVFzym"},{"type":"text","value":" by the boundary values being assigned to the boundary points. Here, we let the boundary values be zero everywhere.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"F4DFLXB3J7"}],"key":"rXDic6kY2l"}],"key":"gWpiUam9yO"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2025-01-09T20:35:11.687293Z","iopub.status.busy":"2025-01-09T20:35:11.687129Z","iopub.status.idle":"2025-01-09T20:35:11.689315Z","shell.execute_reply":"2025-01-09T20:35:11.689002Z"}},"children":[{"type":"code","lang":"python","executable":true,"value":"b[idx] = 0","key":"MWJzNgzlzw"},{"type":"output","id":"SolY7GaD8LguCU0f28DOK","data":[],"key":"MHe5sLq4Hw"}],"key":"cNptB6eCQr"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Now we can solve for ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"EuCreBwCsf"},{"type":"inlineMath","value":"\\mathbf{u}","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi mathvariant=\"bold\">u</mi></mrow><annotation encoding=\"application/x-tex\">\\mathbf{u}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4444em;\"></span><span class=\"mord mathbf\">u</span></span></span></span>","key":"Njhnd7WsRI"},{"type":"text","value":" and reinterpret it as the matrix-shaped ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"dI2FrB4c8L"},{"type":"inlineMath","value":"\\mathbf{U}","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi mathvariant=\"bold\">U</mi></mrow><annotation encoding=\"application/x-tex\">\\mathbf{U}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6861em;\"></span><span class=\"mord mathbf\">U</span></span></span></span>","key":"KCjVC3Dvdb"},{"type":"text","value":", the solution on our grid.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"OClm0a7weE"}],"key":"ivQWmqRVmU"}],"key":"OEemEBXnbD"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2025-01-09T20:35:11.691011Z","iopub.status.busy":"2025-01-09T20:35:11.690814Z","iopub.status.idle":"2025-01-09T20:35:11.695609Z","shell.execute_reply":"2025-01-09T20:35:11.695269Z"}},"children":[{"type":"code","lang":"python","executable":true,"value":"from scipy.sparse.linalg import spsolve\nu = spsolve(A.tocsr(), b)\nU = unvec(u)\nwith printoptions(precision=4, suppress=True):\n    print(U)","key":"RPLknh54Em"},{"type":"output","id":"2KROJ8Qk8HIA47BxUVlbU","data":[{"name":"stdout","output_type":"stream","text":"[[ 0.      0.      0.      0.      0.      0.      0.    ]\n [ 0.     -0.5512 -0.8252 -0.8791 -0.7476 -0.451   0.    ]\n [ 0.     -0.9109 -1.3939 -1.5092 -1.3003 -0.7928  0.    ]\n [ 0.     -1.1788 -1.7957 -1.9513 -1.7021 -1.0607  0.    ]\n [ 0.     -1.1409 -1.6859 -1.8182 -1.6083 -1.0407  0.    ]\n [ 0.      0.      0.      0.      0.      0.      0.    ]]\n"}],"key":"UMuYSPiCdI"}],"key":"m8bLl79GsR"}],"key":"t93ZuCMdLx"},"references":{"cite":{"order":[],"data":{}}},"footer":{"navigation":{"prev":{"title":"Kron","url":"/kron-2","group":"Chapter 13"},"next":{"title":"Poisson","url":"/poisson-2","group":"Chapter 13"}}},"domain":"http://localhost:3000"}